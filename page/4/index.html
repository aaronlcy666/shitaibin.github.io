<!DOCTYPE html>













<html class="theme-next pisces" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">
































<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.6.0" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.6.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png?v=6.6.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png?v=6.6.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.6.0" color="#222">









<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '6.6.0',
    sidebar: {"position":"left","display":"always","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="区块链、Go语言">
<meta name="keywords" content="区块链 Go语言 后端 技术 人生 编程">
<meta property="og:type" content="website">
<meta property="og:title" content="Go语言充电站">
<meta property="og:url" content="http://lessisbetter.site/page/4/index.html">
<meta property="og:site_name" content="Go语言充电站">
<meta property="og:description" content="区块链、Go语言">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Go语言充电站">
<meta name="twitter:description" content="区块链、Go语言">






  <link rel="canonical" href="http://lessisbetter.site/page/4/"/>



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Go语言充电站 – 大彬 less is better</title>
  












  <noscript>
  <style>
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion .logo-line-before i { left: initial; }
    .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Go语言充电站</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">大彬 less is better</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-主页">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br />主页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-标签云">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br />标签云</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-专题文章">

    
    
    
      
    

    

    <a href="/subject/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br />专题文章</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-文章列表">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br />文章列表</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-关于">

    
    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br />关于</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-大牛博客">

    
    
    
      
    

    

    <a href="/blogs/" rel="section"><i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br />大牛博客</a>

  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    
  
  
  
  

  

    <a href="https://github.com/Shitaibin" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" style="fill: #222; color: #fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>



    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://lessisbetter.site/2019/02/27/good-resource-poket/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="大彬">
      <meta itemprop="description" content="区块链、Go语言">
      <meta itemprop="image" content="http://img.lessisbetter.site/gzh-qrcode-logo-small.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Go语言充电站">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/02/27/good-resource-poket/" class="post-title-link" itemprop="url">好文收藏夹</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-02-27 09:43:24" itemprop="dateCreated datePublished" datetime="2019-02-27T09:43:24+08:00">2019-02-27</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-08-15 08:39:49" itemprop="dateModified" datetime="2019-08-15T08:39:49+08:00">2019-08-15</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>这是一个收藏夹，收藏每一篇都仔细阅读过的好文章。</p>
<h2 id="语言"><a href="#语言" class="headerlink" title="语言"></a>语言</h2><h3 id="Go"><a href="#Go" class="headerlink" title="Go"></a>Go</h3><ol>
<li><a href="http://xargin.com/go-timer/" target="_blank" rel="noopener">曹大：Go 系列文章5 : 定时器</a>，相当深刻，学完还讨论了一下</li>
</ol>
<h2 id="分布式"><a href="#分布式" class="headerlink" title="分布式"></a>分布式</h2><h3 id="并发"><a href="#并发" class="headerlink" title="并发"></a>并发</h3><ol>
<li><a href="https://segmentfault.com/a/1190000019360335#articleHeader0" target="_blank" rel="noopener">当我们在谈论高并发的时候究竟在谈什么?</a></li>
</ol>
<h3 id="分布式一致性"><a href="#分布式一致性" class="headerlink" title="分布式一致性"></a>分布式一致性</h3><ol>
<li><a href="https://danielw.cn/network-failure-models" target="_blank" rel="noopener">分布式系统中的网络模型和故障模型</a></li>
<li><a href="https://danielw.cn/history-of-distributed-systems-1" target="_blank" rel="noopener">分布式系统一致性的发展历史 (一)</a></li>
<li><a href="https://danielw.cn/history-of-distributed-systems-2" target="_blank" rel="noopener">分布式系统一致性的发展历史 (二)</a></li>
<li><a href="https://www.codedump.info/post/20180922-etcd-raft/" target="_blank" rel="noopener">etcd Raft库解析</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/51063866" target="_blank" rel="noopener">etcd raft 设计与实现《一》</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/51065416" target="_blank" rel="noopener">etcd raft 设计与实现《二》</a></li>
<li><a href="https://blog.betacat.io/post/raft-implementation-in-etcd/" target="_blank" rel="noopener">Raft在etcd中的实现</a></li>
</ol>
<h2 id="网络"><a href="#网络" class="headerlink" title="网络"></a>网络</h2><h3 id="P2P"><a href="#P2P" class="headerlink" title="P2P"></a>P2P</h3><ol>
<li><a href="https://colobu.com/2018/03/26/distributed-hash-table/" target="_blank" rel="noopener">DHT 分布式哈希表</a></li>
</ol>
<h2 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h2><h3 id="Git"><a href="#Git" class="headerlink" title="Git"></a>Git</h3><ul>
<li>Commit规范：<a href="http://www.ruanyifeng.com/blog/2016/01/commit_message_change_log.html" target="_blank" rel="noopener">Commit message 和 Change log 编写指南</a></li>
<li>commit检查工具：<a href="https://github.com/conventional-changelog/commitlint" target="_blank" rel="noopener">commitlint</a></li>
<li>commit生成relase：<a href="https://github.com/conventional-changelog/conventional-changelog" target="_blank" rel="noopener">conventional-changelog</a></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://lessisbetter.site/2019/02/24/go-law-of-reflect/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="大彬">
      <meta itemprop="description" content="区块链、Go语言">
      <meta itemprop="image" content="http://img.lessisbetter.site/gzh-qrcode-logo-small.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Go语言充电站">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/02/24/go-law-of-reflect/" class="post-title-link" itemprop="url">Go高级实践：反射3定律</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-02-24 18:28:52" itemprop="dateCreated datePublished" datetime="2019-02-24T18:28:52+08:00">2019-02-24</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-08-13 16:18:50" itemprop="dateModified" datetime="2019-08-13T16:18:50+08:00">2019-08-13</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>各位学习Go语言的朋友，周末好，这次跟大家聊一聊Go语言的一个高级话题：反射。</p>
<p>这篇文章是从我过去的学习笔记修改来的，内容主要来自Go Blog的一篇文章《The law of reflection》。</p>
<p><strong>这篇文章主要介绍反射和接口的关系，解释内在的关系和原理</strong>。</p>
<p>反射来自元编程，指通过类型检查变量本身数据结构的方式，只有部分编程语言支持反射。</p>
<h2 id="类型"><a href="#类型" class="headerlink" title="类型"></a>类型</h2><p>反射构建在类型系统之上，Go是静态类型语言，每一个变量都有<strong>静态类型</strong>，在编译时就确定下来了。</p>
<p>比如：<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> MyInt <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> i <span class="keyword">int</span></span><br><span class="line"><span class="keyword">var</span> j MyInt</span><br></pre></td></tr></table></figure></p>
<p>i和j的<strong>底层类型</strong>都是<code>int</code>，但i的静态类型是<code>int</code>，j的静态类型是<code>MyInt</code>，这两个是不同类型，是不能直接赋值的，需要类型强制转换。</p>
<p>接口类型比较特殊，接口类型的变量被多种对象类型赋值，看起来像动态语言的特性，但变量类型始终是接口类型，Go是静态的。举例：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> r io.Reader</span><br><span class="line">r = os.Stdin</span><br><span class="line">r = bufio.NewReader(r)</span><br><span class="line">r = <span class="built_in">new</span>(bytes.Buffer)</span><br><span class="line"><span class="comment">// and so on</span></span><br></pre></td></tr></table></figure>
<p>虽然r被3种类型的变量赋值，但r的类型始终是<code>io.Reader</code>。</p>
<blockquote>
<p>最特别：空接口<code>interface{}</code>的变量可以被任何类型的值赋值，但类型一直都是<code>interface{}</code>。</p>
</blockquote>
<h2 id="接口的表示"><a href="#接口的表示" class="headerlink" title="接口的表示"></a>接口的表示</h2><p>Russ Cox（Go语言创始人）在他的<a href="https://research.swtch.com/2009/12/go-data-structures-interfaces.html" target="_blank" rel="noopener">博客详细介绍了Go语言接口</a>，结论是：</p>
<p>接口类型的变量存储的是<strong>一对数据</strong>：</p>
<ol>
<li>变量实际的值</li>
<li>变量的静态类型</li>
</ol>
<p>例子：<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> r io.Reader</span><br><span class="line">tty, err := os.OpenFile(<span class="string">"/dev/tty"</span>, os.O_RDWR, <span class="number">0</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">&#125;</span><br><span class="line">r = tty</span><br></pre></td></tr></table></figure></p>
<p>r是接口类型变量，保存了<strong>值tty和tty的类型</strong><code>*os.File</code>，所以才能使用<strong>类型断言</strong>判断r保存的值的静态类型：<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> w io.Writer</span><br><span class="line">w = r.(io.Writer)</span><br></pre></td></tr></table></figure></p>
<p>虽然r中包含了tty和它的类型，包含了tty的所有函数，但r是接口类型，决定了r只能调用接口<code>io.Reader</code>中包含的函数。</p>
<p>记住：<strong>接口变量保存的不是接口类型的值，还是英语说起来更方便：Interfaces do not hold interface values.</strong></p>
<h2 id="反射的3条定律"><a href="#反射的3条定律" class="headerlink" title="反射的3条定律"></a>反射的3条定律</h2><h3 id="定律1：从接口值到反射对象"><a href="#定律1：从接口值到反射对象" class="headerlink" title="定律1：从接口值到反射对象"></a>定律1：从接口值到反射对象</h3><p>反射是一种检测存储在接口变量中值和类型的机制。通过<code>reflect</code>包的一些函数，可以把接口转换为反射定义的对象。</p>
<p>掌握<code>reflect</code>包的以下函数：</p>
<ol>
<li><code>reflect.ValueOf({}interface) reflect.Value</code>：获取某个变量的值，但值是通过<code>reflect.Value</code>对象描述的。</li>
<li><code>reflect.TypeOf({}interface) reflect.Type</code>：获取某个变量的静态类型，但值是通过<code>reflect.Type</code>对象描述的，是可以直接使用<code>Println</code>打印的。</li>
<li><code>reflect.Value.Kind() Kind</code>：获取变量值的底层类型（类别），注意不是类型，是Int、Float，还是Struct，还是Slice，<a href="https://golang.org/src/reflect/type.go?s=8302:8316#L217" target="_blank" rel="noopener">具体见此</a>。</li>
<li><code>reflect.Value.Type() reflect.Type</code>：获取变量值的类型，效果等同于<code>reflect.TypeOf</code>。</li>
</ol>
<p>再解释下Kind和Type的区别，比如：<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> MyInt <span class="keyword">int</span></span><br><span class="line"><span class="keyword">var</span> x MyInt = <span class="number">7</span></span><br><span class="line">v := reflect.ValueOf(x)</span><br></pre></td></tr></table></figure></p>
<p>v.Kind()得到的是Int，而Type得到是<code>MyInt</code>。</p>
<h3 id="定律2：从反射对象到接口值"><a href="#定律2：从反射对象到接口值" class="headerlink" title="定律2：从反射对象到接口值"></a>定律2：从反射对象到接口值</h3><p>定律2是定律1的逆向过程，上面我们学了：<code>普通变量 -&gt; 接口变量 -&gt; 反射对象</code>的过程，这是从<code>反射对象 -&gt; 接口变量</code>的过程，使用的是<code>Value</code>的<code>Interface</code>函数，是把实际的值赋值给空接口变量，它的声明如下：<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v Value)</span> <span class="title">Interface</span><span class="params">()</span> <span class="params">(i <span class="keyword">interface</span>&#123;&#125;)</span></span></span><br></pre></td></tr></table></figure></p>
<p>回忆一下：接口变量存储了实际的值和值的类型，<code>Println</code>可以根据接口变量实际存储的类型自动识别其值并打印。</p>
<p>注意事项：如果Value是结构体的非导出字段，调用该函数会导致panic。</p>
<h3 id="定律3：当反射对象所存的值是可设置时，反射对象才可修改"><a href="#定律3：当反射对象所存的值是可设置时，反射对象才可修改" class="headerlink" title="定律3：当反射对象所存的值是可设置时，反射对象才可修改"></a>定律3：当反射对象所存的值是可设置时，反射对象才可修改</h3><p>从定律1入手理解，定律3就不再那么难懂。</p>
<p>Settability is a property of a reflection Value, and not all reflection Values have it.</p>
<p>可设置指的是，可以通过Value设置原始变量的值。</p>
<p>通过函数的例子思考一下可设置：<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f</span><span class="params">(x <span class="keyword">int</span>)</span></span></span><br></pre></td></tr></table></figure></p>
<p>在调用f的时候，传入了参数x，从函数内部修改x的值，外部的变量的值并不会发生改变，因为这种是传值，是拷贝的传递方式。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f</span><span class="params">(p *<span class="keyword">int</span>)</span></span></span><br></pre></td></tr></table></figure>
<p>函数f的入参是指针类型，在函数内部的修改变量的值，函数外部变量的值也会跟着变化。</p>
<p>使用反射也是这个原理，如果创建Value时传递的是变量，则Value是不可设置的。如果创建Value时传递的是变量地址，则Value是可设置的。</p>
<p>可以使用<code>Value.CanSet()</code>检测是否可以通过此Value修改原始变量的值。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">x := <span class="number">10</span></span><br><span class="line">v1 := reflect.ValueOf(x)</span><br><span class="line">fmt.Println(<span class="string">"setable:"</span>, v1.CanSet())</span><br><span class="line">p := reflect.ValueOf(&amp;x)</span><br><span class="line">fmt.Println(<span class="string">"setable:"</span>, p.CanSet())</span><br><span class="line">v2 := p.Elem()</span><br><span class="line">fmt.Println(<span class="string">"setable:"</span>, v2.CanSet())</span><br></pre></td></tr></table></figure>
<p>如何通过Value设置原始对象值呢？</p>
<p><code>Value.SetXXX()</code>系列函数可设置Value中原始对象的值。</p>
<p>系列函数有：</p>
<ul>
<li>Value.SetInt()</li>
<li>Value.SetUint()</li>
<li>Value.SetBool()</li>
<li>Value.SetBytes()</li>
<li>Value.SetFloat()</li>
<li>Value.SetString()</li>
<li>…</li>
</ul>
<p><strong>设置函数这么多，到底该选用哪个Set函数？</strong><br>根据<code>Value.Kind()</code>的结果去获得变量的底层类型，然后选用该类别的Set函数。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ol>
<li><a href="https://blog.golang.org/laws-of-reflection" target="_blank" rel="noopener">https://blog.golang.org/laws-of-reflection</a></li>
</ol>
<blockquote>
<ol>
<li>如果这篇文章对你有帮助，不妨关注下我的Github，有文章会收到通知。</li>
<li>本文作者：<a href="http://lessisbetter.site/about/">大彬</a></li>
<li>如果喜欢本文，随意转载，但请保留此原文链接：<a href="http://lessisbetter.site/2019/02/24/go-law-of-reflect/">http://lessisbetter.site/2019/02/24/go-law-of-reflect/</a></li>
</ol>
</blockquote>
<p><div style="color:#0096FF; text-align:center">关注公众号，获取最新Golang文章</div><br><img src="http://img.lessisbetter.site/2019-01-article_qrcode.jpg" style="border:0" align="center"></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://lessisbetter.site/2019/02/16/book-recommend-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="大彬">
      <meta itemprop="description" content="区块链、Go语言">
      <meta itemprop="image" content="http://img.lessisbetter.site/gzh-qrcode-logo-small.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Go语言充电站">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/02/16/book-recommend-1/" class="post-title-link" itemprop="url">书籍推荐1</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-02-16 21:29:33" itemprop="dateCreated datePublished" datetime="2019-02-16T21:29:33+08:00">2019-02-16</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-08-13 16:18:50" itemprop="dateModified" datetime="2019-08-13T16:18:50+08:00">2019-08-13</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Hi，各位老朋友、新朋友，好久不见，按照之前的规划，本次专题是书籍推荐，主要包含3类：</p>
<ol>
<li>Go语言技术书籍和资料</li>
<li>开发人员综合技能书籍</li>
<li>团队协作书籍</li>
</ol>
<h3 id="Go语言技术书籍和资料"><a href="#Go语言技术书籍和资料" class="headerlink" title="Go语言技术书籍和资料"></a>Go语言技术书籍和资料</h3><p><strong>1.《Effective Go》</strong><br>每一个Golang开发人员都应当把Effective Go多读几篇，它能帮助你理解Go、掌握Go，培养Go思维，用Go的思维去解决问题，而不是利用你已有的编程（C/C++/Java/Python）思维去写Go代码，防止写出蹩脚、笨拙的Go代码。</p>
<p><img src="http://img.lessisbetter.site/2019-02-Effective-go.png" alt=""></p>
<p>你可以从这篇文章中理解：</p>
<ul>
<li>代码格式化</li>
<li>注释</li>
<li>命名</li>
<li>Go语法</li>
</ul>
<p>链接：<a href="https://golang.org/doc/effective_go.html" target="_blank" rel="noopener">https://golang.org/doc/effective_go.html</a></p>
<p><strong>2.《Go语言圣经》</strong><br><img src="http://img.lessisbetter.site/2019-02-go-book.png" alt=""></p>
<p>这是一本很好的Go语言书籍，有中文版并且开源，可以网上阅读或下载PDF。如果你的英文不是特别好，这本书可以帮助你快速入门Go语言。</p>
<p>链接：<a href="https://legacy.gitbook.com/book/yar999/gopl-zh/details" target="_blank" rel="noopener">https://legacy.gitbook.com/book/yar999/gopl-zh/details</a></p>
<p><strong>3. Google</strong></p>
<p>Google即不是书籍也不是资料，但是在查找Golang资料中最有用的工具，并且能找到很好、很有用的Go英文资料。搜索的正确姿势是：“golang topic”，优先看Golang官方（<code>*.golang.org</code>）的资料。比如我要学习reflect相关的知识，我会先看Golang博客的文章：</p>
<p><img src="http://img.lessisbetter.site/2019-02-google-go.png" alt=""></p>
<h3 id="综合技能"><a href="#综合技能" class="headerlink" title="综合技能"></a>综合技能</h3><p><strong>1.《软技能 代码之外的生存指南》</strong><br><img src="http://img.lessisbetter.site/2019-02-soft-skill.png" alt=""></p>
<p><strong>技术之外必读的一本书</strong>，在理财文章推荐提到的，我们作为一个人，需要注重的是全面的发展，不能只关注技术能力的建设。《软技能》从职业篇、自我营销篇、学习篇、生产力篇、理财篇、健身篇、精神篇等7个方面，介绍软件行业从业人员所需的代码之外的技能，以及如何培养。</p>
<p><strong>2.《高效能人士的7个习惯》</strong><br><img src="http://img.lessisbetter.site/2019-02-7-habits.png" alt=""></p>
<p>如果你想在职业发展走的顺利，你必须注重工作效率。这本书的帮助其实不仅仅是工作，而是个人的方方面面都可以得到效率的提升。</p>
<h3 id="团队协作书籍"><a href="#团队协作书籍" class="headerlink" title="团队协作书籍"></a>团队协作书籍</h3><p>除了个人开发者除外，我们大多数技术人都在团队之中，团队合作和生产效率是至关重要的话题。</p>
<p>很多公司的研发流程都采用敏捷，尤其是科技巨头，如果你们已经采用了敏捷，或者即将采用敏捷，我建议好好读下下面这2本书。对于团队，带来的不仅仅是团队效率的提升，还有更高的软件质量、更高的生产力等等，对于个人，你的综合能力能不断提升，在团队中出类拔萃。</p>
<p><strong>《学习敏捷 构建高效团队》</strong><br><img src="http://img.lessisbetter.site/2019-02-learn-agile.png" alt=""></p>
<p>非常好的敏捷入门书籍，带你理解敏捷思维和实践，以及介绍多种敏捷方法，比如Scrum、XP（极限编程）、看板、精益，这些思维，绝对能帮助你成为更出色的工程师，为你如何搭建一支高效的研发团队提供一些思路。</p>
<p><strong>《敏捷革命》</strong><br><img src="http://img.lessisbetter.site/2019-02-agile-revolution.png" alt=""></p>
<p>Scrum是使用最多的敏捷方法，这本书由Scrum敏捷之父编写，这个老头人生经历很牛，西点军校 -&gt; 越战飞行员 -&gt; 学术界 -&gt; 工业界，他从他的经历介绍了Scrum是如何建立起来的， 这本书能帮你更好的理解和运用Scrum。</p>
<p>本次书籍推荐到此结束，感谢阅读。</p>
<blockquote>
<ol>
<li>如果这篇文章对你有帮助，不妨关注下我的Github，有文章会收到通知。</li>
<li>本文作者：<a href="http://lessisbetter.site/about/">大彬</a></li>
<li>如果喜欢本文，随意转载，但请保留此原文链接：<a href="http://lessisbetter.site/2019/02/16/book-recommend-1">http://lessisbetter.site/2019/02/16/book-recommend-1</a></li>
</ol>
</blockquote>
<p><div style="color:#0096FF; text-align:center">关注公众号，获取最新Golang文章</div><br><img src="http://img.lessisbetter.site/2019-01-article_qrcode.jpg" style="border:0" align="center"></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://lessisbetter.site/2019/02/01/ethereum-useful-command-and-flag/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="大彬">
      <meta itemprop="description" content="区块链、Go语言">
      <meta itemprop="image" content="http://img.lessisbetter.site/gzh-qrcode-logo-small.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Go语言充电站">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/02/01/ethereum-useful-command-and-flag/" class="post-title-link" itemprop="url">以太坊有用的命令和标记</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-02-01 14:57:55" itemprop="dateCreated datePublished" datetime="2019-02-01T14:57:55+08:00">2019-02-01</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-08-13 16:18:50" itemprop="dateModified" datetime="2019-08-13T16:18:50+08:00">2019-08-13</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><code>--debug</code>：日志显示文件和行数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">geth --debug --datadir node0 [其他参数]</span><br><span class="line"></span><br><span class="line">INFO [02-01|14:59:47|miner/worker.go:539]              Commit new mining work                   number=1 txs=0 elapsed=628.966µs</span><br></pre></td></tr></table></figure></p>
<p><code>--pprof</code>：节点开启http服务用来显示prof信息，网址和端口可以通过<code>--pprofaddr, --pprofport</code>指定，默认是<code>127.0.0.1:6060</code>。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">geth --pprof --datadir node0 [其他参数]</span><br></pre></td></tr></table></figure></p>
<p>打开网址：<code>http://127.0.0.1:6060/debug/pprof/</code></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://lessisbetter.site/2019/01/27/choose-your-career/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="大彬">
      <meta itemprop="description" content="区块链、Go语言">
      <meta itemprop="image" content="http://img.lessisbetter.site/gzh-qrcode-logo-small.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Go语言充电站">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/01/27/choose-your-career/" class="post-title-link" itemprop="url">未来你是CTO，还是架构师</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-01-27 14:57:12" itemprop="dateCreated datePublished" datetime="2019-01-27T14:57:12+08:00">2019-01-27</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-08-13 16:18:50" itemprop="dateModified" datetime="2019-08-13T16:18:50+08:00">2019-08-13</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>春节就要到了，每到年末就非常适合总结、反思，思考过去一年的成长（就），过去一年的收获，过去一年的改变，所以接下来两三周的时间，我想给大家分享一些技术以外的思考。</p>
<p>这次先跟大家分享关于未来的思考，<strong>职业目标和规划决定了你以后的职业高度、职业角色</strong>，你本来想成架构师、技术VP、CTO，结果就是没有了结果。</p>
<p>后面可能分享理财和读书等方面的思考，因为技术人，首先是一个人，那必然就有生活，生活就需要money，你不理财，最后只能一穷二白，辛辛苦苦一年的劳动，可能所剩无几，甚至负数了，几年后别人过着舒服的生活了，而你还在苦逼的挤公交、地铁。</p>
<p>读书是获取知识最廉价的方式，知识改变命运不是闹着玩的，读大学没用这些言论是扯淡的，你看那些CEO、CTO，或者你身边的非常牛的人，哪个不读书？如果你不喜欢读书，大概是心里没有目标，没有找到自己喜欢的书。</p>
<p>预告到此打住，如果希望读到理财和读书的文章的话，在春节期间，记得关注文章推送，不妨<strong>给一起学Golang加星标</strong>。</p>
<h2 id="技术人有哪些角色-岗位？"><a href="#技术人有哪些角色-岗位？" class="headerlink" title="技术人有哪些角色/岗位？"></a>技术人有哪些角色/岗位？</h2><p>技术人常说自己是靠手艺、靠技术吃饭的，最初只是开发/测试/运维工程师，后面一路打怪升级，经历高级、资深工程师到达首席架构师、技术总监、技术VP、CTO，这些顶级的技术角色，哪些才是你的未来？</p>
<p>如果你热爱技术，愿意靠技术生活，或者立志使用技术改变世界，你可能就会走到上面列出的技术岗位，<strong>你是否想过你的未来在哪？</strong></p>
<p>如果你想到了，你是否了解这些不同岗位的区别，以及需要的能力？</p>
<h2 id="架构师"><a href="#架构师" class="headerlink" title="架构师"></a>架构师</h2><p>架构师是一个公司的核心技术人员，是公司技术团队中的<strong>技术佼佼者</strong>，对架构师主要要求是技术能力。</p>
<p>如果你喜欢深入研究技术，架构师就是你很好的目标。</p>
<h2 id="首席架构师"><a href="#首席架构师" class="headerlink" title="首席架构师"></a>首席架构师</h2><p>首席架构师应当是<strong>公司技术最牛的人</strong>，但同时是公司所有架构师的管理人，需要有<strong>一定的人员管理能力</strong>，所以首席架构师的主要能力栈是：</p>
<ol>
<li>技术能力</li>
<li>人员管理能力</li>
</ol>
<p>如果你深入研究技术，能用技术解决公司遇到的业务难题，还具备一些人员管理能力，不妨在成为架构师后，将目标再提升1个level，成为公司首席架构师。</p>
<h2 id="技术总监"><a href="#技术总监" class="headerlink" title="技术总监"></a>技术总监</h2><p>技术总监这个岗位，一般在大、中公司才有，它是<strong>技术和管理能力比较均衡的1个岗位</strong>，技术上不如某些架构师、首席架构师，但管理能力要比架构师高，它的主要能力栈和架构师相同：</p>
<ol>
<li>技术能力</li>
<li>人员管理能力 </li>
</ol>
<p>如果在技术圈摸爬滚打了一段时间，发现自己擅长沟通、上下级管理、员工心理、决策能力强，也许你的目标可以设定为技术经理或技术总监。</p>
<h2 id="技术VP"><a href="#技术VP" class="headerlink" title="技术VP"></a>技术VP</h2><p>技术VP（副总裁）更是公司规模比较大时才有的技术岗位，技术VP是<strong>CTO的副手</strong>，公司只有1个CTO，但通常有多个技术VP，负责公司不同业务的技术，技术VP管着多个技术总监。技术VP也是技术出身，但比技术总监高一个level，除了技术能力和人员管理能力外，还要求技术VP有很强的体系搭建能力，体系搭建是一个很复杂的能力，总结来讲就是要管事的能力，比如要管理研发质量、进度、节奏、人员等等。</p>
<p>技术总监的主要能力栈：</p>
<ol>
<li>技术能力</li>
<li>人员管理能力 </li>
<li>体系搭建能力</li>
</ol>
<p>如果你发现自己技术够牛，也能带人，还能管事，技术VP绝对会是一个非常好的目标，但是你估计头都大了，怎么要管这么多🙂。</p>
<h2 id="CTO"><a href="#CTO" class="headerlink" title="CTO"></a>CTO</h2><p>只要带O的都很了不起，想想CEO、COO、CFO等等，<strong>CTO是一个公司的直接技术负责人</strong>，出了问题CEO可是要拿CTO是问的，而不是那群技术VP，CTO要和各种O沟通，要让整个技术团队，用技术把产品做出来，跟上业务的脚步。</p>
<p>CTO是个多面手，他的主要能力栈：</p>
<ol>
<li>很强的技术能力，尤其在创业早起，必须撸起袖子带所有人一起干，但是CTO的技术不能是最牛的，公司稳定后，他需要分配更多的精力负责技术团队的各项事务，如果CTO技术是最牛的，他必然是整个技术团队的瓶颈。</li>
<li>很强的体系建设能力，虽然hold的事情没有技术VP细，但各种都抓。</li>
<li>很强的人员管理能力，然每一个技术人员，尤其是技术管理人员发挥十倍、百倍的能力，建设强大的团队。</li>
<li>很强的文化建设能力，公司大了，公司的技术文化，决定了员工在没有管理时的状态，是游手好闲，还是聚焦工作。</li>
<li>很强的领导力，易观CTO郭炜给领导力一个通俗易懂的解释，把事办成的能力，就是从0到1的能力，公司需要的是完整可用的产品，最后只做到了0.99都不是完整的产品。</li>
</ol>
<p>如果你立志要成为一个CTO，那你要充分利用时间，跟时间赛跑，不断的学习/迭代各种能力。</p>
<p>关于领导力，我根据郭炜的描述，做了一个导图，把一个大的、复杂的能力拆解，感觉目标就清晰了。</p>
<p><img src="http://img.lessisbetter.site/2019-01-leadership.png" alt=""><br><em>根据领导力300讲文章《技术领导力就是“成事”的能力》制作</em></p>
<p>也许我上面的文章不一定准确，甚至有些地方不一定对，但这不重要，重要的是你如果还没有职业目标和职业规划，反思一下你是否喜欢技术，是否希望在技术上长期发展？如果答案是肯定的，你应当<strong>为自己负责</strong>，设定一个目标和一个实现目标的计划。</p>
<h2 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h2><p><strong>如何找到自己的兴趣和能力</strong></p>
<p>兴趣、能力和我们的职业目标有什么关系？关系大了去了。你不喜欢coding，就写不出高质量的代码，你不喜欢钻研技术，就成不了架构师，你不喜欢业务，就无法成为技术管理者，你不喜欢“事多”就成不了技术VP、CTO。</p>
<p><strong>基于自己的兴趣和能力，设定最适合自己的目标，这样才能让目标实现</strong>。</p>
<p>But很多人都有一个特（问）点（题），不了解自己。你问他“你喜欢做什么？”，通常哑口无言，啥也说出来。那我教你，如何发现自己的兴趣或者能力。</p>
<p>把下面这几个问题问自己，每个思考5分钟，如果第一个没有答案，就看下一个：</p>
<ol>
<li>我擅长做什么？</li>
<li>我得到表扬的工作是什么？</li>
<li>我最经常做的是什么？</li>
<li>在你过去1年的工作中，我做的最好的3件事是什么？</li>
</ol>
<p>如果第4个还没有答案，我建议你给自己一段时间，了解自己，从今天开始写<strong>成功日记</strong>，每天写一个，记录自己今天做的好的事情，不论工作还是生活。</p>
<p>每月回顾过去的成功日记，其中写的最多的就是你的<strong>特长</strong>，也许你一两个月就发现自己擅长的事情，也许要半年，也许要1年，但终究你能发现自己的能力，那时你会更加自信。</p>
<p><strong>文章不精，希望你有所收获。</strong></p>
<h2 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a>写在最后</h2><p>其实，我对自己的了解还不够深入，这是我必须坦诚的。但我们对自己的了解程度，和对世界的认知，这种“内在”的认知，会通过我们日常的行为<strong>映射</strong>出来，体现在我们的待人接物，同样也会决定着我们人生的高度、工作的高度。</p>
<p>想让自己的思想和视野站上一个更高的高度，我购买了极客时间《技术领导力300讲》这个课程，听、读了很多CEO、CTO等的观点后，想输出下，这篇文章的主要内容是我读郭炜的《你的能力模型决定你的职位》这篇文章“贩卖”出来的，不如原文好，为了避免广告嫌疑，我不在此放分享链接了。<strong>真心想读</strong>的朋友，可以后台私信，我发给你。极客时间分享的文章最多能被10个人阅读，所以只发给前10个留言的朋友。</p>
<blockquote>
<ol>
<li>如果这篇文章对你有帮助，不妨关注下我的Github，有文章会收到通知。</li>
<li>本文作者：<a href="http://lessisbetter.site/about/">大彬</a></li>
<li>如果喜欢本文，随意转载，但请保留此原文链接：<a href="http://lessisbetter.site/2019/01/27/choose-your-career/">http://lessisbetter.site/2019/01/27/choose-your-career/</a></li>
</ol>
</blockquote>
<p><div style="color:#0096FF; text-align:center">关注公众号，获取最新Golang文章</div><br><img src="http://img.lessisbetter.site/2019-01-article_qrcode.jpg" style="border:0" align="center"></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://lessisbetter.site/2019/01/27/blockchain-bussiness/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="大彬">
      <meta itemprop="description" content="区块链、Go语言">
      <meta itemprop="image" content="http://img.lessisbetter.site/gzh-qrcode-logo-small.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Go语言充电站">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/01/27/blockchain-bussiness/" class="post-title-link" itemprop="url">区块链与商业结合：场景+案例</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-01-27 09:30:58" itemprop="dateCreated datePublished" datetime="2019-01-27T09:30:58+08:00">2019-01-27</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-08-13 16:18:50" itemprop="dateModified" datetime="2019-08-13T16:18:50+08:00">2019-08-13</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>我专注区块链技术，让技术为业务服务，在业务应用知识方面还不是行家里手，所以这里只做<strong>文字的搬运工</strong>，具体讲解就得和我们云象合作业务的VNT Chain了，它们把复杂的商业原理，用一篇文章做了通俗易懂的解释，解释了行业痛点，以及如何使用区块链解决痛点，在某些应用场景上，云象已经走在了行业前列，所以文章中也包含云象的案例。</p>
<p>陆续会有很多期，请阅读自己感兴趣的文章：</p>
<ol>
<li><a href="https://mp.weixin.qq.com/s/yJfthwFgiolSVKAkC9uSCA" target="_blank" rel="noopener">区块链+数字版权</a></li>
<li><a href="https://mp.weixin.qq.com/s/J2rpRiaEsl2c0kLWSu4e3Q" target="_blank" rel="noopener">区块链+跨境支付</a></li>
<li><a href="https://mp.weixin.qq.com/s/Yhht-PBLxvl9rRu5RiXuqg" target="_blank" rel="noopener">区块链+供应链金融</a></li>
<li><a href="https://mp.weixin.qq.com/s/TGjDimw9BK7f-KfuDZvJqg" target="_blank" rel="noopener">区块链+信用证</a></li>
<li><a href="https://mp.weixin.qq.com/s/BjnNpnzYgd_Kv6nvaElrfg" target="_blank" rel="noopener">区块链+福费廷</a>，福费廷业务历史久远，银行在国际贸易买卖双方的中间，诸多的不透明因素增加银行的风险，国内多家银行使用区块链重塑了福费廷业务，只有当买卖双方都参与进来，才能更好的塑造基于区块链的福费廷业务</li>
</ol>
<p>云象在区块链上的解决方案有：</p>
<ul>
<li>数字存证</li>
<li>贸易金融</li>
<li>股权交易</li>
<li>发审监管</li>
<li>供应链金融</li>
<li>资产证券化</li>
</ul>
<p>更多内容，请查看<a href="https://www.yunphant.com/solution/securitization" target="_blank" rel="noopener">云象区块链网站</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://lessisbetter.site/2019/01/26/bussiness-abs/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="大彬">
      <meta itemprop="description" content="区块链、Go语言">
      <meta itemprop="image" content="http://img.lessisbetter.site/gzh-qrcode-logo-small.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Go语言充电站">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/01/26/bussiness-abs/" class="post-title-link" itemprop="url">区块链与资产证券化</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-01-26 21:26:11" itemprop="dateCreated datePublished" datetime="2019-01-26T21:26:11+08:00">2019-01-26</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-08-13 16:18:50" itemprop="dateModified" datetime="2019-08-13T16:18:50+08:00">2019-08-13</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>区块链诞生之初就和金融有着某种“天然”的联系，今天就聊一下区块链的一个应用场景：区块链在资产证券化中的利用。</p>
<h1 id="什么是资产证券化？"><a href="#什么是资产证券化？" class="headerlink" title="什么是资产证券化？"></a>什么是资产证券化？</h1><blockquote>
<p>资产证券化是指以基础资产未来所产生的现金流为偿付支持，通过结构化设计进行信用增级，在此基础上发行资产支持证券（Asset-backed Securities, ABS）的过程。</p>
</blockquote>
<p>不了解金融的朋友可能对资产证券化不熟悉，甚至根本没听说过。我就用我的粗浅理解为技术朋友介绍下，先看证券，大家多少对股票、债券多少有些了解，它们都属于证券，是证券中的某一个类别。那什么又是资产呢？通俗的来讲能拿来做抵押的就是资产。用大白话讲资产证券化就是：<strong>贷款人把能产生未来现金流的资产转变为证券换取贷款的融资方式</strong>。</p>
<h1 id="ABS和普通人的关系"><a href="#ABS和普通人的关系" class="headerlink" title="ABS和普通人的关系"></a>ABS和普通人的关系</h1><p>18年这么火的P2P你参与了么？这里也有资产证券化，如果你在P2P平台投了钱，你则是投资人，你在P2P平台借了钱，则是债券人。</p>
<p>还有就是，你租商场的商铺、车位了么？商场把商铺、车位这些作为基础资产，这些资产通过出租等能有稳定的未来收益，然后卖给你，从你手里拿钱，继续去运营，每年给分红，到期买回之类的，虽然没有进行证券化，但总体的原理是一致的，<strong>你清楚里面的流程么？你想想你的身边有没有人买了商铺，最后商场跑路了？</strong>。</p>
<h1 id="资产证券化的流程"><a href="#资产证券化的流程" class="headerlink" title="资产证券化的流程"></a>资产证券化的流程</h1><p>我把资产证券化的流程进行了抽象和简化，实际比这复杂的多，整个过程有：</p>
<ul>
<li>债权人，拥有基础资产，期望获得资金</li>
<li>受托人，不一定是银行，比如P2P公司</li>
<li>投资者，任何手里有闲钱进行投资的人</li>
<li>基础资产，能够产生未来现金流的资产</li>
</ul>
<p>一图胜前言，看下图：</p>
<p><img src="http://img.lessisbetter.site/2019-01-abs.png" alt=""></p>
<p>债权人把基础资产拿出来，向受托人（机构）证明资产是可以产生未来现金流的，受托人也要辨认这个基础资产到底好不好，然后用你好的基础资产发行证券（债券），把证券卖给投资人，说这个资产很好，贷款企业可以按时产生现金流，非常稳定，吹了不少，然后你感觉不错就投资了，资金进了受托人口袋，然后，受托人把钱再带给债权人，从中赚取利息。</p>
<h1 id="资产证券化的问题"><a href="#资产证券化的问题" class="headerlink" title="资产证券化的问题"></a>资产证券化的问题</h1><p>如果投过P2P，相信大家一定不会忘记2018年P2P的炸雷，这其中暗藏着许多风险，根本就不是普通投资者能看到的：</p>
<ol>
<li>贷款企业信用是否良好？怎么证明？基础资产是否真实？能否产生稳定的现金流？</li>
<li>担保企业信用等级如何，如果贷款企业不能还款，担保企业能不能还款？</li>
<li>受托机构信用等级好不好？资产的评级是否准确、合理？这其中有没有猫腻？</li>
<li>……</li>
</ol>
<p>问题再归类：</p>
<ol>
<li>信用问题</li>
<li>透明问题</li>
<li>真实性问题</li>
<li>……</li>
</ol>
<p><strong>不易监管，问题积累，增加风险，导致暴雷，所以政府说了，我们要稳金融，稳金融就得控制风险</strong>。</p>
<h1 id="资产证券化牵手区块链"><a href="#资产证券化牵手区块链" class="headerlink" title="资产证券化牵手区块链"></a>资产证券化牵手区块链</h1><p>作为一个技术人，我们虽然无力直接参与稳金融，但是，我们可以从技术角度思考下，是不是又解决、优化的办法呢？</p>
<p><strong>区块链有去中心化、去信任、不可篡改、可靠的特性，可以解决当前ABS的一些问题</strong>，比如：</p>
<ol>
<li>使用区块链放篡改和溯源的能力，解决信任问题、基础资产虚假有效的问题</li>
<li>使用使用区块链可以连接参与ABS的多方主体，提高信息共享，提升业务效率</li>
<li>区块链的透明对于国家监管也特别有利</li>
<li>资金流动的地方就有清算，各ABS参与方很容易通过区块链进行清算</li>
</ol>
<h1 id="云象区块链资产证券化解决方案"><a href="#云象区块链资产证券化解决方案" class="headerlink" title="云象区块链资产证券化解决方案"></a>云象区块链资产证券化解决方案</h1><p>云象区块链作为区块链行业的领先者，依托多年的区块链技术积累，推出了<strong>云象区块链ABS解决方案，目标是通过价值互联网盘活基础资产</strong>，基于区块链技术建立标准的数据流转体系、协同方式和披露办法，提高资产端与资金端对接效率，帮助投资者穿透基础资产和回款状态，对盘活基础资产具有十分重要的意义。</p>
<p><a href="https://www.yunphant.com/solution/securitization" target="_blank" rel="noopener">想了解云象区块链ABS解决方案？戳这里！</a></p>
<blockquote>
<p>技术人讲业务，难免有不准确的地方，如果不对请重喷！</p>
</blockquote>
<h2 id="扩展阅读"><a href="#扩展阅读" class="headerlink" title="扩展阅读"></a>扩展阅读</h2><p><a href="https://mp.weixin.qq.com/s/9P3hcbQHdWOnyVgr9VpzMw" target="_blank" rel="noopener">如何用“区块链+稳定币”技术来提升资产证券化市场运作效率</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://lessisbetter.site/2019/01/23/why-pbft-using-3f-plus-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="大彬">
      <meta itemprop="description" content="区块链、Go语言">
      <meta itemprop="image" content="http://img.lessisbetter.site/gzh-qrcode-logo-small.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Go语言充电站">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/01/23/why-pbft-using-3f-plus-1/" class="post-title-link" itemprop="url">为什么PBFT的节点数量是3f+1?</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-01-23 17:15:06" itemprop="dateCreated datePublished" datetime="2019-01-23T17:15:06+08:00">2019-01-23</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-08-13 16:18:50" itemprop="dateModified" datetime="2019-08-13T16:18:50+08:00">2019-08-13</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>问题：为什么PBFT的节点数量是3f+1?</p>
<p>pbft的论文提到这样<strong>2</strong>段话，可以很好的解决这个问题：</p>
<p><img src="http://img.lessisbetter.site/2019-02-pbft-paper1.png" alt=""><br><em>page3</em></p>
<p><strong>在存在f个faulty节点的情况下，<code>3f+1</code>是保证系统安全性和活跃性的最小的总节点数量</strong>。当存在f个节点不响应的情况下，需要<code>n-f</code>个正常节点达成共识需要保障<code>n-f &gt; f</code>。另外一种情况：f个响应的节点是错误的（响应错误数据），f个节点没有响应，但他们不是faulty的，所以要保证<code>好的响应的节点 - 好的未响应的节点 - 坏的响应的节点 &gt; 坏的节点</code>，即需要<code>n - f -f &gt; f</code>，<code>n &gt; 3f</code>。但n只能是整数，所以<code>n &gt;= 3f + 1</code>。</p>
<p><img src="http://img.lessisbetter.site/2019-02-pbft-paper2.png" alt=""><br><em>page3</em></p>
<p>副本节点的数量设为<code>R</code>，为了<strong>简便</strong>使<code>R = 3f + 1</code>。尽管存在副本节点数量多于<code>3f+1</code>的情况，比如<code>3f+2, 3f+3</code>，<strong>但多出来的节点没有带来任何改善，反而降低了系统的性能，因为需要更多的通信量</strong>。</p>
<p>为什么这样说呢？</p>
<p><code>3f+2, 3f+3</code>的实际能容错的节点数量与<code>3f+1</code>是相同的，即只能容忍<code>f</code>个faulty的节点。</p>
<p>根据论文，当<code>n = 3f+1</code>时，</p>
<ul>
<li>在Prepare进入Commit阶段，需要<code>2f</code>个Prepare消息，即需要<code>n - 1 - f</code>条Prepare消息。</li>
<li>在Commit阶段完成，需要<code>2f+1</code>条Commit消息，即需要<code>n - f</code>条Commit消息。</li>
</ul>
<p>请思考，当<code>n = 3f+2</code>时，</p>
<ul>
<li>在Prepare进入Commit阶段，需要<code>n - 1 - f</code>个Prepare消息，即<code>2f+1</code>需要条Prepare消息。</li>
<li>在Commit阶段完成，需要<code>n - 1 - f</code>条Commit消息，即需要<code>2f+1</code>条Commit消息。</li>
</ul>
<blockquote>
<ol>
<li>如果这篇文章对你有帮助，不妨关注下我的Github，有文章会收到通知。</li>
<li>本文作者：<a href="http://lessisbetter.site/about/">大彬</a></li>
<li>如果喜欢本文，随意转载，但请保留此原文链接：<a href="http://lessisbetter.site/2019/01/23/why-pbft-using-3f-plus-1/">http://lessisbetter.site/2019/01/23/why-pbft-using-3f-plus-1/</a></li>
</ol>
</blockquote>
<p><div style="color:#0096FF; text-align:center">关注公众号，获取最新Golang文章</div><br><img src="http://img.lessisbetter.site/2019-01-article_qrcode.jpg" style="border:0" align="center"></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://lessisbetter.site/2019/01/20/golang-channel-all-usage/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="大彬">
      <meta itemprop="description" content="区块链、Go语言">
      <meta itemprop="image" content="http://img.lessisbetter.site/gzh-qrcode-logo-small.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Go语言充电站">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/01/20/golang-channel-all-usage/" class="post-title-link" itemprop="url">总结了才知道，原来channel有这么多用法！</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-01-20 19:44:28" itemprop="dateCreated datePublished" datetime="2019-01-20T19:44:28+08:00">2019-01-20</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-08-13 16:18:50" itemprop="dateModified" datetime="2019-08-13T16:18:50+08:00">2019-08-13</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>这篇文章总结了channel的11种常用操作，以一个更高的视角看待channel，会给大家带来对channel更全面的认识。</p>
<p>在介绍11种操作前，先简要介绍下channel的使用场景、基本操作和注意事项。</p>
<h2 id="channel的使用场景"><a href="#channel的使用场景" class="headerlink" title="channel的使用场景"></a>channel的使用场景</h2><p>把channel用在<strong>数据流动的地方</strong>：</p>
<ol>
<li>消息传递、消息过滤</li>
<li>信号广播</li>
<li>事件订阅与广播</li>
<li>请求、响应转发</li>
<li>任务分发</li>
<li>结果汇总</li>
<li>并发控制</li>
<li>同步与异步</li>
<li>…</li>
</ol>
<h2 id="channel的基本操作和注意事项"><a href="#channel的基本操作和注意事项" class="headerlink" title="channel的基本操作和注意事项"></a>channel的基本操作和注意事项</h2><p>channel存在<code>3种状态</code>：</p>
<ol>
<li>nil，未初始化的状态，只进行了声明，或者手动赋值为<code>nil</code></li>
<li>active，正常的channel，可读或者可写</li>
<li>closed，已关闭，<strong>千万不要误认为关闭channel后，channel的值是nil</strong></li>
</ol>
<p>channel可进行<code>3种操作</code>：</p>
<ol>
<li>读</li>
<li>写</li>
<li>关闭</li>
</ol>
<p>把这3种操作和3种channel状态可以组合出<code>9种情况</code>：</p>
<table>
<thead>
<tr>
<th>操作</th>
<th>nil的channel</th>
<th>正常channel</th>
<th>已关闭channel</th>
</tr>
</thead>
<tbody>
<tr>
<td>&lt;- ch</td>
<td>阻塞</td>
<td>成功或阻塞</td>
<td>读到零值</td>
</tr>
<tr>
<td>ch &lt;-</td>
<td>阻塞</td>
<td>成功或阻塞</td>
<td>panic</td>
</tr>
<tr>
<td>close(ch)</td>
<td>panic</td>
<td>成功</td>
<td>panic</td>
</tr>
</tbody>
</table>
<p>对于nil通道的情况，也并非完全遵循上表，<strong>有1个特殊场景</strong>：当<code>nil</code>的通道在<code>select</code>的某个<code>case</code>中时，这个case会阻塞，但不会造成死锁。</p>
<p><em>参考代码请看：<a href="https://dave.cheney.net/2014/03/19/channel-axioms" target="_blank" rel="noopener">https://dave.cheney.net/2014/03/19/channel-axioms</a></em></p>
<p>下面介绍使用channel的10种常用操作。</p>
<h2 id="1-使用for-range读channel"><a href="#1-使用for-range读channel" class="headerlink" title="1. 使用for range读channel"></a>1. 使用for range读channel</h2><h3 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h3><p>当需要不断从channel读取数据时。</p>
<h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p>使用<code>for-range</code>读取channel，这样既安全又便利，当channel关闭时，for循环会自动退出，无需主动监测channel是否关闭，可以防止读取已经关闭的channel，造成读到数据为通道所存储的数据类型的零值。</p>
<h3 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> x := <span class="keyword">range</span> ch&#123;</span><br><span class="line">    fmt.Println(x)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="2-使用v-ok-lt-ch-select操作判断channel是否关闭"><a href="#2-使用v-ok-lt-ch-select操作判断channel是否关闭" class="headerlink" title="2. 使用v,ok := &lt;-ch + select操作判断channel是否关闭"></a>2. 使用<code>v,ok := &lt;-ch</code> + <code>select</code>操作判断channel是否关闭</h2><h3 id="场景-1"><a href="#场景-1" class="headerlink" title="场景"></a>场景</h3><p><code>v,ok := &lt;-ch</code> + <code>select</code>操作判断channel是否关闭</p>
<h3 id="原理-1"><a href="#原理-1" class="headerlink" title="原理"></a>原理</h3><p>ok的结果和含义：</p>
<pre><code>- `true`：读到通道数据，不确定是否关闭，可能channel还有保存的数据，但channel已关闭。
- `false`：通道关闭，无数据读到。
</code></pre><p>从关闭的channel读值读到是channel所传递数据类型的零值，这个零值有可能是发送者发送的，也可能是channel关闭了。</p>
<p><code>_, ok := &lt;-ch</code>与select配合使用的，当ok为false时，代表了channel已经close。下面解释原因，<code>_,ok := &lt;-ch</code>对应的函数是<code>func chanrecv(c *hchan, ep unsafe.Pointer, block bool) (selected, received bool)</code>，入参block含义是当前goroutine是否可阻塞，当block为false代表的是select操作，不可阻塞当前goroutine的在channel操作，否则是普通操作（即<code>_, ok</code>不在select中）。返回值selected代表当前操作是否成功，主要为select服务，返回<strong>received代表是否从channel读到有效值</strong>。它有3种返回值情况：</p>
<ol>
<li>block为false，即执行select时，如果channel为空，返回(false,false)，代表select操作失败，没接收到值。</li>
<li>否则，如果channel已经关闭，并且没有数据，ep即接收数据的变量设置为零值，返回(true,false)，代表select操作成功，但channel已关闭，没读到有效值。</li>
<li>否则，其他读到有效数据的情况，返回(true,ture)。</li>
</ol>
<p>我们考虑<code>_, ok := &lt;-ch</code>和<code>select</code>结合使用的情况。</p>
<p>情况1：当chanrecv返回(false,false)时，本质是select操作失败了，所以相关的case会阻塞，不会执行，比如下面的代码：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br><span class="line">	<span class="keyword">select</span> &#123;</span><br><span class="line">	<span class="keyword">case</span> v, ok := &lt;-ch:</span><br><span class="line">		fmt.Printf(<span class="string">"v: %v, ok: %v\n"</span>, v, ok)</span><br><span class="line">	<span class="keyword">default</span>:</span><br><span class="line">		fmt.Println(<span class="string">"nothing"</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 结果：</span></span><br><span class="line"><span class="comment">// nothing</span></span><br></pre></td></tr></table></figure>
<p>情况2：下面的结果会是零值和false：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 增加关闭</span></span><br><span class="line">	<span class="built_in">close</span>(ch)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">select</span> &#123;</span><br><span class="line">	<span class="keyword">case</span> v, ok := &lt;-ch:</span><br><span class="line">		fmt.Printf(<span class="string">"v: %v, ok: %v\n"</span>, v, ok)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// v: 0, ok: false</span></span><br></pre></td></tr></table></figure>
<p>情况3的<code>received</code>为true，即<code>_, ok</code>中的<code>ok</code>为true，不做讨论了，只讨论<code>ok</code>为false的情况。</p>
<p>最后<code>ok</code>为false的时候，只有情况2，此时channel必然已经关闭，我们便可以在<code>select</code>中用<code>ok</code>判断channel是否已经关闭。</p>
<h3 id="用法-1"><a href="#用法-1" class="headerlink" title="用法"></a>用法</h3><p>下面例子展示了，向channel写数据然后关闭，依然可以从已关闭channel读到有效数据，但channel关闭且没有数据时，读不到有效数据，ok为false，可以确定当前channel已关闭。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// demo_select6.go</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 发送1个数据关闭channel</span></span><br><span class="line">	ch &lt;- <span class="number">1</span></span><br><span class="line">	<span class="built_in">close</span>(ch)</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">"close channel\n"</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 不停读数据直到channel没有有效数据</span></span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		<span class="keyword">select</span> &#123;</span><br><span class="line">		<span class="keyword">case</span> v, ok := &lt;-ch:</span><br><span class="line">			<span class="built_in">print</span>(<span class="string">"v: "</span>, v, <span class="string">", ok:"</span>, ok, <span class="string">"\n"</span>)</span><br><span class="line">			<span class="keyword">if</span> !ok &#123;</span><br><span class="line">				<span class="built_in">print</span>(<span class="string">"channel is close\n"</span>)</span><br><span class="line">				<span class="keyword">return</span></span><br><span class="line">			&#125;	</span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			<span class="built_in">print</span>(<span class="string">"nothing\n"</span>)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 结果</span></span><br><span class="line"><span class="comment">// close channel</span></span><br><span class="line"><span class="comment">// v: 1, ok:true</span></span><br><span class="line"><span class="comment">// v: 0, ok:false</span></span><br><span class="line"><span class="comment">// channel is close</span></span><br></pre></td></tr></table></figure>
<p>更多见<a href="https://github.com/Shitaibin/golang_step_by_step/tree/master/channel/ok" target="_blank" rel="noopener">golang_step_by_step/channel/ok</a>仓库中ok和select的示例，或者阅读channel源码。</p>
<h2 id="3-使用select处理多个channel"><a href="#3-使用select处理多个channel" class="headerlink" title="3. 使用select处理多个channel"></a>3. 使用select处理多个channel</h2><h3 id="场景-2"><a href="#场景-2" class="headerlink" title="场景"></a>场景</h3><p>需要对多个通道进行同时处理，但只处理最先发生的channel时</p>
<h3 id="原理-2"><a href="#原理-2" class="headerlink" title="原理"></a>原理</h3><p><code>select</code>可以同时监控多个通道的情况，只处理未阻塞的case。<strong>当通道为nil时，对应的case永远为阻塞，无论读写。特殊关注：普通情况下，对nil的通道写操作是要panic的</strong>。</p>
<h3 id="用法-2"><a href="#用法-2" class="headerlink" title="用法"></a>用法</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 分配job时，如果收到关闭的通知则退出，不分配job</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *Handler)</span> <span class="title">handle</span><span class="params">(job *Job)</span></span> &#123;</span><br><span class="line">    <span class="keyword">select</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> h.jobCh&lt;-job:</span><br><span class="line">        <span class="keyword">return</span> </span><br><span class="line">    <span class="keyword">case</span> &lt;-h.stopCh:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="4-使用channel的声明控制读写权限"><a href="#4-使用channel的声明控制读写权限" class="headerlink" title="4. 使用channel的声明控制读写权限"></a>4. 使用channel的声明控制读写权限</h2><h3 id="场景-3"><a href="#场景-3" class="headerlink" title="场景"></a>场景</h3><p>协程对某个通道只读或只写时</p>
<p>目的：</p>
<ol>
<li>使代码更易读、更易维护，</li>
<li>防止只读协程对通道进行写数据，但通道已关闭，造成panic。</li>
</ol>
<h3 id="用法-3"><a href="#用法-3" class="headerlink" title="用法"></a>用法</h3><ul>
<li>如果协程对某个channel只有写操作，则这个channel声明为只写。</li>
<li>如果协程对某个channel只有读操作，则这个channe声明为只读。</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 只有generator进行对outCh进行写操作，返回声明</span></span><br><span class="line"><span class="comment">// &lt;-chan int，可以防止其他协程乱用此通道，造成隐藏bug</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">generator</span><span class="params">(<span class="keyword">int</span> n)</span> &lt;-<span class="title">chan</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    outCh := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span> i:=<span class="number">0</span>;i&lt;n;i++&#123;</span><br><span class="line">            outCh&lt;-i</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;()</span><br><span class="line">    <span class="keyword">return</span> outCh</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// consumer只读inCh的数据，声明为&lt;-chan int</span></span><br><span class="line"><span class="comment">// 可以防止它向inCh写数据</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">consumer</span><span class="params">(inCh &lt;-<span class="keyword">chan</span> <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> x := <span class="keyword">range</span> inCh &#123;</span><br><span class="line">        fmt.Println(x)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="5-使用缓冲channel增强并发"><a href="#5-使用缓冲channel增强并发" class="headerlink" title="5. 使用缓冲channel增强并发"></a>5. 使用缓冲channel增强并发</h2><h3 id="场景-4"><a href="#场景-4" class="headerlink" title="场景"></a>场景</h3><p>异步</p>
<h3 id="原理-3"><a href="#原理-3" class="headerlink" title="原理"></a>原理</h3><p>有缓冲通道可供多个协程同时处理，在一定程度可提高并发性。</p>
<h3 id="用法-4"><a href="#用法-4" class="headerlink" title="用法"></a>用法</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 无缓冲</span></span><br><span class="line">ch1 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br><span class="line">ch2 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">0</span>)</span><br><span class="line"><span class="comment">// 有缓冲</span></span><br><span class="line">ch3 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用5个`do`协程同时处理输入数据</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">()</span></span> &#123;</span><br><span class="line">    inCh := generator(<span class="number">100</span>)</span><br><span class="line">    outCh := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5</span>; i++ &#123;</span><br><span class="line">        <span class="keyword">go</span> do(inCh, outCh)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> r := <span class="keyword">range</span> outCh &#123;</span><br><span class="line">        fmt.Println(r)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">do</span><span class="params">(inCh &lt;-<span class="keyword">chan</span> <span class="keyword">int</span>, outCh <span class="keyword">chan</span>&lt;- <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> v := <span class="keyword">range</span> inCh &#123;</span><br><span class="line">        outCh &lt;- v * v</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="6-为操作加上超时"><a href="#6-为操作加上超时" class="headerlink" title="6. 为操作加上超时"></a>6. 为操作加上超时</h2><h3 id="场景-5"><a href="#场景-5" class="headerlink" title="场景"></a>场景</h3><p>需要超时控制的操作</p>
<h3 id="原理-4"><a href="#原理-4" class="headerlink" title="原理"></a>原理</h3><p>使用<code>select</code>和<code>time.After</code>，看操作和定时器哪个先返回，处理先完成的，就达到了超时控制的效果</p>
<h3 id="用法-5"><a href="#用法-5" class="headerlink" title="用法"></a>用法</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">doWithTimeOut</span><span class="params">(timeout time.Duration)</span> <span class="params">(<span class="keyword">int</span>, error)</span></span> &#123;</span><br><span class="line">	<span class="keyword">select</span> &#123;</span><br><span class="line">	<span class="keyword">case</span> ret := &lt;-do():</span><br><span class="line">		<span class="keyword">return</span> ret, <span class="literal">nil</span></span><br><span class="line">	<span class="keyword">case</span> &lt;-time.After(timeout):</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>, errors.New(<span class="string">"timeout"</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">do</span><span class="params">()</span> &lt;-<span class="title">chan</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	outCh := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		<span class="comment">// do work</span></span><br><span class="line">	&#125;()</span><br><span class="line">	<span class="keyword">return</span> outCh</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="7-使用time实现channel无阻塞读写"><a href="#7-使用time实现channel无阻塞读写" class="headerlink" title="7. 使用time实现channel无阻塞读写"></a>7. 使用time实现channel无阻塞读写</h2><h3 id="场景-6"><a href="#场景-6" class="headerlink" title="场景"></a>场景</h3><p>并不希望在channel的读写上浪费时间</p>
<h3 id="原理-5"><a href="#原理-5" class="headerlink" title="原理"></a>原理</h3><p>是为操作加上超时的扩展，这里的操作是channel的读或写</p>
<h3 id="用法-6"><a href="#用法-6" class="headerlink" title="用法"></a>用法</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">unBlockRead</span><span class="params">(ch <span class="keyword">chan</span> <span class="keyword">int</span>)</span> <span class="params">(x <span class="keyword">int</span>, err error)</span></span> &#123;</span><br><span class="line">	<span class="keyword">select</span> &#123;</span><br><span class="line">	<span class="keyword">case</span> x = &lt;-ch:</span><br><span class="line">		<span class="keyword">return</span> x, <span class="literal">nil</span></span><br><span class="line">	<span class="keyword">case</span> &lt;-time.After(time.Microsecond):</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>, errors.New(<span class="string">"read time out"</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">unBlockWrite</span><span class="params">(ch <span class="keyword">chan</span> <span class="keyword">int</span>, x <span class="keyword">int</span>)</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line">	<span class="keyword">select</span> &#123;</span><br><span class="line">	<span class="keyword">case</span> ch &lt;- x:</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">	<span class="keyword">case</span> &lt;-time.After(time.Microsecond):</span><br><span class="line">		<span class="keyword">return</span> errors.New(<span class="string">"read time out"</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><em>注：time.After等待可以替换为default，则是channel阻塞时，立即返回的效果</em></p>
<h2 id="8-使用close-ch-关闭所有下游协程"><a href="#8-使用close-ch-关闭所有下游协程" class="headerlink" title="8. 使用close(ch)关闭所有下游协程"></a>8. 使用<code>close(ch)</code>关闭所有下游协程</h2><h3 id="场景-7"><a href="#场景-7" class="headerlink" title="场景"></a>场景</h3><p>退出时，显示通知所有协程退出</p>
<h3 id="原理-6"><a href="#原理-6" class="headerlink" title="原理"></a>原理</h3><p>所有读<code>ch</code>的协程都会收到<code>close(ch)</code>的信号</p>
<h3 id="用法-7"><a href="#用法-7" class="headerlink" title="用法"></a>用法</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *Handler)</span> <span class="title">Stop</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="built_in">close</span>(h.stopCh)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 可以使用WaitGroup等待所有协程退出</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 收到停止后，不再处理请求</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *Handler)</span> <span class="title">loop</span><span class="params">()</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> &#123;</span><br><span class="line">        <span class="keyword">select</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> req := &lt;-h.reqCh:</span><br><span class="line">            <span class="keyword">go</span> handle(req)</span><br><span class="line">        <span class="keyword">case</span> &lt;-h.stopCh:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="9-使用chan-struct-作为信号channel"><a href="#9-使用chan-struct-作为信号channel" class="headerlink" title="9. 使用chan struct{}作为信号channel"></a>9. 使用<code>chan struct{}</code>作为信号channel</h2><h3 id="场景-8"><a href="#场景-8" class="headerlink" title="场景"></a>场景</h3><p>使用channel传递信号，而不是传递数据时</p>
<h3 id="原理-7"><a href="#原理-7" class="headerlink" title="原理"></a>原理</h3><p>没数据需要传递时，传递空struct</p>
<h3 id="用法-8"><a href="#用法-8" class="headerlink" title="用法"></a>用法</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 上例中的Handler.stopCh就是一个例子，stopCh并不需要传递任何数据</span></span><br><span class="line"><span class="comment">// 只是要给所有协程发送退出的信号</span></span><br><span class="line"><span class="keyword">type</span> Handler <span class="keyword">struct</span> &#123;</span><br><span class="line">    stopCh <span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line">    reqCh <span class="keyword">chan</span> *Request</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="10-使用channel传递结构体的指针而非结构体"><a href="#10-使用channel传递结构体的指针而非结构体" class="headerlink" title="10. 使用channel传递结构体的指针而非结构体"></a>10. 使用channel传递结构体的指针而非结构体</h2><h3 id="场景-9"><a href="#场景-9" class="headerlink" title="场景"></a>场景</h3><p>使用channel传递结构体数据时</p>
<h3 id="原理-8"><a href="#原理-8" class="headerlink" title="原理"></a>原理</h3><p><strong>channel本质上传递的是数据的拷贝，拷贝的数据越小传输效率越高，传递结构体指针，比传递结构体更高效</strong></p>
<h3 id="用法-9"><a href="#用法-9" class="headerlink" title="用法"></a>用法</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">reqCh <span class="keyword">chan</span> *Request</span><br><span class="line"></span><br><span class="line"><span class="comment">// 好过</span></span><br><span class="line">reqCh <span class="keyword">chan</span> Request</span><br></pre></td></tr></table></figure>
<h2 id="11-使用channel传递channel"><a href="#11-使用channel传递channel" class="headerlink" title="11. 使用channel传递channel"></a>11. 使用channel传递channel</h2><h3 id="场景-10"><a href="#场景-10" class="headerlink" title="场景"></a>场景</h3><p>使用场景有点多，通常是用来获取结果。</p>
<h3 id="原理-9"><a href="#原理-9" class="headerlink" title="原理"></a>原理</h3><p>channel可以用来传递变量，channel自身也是变量，可以传递自己。</p>
<h3 id="用法-10"><a href="#用法-10" class="headerlink" title="用法"></a>用法</h3><p>下面示例展示了有序展示请求的结果，另一个示例可以见<a href="http://lessisbetter.site/2019/06/09/golang-first-class-function/#%E7%89%88%E6%9C%AC3">另外文章的版本3</a>。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"math/rand"</span></span><br><span class="line">	<span class="string">"sync"</span></span><br><span class="line">	<span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	reqs := []<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 存放结果的channel的channel</span></span><br><span class="line">	outs := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">chan</span> <span class="keyword">int</span>, <span class="built_in">len</span>(reqs))</span><br><span class="line">	<span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line">	wg.Add(<span class="built_in">len</span>(reqs))</span><br><span class="line">	<span class="keyword">for</span> _, x := <span class="keyword">range</span> reqs &#123;</span><br><span class="line">		o := handle(&amp;wg, x)</span><br><span class="line">		outs &lt;- o</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		wg.Wait()</span><br><span class="line">		<span class="built_in">close</span>(outs)</span><br><span class="line">	&#125;()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 读取结果，结果有序</span></span><br><span class="line">	<span class="keyword">for</span> o := <span class="keyword">range</span> outs &#123;</span><br><span class="line">		fmt.Println(&lt;-o)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// handle 处理请求，耗时随机模拟</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">handle</span><span class="params">(wg *sync.WaitGroup, a <span class="keyword">int</span>)</span> <span class="title">chan</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	out := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		time.Sleep(time.Duration(rand.Intn(<span class="number">3</span>)) * time.Second)</span><br><span class="line">		out &lt;- a</span><br><span class="line">		wg.Done()</span><br><span class="line">	&#125;()</span><br><span class="line">	<span class="keyword">return</span> out</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="推荐阅读"><a href="#推荐阅读" class="headerlink" title="推荐阅读"></a>推荐阅读</h2><p>本文介绍的channel特性，大多在过去的文章中已详细介绍，可按需求阅读。</p>
<ol>
<li><a href="https://mp.weixin.qq.com/s/RjomKnfwCTy7tC9gbpPxCQ" target="_blank" rel="noopener">Golang并发模型：并发协程的优雅退出</a></li>
<li><a href="https://mp.weixin.qq.com/s/ACh-TGlPo72r4e6pbh52vg" target="_blank" rel="noopener">Golang并发模型：轻松入门select</a></li>
<li><a href="https://mp.weixin.qq.com/s/ZfBcxvqiyks_s7cAD-zGCw" target="_blank" rel="noopener">Golang并发模型：select进阶</a></li>
<li><a href="https://mp.weixin.qq.com/s/fINhzg3eNi9YFi5qZ_JzGA" target="_blank" rel="noopener">Golang并发模型：轻松入门协程池</a></li>
<li><a href="https://mp.weixin.qq.com/s/JcED2qgJEj8LaBckVZBhDA" target="_blank" rel="noopener">Golang并发模型：再也不愁选channel还是选锁</a></li>
</ol>
<blockquote>
<ol>
<li>如果这篇文章对你有帮助，不妨关注下我的Github，有文章会收到通知。</li>
<li>本文作者：<a href="http://lessisbetter.site/about/">大彬</a></li>
<li>如果喜欢本文，随意转载，但请保留此原文链接：<a href="http://lessisbetter.site/2019/01/20/golang-channel-all-usage/">http://lessisbetter.site/2019/01/20/golang-channel-all-usage/</a></li>
</ol>
</blockquote>
<div style="text-align:center">关注公众号，获取最新Golang文章。</div><br><img src="http://img.lessisbetter.site/2019-01-article_qrcode.jpg" style="border:0" align="center"><br><div style="color:#0096FF; text-align:center">一起学Golang-分享有料的Go语言技术</div>
          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://lessisbetter.site/2019/01/14/golang-channel-and-mutex/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="大彬">
      <meta itemprop="description" content="区块链、Go语言">
      <meta itemprop="image" content="http://img.lessisbetter.site/gzh-qrcode-logo-small.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Go语言充电站">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/01/14/golang-channel-and-mutex/" class="post-title-link" itemprop="url">Golang并发：再也不愁选channel还是选锁</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-01-14 21:43:41" itemprop="dateCreated datePublished" datetime="2019-01-14T21:43:41+08:00">2019-01-14</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-08-13 16:18:50" itemprop="dateModified" datetime="2019-08-13T16:18:50+08:00">2019-08-13</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>周末又到了，为大家准备了一份实用干货：如何使用channel和Mutex解决并发问题，利用周末的好时光，配上音乐，思考一下吧🤔。</p>
<p>来，问自己个问题：<strong>面对并发问题，是用channel解决，还是用Mutex解决</strong>？</p>
<p>如果自己心里还没有清晰的答案，那就读下这篇文章，你会了解到：</p>
<ul>
<li>使用channel解决并发问题的核心思路和示例</li>
<li>channel擅长解决什么样的并发问题，Mutex擅长解决什么样的并发问题</li>
<li>一个并发问题该怎么入手解解决</li>
<li>一个重要的plus思维</li>
</ul>
<h3 id="前戏"><a href="#前戏" class="headerlink" title="前戏"></a>前戏</h3><p>前面很多篇的文章都在围绕<code>channel</code>介绍，而只有前一篇<code>sync</code>的文章介绍到了<code>Mutex</code>，不是我偏心，而是channel在Golang是first class级别的，设计在语言特性中的，而<code>Mutex</code>只是一个包中的。这就注定了一个是主角，一个是配角。</p>
<p>并且Golang还有一个并发座右铭，在《Effective Go》的channel介绍中写到：</p>
<blockquote>
<p>Share memory by communicating, don’t communicate by sharing memory.<br>通过通信共享内存，而不是通过共享内存而通信。</p>
</blockquote>
<p><strong>Golang以如此明显的方式告诉我们：面对并发问题，你首先想到的应该是channel，因为channel是线程安全的并且不会有数据冲突，比锁好用多了</strong>。</p>
<p>既生瑜，何生亮。既然有<code>channel</code>了，为啥还提供<code>sync.Mutex</code>呢？</p>
<p>主角不是万能的，他也需要配角。在Golang里，channel也不是万能的，这是由channel的特性和局限造成的。</p>
<p>下面就给大家介绍channel的特点、核心方法和缺点。</p>
<h3 id="channel解决并发问题的思路和示例"><a href="#channel解决并发问题的思路和示例" class="headerlink" title="channel解决并发问题的思路和示例"></a>channel解决并发问题的思路和示例</h3><p><strong>channel的核心是数据流动，关注到并发问题中的数据流动，把流动的数据放到channel中，就能使用channel解决这个并发问题</strong>。这个思路是从Go语言的核心开发者的演讲中学来的，然而视频我已经找不到了，不然直接共享给大家，他提到了Golang并发的核心实践的4个点：</p>
<blockquote>
<p><code>DataFlow -&gt; Drawing -&gt; Pipieline -&gt; Exiting</code></p>
</blockquote>
<p>DataFlow指数据流动，Drawing指把数据流动画出来，Pipeline指的是流水线，Exit指协程的退出。<strong>DataFlow + Drawing</strong>就是我提到到channel解决并发问题的思路，Pipeline和Exit是具体的实践模式，Pipeline和Exit我都写过文章，有需要自取：</p>
<ul>
<li><a href="https://mp.weixin.qq.com/s/YB5XZ5NatniHSYBQ3AHONw" target="_blank" rel="noopener">Golang并发模型：轻松入门流水线模型</a></li>
<li><a href="https://mp.weixin.qq.com/s/68FGjm7PFN5VbVF0zL-PlQ" target="_blank" rel="noopener">Golang并发模型：轻松入门流水线FAN模式</a></li>
<li><a href="https://mp.weixin.qq.com/s/RjomKnfwCTy7tC9gbpPxCQ" target="_blank" rel="noopener">Golang并发模型：并发协程的优雅退出</a></li>
</ul>
<p>下面我使用例子具体解释<strong>DataFlow + Drawing</strong>。借用《<a href="https://mp.weixin.qq.com/s/UpYbmFTowjCPU83W3DxP6Q" target="_blank" rel="noopener">Golang并发的次优选择：sync包</a>》中银行的例子，介绍如何使用channel解决例子中银行的并发问题：银行支持多个用户的同时操作。顺便看下同一个并发问题，使用channel和Mutex解决是什么差别。</p>
<p>一起分析下多个用户同时操作银行的数据流动：</p>
<ol>
<li>每个人都可以向银行发起请求，请求可以是存、取、查3种操作，并且包含操作时必要的数据，包含的数据只和自身相关。</li>
<li>银行处理请求后给用户发送响应，包含的数据只和操作用户相关。</li>
</ol>
<p><img src="http://img.lessisbetter.site/2019-01-12-bank-user.png" alt=""></p>
<p>你一定发现了上面的数据流动：</p>
<ol>
<li>请求数据：个人请求数据流向银行。</li>
<li>响应数据：银行处理结果数据流向用户。</li>
</ol>
<p>channel是数据流动的通道/管道，为流动的数据建立通道，这里需要建立2类channel：</p>
<ol>
<li>reqCh：传送请求的channel，把请求从个人发送给银行。</li>
<li>retCh：传送响应的channel，把响应从银行发给个人。</li>
</ol>
<p>我们把channel添加到上图中，得到下面的图：</p>
<p><img src="http://img.lessisbetter.site/2019-01-12-bank_channel.png" alt=""></p>
<p>以上就是从数据流动的角度，发现如何使用channel解决并发问题。思路有了，再思考下代码层面需要怎么做：</p>
<ol>
<li>银行：<ol>
<li>定义银行，只保存1个map即可</li>
<li>银行操作：接收和解析请求，并把请求分发给存、取、查函数</li>
<li>实现存、取、查函数：处理请求，并把结果写入到用户提供的响应通道</li>
</ol>
</li>
<li>定义请求和响应</li>
<li>用户：创建请求和接收响应的通道，发送请求后等待响应，提取响应结果</li>
<li>mian函数：创建银行和用户间的请求通道，创建银行、用户等协程，并等待操作完成</li>
</ol>
<p>以上，我们这个并发问题的逻辑实现和各块工作就清晰了，写起来也方便、简单。代码实现有200多行，<strong>公众号不方便查看，可以点阅读原文，一键直达</strong>。</p>
<p>代码不能贴了，运行结果还是可以的，为了方便理解结果，介绍下示例代码做了什么。main函数创建了银行、小明、小刚3个并发协程：</p>
<ol>
<li>银行：从<code>reqCh</code>接收请求，依次处理每个请求，直到通道关闭，把请求交给处理函数，处理函数把结果写入到请求中的<code>retCh</code>。</li>
<li>用户小明：创建了存100、取20、查余额的3个请求，每个请求得到响应后，再把下一个请求写入到<code>reqCh</code>。</li>
<li>用户小刚：流程和小明相同，但存100取200，造成取钱操作失败，他查询下自己又多少钱，得到100。</li>
</ol>
<p>main函数最后使用WaitGroup等待小明、小刚结束后退出。</p>
<p>下面是运行结果:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ go run channel_map.go</span><br><span class="line">xiaogang deposite 100 success</span><br><span class="line">xiaoming deposite 100 success</span><br><span class="line">xiaogang withdraw 200 failed</span><br><span class="line">xiaoming withdraw 20 success</span><br><span class="line">xiaogang has 100</span><br><span class="line">xiaoming has 80</span><br><span class="line">Bank exit</span><br></pre></td></tr></table></figure>
<p>这一遭搞完，发现啥没有？用Mutex直接加锁、解锁完事了，但channel搞出来一坨，<strong>是不是用channel解决这个问题不太适合</strong>？是的。对于当前这个问题，和Mutex的方案相比，channel的方案显的有点“重”，<strong>不够简洁、高效、易用</strong>。</p>
<p><strong>但这个例子展示了3点：</strong></p>
<ol>
<li><strong>使用channel解决并发问题的核心在于关注数据的流动</strong></li>
<li><strong>channel不一定是某个并发问题最好的解决方案</strong></li>
<li><strong>map在并发中，可以不用锁进行保护，而是使用channel</strong></li>
</ol>
<p>现在，回到了开篇的问题：同一个并发问题，你是用channel解决，还是用mutex解决？下面，一起看看怎么选择。</p>
<h3 id="channel和mutex的选择"><a href="#channel和mutex的选择" class="headerlink" title="channel和mutex的选择"></a>channel和mutex的选择</h3><p>面对一个并发问题的时候，应当选择合适的并发方式：channel还是mutex。<strong>选择的依据是他们的能力/特性：channel的能力是让数据流动起来，擅长的是数据流动的场景</strong>，《Channel or Mutex》中给了3个数据流动的场景：</p>
<ol>
<li>传递数据的所有权，即把某个数据发送给其他协程</li>
<li>分发任务，每个任务都是一个数据</li>
<li>交流异步结果，结果是一个数据</li>
</ol>
<p><strong>mutex的能力是数据不动，某段时间只给一个协程访问数据的权限擅长数据位置固定的场景</strong>，《Channel or Mutex》中给了2个数据不动场景：</p>
<ol>
<li>缓存</li>
<li>状态，我们银行例子中的<code>map</code>就是一种状态</li>
</ol>
<p><strong>提供解决并发问题的一个思路</strong>：</p>
<ol>
<li>先找到数据的流动，并且还要画出来，数据流动的路径换成channel，channel的两端设计成协程</li>
<li>基于画出来的图设计简要的channel方案，代码需要做什么</li>
<li>这个方案是不是有点复杂，是不是用Mutex更好一点？设计一个简要的Mutex方案，对比&amp;选择易做的、高效的</li>
</ol>
<h3 id="channel-mutex思维"><a href="#channel-mutex思维" class="headerlink" title="channel + mutex思维"></a>channel + mutex思维</h3><p>面对并发问题，除了<strong>channel or mutex</strong>，你还有另外一个选择：<strong>channel plus mutex</strong>。</p>
<p>一个大并发问题，可以分解成很多小的并发问题，每个小的并发都可以单独选型：channel or mutex。但对于整个大的问题，通常不是channel or mutex，而是channel plus mutex。</p>
<p><em>如果你是认为是channel and mutex也行，但我更喜欢plus，体现相互配合</em>。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>读到这里，感觉这篇文章头重脚轻，channel的讲了很多，而channel和mutex的选择却讲的很少。在channel和mutex的选择，实际并没有一个固定答案，也没有固定的方法，但提供了一个简单的思路：设计出channel和Mutex的简单方案，然后<strong>选择最适合当前业务、问题的</strong>那个。</p>
<p><strong>思考比结论更重要，希望你有所收获</strong>：</p>
<ol>
<li>关注数据的流动，就可以使用channel解决并发问题。</li>
<li>不流动的数据，如果存在并发访问，尝试使用sync.Mutex保护数据。</li>
<li>channel不一定某个并发问题的最优解。</li>
<li>不要害怕、拒绝使用mutex，如果mutex是问题的最优解，那就大胆使用。</li>
<li>对于大问题，channel plus mutex也许才是更好的方案。</li>
</ol>
<h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ol>
<li>《<a href="https://golang.org/doc/effective_go.html#sharing" target="_blank" rel="noopener">Effective Go</a>》，<a href="https://golang.org/doc/effective_go.html#sharing" target="_blank" rel="noopener">https://golang.org/doc/effective_go.html#sharing</a></li>
<li>《<a href="https://github.com/golang/go/wiki/Mutex" target="_blank" rel="noopener">Mutex Or Channel</a>》，<a href="https://github.com/golang/go/wiki/MutexOrChannel" target="_blank" rel="noopener">https://github.com/golang/go/wiki/MutexOrChannel</a></li>
</ol>
<h3 id="文章推荐"><a href="#文章推荐" class="headerlink" title="文章推荐"></a>文章推荐</h3><ol>
<li><a href="https://mp.weixin.qq.com/s/YB5XZ5NatniHSYBQ3AHONw" target="_blank" rel="noopener">Golang并发模型：轻松入门流水线模型</a></li>
<li><a href="https://mp.weixin.qq.com/s/68FGjm7PFN5VbVF0zL-PlQ" target="_blank" rel="noopener">Golang并发模型：轻松入门流水线FAN模式</a></li>
<li><a href="https://mp.weixin.qq.com/s/RjomKnfwCTy7tC9gbpPxCQ" target="_blank" rel="noopener">Golang并发模型：并发协程的优雅退出</a></li>
<li><a href="https://mp.weixin.qq.com/s/UpYbmFTowjCPU83W3DxP6Q" target="_blank" rel="noopener">Golang并发的次优选择：sync包</a></li>
</ol>
<blockquote>
<ol>
<li>如果这篇文章对你有帮助，不妨关注下我的Github，有文章会收到通知。</li>
<li>本文作者：<a href="http://lessisbetter.site/about/">大彬</a></li>
<li>如果喜欢本文，随意转载，但请保留此原文链接：<a href="http://lessisbetter.site/2019/01/14/golang-channel-and-mutex/">http://lessisbetter.site/2019/01/14/golang-channel-and-mutex/</a></li>
</ol>
</blockquote>
<div style="text-align:center">关注公众号，获取最新Golang文章。</div>

<p><img src="http://img.lessisbetter.site/2019-01-article_qrcode.jpg" style="border:0" align="center"></p>
<div style="color:#0096FF; text-align:center">一起学Golang-分享有料的Go语言技术</div>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><a class="extend next" rel="next" href="/page/5/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="http://img.lessisbetter.site/gzh-qrcode-logo-small.png"
                alt="大彬" />
            
              <p class="site-author-name" itemprop="name">大彬</p>
              <p class="site-description motion-element" itemprop="description">区块链、Go语言</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives">
                
                    <span class="site-state-item-count">97</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">61</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="http://img.lessisbetter.site/gzh-qrcode-logo-small.png" title="公众号 &rarr; http://img.lessisbetter.site/gzh-qrcode-logo-small.png" rel="noopener" target="_blank"><i class="fa fa-fw fa-wechat"></i>公众号</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/shitaibin" title="GitHub &rarr; https://github.com/shitaibin" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://segmentfault.com/u/lessisbetter" title="SegmentFault &rarr; https://segmentfault.com/u/lessisbetter" rel="noopener" target="_blank"><i class="fa fa-fw fa-crosshairs"></i>SegmentFault</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://www.jianshu.com/u/947f3ccdd481" title="简书 &rarr; https://www.jianshu.com/u/947f3ccdd481" rel="noopener" target="_blank"><i class="fa fa-fw fa-heartbeat"></i>简书</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://stackoverflow.com/users/4296218/james-shi" title="StackOverflow &rarr; https://stackoverflow.com/users/4296218/james-shi" rel="noopener" target="_blank"><i class="fa fa-fw fa-stack-overflow"></i>StackOverflow</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="mailto:hz_stb@163.com" title="E-Mail &rarr; mailto:hz_stb@163.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
            </div>
          

          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                友链
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://xargin.com" title="https://xargin.com" rel="noopener" target="_blank">Xargin曹大博客</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://pingcap.com/blog-cn/" title="https://pingcap.com/blog-cn/" rel="noopener" target="_blank">PingCap技术博客</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://qcrao.github.io/" title="https://qcrao.github.io/" rel="noopener" target="_blank">码农桃花源博客</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://book.eddycjy.com/golang/" title="https://book.eddycjy.com/golang/" rel="noopener" target="_blank">煎鱼的迷之博客</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://dave.cheney.net" title="https://dave.cheney.net" rel="noopener" target="_blank">Dave Cheney的博客</a>
                  </li>
                
              </ul>
            </div>
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">[object Object]</span>

  

  
</div>


  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.7.1</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> v6.6.0</div>




        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv" title="总访客量">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  

  
    <span class="site-pv" title="总访问量">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>









  <div style="display: none;">
    <script src="//s95.cnzz.com/z_stat.php?id=1275814754&web_id=1275814754" language="JavaScript"></script>
  </div>



        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script src="/js/src/utils.js?v=6.6.0"></script>

  <script src="/js/src/motion.js?v=6.6.0"></script>



  
  


  <script src="/js/src/affix.js?v=6.6.0"></script>

  <script src="/js/src/schemes/pisces.js?v=6.6.0"></script>



  

  


  <script src="/js/src/bootstrap.js?v=6.6.0"></script>



  



  











  





  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  

  

  
  

  

  

  

  

  
  <style>
    .copy-btn {
      display: inline-block;
      padding: 6px 12px;
      font-size: 13px;
      font-weight: 700;
      line-height: 20px;
      color: #333;
      white-space: nowrap;
      vertical-align: middle;
      cursor: pointer;
      background-color: #eee;
      background-image: linear-gradient(#fcfcfc, #eee);
      border: 1px solid #d5d5d5;
      border-radius: 3px;
      user-select: none;
      outline: 0;
    }

    .highlight-wrap .copy-btn {
      transition: opacity .3s ease-in-out;
      opacity: 0;
      padding: 2px 6px;
      position: absolute;
      right: 4px;
      top: 8px;
    }

    .highlight-wrap:hover .copy-btn,
    .highlight-wrap .copy-btn:focus {
      opacity: 1
    }

    .highlight-wrap {
      position: relative;
    }
  </style>
  <script>
    $('.highlight').each(function (i, e) {
      var $wrap = $('<div>').addClass('highlight-wrap');
      $(e).after($wrap);
      $wrap.append($('<button>').addClass('copy-btn').append('复制').on('click', function (e) {
        var code = $(this).parent().find('.code').find('.line').map(function (i, e) {
          return $(e).text();
        }).toArray().join('\n');
        var ta = document.createElement('textarea');
        var range = document.createRange(); //For Chrome
        var sel = window.getSelection(); //For Chrome
        var yPosition = window.pageYOffset || document.documentElement.scrollTop;
        ta.style.top = yPosition + 'px'; //Prevent page scroll
        ta.style.position = 'absolute';
        ta.style.opacity = '0';
        ta.value = code;
        ta.textContent = code; //For FireFox
        ta.contentEditable = true;
        ta.readOnly = false;
        document.body.appendChild(ta);
        range.selectNode(ta);
        sel.removeAllRanges();
        sel.addRange(range);
        ta.setSelectionRange(0, code.length);
        var result = document.execCommand('copy');
        
        ta.blur(); //For iOS
        $(this).blur();
      })).on('mouseleave', function (e) {
        var $b = $(this).find('.copy-btn');
        setTimeout(function () {
          $b.text('复制');
        }, 300);
      }).append(e);
    })
  </script>


  

</body>
</html>
