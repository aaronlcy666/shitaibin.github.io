<!DOCTYPE html>













<html class="theme-next pisces" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">
































<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.6.0" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.6.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png?v=6.6.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png?v=6.6.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.6.0" color="#222">









<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '6.6.0',
    sidebar: {"position":"left","display":"always","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="区块链、Go语言">
<meta name="keywords" content="区块链 Go语言 后端 技术 人生 编程">
<meta property="og:type" content="website">
<meta property="og:title" content="Go语言充电站">
<meta property="og:url" content="http://lessisbetter.site/index.html">
<meta property="og:site_name" content="Go语言充电站">
<meta property="og:description" content="区块链、Go语言">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Go语言充电站">
<meta name="twitter:description" content="区块链、Go语言">






  <link rel="canonical" href="http://lessisbetter.site/"/>



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Go语言充电站 – 大彬 less is better</title>
  












  <noscript>
  <style>
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion .logo-line-before i { left: initial; }
    .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Go语言充电站</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">大彬 less is better</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-主页 menu-item-active">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br />主页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-标签云">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br />标签云</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-专题文章">

    
    
    
      
    

    

    <a href="/subject/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br />专题文章</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-文章列表">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br />文章列表</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-关于">

    
    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br />关于</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-大牛博客">

    
    
    
      
    

    

    <a href="/blogs/" rel="section"><i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br />大牛博客</a>

  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    
  
  
  
  

  

    <a href="https://github.com/Shitaibin" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" style="fill: #222; color: #fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>



    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://lessisbetter.site/2019/08/22/etcd-raft-sources-structs/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="大彬">
      <meta itemprop="description" content="区块链、Go语言">
      <meta itemprop="image" content="http://img.lessisbetter.site/gzh-qrcode-logo-small.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Go语言充电站">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/08/22/etcd-raft-sources-structs/" class="post-title-link" itemprop="url">Etcd Raft架构设计和源码剖析2：重要结构体定义</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-08-22 21:59:35 / 修改时间：17:00:32" itemprop="dateCreated datePublished" datetime="2019-08-22T21:59:35+08:00">2019-08-22</time>
            

            
              

              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="序言"><a href="#序言" class="headerlink" title="序言"></a>序言</h2><p>etcd raft定义了一些重要的结构体，来传递和表示raft使用到的数据。</p>
<p>在介绍各结构体之前，先澄清一下raft、log和state machine的关系，它们三个是独立的，没有隶属关系，尤其是state machine并不属于raft。</p>
<p><img src="http://img.lessisbetter.site/2019-08-raft-%E5%9B%BE1.png" alt="State machine"></p>
<p>Consensus Module指raft算法，它输出一致的Log Entry序列，State machine指应用Entry后得到的状态，状态机是并不是raft的一部分，而是用来存储数据的模块。</p>
<h2 id="Entry"><a href="#Entry" class="headerlink" title="Entry"></a>Entry</h2><p>每个Raft集群节点都是一个状态机，每个节点都使用相同的log entry序列修改状态机的数据，Entry就是每一个操作项，<strong>raft的核心能力就是为应用层提供序列相同的entry</strong>。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Entry <span class="keyword">struct</span> &#123;</span><br><span class="line">	Term             <span class="keyword">uint64</span>    <span class="string">`protobuf:"varint,2,opt,name=Term" json:"Term"`</span></span><br><span class="line">	Index            <span class="keyword">uint64</span>    <span class="string">`protobuf:"varint,3,opt,name=Index" json:"Index"`</span></span><br><span class="line">	Type             EntryType <span class="string">`protobuf:"varint,1,opt,name=Type,enum=raftpb.EntryType" json:"Type"`</span></span><br><span class="line">	Data             []<span class="keyword">byte</span>    <span class="string">`protobuf:"bytes,4,opt,name=Data" json:"Data,omitempty"`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> EntryType <span class="keyword">int32</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">	EntryNormal       EntryType = <span class="number">0</span></span><br><span class="line">	EntryConfChange   EntryType = <span class="number">1</span></span><br><span class="line">	EntryConfChangeV2 EntryType = <span class="number">2</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>每一个Entry，都可以使用(Term, Index)进行唯一标记，相当于Entry的ID：</p>
<ul>
<li>Term：即raft论文中的Term，表明了当前Entry所属的Term。raft不使用绝对时间，而是使用相对时间，它把时间分割成了大小不等的term，每一轮选举都会开启一个新的term，term值会连续累加。如果当前的节点已经是Term 10缺收到了Term 8的Entry，Term 8的Entry已经过时，会被丢弃。</li>
<li>Index：每一个Entry都有一个的Index，代表当前Entry在log entry序列中的位置，每个index上最终只有1个达成共识的Entry。</li>
</ul>
<p>除了用于达成一致的Term和Index外，Entry还携带了数据：</p>
<ul>
<li>Type：表明当前Entry的类型，<code>EntryNormal</code>代表是Entry携带的是修改状态机的操作数据，<code>EntryConfChange</code>和<code>EntryConfChangeV2</code>代表的是Entry携带的是修改当前raft集群的配置。</li>
<li>Data：是序列化的数据，不同的Type类型，对应不同的Data。</li>
</ul>
<h2 id="Snapshot"><a href="#Snapshot" class="headerlink" title="Snapshot"></a>Snapshot</h2><p>在Entry特别多的场景下，会存在一些问题，比如现在有1亿条已经达成一致Entry，后面还有源源不断的Entry产生，是否有以下问题：</p>
<ol>
<li>这些Entry占用了大量的磁盘空间，但实际上过去的Entry已经对已经拥有这些Entry的节点没有意义了，只对那些没有Entry的节点有意义，leader把Entry发送给没有这些Entry节点，以让这些节点最终能和leader保持一致的状态。</li>
<li>有些follower非常慢，或者刚启动，或者重启过，与leader的当前状态已经严重脱节，让他们从Entry 0开始同步，然后应用到状态机，这种操作时间效率是不是非常慢？然后每一个Entry都会产生一个历史的状态，当产生新的状态之后，历史状态对当前节点也没有意义。</li>
</ol>
<p>解决这种问题的办法就是快照，比如虚拟机的快照，或者docker镜像（镜像本质也是一种快照），有了快照就可以把状态机快速恢复到快照时的状态，<strong>空间和时间上效率都能提高很多</strong>。</p>
<p>Raft可以定期产生一些快照，然后在这些快照上按序应用快照之后的Entry就能得到一致的状态。1亿个Entry + 1亿01个Entry得到的状态，跟第1亿个Entry后所产生的快照+1亿零1个Entry得到的状态是一致的。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Snapshot <span class="keyword">struct</span> &#123;</span><br><span class="line">	Data             []<span class="keyword">byte</span>           <span class="string">`protobuf:"bytes,1,opt,name=data" json:"data,omitempty"`</span></span><br><span class="line">	Metadata         SnapshotMetadata <span class="string">`protobuf:"bytes,2,opt,name=metadata" json:"metadata"`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> SnapshotMetadata <span class="keyword">struct</span> &#123;</span><br><span class="line">	ConfState        ConfState <span class="string">`protobuf:"bytes,1,opt,name=conf_state,json=confState" json:"conf_state"`</span></span><br><span class="line">	Index            <span class="keyword">uint64</span>    <span class="string">`protobuf:"varint,2,opt,name=index" json:"index"`</span></span><br><span class="line">	Term             <span class="keyword">uint64</span>    <span class="string">`protobuf:"varint,3,opt,name=term" json:"term"`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Data：是状态机中状态的快照。</li>
<li>Metadata：是快照自身相关的数据。<ul>
<li>ConfState：是快照时，当前raft的配置状态，这些状态数据并不在状态机中，所以需要进行保存。</li>
<li>Index、Term：快照所依据的Entry所在的Index和Term。</li>
</ul>
</li>
</ul>
<h2 id="Message"><a href="#Message" class="headerlink" title="Message"></a>Message</h2><p>Raft集群节点之间的通信只使用了1个结构体<code>Message</code>，Message中有一个<code>Type</code>成员，表明了当前的Message是哪种消息，比如可以是Raft论文中提到的AppendEntries，RequestVotes等，目前实际可以容纳19种类型的消息，每种消息对Raft都有不同的作用，具体见<a href="https://zhuanlan.zhihu.com/p/51065416" target="_blank" rel="noopener">这篇文章</a>：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 不同的Message类型会用到不同的字段</span></span><br><span class="line"><span class="keyword">type</span> Message <span class="keyword">struct</span> &#123;</span><br><span class="line">	Type             MessageType <span class="string">`protobuf:"varint,1,opt,name=type,enum=raftpb.MessageType" json:"type"`</span></span><br><span class="line">	To               <span class="keyword">uint64</span>      <span class="string">`protobuf:"varint,2,opt,name=to" json:"to"`</span></span><br><span class="line">	From             <span class="keyword">uint64</span>      <span class="string">`protobuf:"varint,3,opt,name=from" json:"from"`</span></span><br><span class="line">	Term             <span class="keyword">uint64</span>      <span class="string">`protobuf:"varint,4,opt,name=term" json:"term"`</span></span><br><span class="line">	LogTerm          <span class="keyword">uint64</span>      <span class="string">`protobuf:"varint,5,opt,name=logTerm" json:"logTerm"`</span></span><br><span class="line">	Index            <span class="keyword">uint64</span>      <span class="string">`protobuf:"varint,6,opt,name=index" json:"index"`</span></span><br><span class="line">	Entries          []Entry     <span class="string">`protobuf:"bytes,7,rep,name=entries" json:"entries"`</span></span><br><span class="line">	Commit           <span class="keyword">uint64</span>      <span class="string">`protobuf:"varint,8,opt,name=commit" json:"commit"`</span></span><br><span class="line">	Snapshot         Snapshot    <span class="string">`protobuf:"bytes,9,opt,name=snapshot" json:"snapshot"`</span></span><br><span class="line">	Reject           <span class="keyword">bool</span>        <span class="string">`protobuf:"varint,10,opt,name=reject" json:"reject"`</span></span><br><span class="line">	RejectHint       <span class="keyword">uint64</span>      <span class="string">`protobuf:"varint,11,opt,name=rejectHint" json:"rejectHint"`</span></span><br><span class="line">	Context          []<span class="keyword">byte</span>      <span class="string">`protobuf:"bytes,12,opt,name=context" json:"context,omitempty"`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Message中包含了很多字段，不同的消息类型使用的字段组合不相同，可以从不同消息的处理逻辑中看出来。</p>
<ul>
<li>To, From：是消息的接收节点和发送节点的的Raft ID。</li>
<li>Term：创建Message时，发送节点所在的Term。</li>
<li>LogTerm：创建Message时，发送节点本地所保存的log entry序列中最大的Term，在选举的时候会使用。</li>
<li>Index：不同的消息类型，Index的含义不同。Term和Index与Entry中的Term和Index不一定会相同，因为某个follower可能比较慢，leader向follower发送已经committed的Entry。</li>
<li>Entries：发送给follower，待follower处理的Entry。</li>
<li>Commit：创建Message时，不同消息含义不同，Append时是发送节点本地已committed的Index，Heartbeat时是committed Index或者与follower匹配的Index。</li>
<li>Snapshot：leader传递给follower的snapshot。</li>
<li>Reject：投票和Append的响应消息使用，Reject表示拒绝leader发来的消息。</li>
<li>RejectHint：拒绝Append消息的响应消息使用，用来给leader提示，发送follower已有的最后一个Index。</li>
<li>Context：某些消息的附加信息，即用来存储通用的数据。比如竞选时，存放<code>campaignTransfer</code>。</li>
</ul>
<h2 id="Storage"><a href="#Storage" class="headerlink" title="Storage"></a>Storage</h2><p>etcd raft不负责数据存储和网络通信，网络数据都是通过Node接口的函数传入和传出raft。数据存储由创建raft.Node的应用层负责，数据存储包含：</p>
<ul>
<li>应用层使用Entry生成的状态机，即一致的应用数据。</li>
<li>raft算法使用的存储信息，比如保存Entry序列的文件，保存Snapshot的文件。</li>
</ul>
<p>它们都在应用层，raft为了能够<strong>读取</strong>这些数据，定义了一个接口<code>Storage</code>：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Storage is an interface that may be implemented by the application</span></span><br><span class="line"><span class="comment">// to retrieve log entries from storage.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// If any Storage method returns an error, the raft instance will</span></span><br><span class="line"><span class="comment">// become inoperable and refuse to participate in elections; the</span></span><br><span class="line"><span class="comment">// application is responsible for cleanup and recovery in this case.</span></span><br><span class="line"><span class="keyword">type</span> Storage <span class="keyword">interface</span> &#123;</span><br><span class="line">	<span class="comment">// TODO(tbg): split this into two interfaces, LogStorage and StateStorage.</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// InitialState returns the saved HardState and ConfState information.</span></span><br><span class="line">	InitialState() (pb.HardState, pb.ConfState, error)</span><br><span class="line">	<span class="comment">// Entries returns a slice of log entries in the range [lo,hi).</span></span><br><span class="line">	<span class="comment">// MaxSize limits the total size of the log entries returned, but</span></span><br><span class="line">	<span class="comment">// Entries returns at least one entry if any.</span></span><br><span class="line">	Entries(lo, hi, maxSize <span class="keyword">uint64</span>) ([]pb.Entry, error)</span><br><span class="line">	<span class="comment">// Term returns the term of entry i, which must be in the range</span></span><br><span class="line">	<span class="comment">// [FirstIndex()-1, LastIndex()]. The term of the entry before</span></span><br><span class="line">	<span class="comment">// FirstIndex is retained for matching purposes even though the</span></span><br><span class="line">	<span class="comment">// rest of that entry may not be available.</span></span><br><span class="line">	Term(i <span class="keyword">uint64</span>) (<span class="keyword">uint64</span>, error)</span><br><span class="line">	<span class="comment">// LastIndex returns the index of the last entry in the log.</span></span><br><span class="line">	LastIndex() (<span class="keyword">uint64</span>, error)</span><br><span class="line">	<span class="comment">// FirstIndex returns the index of the first log entry that is</span></span><br><span class="line">	<span class="comment">// possibly available via Entries (older entries have been incorporated</span></span><br><span class="line">	<span class="comment">// into the latest Snapshot; if storage only contains the dummy entry the</span></span><br><span class="line">	<span class="comment">// first log entry is not available).</span></span><br><span class="line">	FirstIndex() (<span class="keyword">uint64</span>, error)</span><br><span class="line">	<span class="comment">// Snapshot returns the most recent snapshot.</span></span><br><span class="line">	<span class="comment">// If snapshot is temporarily unavailable, it should return ErrSnapshotTemporarilyUnavailable,</span></span><br><span class="line">	<span class="comment">// so raft state machine could know that Storage needs some time to prepare</span></span><br><span class="line">	<span class="comment">// snapshot and call Snapshot later.</span></span><br><span class="line">	Snapshot() (pb.Snapshot, error)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用这个接口，从应用层读取：</p>
<ul>
<li>InitialState：HardState和配置状态Confstate</li>
<li>Entries：根据Index获取连续的Entry</li>
<li>Term：获取某个Entry所在的Term</li>
<li>LastIndex：获取本节点已存储的最新的Entry的Index</li>
<li>FirstIndex：获取本节点已存储的第一个Entry的Index</li>
<li>Snapshot：获取本节点最近生成的Snapshot，Snapshot是由应用层创建的，并暂时保存起来，raft调用此接口读取</li>
</ul>
<h2 id="unstable"><a href="#unstable" class="headerlink" title="unstable"></a>unstable</h2><p>unstable因为Entry的存储是由应用层负责的raft负责的，所以raft需要暂时存储还未存到Storage中的Entry或者Snapshot，在创建Ready时，Entry和Snapshot会被封装到Ready，由应用层写入到storage。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// unstable.entries[i] has raft log position i+unstable.offset.</span></span><br><span class="line"><span class="comment">// Note that unstable.offset may be less than the highest log</span></span><br><span class="line"><span class="comment">// position in storage; this means that the next write to storage</span></span><br><span class="line"><span class="comment">// might need to truncate the log before persisting unstable.entries.</span></span><br><span class="line"><span class="keyword">type</span> unstable <span class="keyword">struct</span> &#123;</span><br><span class="line">	<span class="comment">// the incoming unstable snapshot, if any.</span></span><br><span class="line">	snapshot *pb.Snapshot</span><br><span class="line">	<span class="comment">// all entries that have not yet been written to storage.</span></span><br><span class="line">	entries []pb.Entry</span><br><span class="line">	offset  <span class="keyword">uint64</span></span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Snapshot：是follower从leader收到的最新的Snapshot。</li>
<li>entries：对leader而已，是raft刚利用请求创建的Entry，对follower而言是从leader收到的Entry。</li>
<li>offset：Entries[i].Index = i + offset。</li>
</ul>
<h2 id="raftLog"><a href="#raftLog" class="headerlink" title="raftLog"></a>raftLog</h2><p>raft使用raftLog来管理当前Entry序列和Snapshot等信息，它由Storage、unstable、committed和applied组成。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> raftLog <span class="keyword">struct</span> &#123;</span><br><span class="line">	<span class="comment">// storage contains all stable entries since the last snapshot.</span></span><br><span class="line">	storage Storage</span><br><span class="line"></span><br><span class="line">	<span class="comment">// unstable contains all unstable entries and snapshot.</span></span><br><span class="line">	<span class="comment">// they will be saved into storage.</span></span><br><span class="line">	unstable unstable</span><br><span class="line"></span><br><span class="line">	<span class="comment">// committed和applied是storage的2个整数下标</span></span><br><span class="line">	<span class="comment">// committed到applied需要Ready</span></span><br><span class="line">	<span class="comment">// committed is the highest log position that is known to be in</span></span><br><span class="line">	<span class="comment">// stable storage on a quorum of nodes.</span></span><br><span class="line">	committed <span class="keyword">uint64</span></span><br><span class="line">	<span class="comment">// applied is the highest log position that the application has</span></span><br><span class="line">	<span class="comment">// been instructed to apply to its state machine.</span></span><br><span class="line">	<span class="comment">// Invariant: applied &lt;= committed</span></span><br><span class="line">	applied <span class="keyword">uint64</span></span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Storage和unstable前面已经介绍过了，所以介绍下committed和applied。</p>
<p>committed指最后一个在raft集群多数节点之间达成一致的Entry Index。</p>
<p>applied指当前节点被应用层应用到状态机的最后一个Entry Index。applied和committed之间的Entry就是等待被应用层应用到状态机的Entry。</p>
<p>前面提到Storage接口可以获取第一个索引firstIdx，最后一个索引lastIdx，在生成snapshot之后签名的Entry就可以删除了，所以firstidx是storage中snapshot后的第一个Entry的Index，lastIndex是storage中保存的最后一个Entry的Index，这个Entry可能还没有在raft集群多数节点之间达成一致，所以在committed之后，这些Entry是等待commit的Entry，leader发现某个Entry Index已经在多数节点之间达成一致，就会把committed移动到该Entry Index。</p>
<p><img src="/Users/shitaibin/etcd raft基础结构.assets/raftLog.png" alt="raftLog"></p>
<h2 id="SoftState"><a href="#SoftState" class="headerlink" title="SoftState"></a>SoftState</h2><p>SoftState指易变的状态数据，记录了<strong>当前</strong>的Leader的Node ID，以及当前节点的角色。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SoftState provides state that is useful for logging and debugging.</span></span><br><span class="line"><span class="comment">// The state is volatile and does not need to be persisted to the WAL.</span></span><br><span class="line"><span class="keyword">type</span> SoftState <span class="keyword">struct</span> &#123;</span><br><span class="line">	<span class="comment">// leader的Node ID</span></span><br><span class="line">	Lead <span class="keyword">uint64</span> <span class="comment">// must use atomic operations to access; keep 64-bit aligned.</span></span><br><span class="line">	<span class="comment">// 节点是什么角色：leader、follower...</span></span><br><span class="line">	RaftState StateType</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// StateType represents the role of a node in a cluster.</span></span><br><span class="line"><span class="keyword">type</span> StateType <span class="keyword">uint64</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> stmap = [...]<span class="keyword">string</span>&#123;</span><br><span class="line">	<span class="string">"StateFollower"</span>,</span><br><span class="line">	<span class="string">"StateCandidate"</span>,</span><br><span class="line">	<span class="string">"StateLeader"</span>,</span><br><span class="line">	<span class="string">"StatePreCandidate"</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="HardState"><a href="#HardState" class="headerlink" title="HardState"></a>HardState</h2><p>HardState是写入到WAL（存储Entry的文件）的状态，可以在节点重启时恢复raft的状态，它了记录：</p>
<ul>
<li>Term：节点当前所在的Term。</li>
<li>Vote：节点在竞选期间所投的候选节点ID。</li>
<li>Commit：当前已经committed Entry Index。</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> HardState <span class="keyword">struct</span> &#123;</span><br><span class="line">	Term             <span class="keyword">uint64</span> <span class="string">`protobuf:"varint,1,opt,name=term" json:"term"`</span></span><br><span class="line">	Vote             <span class="keyword">uint64</span> <span class="string">`protobuf:"varint,2,opt,name=vote" json:"vote"`</span></span><br><span class="line">	Commit           <span class="keyword">uint64</span> <span class="string">`protobuf:"varint,3,opt,name=commit" json:"commit"`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Ready"><a href="#Ready" class="headerlink" title="Ready"></a>Ready</h2><p>终于到etcd raft最重要的一个结构体了。raft使用Ready结构体对外传递数据，是多种数据的打包。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Ready encapsulates the entries and messages that are ready to read,</span></span><br><span class="line"><span class="comment">// be saved to stable storage, committed or sent to other peers.</span></span><br><span class="line"><span class="comment">// All fields in Ready are read-only.</span></span><br><span class="line"><span class="keyword">type</span> Ready <span class="keyword">struct</span> &#123;</span><br><span class="line">	<span class="comment">// The current volatile state of a Node.</span></span><br><span class="line">	<span class="comment">// SoftState will be nil if there is no update.</span></span><br><span class="line">	<span class="comment">// It is not required to consume or store SoftState.</span></span><br><span class="line">	*SoftState</span><br><span class="line"></span><br><span class="line">	<span class="comment">// The current state of a Node to be saved to stable storage BEFORE</span></span><br><span class="line">	<span class="comment">// Messages are sent.</span></span><br><span class="line">	<span class="comment">// HardState will be equal to empty state if there is no update.</span></span><br><span class="line">	pb.HardState</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ReadStates can be used for node to serve linearizable read requests locally</span></span><br><span class="line">	<span class="comment">// when its applied index is greater than the index in ReadState.</span></span><br><span class="line">	<span class="comment">// Note that the readState will be returned when raft receives msgReadIndex.</span></span><br><span class="line">	<span class="comment">// The returned is only valid for the request that requested to read.</span></span><br><span class="line">	ReadStates []ReadState</span><br><span class="line"></span><br><span class="line">	<span class="comment">// unstable的entry，即待写入到storage的entry</span></span><br><span class="line">	<span class="comment">// Entries specifies entries to be saved to stable storage BEFORE</span></span><br><span class="line">	<span class="comment">// Messages are sent.</span></span><br><span class="line">	Entries []pb.Entry</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Snapshot specifies the snapshot to be saved to stable storage.</span></span><br><span class="line">	Snapshot pb.Snapshot</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 待applied的entry</span></span><br><span class="line">	<span class="comment">// CommittedEntries specifies entries to be committed to a</span></span><br><span class="line">	<span class="comment">// store/state-machine. These have previously been committed to stable</span></span><br><span class="line">	<span class="comment">// store.</span></span><br><span class="line">	CommittedEntries []pb.Entry</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Messages specifies outbound messages to be sent AFTER Entries are</span></span><br><span class="line">	<span class="comment">// committed to stable storage.</span></span><br><span class="line">	<span class="comment">// If it contains a MsgSnap message, the application MUST report back to raft</span></span><br><span class="line">	<span class="comment">// when the snapshot has been received or has failed by calling ReportSnapshot.</span></span><br><span class="line">	Messages []pb.Message</span><br><span class="line"></span><br><span class="line">	<span class="comment">// MustSync indicates whether the HardState and Entries must be synchronously</span></span><br><span class="line">	<span class="comment">// written to disk or if an asynchronous write is permissible.</span></span><br><span class="line">	MustSync <span class="keyword">bool</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>SoftState、HardState、Entry、Snapshot、Message都已经介绍过，不再单独介绍含义。</p>
<p>Entries和CommittedEntries的区别是，Entries保存的是从unstable读取的Entry，它们即将被应用层写入storage，CommittedEntries是已经被Committed，还没有applied，应用层会把他们应用到状态机。</p>
<p>ReadStateraft用来处理读请求，MustSync用来指明应用层是否采用异步的方式写数据。</p>
<p>应用层在接收到Ready后，应当处理Ready中的每一个有效字段，处理完毕后，调用<code>Advance()</code>通知raft Ready已处理完毕。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://lessisbetter.site/2019/08/19/etcd-raft-sources-arch/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="大彬">
      <meta itemprop="description" content="区块链、Go语言">
      <meta itemprop="image" content="http://img.lessisbetter.site/gzh-qrcode-logo-small.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Go语言充电站">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/08/19/etcd-raft-sources-arch/" class="post-title-link" itemprop="url">Etcd Raft架构设计和源码剖析1：</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-08-19 09:42:37" itemprop="dateCreated datePublished" datetime="2019-08-19T09:42:37+08:00">2019-08-19</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-08-22 16:59:42" itemprop="dateModified" datetime="2019-08-22T16:59:42+08:00">2019-08-22</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="序言"><a href="#序言" class="headerlink" title="序言"></a>序言</h2><p>以raftexample为例，介绍一条log从客户端发起到raft集群达成共识，将log应用到状态机的过程。</p>
<p>raftexample是etcd中的一个简单的内存分布式KV数据库，实现了多Raft节点间的数据存取，以及集群增删节点，它是学习使用etcd raft的非常好的样例。</p>
<h2 id="Raft应用架构"><a href="#Raft应用架构" class="headerlink" title="Raft应用架构"></a>Raft应用架构</h2><p>架构图</p>
<h2 id="总过程"><a href="#总过程" class="headerlink" title="总过程"></a>总过程</h2><p>摘要版：</p>
<p>详细版：</p>
<ol>
<li>cli发送req</li>
<li>app收到</li>
<li>app交给raft.node</li>
<li>raft.node交给raft.raft：func (n *node) Propose，pb.MsgProp</li>
<li>stepLeader把entry存到raftLog，log加入到unstable。尝试更新本地committed，maybeCommit</li>
<li>stepLeader对所有node发起一轮广播，对每个节点执行sendAppend，从它们的Next位置开始，从raftLog提取出一批连续的entry，由于每个节点情况不一样，这些entry可能是applied、committed、append到storage但没committed，也可能是unstable的，生成MsgApp存到raft.msgs</li>
</ol>
<p>Ready流程：</p>
<ol>
<li>node.run发现可以Ready，利用<code>newReady</code>生成Ready<ol>
<li>把unstable取出来，存到Entries，</li>
<li>把raft.msg取出来，存到Messages</li>
<li>把已committed但未applied的entry取出来，存到CommittedEntries</li>
</ol>
</li>
<li>Ready交给APP</li>
<li>App处理Ready消息<ol>
<li>把Entries append到storage，log append到storage，func (ms *MemoryStorage) Append(，由应用层完成</li>
<li>把CommittedEntries存的msg，apply到状态机</li>
<li>把Messages中的消息，使用transport发给对应节点</li>
</ol>
</li>
<li>App将消息，交给transport发送给对应节点</li>
</ol>
<p>接收请求：</p>
<ol>
<li>transport收到消息，交给App</li>
<li>App利用Step交给raft.node</li>
<li>raft.Node交给raft.raft</li>
<li>raft.raft处理MsgApp请求：handleAppendEntries，存到unstable，顺便利用消息中committed字段更新本地raftLog中的committed字段</li>
<li>raft.raft创建MsgAppResp响应</li>
<li>消息存到raft.msgs</li>
<li>raft.node发现可以创建Ready，接下来就是Ready流程</li>
</ol>
<p>接收响应：</p>
<ol>
<li>stepLeader中对MsgAppResp的处理，更加已有的response，尝试更新committed，maybeCommit，如果committed更新了，说明可以给其他node发送新的MsgApp</li>
</ol>
<h3 id="raftLog"><a href="#raftLog" class="headerlink" title="raftLog"></a>raftLog</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> raftLog <span class="keyword">struct</span> &#123;</span><br><span class="line">	<span class="comment">// storage contains all stable entries since the last snapshot.</span></span><br><span class="line">	storage Storage</span><br><span class="line"></span><br><span class="line">	<span class="comment">// unstable contains all unstable entries and snapshot.</span></span><br><span class="line">	<span class="comment">// they will be saved into storage.</span></span><br><span class="line">	unstable unstable</span><br><span class="line"></span><br><span class="line">	<span class="comment">// committed和applied是storage的2个整数下标</span></span><br><span class="line">	<span class="comment">// committed到applied需要Ready</span></span><br><span class="line">	<span class="comment">// committed is the highest log position that is known to be in</span></span><br><span class="line">	<span class="comment">// stable storage on a quorum of nodes.</span></span><br><span class="line">	committed <span class="keyword">uint64</span></span><br><span class="line">	<span class="comment">// applied is the highest log position that the application has</span></span><br><span class="line">	<span class="comment">// been instructed to apply to its state machine.</span></span><br><span class="line">	<span class="comment">// Invariant: applied &lt;= committed</span></span><br><span class="line">	applied <span class="keyword">uint64</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>client提交的请求会变成entry，最先是unstable状态，保存在raft中，然后发送Ready，让App执行commit，把unstable的entry存入storage，storage存了2个整数，使用下标记录最新commited的entry和最新applied的entry，存在committed为未applied的entry，存在的时候，也会生成Ready消息，让App把committed的entry进行apply，即修改状态机。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://lessisbetter.site/2019/08/13/raft-zh/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="大彬">
      <meta itemprop="description" content="区块链、Go语言">
      <meta itemprop="image" content="http://img.lessisbetter.site/gzh-qrcode-logo-small.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Go语言充电站">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/08/13/raft-zh/" class="post-title-link" itemprop="url">Raft中文翻译与笔记</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-08-13 20:49:05 / 修改时间：19:41:32" itemprop="dateCreated datePublished" datetime="2019-08-13T20:49:05+08:00">2019-08-13</time>
            

            
              

              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>本文在 <a href="https://github.com/maemual/raft-zh_cn/blob/master/raft-zh_cn.md" target="_blank" rel="noopener">https://github.com/maemual/raft-zh_cn/blob/master/raft-zh_cn.md</a> 基础上修改、标注重点。如果遇到中文别扭的地方、不懂的地方，建议配合<a href="https://raft.github.io/raft.pdf" title="Raft英文论文" target="_blank" rel="noopener">英文原文</a>一起阅读。</p>
<p>Raft与PBFT、Paxos等其他一致性算法相比，确实简单不少，易于理解和实现，还有很强的可用性。</p>
<p>Raft的3大核心是强领导者、领导者选举和成员关系变更（增加和减少Raft节点），论文就是围绕着3个核心进行介绍，以及论证安全性（正确性、一致性）和可用性。但成员关系变更的细节，依然还有一些疑问，做了一些注释在文中，需要去看源码和讨论弄清楚。</p>
<p>除了3大核心，论文还提到了一些优化策略：</p>
<ol>
<li>日志快照能够解决2个问题：<ol>
<li>日志不断积累占用空间不断增长，带来了可用性问题</li>
<li>性能低下的机器跟不上领导者的节奏，领导者可以把快照发送给跟随者，慢的跟随者就能“大跨步”到比较新的状态</li>
</ol>
</li>
<li>在领导人接到大量请求时，领导人批量发送日志，可以提高系统的吞吐率</li>
</ol>
<p>除了论文提到的优化，工业实践中也有几大类优化策略：</p>
<ol>
<li>Batch and Pipeline</li>
<li>Append Log Parallelly</li>
<li>Asynchronous Apply</li>
<li>Asynchronous Lease Read</li>
<li>Lease Read</li>
</ol>
<p><img src="https://static001.geekbang.org/resource/image/0c/ec/0c99e3c238ae1ad680a7c78ecd7312ec.jpg" alt=""></p>
<p>相关优化文章：</p>
<ol>
<li><a href="https://www.cnblogs.com/williamjie/p/10220019.html" target="_blank" rel="noopener">TiKV 源码解析系列 - Raft 的优化</a></li>
<li><a href="https://mp.weixin.qq.com/s?__biz=MzI3NDIxNTQyOQ==&amp;mid=2247484499&amp;idx=1&amp;sn=79acb9b4b2f8baa3296f2288c4a0a45b" target="_blank" rel="noopener">TiKV 源码解析系列 - Lease Read</a></li>
<li><a href="https://www.infoq.cn/article/acwsyQNTRtQof*3ivY4X" target="_blank" rel="noopener">详解蚂蚁金服 SOFAJRaft：生产级高性能 Java 实现</a></li>
<li><a href="https://www.yuque.com/huarou/gd4szw/zon6t9#c2f42bd2" target="_blank" rel="noopener">蚂蚁金服开源 SOFAJRaft：生产级 Java Raft 算法库</a></li>
</ol>
<hr>
<h1 id="寻找一种易于理解的一致性算法（扩展版）"><a href="#寻找一种易于理解的一致性算法（扩展版）" class="headerlink" title="寻找一种易于理解的一致性算法（扩展版）"></a>寻找一种易于理解的一致性算法（扩展版）</h1><h2 id="摘要"><a href="#摘要" class="headerlink" title="摘要"></a>摘要</h2><p><strong>Raft 是一种为了管理复制日志的一致性算法</strong>。它提供了和 Paxos 算法相同的功能和性能，但是它的算法结构和 Paxos 不同，使得 Raft 算法更加<strong>容易理解</strong>并且更<strong>容易构建实际的系统</strong>。为了提升可理解性，<strong>Raft 将一致性算法分解成了几个关键模块，例如领导人选举、日志复制和安全性</strong>。同时它通过实施一个更强的一致性来减少需要考虑的状态的数量。从一个用户研究的结果可以证明，对于学生而言，Raft 算法比 Paxos 算法更加容易学习。Raft 算法还包括一个新的机制来允许集群成员的动态改变，它利用重叠的大多数来保证安全性。</p>
<h2 id="1-介绍"><a href="#1-介绍" class="headerlink" title="1 介绍"></a>1 介绍</h2><p>一致性算法允许一组机器像一个整体一样工作，即使其中一些机器出现故障也能够继续工作下去。正因为如此，<strong>一致性算法在构建可信赖的大规模软件系统中扮演着重要的角色</strong>。在过去的 10 年里，Paxos  算法统治着一致性算法这一领域：绝大多数的实现都是基于 Paxos 或者受其影响。同时 Paxos 也成为了教学领域里讲解一致性问题时的示例。</p>
<p>但是不幸的是，尽管有很多工作都在尝试降低它的复杂性，但是 Paxos 算法依然十分难以理解。并且，Paxos 自身的算法结构需要进行大幅的修改才能够应用到实际的系统中。这些都导致了工业界和学术界都对 Paxos 算法感到十分头疼。</p>
<p>和 Paxos 算法进行过努力之后，我们开始寻找一种新的一致性算法，可以为构建实际的系统和教学提供更好的基础。我们的做法是不寻常的，我们的首要目标是可理解性：我们是否可以在实际系统中定义一个一致性算法，并且能够比 Paxos 算法以一种更加容易的方式来学习。此外，我们希望该算法方便系统构建者的直觉的发展。不仅一个算法能够工作很重要，而且能够显而易见的知道为什么能工作也很重要。</p>
<p>Raft 一致性算法就是这些工作的结果。在设计 Raft 算法的时候，我们使用一些特别的技巧来提升它的可理解性，包括算法分解（Raft 主要被分成了领导人选举，日志复制和安全三个模块）和减少状态机的状态（相对于 Paxos，Raft 减少了非确定性和服务器互相处于非一致性的方式）。一份针对两所大学 43 个学生的研究表明 Raft 明显比 Paxos 算法更加容易理解。在这些学生同时学习了这两种算法之后，和 Paxos 比起来，其中 33 个学生能够回答有关于 Raft 的问题。</p>
<p>Raft 算法在许多方面和现有的一致性算法都很相似（主要是 Oki 和 Liskov 的 Viewstamped Replication），但是它也有一些独特的特性：</p>
<ul>
<li><strong>强领导者</strong>：和其他一致性算法相比，Raft 使用一种更强的领导能力形式。比如，日志条目只从领导者发送给其他的服务器。这种方式简化了对复制日志的管理并且使得 Raft 算法更加易于理解。</li>
<li><strong>领导选举</strong>：Raft 算法使用一个随机计时器来选举领导者。这种方式只是在任何一致性算法都必须实现的心跳机制上增加了一点机制。在解决冲突的时候会更加简单快捷。</li>
<li><strong>成员关系调整</strong>：Raft 使用一种联结一致(joint consensus)的方法来处理集群成员变换的问题，在这种方法下，处于调整过程中的两种不同的配置集群中大多数机器会有重叠，这就使得集群在成员变换的时候依然可以继续工作。</li>
</ul>
<p>我们相信，Raft 算法不论出于教学目的还是作为实践项目的基础都是要比 Paxos 或者其他一致性算法要优异的。它比其他算法更加简单，更加容易理解；它的算法描述足以实现一个现实的系统；它有好多开源的实现并且在很多公司里使用；它的安全性已经被证明；它的效率和其他算法比起来也不相上下。</p>
<p>接下来，这篇论文会介绍以下内容：复制状态机问题（第 2 节），讨论 Paxos 的优点和缺点（第 3 节），讨论我们为了可理解性而采取的方法（第 4 节），阐述 Raft 一致性算法（第 5-8 节），评价 Raft 算法（第 9 节），以及一些相关的工作（第 10 节）。</p>
<h2 id="2-复制状态机"><a href="#2-复制状态机" class="headerlink" title="2 复制状态机"></a>2 复制状态机</h2><p>一致性算法是从复制状态机的背景下提出的（参考英文原文引用37）。在这种方法中，一组服务器上的状态机产生相同状态的副本，并且在一些机器宕掉的情况下也可以继续运行。复制状态机在分布式系统中被用于解决很多容错的问题。例如，大规模的系统中通常都有一个集群领导者，像 GFS、HDFS 和 RAMCloud，典型应用就是一个独立的的复制状态机去管理领导选举和存储配置信息并且在领导人宕机的情况下也要存活下来。比如 Chubby 和 ZooKeeper。</p>
<p><img src="http://img.lessisbetter.site/2019-08-raft-图1.png" alt="图 1 "></p>
<blockquote>
<p>图 1 ：复制状态机的结构。一致性算法管理着来自客户端指令的复制日志。状态机从日志中处理相同顺序的相同指令，所以产生的结果也是相同的。</p>
</blockquote>
<p>复制状态机通常都是基于<strong>复制日志</strong>实现的，如图 1。每一个服务器存储一个包含一系列指令的日志，并且按照日志的顺序进行执行。每一个日志都按照相同的顺序包含相同的指令，所以每一个服务器都执行相同的指令序列。因为每个状态机都是确定的，每一次执行操作都产生相同的状态和同样的序列。</p>
<p>保证复制日志相同就是一致性算法的工作了。在一台服务器上，一致性模块接收客户端发送来的指令然后增加到自己的日志中去。它和其他服务器上的一致性模块进行通信来保证每一个服务器上的<strong>日志最终都以相同的顺序包含相同的请求</strong>，尽管有些服务器会宕机。一旦指令被正确的复制，每一个服务器的状态机按照日志顺序处理他们，然后输出结果被返回给客户端。因此，服务器集群看起来形成一个高可靠的状态机。</p>
<p>实际系统中使用的一致性算法通常含有以下特性：</p>
<ul>
<li><strong>安全性</strong>保证（绝对不会返回一个错误的结果）：在非拜占庭错误情况下，包括网络延迟、分区、丢包、冗余和乱序等错误都可以保证正确。</li>
<li><strong>可用性</strong>：集群中只要有大多数的机器可运行并且能够相互通信、和客户端通信，就可以保证可用。因此，一个典型的包含 5 个节点的集群可以容忍两个节点的失败。服务器被停止就认为是失败。他们当有稳定的存储的时候可以从状态中恢复回来并重新加入集群。</li>
<li><strong>不依赖时序来保证一致性</strong>：物理时钟错误或者极端的消息延迟只有在最坏情况下才<strong>会导致可用性问题</strong>。</li>
<li>通常情况下，一条指令可以尽可能快的在集群中大多数节点响应一轮远程过程调用时完成。<strong>小部分比较慢的节点不会影响系统整体的性能</strong>。</li>
</ul>
<h2 id="3-Paxos-算法的问题"><a href="#3-Paxos-算法的问题" class="headerlink" title="3 Paxos 算法的问题"></a>3 Paxos 算法的问题</h2><p>在过去的 10 年里，Leslie Lamport 的 Paxos 算法几乎已经成为一致性的代名词：Paxos 是在课程教学中最经常使用的算法，同时也是大多数一致性算法实现的起点。Paxos 首先定义了一个能够达成单一决策一致的协议，比如单条的复制日志项。我们把这一子集叫做单决策 Paxos。然后通过组合多个 Paxos 协议的实例来促进一系列决策的达成。Paxos 保证安全性和活性，同时也支持集群成员关系的变更。Paxos 的正确性已经被证明，在通常情况下也很高效。</p>
<p>不幸的是，Paxos 有两个明显的缺点。第一个缺点是 Paxos 算法特别的<strong>难以理解</strong>。完整的解释是出了名的不透明；通过极大的努力之后，也只有少数人成功理解了这个算法。因此，有了几次用更简单的术语来解释 Paxos 的尝试。尽管这些解释都只关注了单决策的子集问题，但依然很具有挑战性。在 2012 年 NSDI 的会议中的一次调查显示，很少有人对 Paxos 算法感到满意，甚至在经验老道的研究者中也是如此。我们自己也尝试去理解 Paxos；我们一直没能理解 Paxos 直到我们读了很多对 Paxos 的简化解释并且设计了我们自己的算法之后，这一过程花了近一年时间。</p>
<p>我们假设 Paxos 的不透明性来自它选择单决策问题作为它的基础。单决策 Paxos 是晦涩微妙的，它被划分成了两种没有简单直观解释和无法独立理解的情景。因此，这导致了很难建立起直观的感受为什么单决策 Paxos 算法能够工作。构成多决策 Paxos 增加了很多错综复杂的规则。我们相信，在多决策上达成一致性的问题（一份日志而不是单一的日志记录）能够被分解成其他的方式并且更加直接和明显。</p>
<p>Paxos算法的第二个问题就是它<strong>没有提供一个足够好的用来构建一个现实系统的基础</strong>。一个原因是还没有一种被广泛认同的多决策问题的算法。Lamport 的描述基本上都是关于单决策 Paxos 的；他简要描述了实施多决策 Paxos 的方法，但是缺乏很多细节。当然也有很多具体化 Paxos 的尝试，但是他们都互相不一样，和 Paxos 的概述也不同。例如 Chubby 这样的系统实现了一个类似于 Paxos 的算法，但是大多数的细节并没有被公开。</p>
<p>而且，Paxos 算法的结构也不是十分易于构建实践的系统；单决策分解也会产生其他的结果。例如，独立的选择一组日志条目然后合并成一个序列化的日志并没有带来太多的好处，仅仅增加了不少复杂性。围绕着日志来设计一个系统是更加简单高效的；新日志条目以严格限制的顺序增添到日志中去。另一个问题是，Paxos 使用了一种对等的点对点的方式作为它的核心（尽管它最终提议了一种弱领导人的方法来优化性能）。在只有一个决策会被制定的简化世界中是很有意义的，但是很少有现实的系统使用这种方式。如果有一系列的决策需要被制定，首先选择一个领导人，然后让他去协调所有的决议，会更加简单快速。</p>
<p>因此，实际的系统中很少有和 Paxos 相似的实践。每一种实现都是从 Paxos 开始研究，然后发现很多实现上的难题，再然后开发了一种和 Paxos 明显不一样的结构。这样是非常费时和容易出错的，并且理解 Paxos 的难度使得这个问题更加糟糕。Paxos 算法在理论上被证明是正确可行的，但是现实的系统和 Paxos 差别是如此的大，以至于这些证明没有什么太大的价值。下面来自 Chubby 实现非常典型：</p>
<blockquote>
<p>在Paxos算法描述和实现现实系统中间有着巨大的鸿沟。最终的系统建立在一种没有经过证明的算法之上。</p>
</blockquote>
<p>由于以上问题，我们认为 Paxos 算法既没有提供一个良好的基础给实践的系统，也没有给教学很好的帮助。基于一致性问题在大规模软件系统中的重要性，我们决定看看我们是否可以设计一个拥有更好特性的替代 Paxos 的一致性算法。Raft算法就是这次实验的结果。</p>
<h2 id="4-为了可理解性的设计"><a href="#4-为了可理解性的设计" class="headerlink" title="4 为了可理解性的设计"></a>4 为了可理解性的设计</h2><p>设计 Raft 算法我们有几个初衷：它必须提供一个完整的实际的系统实现基础，这样才能大大减少开发者的工作；它必须在任何情况下都是安全的并且在大多数的情况下都是可用的；并且它的大部分操作必须是高效的。但是我们最重要也是最大的挑战是可理解性。它必须保证对于普遍的人群都可以十分容易的去理解。另外，它必须能够让人形成直观的认识，这样系统的构建者才能够在现实中进行必然的扩展。</p>
<p>在设计 Raft 算法的时候，有很多的点需要我们在各种备选方案中进行选择。在这种情况下，我们评估备选方案基于可理解性原则：解释各个备选方案有多大的难度（例如，Raft 的状态空间有多复杂，是否有微妙的暗示）？对于一个读者而言，完全理解这个方案和暗示是否容易？</p>
<p>我们意识到对这种可理解性分析上具有高度的主观性；尽管如此，我们使用了两种通常适用的技术来解决这个问题。第一个技术就是众所周知的<strong>问题分解：只要有可能，我们就将问题分解成几个相对独立的，可被解决的、可解释的和可理解的子问题</strong>。例如，Raft 算法被我们分成领导人选举，日志复制，安全性和角色改变几个部分。</p>
<p>我们使用的<strong>第二个方法是通过减少状态的数量来简化需要考虑的状态空间，使得系统更加连贯并且在可能的时候消除不确定性</strong>。特别的，所有的日志是不允许有空洞的，并且 Raft 限制了日志之间变成不一致状态的可能。尽管在大多数情况下我们都试图去消除不确定性，但是也有一些情况下不确定性可以提升可理解性。尤其是，随机化方法增加了不确定性，但是他们有利于减少状态空间数量，通过处理所有可能选择时使用相似的方法。我们<strong>使用随机化去简化 Raft 中领导人选举算法</strong>。</p>
<h2 id="5-Raft-一致性算法"><a href="#5-Raft-一致性算法" class="headerlink" title="5 Raft 一致性算法"></a>5 Raft 一致性算法</h2><p>Raft 是一种用来管理章节 2 中描述的复制日志的算法。图 2 为了参考之用，总结这个算法的简略版本，图 3 列举了这个算法的一些关键特性。图中的这些元素会在剩下的章节逐一介绍。</p>
<p><strong>Raft 通过选举一个权威的领导人，然后给予他全部的管理复制日志的责任来实现一致性</strong>。领导人从客户端接收日志条目，把日志条目复制到其他服务器上，并且当保证安全性的时候告诉其他的服务器应用日志条目到他们的状态机中。拥有一个领导人大大简化了对复制日志的管理。例如，领导人可以决定新的日志条目需要放在日志中的什么位置而不需要和其他服务器商议，并且数据都从领导人流向其他服务器。一个领导人可以宕机，可以和其他服务器失去连接，这时一个新的领导人会被选举出来。</p>
<p><strong>通过领导人的方式，Raft 将一致性问题分解成了三个相对独立的子问题</strong>，这些问题会在接下来的子章节中进行讨论：</p>
<ul>
<li><strong>领导选举</strong>：一个新的领导人需要被选举出来，当现存的领导人宕机的时候（章节 5.2）</li>
<li><strong>日志复制</strong>：领导人必须从客户端接收日志然后复制到集群中的其他节点，并且强制要求其他节点的日志保持和自己相同。</li>
<li><strong>安全性</strong>：在 Raft 中安全性的关键是在图 3 中展示的状态机安全：如果有任何的服务器节点已经应用了一个确定的日志条目到它的状态机中，那么其他服务器节点不能在同一个日志索引位置应用一个不同的指令。章节 5.4 阐述了 Raft 算法是如何保证这个特性的；这个解决方案涉及到一个额外的选举机制（5.2 节）上的限制。</li>
</ul>
<p>在展示一致性算法之后，这一章节会讨论可用性的一些问题和计时在系统的作用。</p>
<p><strong>状态</strong>：</p>
<table>
<thead>
<tr>
<th>状态</th>
<th>所有服务器上持久存在的状态</th>
</tr>
</thead>
<tbody>
<tr>
<td>currentTerm</td>
<td>服务器最后一次知道的<strong>任期</strong>号（初始化为 0，持续递增）</td>
</tr>
<tr>
<td>votedFor</td>
<td>在当前任期获得选票的候选人的 Id</td>
</tr>
<tr>
<td>log[]</td>
<td>日志条目集；每一个条目包含一个用户状态机执行的指令，和收到时的任期号</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>状态</th>
<th>所有服务器上经常变的状态</th>
</tr>
</thead>
<tbody>
<tr>
<td>commitIndex</td>
<td>已知的最大的已经被提交的日志条目的<strong>索引</strong>值</td>
</tr>
<tr>
<td>lastApplied</td>
<td>最后被应用到状态机的日志条目索引值（初始化为 0，持续递增）</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>状态</th>
<th>在领导人上经常改变的状态 （选举后重新初始化）</th>
</tr>
</thead>
<tbody>
<tr>
<td>nextIndex[]</td>
<td>为每个服务器保存的，需要发送给他的下一个日志条目的索引值（初始化为领导人最后索引值加1）</td>
</tr>
<tr>
<td>matchIndex[]</td>
<td>为每个服务器保存的，已经复制给他的日志的最高索引值（初始值为0）</td>
</tr>
</tbody>
</table>
<p><strong>追加日志的RPC</strong>：</p>
<p><strong>由领导人负责调用来复制日志指令；也会用作heartbeat</strong>。</p>
<table>
<thead>
<tr>
<th>RPC请求参数</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td>term</td>
<td>领导人的任期号</td>
</tr>
<tr>
<td>leaderId</td>
<td>领导人的 Id，以便于跟随者重定向请求</td>
</tr>
<tr>
<td>prevLogIndex</td>
<td>前一条日志条目索引</td>
</tr>
<tr>
<td>prevLogTerm</td>
<td>prevLogIndex 条目的所在的任期</td>
</tr>
<tr>
<td>entries[]</td>
<td>准备存储的日志条目（表示心跳时为空；一次性发送多个是为了提高效率）</td>
</tr>
<tr>
<td>leaderCommit</td>
<td>领导人已经提交的日志的索引值</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>RPC结果返回值</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td>term</td>
<td>当前的任期号，用于领导人去更新自己</td>
</tr>
<tr>
<td>success</td>
<td>跟随者包含了匹配上 prevLogIndex 和 prevLogTerm 的日志时为真</td>
</tr>
</tbody>
</table>
<p>接收者实现：</p>
<ol>
<li>如果 <code>term &lt; currentTerm</code> 就返回 false （5.1 节）</li>
<li>如果日志在 prevLogIndex 位置处的日志条目的任期号和 prevLogTerm 不匹配，则返回 false （5.3 节）</li>
<li>如果已经存在的日志条目和新的产生冲突（相同索引值但是任期号不同），删除这一条和之后所有的条目 （5.3 节）</li>
<li>追加日志中不存在的任何新条目</li>
<li>如果 <code>leaderCommit &gt; commitIndex</code>，令 commitIndex 等于 leaderCommit 和 新日志条目索引值中较小的一个</li>
</ol>
<p><strong>请求投票的RPC</strong>：</p>
<p>由候选人负责调用用来征集选票（5.2 节）</p>
<table>
<thead>
<tr>
<th>请求的参数</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td>term</td>
<td>候选人的任期号</td>
</tr>
<tr>
<td>candidateId</td>
<td>请求选票的候选人的 Id</td>
</tr>
<tr>
<td>lastLogIndex</td>
<td>候选人的最后日志条目的索引值</td>
</tr>
<tr>
<td>lastLogTerm</td>
<td>候选人最后日志条目的任期号</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>请求的结果</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td>term</td>
<td>当前任期号，以便于候选人去更新自己的任期号</td>
</tr>
<tr>
<td>voteGranted</td>
<td>候选人赢得了此张选票时为真</td>
</tr>
</tbody>
</table>
<p>接收者实现：</p>
<ol>
<li>如果<code>term &lt; currentTerm</code>返回 false （5.2 节）</li>
<li>如果 votedFor 为空或者为 candidateId，并且候选人的日志至少和自己一样新，那么就投票给他（5.2 节，5.4 节）</li>
</ol>
<p><strong>所有服务器需遵守的规则</strong>：</p>
<p>所有服务器：</p>
<ul>
<li>如果<code>commitIndex &gt; lastApplied</code>，那么就 lastApplied 加一，并把<code>log[lastApplied]</code>应用到状态机中（5.3 节）</li>
<li>如果接收到的 RPC 请求或响应中，任期号<code>T &gt; currentTerm</code>，那么就令 currentTerm 等于 T，并切换状态为跟随者（5.1 节）</li>
</ul>
<p>跟随者（5.2 节）：</p>
<ul>
<li>响应来自候选人和领导者的请求</li>
<li>如果在超过选举超时时间的情况之前都没有收到领导人的心跳，或者是候选人请求投票的，就自己变成候选人</li>
</ul>
<p>候选人（5.2 节）：</p>
<ul>
<li>在转变成候选人后就立即开始选举过程<ul>
<li>自增当前的任期号（currentTerm）</li>
<li>给自己投票</li>
<li>重置选举超时计时器</li>
<li>发送请求投票的 RPC 给其他所有服务器</li>
</ul>
</li>
<li>如果接收到大多数服务器的选票，那么就变成领导人</li>
<li>如果接收到来自新的领导人的追加日志 RPC，转变成跟随者</li>
<li>如果选举过程超时，再次发起一轮选举</li>
</ul>
<p>领导人：</p>
<ul>
<li>一旦成为领导人：发送空的追加日志 RPC（心跳）给其他所有的服务器；在一定的空余时间之后不停的重复发送，以阻止跟随者超时（5.2 节）</li>
<li>如果接收到来自客户端的请求：追加条目到本地日志中，在条目被应用到状态机后响应客户端（5.3 节）</li>
<li>如果对于一个跟随者，最后日志条目的索引值大于等于 nextIndex，那么：发送从 nextIndex 开始的所有日志条目：<ul>
<li>如果成功：更新相应跟随者的 nextIndex 和 matchIndex</li>
<li>如果因为日志不一致而失败，减少 nextIndex 重试</li>
</ul>
</li>
<li>如果存在一个满足<code>N &gt; commitIndex</code>的 N，并且大多数的<code>matchIndex[i] ≥ N</code>成立，并且<code>log[N].term == currentTerm</code>成立，那么令 commitIndex 等于这个 N （5.3 和 5.4 节）</li>
</ul>
<p><img src="http://img.lessisbetter.site/2019-08-raft-图2.png" alt="图 2 "></p>
<blockquote>
<p>图 2：一个关于 Raft 一致性算法的浓缩总结（不包括成员变换和日志压缩）。</p>
</blockquote>
<table>
<thead>
<tr>
<th>特性</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td>选举安全特性</td>
<td>对于一个给定的任期号，最多只会有一个领导人被选举出来（5.2 节）</td>
</tr>
<tr>
<td>领导人只追加原则</td>
<td>领导人绝对不会删除或者覆盖自己的日志，只会增加（5.3 节）</td>
</tr>
<tr>
<td>日志匹配原则</td>
<td>如果两个日志在相同的索引位置的日志条目的任期号相同，那么我们就认为这个日志从头到这个索引位置之间全部完全相同（5.3 节）</td>
</tr>
<tr>
<td>领导人完全特性</td>
<td>如果某个日志条目在某个任期号中已经被提交，那么这个条目必然出现在更大任期号的所有领导人中（5.4 节）</td>
</tr>
<tr>
<td>状态机安全特性</td>
<td>如果一个领导人已经在给定的索引值位置的日志条目应用到状态机中，那么其他任何的服务器在这个索引位置不会提交一个不同的日志（5.4.3 节）</td>
</tr>
</tbody>
</table>
<p><img src="http://img.lessisbetter.site/2019-08-raft-图3.png" alt="图 3 "></p>
<blockquote>
<p>图 3：Raft 在任何时候都保证以上的各个特性。</p>
</blockquote>
<h3 id="5-1-Raft-基础"><a href="#5-1-Raft-基础" class="headerlink" title="5.1 Raft 基础"></a>5.1 Raft 基础</h3><p><strong>一个 Raft 集群包含若干个服务器节点；通常是 5 个，这允许整个系统容忍 2 个节点的失效</strong>。在任何时刻，每一个服务器节点都处于这三个状态之一：领导人、跟随者或者候选人。在通常情况下，系统中只有一个领导人并且其他的节点全部都是跟随者。<strong>跟随者都是被动的：他们不会发送任何请求，只是简单的响应来自领导者或者候选人的请求</strong>。领导人处理所有的客户端请求（如果一个客户端和跟随者联系，那么跟随者会把请求重定向给领导人）。第三种状态，候选人，是用来在 5.2 节描述的选举新领导人时使用。图 4 展示了这些状态和他们之间的转换关系；这些转换关系会在接下来进行讨论。</p>
<p><img src="http://img.lessisbetter.site/2019-08-raft-图4.png" alt="图 4 "></p>
<blockquote>
<p>图 4：服务器状态。跟随者只响应来自其他服务器的请求。如果跟随者接收不到消息，那么他就会变成候选人并发起一次选举。获得集群中大多数选票的候选人将成为领导者。在一个任期内，领导人一直都会是领导人直到自己宕机了。</p>
</blockquote>
<p><img src="http://img.lessisbetter.site/2019-08-raft-图5.png" alt="图 5"></p>
<blockquote>
<p>图 5：时间被划分成一个个的任期，每个任期开始都是一次选举。在选举成功后，领导人会管理整个集群直到任期结束。有时候选举会失败，那么这个任期就会没有领导人而结束。任期之间的切换可以在不同的时间不同的服务器上观察到。</p>
</blockquote>
<p>Raft 把时间分割成任意长度的<strong>任期</strong>，如图 5。<strong>任期用连续的整数标记</strong>。每一段任期从一次<strong>选举</strong>开始，就像章节 5.2 描述的一样，一个或者多个候选人尝试成为领导者。如果一个候选人赢得选举，然后他就在接下来的任期内充当领导人的职责。<strong>在某些情况下，一次选举过程会造成选票的瓜分。在这种情况下，这一任期会以没有领导人结束；一个新的任期（和一次新的选举）会很快重新开始。Raft 保证了在一个给定的任期内，最多只有一个领导者。</strong></p>
<p>不同的服务器节点可能多次观察到任期之间的转换，但在某些情况下，一个节点也可能观察不到任何一次选举或者整个任期全程。<strong>任期在 Raft 算法中充当逻辑时钟</strong>的作用，这会允许服务器节点查明一些过期的信息比如陈旧的领导者。每一个节点存储一个当前任期号，这一编号在整个时期内单调的增长。当服务器之间通信的时候会交换当前任期号；如果一个服务器的当前任期号比其他人小，那么他会更新自己的编号到较大的编号值。如果一个候选人或者领导者发现自己的任期号过期了，那么他会立即恢复成跟随者状态。如果一个节点接收到一个包含过期的任期号的请求，那么他会直接拒绝这个请求。</p>
<p>Raft 算法中服务器节点之间通信使用远程过程调用（RPCs），并且基本的一致性算法只需要两种类型的 RPCs。请求投票（RequestVote） RPCs 由候选人在选举期间发起（章节  5.2），然后追加条目（AppendEntries）RPCs 由领导人发起，用来复制日志和提供一种心跳机制（章节 5.3）。第 7 节为了<strong>在服务器之间传输快照增加了第三种 RPC</strong>。当服务器没有及时的收到 RPC 的响应时，会进行重试， 并且他们能够<strong>并行的发起 RPCs 来获得最佳的性能</strong>。</p>
<h3 id="5-2-领导人选举"><a href="#5-2-领导人选举" class="headerlink" title="5.2 领导人选举"></a>5.2 领导人选举</h3><p>Raft 使用一种<strong>心跳机制来触发领导人选举</strong>。当服务器程序启动时，他们都是跟随者身份。一个服务器节点继续保持着跟随者状态只要他从领导人或者候选者处接收到有效的 RPCs。领导者周期性的向所有跟随者<strong>发送心跳包</strong>（即不包含日志项内容的追加日志项 RPCs）<strong>来维持自己的权威</strong>。<strong>如果一个跟随者在一段时间里没有接收到任何消息，也就是选举超时，那么他就会认为系统中没有可用的领导者，并且发起选举以选出新的领导者</strong>。</p>
<p>要开始一次选举过程，跟随者先要增加自己的当前任期号并且转换到候选人状态。然后他会并行的向集群中的其他服务器节点发送请求投票的 RPCs 来给自己投票。候选人会继续保持着当前状态直到以下三件事情之一发生：(a) 他自己赢得了这次的选举，(b) 其他的服务器成为领导者，(c) 一段时间之后没有任何一个获胜的人。这些结果会分别的在下面的段落里进行讨论。</p>
<p>当一个候选人从整个集群的大多数服务器节点获得了针对同一个任期号的选票，那么他就赢得了这次选举并成为领导人。每一个服务器最多会对一个任期号投出一张选票，按照先来先服务的原则（注意：5.4 节在投票上增加了一点额外的限制）。<strong>要求大多数选票的规则确保了最多只会有一个候选人赢得此次选举</strong>（图 3 中的选举安全性）。一旦候选人赢得选举，他就立即成为领导人。<strong>然后他会向其他的服务器发送心跳消息来建立自己的权威并且阻止新的领导人的产生</strong>。</p>
<p>在等待投票的时候，候选人可能会从其他的服务器接收到声明它是领导人的追加日志项 RPC。如果这个领导人的任期号（包含在此次的 RPC中）不小于候选人当前的任期号，那么候选人会承认领导人合法并回到跟随者状态。 如果此次 RPC 中的任期号比自己小，那么候选人就会拒绝这次的 RPC 并且继续保持候选人状态。</p>
<p>第三种可能的结果是候选人既没有赢得选举也没有输：<strong>如果有多个跟随者同时成为候选人，那么选票可能会被瓜分以至于没有候选人可以赢得大多数人的支持</strong>。当这种情况发生的时候，每一个候选人都会超时，然后通过增加当前任期号来开始一轮新的选举。然而，没有其他机制的话，选票可能会被无限的重复瓜分。</p>
<p>Raft 算法<strong>使用随机选举超时时间的方法来确保很少会发生选票瓜分的情况</strong>，就算发生也能很快的解决。为了阻止选票起初就被瓜分，选举超时时间是从一个固定的区间（例如 150-300 毫秒）随机选择。这样可以把服务器都分散开以至于在大多数情况下只有一个服务器会选举超时；然后他赢得选举并在其他服务器超时之前发送心跳包。同样的机制被用在选票瓜分的情况下。每一个候选人在开始一次选举的时候会重置一个随机的选举超时时间，然后在超时时间内等待投票的结果；这样减少了在新的选举中另外的选票瓜分的可能性。9.3 节展示了这种方案能够快速的选出一个领导人。</p>
<p>领导人选举这个例子，体现了可理解性原则是如何指导我们进行方案设计的。起初我们计划使用一种排名系统：每一个候选人都被赋予一个唯一的排名，供候选人之间竞争时进行选择。如果一个候选人发现另一个候选人拥有更高的排名，那么他就会回到跟随者状态，这样高排名的候选人能够更加容易的赢得下一次选举。但是我们发现这种方法在可用性方面会有一点问题（如果高排名的服务器宕机了，那么低排名的服务器可能会超时并再次进入候选人状态。而且如果这个行为发生得足够快，则可能会导致整个选举过程都被重置掉）。我们针对算法进行了多次调整，但是每次调整之后都会有新的问题。最终我们认为随机重试的方法是更加明显和易于理解的。</p>
<h3 id="5-3-日志复制"><a href="#5-3-日志复制" class="headerlink" title="5.3 日志复制"></a>5.3 日志复制</h3><p>一旦一个领导人被选举出来，他就开始为客户端提供服务。客户端的每一个请求都包含一条被复制状态机执行的指令。领导人把这条指令作为一条新的日志条目追加到日志中去，然后并行的发起追加条目 RPCs 给其他的服务器，让他们复制这条日志条目。<strong>当这条日志条目被安全的复制（下面会介绍），领导人会应用这条日志条目到它的状态机中然后把执行的结果返回给客户端。如果跟随者崩溃或者运行缓慢，再或者网络丢包，领导人会不断的重复尝试追加日志条目 RPCs （尽管已经回复了客户端）直到所有的跟随者都最终存储了所有的日志条目。</strong></p>
<blockquote>
<p>所以这时并没有真正的写入日志，如果所有的follower都没收到这个日志，并且leader这时候挂了，其实这条日志可能丢失了。</p>
</blockquote>
<p><img src="http://img.lessisbetter.site/2019-08-raft-图6.png" alt="图 6"></p>
<blockquote>
<p>图 6：日志由有序序号标记的条目组成。每个条目都包含创建时的任期号（图中框中的数字），和一个状态机需要执行的指令。一个条目当可以安全的被应用到状态机中去的时候，就认为是可以提交了。</p>
</blockquote>
<p>日志以图 6 展示的方式组织。每一个日志条目存储<strong>一条状态机指令和从领导人收到这条指令时的任期号</strong>。日志中的任期号用来检查是否出现不一致的情况，同时也用来保证图 3 中的某些性质。<strong>每一条日志条目同时也都有一个整数索引值来表明它在日志中的位置</strong>。</p>
<p><strong>领导人来决定什么时候把日志条目应用到状态机中是安全的：这种日志条目被称为已提交</strong>。Raft 算法保证所有已提交的日志条目都是持久化的并且最终会被所有可用的状态机执行。在领导人将创建的日志条目复制到大多数的服务器上的时候，日志条目就会被提交（例如在图 6 中的条目 7）。同时，领导人的日志中之前的所有日志条目也都会被提交，包括由其他领导人创建的条目。5.4 节会讨论某些当在领导人改变之后应用这条规则的隐晦内容，同时他也展示了这种提交的定义是安全的。领导人跟踪了最大的将会被提交的日志项的索引，并且索引值会被包含在未来的所有追加日志 RPCs （包括心跳包），这样其他的服务器才能最终知道领导人的提交位置。一旦跟随者知道一条日志条目已经被提交，那么他也会将这个日志条目应用到本地的状态机中（按照日志的顺序）。</p>
<p>我们设计了 Raft 的日志机制来维护一个不同服务器的日志之间的高层次的一致性。这么做不仅简化了系统的行为也使得更加可预计，同时他也是安全性保证的一个重要组件。Raft 维护着以下的特性，这些同时也组成了图 3 中的<strong>日志匹配特性</strong>：</p>
<ul>
<li>如果在不同的日志中的两个条目拥有相同的索引和任期号，那么他们存储了相同的指令。</li>
<li>如果在不同的日志中的两个条目拥有相同的索引和任期号，那么他们之前的所有日志条目也全部相同。</li>
</ul>
<p>第一个特性来自这样的一个事实，领导人最多在一个任期里在指定的一个日志索引位置创建一条日志条目，同时日志条目在日志中的位置也从来不会改变。第二个特性由追加日志 RPC 的一个简单的一致性检查所保证。<strong>在发送追加日志 RPC 的时候，领导人会把新的日志条目紧接着之前的条目的索引位置和任期号包含在里面</strong>。如果跟随者在它的日志中找不到包含相同索引位置和任期号的条目，那么他就会拒绝接收新的日志条目。一致性检查就像一个归纳步骤：一开始空的日志状态肯定是满足日志匹配特性的，当日志扩展的时候，一致性检查也确保了日志匹配特性。因此，每当追加日志 RPC 返回成功时，领导人就知道跟随者的日志一定是和自己相同的了。</p>
<p>在正常的操作中，领导人和跟随者的日志保持一致性，所以追加日志 RPC 的一致性检查从来不会失败。然而，<strong>领导人崩溃的情况会使得日志处于不一致的状态（老的领导人可能还没有完全复制所有的日志条目）。这种不一致问题会在领导人和跟随者的一系列崩溃下加剧。图 7 展示了跟随者的日志可能和新的领导人不同的方式。跟随者可能会丢失一些在新的领导人中有的日志条目，他也可能拥有一些领导人没有的日志条目，或者两者都发生。丢失或者多出日志条目可能会持续多个任期</strong>。</p>
<p><img src="http://img.lessisbetter.site/2019-08-raft-图7.png" alt="图 7"></p>
<blockquote>
<p>图 7：当一个领导人成功当选时，跟随者可能是任何情况（a-f）。每一个盒子表示是一个日志条目；里面的数字表示任期号。跟随者可<strong>能会缺少一些日志条目</strong>（a-b），<strong>可能会有一些未被提交的日志条目</strong>（c-d），<strong>或者两种情况都存在</strong>（e-f）。例如，场景 f 可能会这样发生，某服务器在任期 2 的时候是领导人，已追加了一些日志条目到自己的日志中，但在提交之前就崩溃了；很快这个机器就被重启了，在任期 3 重新被选为领导人，并且又增加了一些日志条目到自己的日志中；在任期 2 和任期 3 的日志被提交之前，这个服务器又宕机了，并且在接下来的几个任期里一直处于宕机状态。</p>
</blockquote>
<p>在 Raft 算法中，<strong>领导人处理不一致是通过强制跟随者直接复制自己的日志来解决了</strong>。这意味着在跟随者中的冲突的日志条目会被领导人的日志覆盖。5.4 节会阐述如何通过增加一些限制来使得这样的操作是安全的。</p>
<p><strong>要使得跟随者的日志进入和自己一致的状态，领导人必须找到最后两者达成一致的地方，然后删除跟随者从那个点之后的所有日志条目，发送自己的日志给跟随者。所有的这些操作都在进行追加日志 RPCs 的一致性检查时完成</strong>。领导人针对每一个跟随者维护了一个 <strong>nextIndex</strong>，这表示下一个需要发送给跟随者的日志条目的索引地址。当一个领导人刚获得权力的时候，他初始化所有的 nextIndex 值为自己的最后一条日志的index加1（图 7 中的 11）。<strong>如果一个跟随者的日志和领导人不一致，那么在下一次的追加日志 RPC 时的一致性检查就会失败。在被跟随者拒绝之后，领导人就会减小 nextIndex 值并进行重试。</strong>最终 nextIndex 会在某个位置使得领导人和跟随者的日志达成一致。当这种情况发生，追加日志 RPC 就会成功，这时就会把跟随者冲突的日志条目全部删除并且加上领导人的日志。一旦追加日志 RPC 成功，那么跟随者的日志就会和领导人保持一致，并且在接下来的任期里一直继续保持。</p>
<p>如果需要的话，算法可以通过减少被拒绝的追加日志 RPCs 的次数来<strong>优化</strong>。例如，当追加日志 RPC 的请求被拒绝的时候，<strong>跟随者可以包含冲突的条目的任期号和自己存储的那个任期的最早的索引地址。借助这些信息，领导人可以减小 nextIndex 越过所有那个任期冲突的所有日志条目；这样就变成每个任期需要一次追加条目 RPC 而不是每个条目一次。在实践中，我们十分怀疑这种优化是否是必要的，因为失败是很少发生的并且也不大可能会有这么多不一致的日志。</strong></p>
<p>通过这种机制，领导人在获得权力的时候就不需要任何特殊的操作来恢复一致性。他只需要进行正常的操作，然后日志就能自动的在回复追加日志 RPC 的一致性检查失败的时候自动趋于一致。领导人从来不会覆盖或者删除自己的日志（图 3 的领导人只追加特性）。</p>
<p>日志复制机制展示出了第 2 节中形容的一致性特性：Raft 能够接受，复制并应用新的日志条目只要大部分的机器是工作的；在通常的情况下，新的日志条目可以在一次 RPC 中被复制给集群中的大多数机器；并且单个的缓慢的跟随者不会影响整体的性能。</p>
<h3 id="5-4-安全性"><a href="#5-4-安全性" class="headerlink" title="5.4 安全性"></a>5.4 安全性</h3><p>前面的章节里描述了 Raft 算法是如何选举和复制日志的。然而，到目前为止描述的机制并不能充分的保证每一个状态机会按照相同的顺序执行相同的指令。例如，<strong>一个跟随者可能会进入不可用状态同时领导人已经提交了若干的日志条目，然后这个跟随者可能会被选举为领导人并且覆盖这些日志条目；因此，不同的状态机可能会执行不同的指令序列</strong>。</p>
<p>这一节通过在领导选举的时候增加一些限制来完善 Raft 算法。这一限制保证了任何的领导人对于给定的任期号，都拥有了之前任期的所有被提交的日志条目（图 3 中的领导人完整特性）。增加这一选举时的限制，我们对于提交时的规则也更加清晰。最终，我们将展示对于领导人完整特性的简要证明，并且说明领导人是如何领导复制状态机的做出正确行为的。</p>
<h4 id="5-4-1-选举限制"><a href="#5-4-1-选举限制" class="headerlink" title="5.4.1 选举限制"></a>5.4.1 选举限制</h4><p>在任何基于领导人的一致性算法中，领导人都必须存储所有已经提交的日志条目。在某些一致性算法中，例如 Viewstamped Replication，某个节点即使是一开始并没有包含所有已经提交的日志条目，它也能被选为领导者。这些算法都包含一些额外的机制来识别丢失的日志条目并把他们传送给新的领导人，要么是在选举阶段要么在之后很快进行。不幸的是，这种方法会导致相当大的额外的机制和复杂性。Raft 使用了一种更加简单的方法，它可以保证所有之前的任期号中已经提交的日志条目在选举的时候都会出现在新的领导人中，不需要传送这些日志条目给领导人。这意味着日志条目的传送是单向的，只从领导人传给跟随者，并且领导人从不会覆盖自身本地日志中已经存在的条目。</p>
<p><strong>Raft 使用投票的方式来阻止一个候选人赢得选举，除非这个候选人包含了所有已经提交的日志条目</strong>。候选人为了赢得选举必须联系集群中的大部分节点，这意味着每一个已经提交的日志条目在这些服务器节点中肯定存在于至少一个节点上。如果候选人的日志至少和大多数的服务器节点一样新（这个新的定义会在下面讨论），那么他一定持有了所有已经提交的日志条目。请求投票 RPC 实现了这样的限制： RPC 中包含了候选人的日志信息，然后<strong>投票人会拒绝掉那些日志没有自己的日志新的投票请求</strong>。</p>
<blockquote>
<p>这样选举出来的leader，包含的日志数也是尽量多的，可能比某几个少，但比大多数节点多。</p>
</blockquote>
<p>Raft 通过比较两份日志中最后一条日志条目的索引值和任期号定义谁的日志比较新。如果两份日志最后的条目的任期号不同，那么任期号大的日志更加新。如果两份日志最后的条目任期号相同，那么日志比较长的那个就更加新。</p>
<h4 id="5-4-2-提交之前任期内的日志条目"><a href="#5-4-2-提交之前任期内的日志条目" class="headerlink" title="5.4.2 提交之前任期内的日志条目"></a>5.4.2 提交之前任期内的日志条目</h4><p>如同 5.3 节介绍的那样，领导人知道一条当前任期内的日志记录是可以被提交的，只要它被存储到了大多数的服务器上。<strong>如果一个领导人在提交日志条目之前崩溃了，未来后续的领导人会继续尝试复制这条日志记录。然而，一个领导人不能断定一个之前任期里的日志条目被保存到大多数服务器上的时候就一定已经提交了</strong>。图 8 展示了一种情况，一条已经被存储到大多数节点上的老日志条目，也依然有可能会被未来的领导人覆盖掉。</p>
<p><img src="http://img.lessisbetter.site/2019-08-raft-图8.png" alt="图 8"></p>
<blockquote>
<p>图 8：如图的时间序列展示了为什么领导人无法决定对老任期号的日志条目进行提交。在 (a) 中，S1 是领导者，部分的复制了索引位置 2 的日志条目。在 (b) 中，S1 崩溃了，然后 S5 在任期 3 里通过 S3、S4 和自己的选票赢得选举，然后从客户端接收了一条不一样的日志条目放在了索引 2 处。然后到 (c)，S5 又崩溃了；S1 重新启动，选举成功，开始复制日志。在这时，来自任期 2 的那条日志已经被复制到了集群中的大多数机器上，但是还没有被提交。如果 S1 在 (d) 中又崩溃了，S5 可以重新被选举成功（通过来自 S2，S3 和 S4 的选票），然后覆盖了他们在索引 2 处的日志。反之，如果在崩溃之前，S1 把自己主导的新任期里产生的日志条目复制到了大多数机器上，就如 (e) 中那样，那么在后面任期里面这些新的日志条目就会被提交（因为S5 就不可能选举成功）。 这样在同一时刻就同时保证了，之前的所有老的日志条目就会被提交。</p>
</blockquote>
<p>为了消除图 8 里描述的情况，<strong>Raft 永远不会通过计算副本数目的方式去提交一个之前任期内的日志条目</strong>。只有领导人当前任期里的日志条目通过计算副本数目可以被提交；一旦当前任期的日志条目以这种方式被提交，那么由于日志匹配特性，之前的<strong>日志条目也都会被间接的提交</strong>。在某些情况下，领导人可以安全的知道一个老的日志条目是否已经被提交（例如，该条目是否存储到所有服务器上），但是 Raft 为了简化问题使用一种更加保守的方法。</p>
<blockquote>
<p>补充：获得多数投票的节点被选举为leader，leader并不一定包含上一个任期未提交的log。<br>如果包含，当前新日志提交的时候，新日志之前的日志也被确认，那些没有前一个任期日志的节点，会跟leader进行同步。</p>
</blockquote>
<p><strong>当领导人复制之前任期里的日志时，Raft 会为所有日志保留原始的任期号, 这在提交规则上产生了额外的复杂性</strong>。在其他的一致性算法中，如果一个新的领导人要重新复制之前的任期里的日志时，它必须使用当前新的任期号。<strong>Raft 使用的方法更加容易辨别出日志，因为它可以随着时间和日志的变化对日志维护着同一个任期编号。另外，和其他的算法相比，Raft 中的新领导人只需要发送更少日志条目</strong>（其他算法中必须在他们被提交之前发送更多的冗余日志条目来为他们重新编号）。</p>
<h4 id="5-4-3-安全性论证"><a href="#5-4-3-安全性论证" class="headerlink" title="5.4.3 安全性论证"></a>5.4.3 安全性论证</h4><blockquote>
<p>补：本节证明被提交的log是不会被删除的，即使发生leader切换，以及怎么确保所有机器数据一致。</p>
</blockquote>
<p>在给定了完整的 Raft 算法之后，我们现在可以更加精确的讨论领导人完整性特性（这一讨论基于 9.2 节的安全性证明）。我们假设领导人完全性特性是不存在的，然后我们推出矛盾来。假设任期 T 的领导人（领导人 T）在任期内提交了一条日志条目，但是这条日志条目没有被存储到未来某个任期的领导人的日志中。设大于 T 的最小任期 U 的领导人 U 没有这条日志条目。</p>
<p><img src="http://img.lessisbetter.site/2019-08-raft-图9.png" alt="图 9"></p>
<blockquote>
<p>图 9：如果 S1 （任期 T 的领导者）提交了一条新的日志在它的任期里，然后 S5 在之后的任期 U 里被选举为领导人，然后至少会有一个机器，如 S3，既拥有来自 S1 的日志，也给 S5 投票了。</p>
</blockquote>
<ol>
<li>在领导人 U 选举的时候一定没有那条被提交的日志条目（领导人从不会删除或者覆盖任何条目）。</li>
<li>领导人 T 复制这条日志条目给集群中的大多数节点，同时，领导人U 从集群中的大多数节点赢得了选票。因此，至少有一个节点（投票者、选民）同时接受了来自领导人T 的日志条目，并且给领导人U 投票了，如图 9。这个投票者是产生这个矛盾的关键。</li>
<li>这个投票者必须在给领导人 U 投票之前先接受了从领导人 T 发来的已经被提交的日志条目；否则他就会拒绝来自领导人 T 的追加日志请求（因为此时他的任期号会比 T 大）。</li>
<li>投票者在给领导人 U 投票时依然保存有这条日志条目，因为任何中间的领导人都包含该日志条目（根据上述的假设），领导人从不会删除条目，并且跟随者只有在和领导人冲突的时候才会删除条目。</li>
<li>投票者把自己选票投给领导人 U 时，领导人 U 的日志必须和投票者自己一样新。这就导致了两者矛盾之一。</li>
<li>首先，如果投票者和领导人 U 的最后一条日志的任期号相同，那么领导人 U 的日志至少和投票者一样长，所以领导人 U 的日志一定包含所有投票者的日志。这是另一处矛盾，因为投票者包含了那条已经被提交的日志条目，但是在上述的假设里，领导人 U 是不包含的。</li>
<li>除此之外，领导人 U 的最后一条日志的任期号就必须比投票人大了。此外，他也比 T 大，因为投票人的最后一条日志的任期号至少和 T 一样大（他包含了来自任期 T 的已提交的日志）。创建了领导人 U 最后一条日志的之前领导人一定已经包含了那条被提交的日志（根据上述假设，领导人 U 是第一个不包含该日志条目的领导人）。所以，根据日志匹配特性，领导人 U 一定也包含那条被提交的日志，这里产生矛盾。</li>
<li>这里完成了矛盾。因此，所有比 T 大的领导人一定包含了所有来自 T 的已经被提交的日志。</li>
<li>日志匹配原则保证了未来的领导人也同时会包含被间接提交的条目，例如图 8 (d) 中的索引 2。</li>
</ol>
<p>通过领导人完全特性，我们就能证明图 3 中的状态机安全特性，即如果服务器已经在某个给定的索引值应用了日志条目到自己的状态机里，那么其他的服务器不会应用一个不一样的日志到同一个索引值上。在一个服务器应用一条日志条目到他自己的状态机中时，他的日志必须和领导人的日志，在该条目和之前的条目上相同，并且已经被提交。现在我们来考虑在任何一个服务器应用一个指定索引位置的日志的最小任期；日志完全特性保证拥有更高任期号的领导人会存储相同的日志条目，所以之后的任期里应用某个索引位置的日志条目也会是相同的值。因此，状态机安全特性是成立的。</p>
<p>最后，<strong>Raft 要求服务器按照日志中索引位置顺序应用日志条目，和状态机安全特性结合起来看，这就意味着所有的服务器会应用相同的日志序列集到自己的状态机中，并且是按照相同的顺序</strong>。</p>
<h3 id="5-5-跟随者和候选人崩溃"><a href="#5-5-跟随者和候选人崩溃" class="headerlink" title="5.5 跟随者和候选人崩溃"></a>5.5 跟随者和候选人崩溃</h3><p>到目前为止，我们都只关注了领导人崩溃的情况。<strong>跟随者和候选人崩溃后的处理方式比领导人要简单的多，并且他们的处理方式是相同的。如果跟随者或者候选人崩溃了，那么后续发送给他们的 RPCs 都会失败。Raft 中处理这种失败就是简单的通过无限的重试；如果崩溃的机器重启了，那么这些 RPC 就会完整的成功。如果一个服务器在完成了一个 RPC，但是还没有响应的时候崩溃了，那么在他重新启动之后就会再次收到同样的请求</strong>。Raft 的 RPCs 都是幂等的，所以这样重试不会造成任何问题。例如一个跟随者如果收到追加日志请求但是他已经包含了这一日志，那么他就会直接忽略这个新的请求。</p>
<h3 id="5-6-时间和可用性"><a href="#5-6-时间和可用性" class="headerlink" title="5.6 时间和可用性"></a>5.6 时间和可用性</h3><p>Raft 的要求之一就是安全性不能依赖时间：整个系统不能因为某些事件运行的比预期快一点或者慢一点就产生了错误的结果。但是，可用性（系统可以及时的响应客户端）不可避免的要依赖于时间。例如，如果消息交换比服务器故障间隔时间长，候选人将没有足够长的时间来赢得选举；没有一个稳定的领导人，Raft 将无法工作。</p>
<p><strong>领导人选举是 Raft 中对时间要求最为关键的方面。Raft 可以选举并维持一个稳定的领导人,只要系统满足下面的时间要求</strong>：</p>
<blockquote>
<p>广播时间（broadcastTime）  &lt;&lt;  选举超时时间（electionTimeout） &lt;&lt;  平均故障间隔时间（MTBF）</p>
</blockquote>
<p>在这个不等式中，广播时间指的是从一个服务器并行的发送 RPCs 给集群中的其他服务器并接收响应的平均时间；选举超时时间就是在 5.2 节中介绍的选举的超时时间限制；然后平均故障间隔时间就是对于一台服务器而言，两次故障之间的平均时间。广播时间必须比选举超时时间小一个量级，这样领导人才能够发送稳定的心跳消息来阻止跟随者开始进入选举状态；通过随机化选举超时时间的方法，这个不等式也使得选票瓜分的情况变得不可能。选举超时时间应该要比平均故障间隔时间小上几个数量级，这样整个系统才能稳定的运行。当领导人崩溃后，整个系统会大约相当于选举超时的时间里不可用；我们希望这种情况在整个系统的运行中很少出现。</p>
<p>广播时间和平均故障间隔时间是由系统决定的，但是选举超时时间是我们自己选择的。Raft 的 RPCs 需要接收方将信息持久化的保存到稳定存储中去，所以<strong>广播时间大约是 0.5 毫秒到 20 毫秒，取决于存储的技术。因此，选举超时时间可能需要在 10 毫秒到 500 毫秒之间</strong>。大多数的服务器的平均故障间隔时间都在几个月甚至更长，很容易满足时间的需求。</p>
<h2 id="6-集群成员变化"><a href="#6-集群成员变化" class="headerlink" title="6 集群成员变化"></a>6 集群成员变化</h2><p>到目前为止，我们都假设集群的配置（加入到一致性算法的服务器集合）是固定不变的。但是在实践中，偶尔是会改变集群的配置的，例如替换那些宕机的机器或者改变复制级别。尽管可以通过暂停整个集群，更新所有配置，然后重启整个集群的方式来实现，但是在更改的时候集群会不可用。另外，如果存在手工操作步骤，那么就会有操作失误的风险。为了避免这样的问题，我们决定自动化配置改变并且将其纳入到 Raft 一致性算法中来。</p>
<p><strong>为了让配置修改机制能够安全，那么在转换的过程中不能够存在任何时间点使得两个领导人同时被选举成功在同一个任期里。不幸的是，任何服务器直接从旧的配置直接转换到新的配置的方案都是不安全的。一次性自动的转换所有服务器是不可能的，所以在转换期间整个集群存在划分成两个独立的大多数群体的可能性</strong>（见图 10）。</p>
<blockquote>
<p>补：成员变更有脑裂的风险。</p>
</blockquote>
<p><img src="http://img.lessisbetter.site/2019-08-raft-图10.png" alt="图 10"></p>
<blockquote>
<p>图 10：直接从一种配置转到新的配置是十分不安全的，因为各个机器可能在任何的时候进行转换。在这个例子中，集群配额从 3 台机器变成了 5 台。不幸的是，存在这样的一个时间点，两个不同的领导人在同一个任期里都可以被选举成功。一个是通过旧的配置，一个通过新的配置。</p>
</blockquote>
<p><strong>为了保证安全性，配置更改必须使用两阶段方法</strong>。目前有很多种两阶段的实现。例如，有些系统在第一阶段停掉旧的配置所以集群就不能处理客户端请求；然后在第二阶段在启用新的配置。<strong>在 Raft 中，集群先切换到一个过渡的配置，我们称之为联结一致(joint consensus)</strong>；一旦联结一致(joint consensus)已经被提交了，那么系统就切换到新的配置上。联结一致(joint consensus)是老配置和新配置的结合：</p>
<ul>
<li>日志条目被复制给集群中新、老配置的所有服务器。</li>
<li>新、旧配置的服务器都可以成为领导人。</li>
<li>达成一致（针对选举和提交）需要分别在两种配置上获得大多数的支持。</li>
</ul>
<p>联结一致(joint consensus)允许独立的服务器在不影响安全性的前提下，在不同的时间进行配置转换过程。此外，联结一致(joint consensus)可以让集群在配置转换的过程人依然响应客户端的请求。</p>
<p>集群配置在复制日志中以特殊的日志条目来存储和通信；图 11 展示了配置转换的过程。当一个领导人接收到一个改变配置从 C-old 到 C-new 的请求，他会为了联结一致(joint consensus)存储配置（图中的 C-old,new），以前面描述的日志条目和副本的形式。一旦一个服务器将新的配置日志条目增加到它的日志中，他就会用这个配置来做出未来所有的决定（服务器总是使用最新的配置，无论他是否已经被提交）。这意味着领导人要使用  C-old,new 的规则来决定日志条目 C-old,new 什么时候需要被提交。如果领导人崩溃了，被选出来的新领导人可能是使用 C-old 配置也可能是 C-old,new 配置，这取决于赢得选举的候选人是否已经接收到了 C-old,new 配置。在任何情况下， C-new 配置在这一时期都不会单方面的做出决定。</p>
<p>一旦 C-old,new 被提交，那么无论是 C-old 还是 C-new，在没有经过他人批准的情况下都不可能做出决定，并且领导人完全特性保证了只有拥有 C-old,new 日志条目的服务器才有可能被选举为领导人。这个时候，领导人创建一条关于 C-new 配置的日志条目并复制给集群就是安全的了。再者，每个服务器在见到新的配置的时候就会立即生效。当新的配置在 C-new 的规则下被提交，旧的配置就变得无关紧要，同时不使用新的配置的服务器就可以被关闭了。如图 11，C-old 和 C-new 没有任何机会同时做出单方面的决定；这保证了安全性。</p>
<p><img src="http://img.lessisbetter.site/2019-08-raft-图11.png" alt="图 11"></p>
<blockquote>
<p>图 11：一个配置切换的时间线。虚线表示已经被创建但是还没有被提交的条目，实线表示最后被提交的日志条目。领导人首先创建了 C-old,new 的配置条目在自己的日志中，并提交到 C-old,new 中（C-old 的大多数和  C-new 的大多数）。然后他创建 C-new 条目并提交到 C-new 中的大多数。这样就不存在  C-new 和 C-old 可以同时做出决定的时间点。</p>
</blockquote>
<p>在关于重新配置还有三个问题需要解决。<strong>第一个问题是，新的服务器可能初始化没有存储任何的日志条目</strong>。当这些服务器以这种状态加入到集群中，那么他们需要一段时间来更新追赶，这时还不能提交新的日志条目。为了避免这种可用性的间隔时间，Raft 在配置更新的时候使用了一种额外的阶段，在这个阶段，新的服务器以没有投票权身份加入到集群中来（领导人复制日志给他们，但是不考虑他们是大多数）。一旦新的服务器追赶上了集群中的其他机器，重新配置可以像上面描述的一样处理。</p>
<p><strong>第二个问题是，集群的领导人可能不是新配置的一员</strong>。在这种情况下，<strong>领导人就会在提交了 C-new 日志之后退位（回到跟随者状态）</strong>。这意味着有这样的一段时间，领导人管理着集群，但是不包括他自己；他复制日志但是不把他自己算作是大多数之一。当 C-new 被提交时，会发生领导人过渡，因为这时是最早新的配置可以独立工作的时间点（将总是能够在 C-new 配置下选出新的领导人）。在此之前，可能只能从 C-old 中选出领导人。</p>
<p><strong>第三个问题是，移除不在 C-new 中的服务器可能会扰乱集群</strong>。这些服务器将不会再接收到心跳，所以当选举超时，他们就会进行新的选举过程。他们会发送拥有新的任期号的请求投票 RPCs，这样会导致当前的领导人回退成跟随者状态。新的领导人最终会被选出来，但是被移除的服务器将会再次超时，然后这个过程会再次重复，导致整体可用性大幅降低。为了避免这个问题，当服务器确认当前领导人存在时，服务器会忽略请求投票 RPCs。特别的，<strong>当服务器在当前最小选举超时时间内收到一个请求投票 RPC，他不会更新当前的任期号或者投出选票</strong>。这不会影响正常的选举，每个服务器在开始一次选举之前，至少等待一个最小选举超时时间。然而，这有利于避免被移除的服务器扰乱：如果领导人能够发送心跳给集群，那么他就不会被更大的任期号废黜。</p>
<blockquote>
<p>简述版本：</p>
<ol>
<li>客户端向leader发送更新配置的请求C-new，</li>
<li>领导人生成联结一致的配置C-old,new，即一条特殊的log，</li>
<li>并分发给所有follower，包含old和new2部分，</li>
<li>节点始终使用最新的配置，即使是未提交的，</li>
<li>所以leader把C-old,new分发给所有follower，包含old和new两部分，</li>
<li>follower收到C-old,new后，follower就开始使用新配置，向leader发送响应，</li>
<li>leader收到old和new多数的响应后，提交C-old,new，</li>
<li>leader创建一个包含C-new的log，</li>
<li>按照“节点始终使用最新的配置，即使是未提交的”原则，那leader只需要发送给new集群的节点了，那old咋能知道leader发送新日志了？old咋知道切换到新配置？还得给old follower发送新log，</li>
<li>follower按收到的新log 配置进行，new集群的follower向leader发送响应，（问题：按新配置了，leader不在新配置中，为啥还得向leader发送响应，但此时也不能进行选举，会造成存在2个leader的情况），</li>
<li>leader将新log提交，</li>
<li>如果leader不在新集群中，leader主动退位，新集群进行选举。</li>
</ol>
</blockquote>
<h2 id="7-日志压缩"><a href="#7-日志压缩" class="headerlink" title="7 日志压缩"></a>7 日志压缩</h2><p>Raft 的日志在正常操作中不断的增长，但是在实际的系统中，日志不能无限制的增长。随着日志不断增长，他会占用越来越多的空间，花费越来越多的时间来重置。如果没有一定的机制去清除日志里积累的陈旧的信息，那么会带来可用性问题。</p>
<p><strong>快照是最简单的压缩方法。在快照系统中，整个系统的状态都以快照的形式写入到稳定的持久化存储中，然后到那个时间点之前的日志全部丢弃</strong>。快照技术被使用在 Chubby 和 ZooKeeper 中，接下来的章节会介绍 Raft 中的快照技术。</p>
<p>增量压缩的方法，例如日志清理或者日志结构合并树，都是可行的。这些方法每次只对一小部分数据进行操作，这样就分散了压缩的负载压力。首先，他们先选择一个已经积累的大量已经被删除或者被覆盖对象的区域，然后重写那个区域还活跃的对象，之后释放那个区域。和简单操作整个数据集合的快照相比，需要增加复杂的机制来实现。状态机可以实现 LSM tree 使用和快照相同的接口，但是日志清除方法就需要修改 Raft 了。</p>
<p><img src="http://img.lessisbetter.site/2019-08-raft-图12.png" alt="图 12"></p>
<blockquote>
<p>图 12：一个服务器用新的快照替换了从 1 到 5 的条目，快照值存储了当前的状态。快照中包含了最后的索引位置和任期号。</p>
</blockquote>
<p>图 12 展示了 Raft 中快照的基础思想。<strong>每个服务器独立的创建快照，只包括已经被提交的日志</strong>。主要的工作包括将状态机的状态写入到快照中。Raft 也包含一些少量的元数据到快照中：<strong>最后被包含索引</strong>指的是被快照取代的最后的条目在日志中的索引值（状态机最后应用的日志），<strong>最后被包含的任期</strong>指的是该条目的任期号。保留这些数据是为了支持快照后紧接着的第一个条目的追加日志请求时的一致性检查，因为这个条目需要前一日志条目的索引值和任期号。为了支持集群成员更新（第 6 节），快照中也将最后的一次配置作为最后一个条目存下来。一旦服务器完成一次快照，他就可以删除最后索引位置之前的所有日志和快照了。</p>
<p><strong>尽管通常服务器都是独立的创建快照，但是领导人必须偶尔的发送快照给一些落后的跟随者</strong>。这通常发生在当领导人已经丢弃了下一条需要发送给跟随者的日志条目的时候。幸运的是这种情况不是常规操作：一个与领导人保持同步的跟随者通常都会有这个条目。然而一个运行非常缓慢的跟随者或者新加入集群的服务器（第 6 节）将不会有这个条目。这时让这个跟随者更新到最新的状态的方式就是通过网络把快照发送给他们。</p>
<p><strong>安装快照 RPC</strong>：</p>
<p>由领导人调用以将快照的分块发送给跟随者。领导者总是按顺序发送分块。</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td>term</td>
<td>领导人的任期号</td>
</tr>
<tr>
<td>leaderId</td>
<td>领导人的 Id，以便于跟随者重定向请求</td>
</tr>
<tr>
<td>lastIncludedIndex</td>
<td>快照中包含的最后日志条目的索引值</td>
</tr>
<tr>
<td>lastIncludedTerm</td>
<td>快照中包含的最后日志条目的任期号</td>
</tr>
<tr>
<td>offset</td>
<td>分块在快照中的字节偏移量</td>
</tr>
<tr>
<td>data[]</td>
<td><strong>原始数据</strong></td>
</tr>
<tr>
<td>done</td>
<td>如果这是最后一个分块则为 true</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>结果</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td>term</td>
<td>当前任期号（currentTerm），便于领导人更新自己</td>
</tr>
</tbody>
</table>
<p><strong>接收者实现</strong>：</p>
<ol>
<li>如果<code>term &lt; currentTerm</code>就立即回复</li>
<li>如果是第一个分块（offset 为 0）就创建一个新的快照</li>
<li>在指定偏移量写入数据</li>
<li>如果 done 是 false，则继续等待更多的数据</li>
<li>保存快照文件，丢弃具有较小索引的任何现有或部分快照</li>
<li>如果现存的日志条目与快照中最后包含的日志条目具有相同的索引值和任期号，则保留其后的日志条目并进行回复</li>
<li>丢弃整个日志</li>
<li>使用快照重置状态机（并加载快照的集群配置）</li>
</ol>
<p><img src="http://img.lessisbetter.site/2019-08-raft-图13.png" alt="图 13 "></p>
<blockquote>
<p>图 13：一个关于安装快照的简要概述。<strong>为了便于传输，快照都是被分成分块的；每个分块都给了跟随者生命的迹象，所以跟随者可以重置选举超时计时器</strong>。</p>
</blockquote>
<blockquote>
<p>快照可能比较大，分片传输可以降低快照传输对log传输的影响，同时可以让跟随者重置超时定时器，避免发生选举。</p>
</blockquote>
<p>在这种情况下领导人使用一种叫做安装快照的新的 RPC 来发送快照给太落后的跟随者；见图 13。当跟随者通过这种  RPC 接收到快照时，他必须自己决定对于已经存在的日志该如何处理。通常快照会包含没有在接收者日志中存在的信息。在这种情况下，跟随者丢弃其整个日志；它全部被快照取代，并且可能包含与快照冲突的未提交条目。如果接收到的快照是自己日志的前面部分（由于网络重传或者错误），那么被快照包含的条目将会被全部删除，但是快照后面的条目仍然有效，必须保留。</p>
<p>这种快照的方式背离了 Raft 的强领导人原则，因为跟随者可以在不知道领导人情况下创建快照。但是我们认为这种背离是值得的。<strong>领导人的存在，是为了解决在达成一致性的时候的冲突，但是在创建快照的时候，一致性已经达成，这时不存在冲突了，所以没有领导人也是可以的。数据依然是从领导人传给跟随者，只是跟随者可以重新组织他们的数据了</strong>。</p>
<p>我们考虑过一种替代的基于领导人的快照方案，即只有领导人创建快照，然后发送给所有的跟随者。但是这样做有两个缺点。第一，发送快照会浪费网络带宽并且延缓了快照处理的时间。每个跟随者都已经拥有了所有产生快照需要的信息，而且很显然，自己从本地的状态中创建快照比通过网络接收别人发来的要经济。第二，领导人的实现会更加复杂。例如，领导人需要发送快照的同时并行的将新的日志条目发送给跟随者，这样才不会阻塞新的客户端请求。</p>
<p>还有两个问题影响了快照的性能。首先，服务器必须决定什么时候应该创建快照。如果快照创建的过于频繁，那么就会浪费大量的磁盘带宽和其他资源；如果创建快照频率太低，他就要承受耗尽存储容量的风险，同时也增加了从日志重建的时间。一个简单的策略就是当日志大小达到一个固定大小的时候就创建一次快照。如果这个阈值设置的显著大于期望的快照的大小，那么快照对磁盘压力的影响就会很小了。</p>
<p>第二个影响性能的问题就是写入快照需要花费显著的一段时间，并且我们还不希望影响到正常操作。<strong>解决方案是通过写时复制的技术，这样新的更新就可以被接收而不影响到快照。例如，具有函数式数据结构的状态机天然支持这样的功能。另外，操作系统的写时复制技术的支持（如 Linux 上的 fork）可以被用来创建完整的状态机的内存快照（我们的实现就是这样的）</strong>。</p>
<h2 id="8-客户端交互"><a href="#8-客户端交互" class="headerlink" title="8 客户端交互"></a>8 客户端交互</h2><p>这一节将介绍客户端是如何和 Raft 进行交互的，包括客户端如何发现领导人和 Raft 是如何支持线性化语义的。这些问题对于所有基于一致性的系统都存在，并且 Raft 的解决方案和其他的也差不多。</p>
<p>Raft 中的客户端发送所有请求给领导人。当客户端启动的时候，他会随机挑选一个服务器进行通信。如果客户端第一次挑选的服务器不是领导人，那么那个服务器会拒绝客户端的请求并且提供他最近接收到的领导人的信息（追加条目请求包含了领导人的网络地址）。如果领导人已经崩溃了，那么客户端的请求就会超时；客户端之后会再次重试随机挑选服务器的过程。</p>
<p>我们 <strong>Raft 的目标是要实现线性化语义（每一次操作立即执行，只执行一次，在他调用和收到回复之间）</strong>。但是，如上述，Raft 是可以执行同一条命令多次的：例如，如果领导人在提交了这条日志之后，但是在响应客户端之前崩溃了，那么客户端会和新的领导人重试这条指令，导致这条命令就被再次执行了。解决方案就是客户端对于每一条指令都赋予一个唯一的<strong>序列号</strong>。然后，状态机跟踪每条指令最新的序列号和相应的响应。如果接收到一条指令，<strong>它的序列号已经被执行了，那么就立即返回结果，而不重新执行指令</strong>。</p>
<blockquote>
<p>log的是有状态的，无需重复计算状态。</p>
</blockquote>
<p>只读的操作可以直接处理而不需要记录日志。但是，在不增加任何限制的情况下，这么做可能会冒着返回脏数据的风险，因为领导人响应客户端请求时可能已经被新的领导人作废了，但是他还不知道。<strong>线性化的读操作必须不能返回脏数据，Raft 需要使用两个额外的措施在不使用日志的情况下保证这一点</strong>。首先，领导人必须有关于被提交日志的最新信息。<strong>领导人完全特性保证了领导人一定拥有所有已经被提交的日志条目，但是在他任期开始的时候，他可能不知道哪些是已经被提交的。为了知道这些信息，他需要在他的任期里提交一条日志条目。Raft 中通过领导人在任期开始的时候提交一个空白的没有任何操作的日志条目到日志中去来实现</strong>。<strong>第二，领导人在处理只读的请求之前必须检查自己是否已经被废黜了</strong>（他自己的信息已经变脏了如果一个更新的领导人被选举出来）。Raft 中通过让领导人在响应只读请求之前，先和集群中的大多数节点<strong>交换</strong>一次心跳信息来处理这个问题。可选的，领导人可以依赖心跳机制来实现一种租约的机制，但是这种方法依赖时间来保证安全性（假设时间误差是有界的）。</p>
<h2 id="9-算法实现和评估"><a href="#9-算法实现和评估" class="headerlink" title="9 算法实现和评估"></a>9 算法实现和评估</h2><p>我们已经为 RAMCloud 实现了 Raft 算法作为存储配置信息的复制状态机的一部分，并且帮助 RAMCloud 协调故障转移。这个 Raft 实现包含大约 2000 行 C++ 代码，其中不包括测试、注释和空行。这些代码是开源的。同时也有大约 25 个其他独立的第三方的基于这篇论文草稿的开源实现，针对不同的开发场景。同时，很多公司已经部署了基于 Raft 的系统。</p>
<p>这一节会从三个方面来评估 Raft 算法：可理解性、正确性和性能。</p>
<h3 id="9-1-可理解性"><a href="#9-1-可理解性" class="headerlink" title="9.1 可理解性"></a>9.1 可理解性</h3><p>为了和 Paxos 比较 Raft 算法的可理解能力，我们针对高层次的本科生和研究生，在斯坦福大学的高级操作系统课程和加州大学伯克利分校的分布式计算课程上，进行了一次学习的实验。我们分别拍了针对 Raft 和 Paxos 的视频课程，并准备了相应的小测验。Raft 的视频讲课覆盖了这篇论文的所有内容除了日志压缩；Paxos 讲课包含了足够的资料来创建一个等价的复制状态机，包括单决策 Paxos，多决策 Paxos，重新配置和一些实际系统需要的性能优化（例如领导人选举）。小测验测试一些对算法的基本理解和解释一些边角的示例。每个学生都是看完第一个视频，回答相应的测试，再看第二个视频，回答相应的测试。大约有一半的学生先进行 Paxos 部分，然后另一半先进行 Raft 部分，这是为了说明两者从第一部分的算法学习中获得的表现和经验的差异。我们计算参加人员的每一个小测验的得分来看参与者是否在 Raft 算法上更加容易理解。</p>
<p>我们尽可能的使得 Paxos 和 Raft 的比较更加公平。这个实验偏爱 Paxos 表现在两个方面：43 个参加者中有 15 个人在之前有一些  Paxos 的经验，并且 Paxos 的视频要长 14%。如表格 1 总结的那样，我们采取了一些措施来减轻这种潜在的偏见。我们所有的材料都可供审查。</p>
<table>
<thead>
<tr>
<th>关心</th>
<th>缓和偏见采取的手段</th>
<th>可供查看的材料</th>
</tr>
</thead>
<tbody>
<tr>
<td>相同的讲课质量</td>
<td>两者使用同一个讲师。Paxos 使用的是现在很多大学里经常使用的。Paxos 会长 14%。</td>
<td>视频</td>
</tr>
<tr>
<td>相同的测验难度</td>
<td>问题以难度分组，在两个测验里成对出现。</td>
<td>小测验</td>
</tr>
<tr>
<td>公平评分</td>
<td>使用评价量规。随机顺序打分，两个测验交替进行。</td>
<td>评价量规（rubric）</td>
</tr>
</tbody>
</table>
<blockquote>
<p>表 1：考虑到可能会存在的偏见，对于每种情况的解决方法，和相应的材料。</p>
</blockquote>
<p>参加者平均在 Raft 的测验中比 Paxos 高 4.9 分（总分 60，那么 Raft 的平均得分是 25.7，而 Paxos 是 20.8）；图 14 展示了每个参与者的得分。配置t-检验（又称student‘s t-test）表明，在 95% 的可信度下，真实的 Raft 分数分布至少比 Paxos 高 2.5 分。</p>
<p><img src="http://img.lessisbetter.site/2019-08-raft-图14.png" alt="图 14"></p>
<blockquote>
<p>图 14：一个散点图表示了 43 个学生在 Paxos 和 Raft 的小测验中的成绩。在对角线之上的点表示在 Raft 获得了更高分数的学生。</p>
</blockquote>
<p>我们也建立了一个线性回归模型来预测一个新的学生的测验成绩，基于以下三个因素：他们使用的是哪个小测验，之前对 Paxos 的经验，和学习算法的顺序。模型预测，对小测验的选择会产生 12.5 分的差别。这显著的高于之前的 4.9 分，因为很多学生在之前都已经有了对于 Paxos 的经验，这相当明显的帮助 Paxos，对 Raft 就没什么太大影响了。但是奇怪的是，模型预测对于先进行 Paxos 小测验的人而言，Raft的得分低了6.3分; 虽然我们不知道为什么，这似乎在统计上是有意义的。</p>
<p>我们同时也在测验之后调查了参与者，他们认为哪个算法更加容易实现和解释；这个的结果在图 15 上。压倒性的结果表明 Raft 算法更加容易实现和解释（41 人中的 33个）。但是，这种自己报告的结果不如参与者的成绩更加可信，并且参与者可能因为我们的 Raft 更加易于理解的假说而产生偏见。</p>
<p><img src="http://img.lessisbetter.site/2019-08-raft-图15.png" alt="图 15"></p>
<blockquote>
<p>图 15：通过一个 5 分制的问题，参与者（左边）被问哪个算法他们觉得在一个高效正确的系统里更容易实现，右边被问哪个更容易向学生解释。</p>
</blockquote>
<p>关于 Raft 用户学习有一个更加详细的讨论。</p>
<h3 id="9-2-正确性"><a href="#9-2-正确性" class="headerlink" title="9.2 正确性"></a>9.2 正确性</h3><p>在第 5 节，我们已经制定了正式的规范，和对一致性机制的安全性证明。这个正式规范使用 TLA+ 规范语言使图 2 中总结的信息非常清晰。它长约400行，并作为证明的主题。同时对于任何想实现 Raft 的人也是十分有用的。我们通过 TLA 证明系统非常机械的证明了日志完全特性。然而，这个证明依赖的约束前提还没有被机械证明（例如，我们还没有证明规范的类型安全）。而且，我们已经写了一个非正式的证明关于状态机安全性是完备的，并且是相当清晰的（大约 3500 个词）。</p>
<h3 id="9-3-性能"><a href="#9-3-性能" class="headerlink" title="9.3 性能"></a>9.3 性能</h3><p>Raft 和其他一致性算法例如 Paxos 有着差不多的性能。在性能方面，最重要的关注点是，当领导人被选举成功时，什么时候复制新的日志条目。Raft 通过很少数量的消息包（一轮从领导人到集群大多数机器的消息）就达成了这个目的。同时，<strong>进一步提升 Raft 的性能也是可行的。例如，很容易通过支持批量操作和管道操作来提高吞吐量和降低延迟</strong>。对于其他一致性算法已经提出过很多性能优化方案；其中有很多也可以应用到 Raft 中来，但是我们暂时把这个问题放到未来的工作中去。</p>
<p>我们使用我们自己的 Raft 实现来衡量 Raft 领导人选举的性能并且回答两个问题。首先，领导人选举的过程收敛是否快速？第二，在领导人宕机之后，最小的系统宕机时间是多久？</p>
<p><img src="http://img.lessisbetter.site/2019-08-raft-图16.png" alt="图 16"></p>
<blockquote>
<p>图 16：发现并替换一个已经崩溃的领导人的时间。上面的图考察了在选举超时时间上的随机化程度，下面的图考察了最小选举超时时间。每条线代表了 1000 次实验（除了 150-150 毫秒只试了 100 次），和相应的确定的选举超时时间。例如，150-155 毫秒意思是，选举超时时间从这个区间范围内随机选择并确定下来。这个实验在一个拥有 5 个节点的集群上进行，其广播时延大约是 15 毫秒。对于 9 个节点的集群，结果也差不多。</p>
</blockquote>
<p>为了衡量领导人选举，我们反复的使一个拥有五个节点的服务器集群的领导人宕机，并计算需要多久才能发现领导人已经宕机并选出一个新的领导人（见图 16）。为了构建一个最坏的场景，在每一次的尝试里，服务器都有不同长度的日志，意味着有些候选人是没有成为领导人的资格的。另外，为了促成选票瓜分的情况，我们的测试脚本在终止领导人之前同步的发送了一次心跳广播（这大约和领导人在崩溃前复制一个新的日志给其他机器很像）。领导人均匀的随机的在心跳间隔里宕机，也就是最小选举超时时间的一半。因此，最小宕机时间大约就是最小选举超时时间的一半。</p>
<p>图 16 中上面的图表明，只需要在选举超时时间上使用很少的随机化就可以大大避免选票被瓜分的情况。在没有随机化的情况下，在我们的测试里，选举过程往往都需要花费超过 10 秒钟由于太多的选票瓜分的情况。仅仅<strong>增加 5 毫秒的随机化时间，就大大的改善了选举过程，现在平均的宕机时间只有 287 毫秒</strong>。增加更多的随机化时间可以大大改善最坏情况：通过增加 50 毫秒的随机化时间，最坏的完成情况（1000 次尝试）只要 513 毫秒。</p>
<p>图 16 中下面的图显示，<strong>通过减少选举超时时间可以减少系统的宕机时间</strong>。在选举超时时间为 12-24 毫秒的情况下，只需要平均 35 毫秒就可以选举出新的领导人（最长的一次花费了 152 毫秒）。然而，进一步降低选举超时时间的话就会违反 Raft 的时间不等式需求：在选举新领导人之前，领导人就很难发送完心跳包。这会导致没有意义的领导人改变并降低了系统整体的可用性。我们建议使用更为保守的选举超时时间，比如 150-300 毫秒；这样的时间不大可能导致没有意义的领导人改变，而且依然提供不错的可用性。</p>
<h2 id="10-相关工作"><a href="#10-相关工作" class="headerlink" title="10 相关工作"></a>10 相关工作</h2><p>已经有很多关于一致性算法的工作被发表出来，其中很多都可以归到下面的类别中：</p>
<ul>
<li>Lamport 关于 Paxos 的原始描述，和尝试描述的更清晰。</li>
<li>关于 Paxos 的更详尽的描述，补充遗漏的细节并修改算法，使得可以提供更加容易的实现基础。</li>
<li>实现一致性算法的系统，例如 Chubby，ZooKeeper 和 Spanner。对于 Chubby 和 Spanner 的算法并没有公开发表其技术细节，尽管他们都声称是基于 Paxos 的。ZooKeeper 的算法细节已经发表，但是和 Paxos 着实有着很大的差别。</li>
<li>Paxos 可以应用的性能优化。</li>
<li>Oki 和 Liskov 的 Viewstamped Replication（VR），一种和 Paxos 差不多的替代算法。原始的算法描述和分布式传输协议耦合在了一起，但是核心的一致性算法在最近的更新里被分离了出来。VR 使用了一种基于领导人的方法，和 Raft 有很多相似之处。</li>
</ul>
<p>Raft 和 Paxos 最大的不同之处就在于 Raft 的强领导特性：Raft 使用领导人选举作为一致性协议里必不可少的部分，并且将尽可能多的功能集中到了领导人身上。这样就可以使得算法更加容易理解。例如，在 Paxos 中，领导人选举和基本的一致性协议是正交的：领导人选举仅仅是性能优化的手段，而且不是一致性所必须要求的。但是，这样就增加了多余的机制：Paxos 同时包含了针对基本一致性要求的两阶段提交协议和针对领导人选举的独立的机制。相比较而言，Raft 就直接将领导人选举纳入到一致性算法中，并作为两阶段一致性的第一步。这样就减少了很多机制。</p>
<p>像 Raft 一样，VR 和 ZooKeeper 也是基于领导人的，因此他们也拥有一些 Raft 的优点。但是，Raft 比 VR 和 ZooKeeper 拥有更少的机制因为 Raft 尽可能的减少了非领导人的功能。例如，Raft 中日志条目都遵循着从领导人发送给其他人这一个方向：追加条目 RPC 是向外发送的。在 VR 中，日志条目的流动是双向的（领导人可以在选举过程中接收日志）；这就导致了额外的机制和复杂性。根据 ZooKeeper 公开的资料看，它的日志条目也是双向传输的，但是它的实现更像 Raft。</p>
<p>和上述我们提及的其他基于一致性的日志复制算法中，Raft 的消息类型更少。例如，我们数了一下 VR 和 ZooKeeper 使用的用来基本一致性需要和成员改变的消息数（排除了日志压缩和客户端交互，因为这些都比较独立且和算法关系不大）。VR 和 ZooKeeper 都分别定义了 10 中不同的消息类型，相对的，Raft 只有 4 中消息类型（两种 RPC 请求和对应的响应）。Raft 的消息都稍微比其他算法的要信息量大，但是都很简单。另外，VR 和 ZooKeeper 都在领导人改变时传输了整个日志；所以为了能够实践中使用，额外的消息类型就很必要了。</p>
<p>Raft 的强领导人模型简化了整个算法，但是同时也排斥了一些性能优化的方法。例如，平等主义 Paxos （EPaxos）在某些没有领导人的情况下可以达到很高的性能。平等主义 Paxos 充分发挥了在状态机指令中的交换性。任何服务器都可以在一轮通信下就提交指令，除非其他指令同时被提出了。然而，如果指令都是并发的被提出，并且互相之间不通信沟通，那么 EPaxos 就需要额外的一轮通信。因为任何服务器都可以提交指令，所以 EPaxos 在服务器之间的负载均衡做的很好，并且很容易在 WAN 网络环境下获得很低的延迟。但是，他在 Paxos 上增加了非常明显的复杂性。</p>
<p>一些集群成员变换的方法已经被提出或者在其他的工作中被实现，包括 Lamport 的原始的讨论，VR 和 SMART。我们选择使用联结一致(joint consensus)的方法因为他对一致性协议的其他部分影响很小，这样我们只需要很少的一些机制就可以实现成员变换。Lamport 的基于 α 的方法之所以没有被 Raft 选择是因为它假设在没有领导人的情况下也可以达到一致性。和 VR 和 SMART 相比较，Raft 的重新配置算法可以在不限制正常请求处理的情况下进行；相比较的，VR 需要停止所有的处理过程，SMART 引入了一个和 α 类似的方法，限制了请求处理的数量。Raft 的方法同时也需要更少的额外机制来实现，和 VR、SMART 比较而言。</p>
<h2 id="11-结论"><a href="#11-结论" class="headerlink" title="11 结论"></a>11 结论</h2><p>算法的设计通常会把正确性，效率或者简洁作为主要的目标。尽管这些都是很有意义的目标，但是我们相信，可理解性也是一样的重要。在开发者把算法应用到实际的系统中之前，这些目标没有一个会被实现，这些都会必然的偏离发表时的形式。除非开发人员对这个算法有着很深的理解并且有着直观的感觉，否则将会对他们而言很难在实现的时候保持原有期望的特性。</p>
<p>在这篇论文中，我们尝试解决分布式一致性问题，但是一个广为接受但是十分令人费解的算法 Paxos 已经困扰了无数学生和开发者很多年了。我们创造了一种新的算法 Raft，显而易见的比 Paxos 要容易理解。我们同时也相信，Raft 也可以为实际的实现提供坚实的基础。把可理解性作为设计的目标改变了我们设计 Raft 的方式；随着设计的进展，我们发现自己重复使用了一些技术，比如分解问题和简化状态空间。这些技术不仅提升了 Raft 的可理解性，同时也使我们坚信其正确性。</p>
<h2 id="12-感谢"><a href="#12-感谢" class="headerlink" title="12 感谢"></a>12 感谢</h2><p>这项研究必须感谢以下人员的支持：Ali Ghodsi，David Mazie`res，和伯克利 CS 294-91 课程、斯坦福 CS 240 课程的学生。Scott Klemmer 帮我们设计了用户调查，Nelson Ray 建议我们进行统计学的分析。在用户调查时使用的关于 Paxos 的幻灯片很大一部分是从 Lorenzo Alvisi 的幻灯片上借鉴过来的。特别的，非常感谢 DavidMazieres 和 Ezra Hoch，他们找到了 Raft 中一些难以发现的漏洞。许多人提供了关于这篇论文十分有用的反馈和用户调查材料，包括 Ed Bugnion，Michael Chan，Hugues Evrard，Daniel Giffin，Arjun Gopalan，Jon Howell，Vimalkumar Jeyakumar，Ankita Kejriwal，Aleksandar Kracun，Amit Levy，Joel Martin，Satoshi Matsushita，Oleg Pesok，David Ramos，Robbert van Renesse，Mendel Rosenblum，Nicolas Schiper，Deian Stefan，Andrew Stone，Ryan Stutsman，David Terei，Stephen Yang，Matei Zaharia 以及 24 位匿名的会议审查人员（可能有重复），并且特别感谢我们的领导人 Eddie Kohler。Werner Vogels 发了一条早期草稿链接的推特，给 Raft 带来了极大的关注。我们的工作由 Gigascale 系统研究中心和 Multiscale 系统研究中心给予支持，这两个研究中心由关注中心研究程序资金支持，一个是半导体研究公司的程序，由 STARnet 支持，一个半导体研究公司的程序由 MARCO 和 DARPA 支持，在国家科学基金会的 0963859 号批准，并且获得了来自 Facebook，Google，Mellanox，NEC，NetApp，SAP 和 Samsung 的支持。Diego Ongaro 由 Junglee 公司，斯坦福的毕业团体支持。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p>略</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://lessisbetter.site/2019/08/01/fabric-new-org/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="大彬">
      <meta itemprop="description" content="区块链、Go语言">
      <meta itemprop="image" content="http://img.lessisbetter.site/gzh-qrcode-logo-small.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Go语言充电站">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/08/01/fabric-new-org/" class="post-title-link" itemprop="url">Fabric组织动态加入</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-08-01 20:33:48" itemprop="dateCreated datePublished" datetime="2019-08-01T20:33:48+08:00">2019-08-01</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-08-13 16:18:50" itemprop="dateModified" datetime="2019-08-13T16:18:50+08:00">2019-08-13</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>联盟链中动态加入组织是很正常的一件事，但联盟链不会像公链那样，可以自由加入和退出，所以，加入是要费一般功夫的。</p>
<p>需要做以下几件事情：</p>
<ol>
<li>生成新组织的证书和在要加入通道中的配置</li>
<li>拉取要加入通道的配置，根据新组织通道中的配置和通道配置，最终生成更新通道配置的交易，pb格式</li>
<li>根据通道配置更新策略，让组织节点对交易签名，然后发送更新配置交易到排序节点，并打包上链</li>
<li>新组织利用通道创世块加入通道</li>
<li>可选：新组织设置本组织在通道中的锚节点</li>
</ol>
<h2 id="生成org3的证书和在通道中的配置"><a href="#生成org3的证书和在通道中的配置" class="headerlink" title="生成org3的证书和在通道中的配置"></a>生成org3的证书和在通道中的配置</h2><p>生成新组织的证书，结果在当前目录下生成<code>crypto-config</code>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cryptogen generate --config=./org3-crypto.yaml</span><br></pre></td></tr></table></figure>
<p>当前目录下有<code>configtx.yaml</code>，里面是新组织的配置，利用configtxgen生成更新配置的json文件，放到channel的配置文件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export FABRIC_CFG_PATH=$PWD</span><br><span class="line">configtxgen -printOrg Org3MSP &gt; ../channel-artifacts/org3.json</span><br></pre></td></tr></table></figure>
<h2 id="拉取最新通道配置"><a href="#拉取最新通道配置" class="headerlink" title="拉取最新通道配置"></a>拉取最新通道配置</h2><p>连接cli，修改环境变量，设置Orederer的CA以及通道名称，后续操作会使用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it cli bash</span><br><span class="line">export ORDERER_CA=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem</span><br><span class="line">export CHANNEL_NAME=mychannel</span><br></pre></td></tr></table></figure>
<p>拉取当前的配置块，它会把cahnnel的配置，保存到二进制的protobuf文件<code>config_block.pb</code>，保存在当前目录，这个命令默认会拉去最新的配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer channel fetch config config_block.pb -o orderer.example.com:7050 -c $CHANNEL_NAME --tls --cafile $ORDERER_CA</span><br></pre></td></tr></table></figure>
<p><code>peer channel fetch config</code>可以确保获取最新的配置区块，<code>config_block.pb</code>实际是个区块，上述命令日志的<strong>最后一行</strong>，会显示出当前获取的是哪个区块：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">2019-07-30 09:40:53.047 UTC [msp] GetDefaultSigningIdentity -&gt; DEBU 044 Obtaining default signing identity</span><br><span class="line">2019-07-30 09:40:53.047 UTC [msp] GetDefaultSigningIdentity -&gt; DEBU 045 Obtaining default signing identity</span><br><span class="line">2019-07-30 09:40:53.047 UTC [msp.identity] Sign -&gt; DEBU 046 Sign: plaintext: 0AED060A1508051A0608A5A180EA0522...3849120C0A041A02080212041A020802</span><br><span class="line">2019-07-30 09:40:53.047 UTC [msp.identity] Sign -&gt; DEBU 047 Sign: digest: 2202E1BA573DD47D5F54FA5E022F1ABD78B1DCDBB9CA10C5843A675C031CDAD8</span><br><span class="line">2019-07-30 09:40:53.049 UTC [cli.common] readBlock -&gt; INFO 048 Received block: 2</span><br></pre></td></tr></table></figure>
<p>在byfn中，已经做了几次更改：</p>
<ol>
<li>区块0：使用应用通道创世块创建应用通道</li>
<li>区块1：更新org1的锚节点</li>
<li>区块2：更新org2的锚节点</li>
</ol>
<p>所以，通过上诉命令，得到了区块2中保持的配置。</p>
<p>需要把protobuf文件转换为人可读的JSON配置，configtxlator把protobuf转换为JSON，jq是一个处理JSON的工具，这里是把配置相关的数据读出来，存到config.json中，因为配置块里不仅仅包含配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">configtxlator proto_decode --input config_block.pb --type common.Block | jq .data.data[0].payload.data.config &gt; config.json</span><br></pre></td></tr></table></figure>
<p>配置文件内容700+行，此处省略，具体可看这<a href="http://lessisbetter.site/2019/08/01/fabric-parse-block/#%E5%BA%94%E7%94%A8%E9%80%9A%E9%81%93%E5%88%9B%E4%B8%96%E5%9D%97">利用工具解析fabric区块：应用通道创世块</a>。</p>
<h2 id="利用通道配置和org3配置生成更新通道的配置"><a href="#利用通道配置和org3配置生成更新通道的配置" class="headerlink" title="利用通道配置和org3配置生成更新通道的配置"></a>利用通道配置和org3配置生成更新通道的配置</h2><p>config.json中包含了各组织的信息，已经包含了org1和org2的，现在要把org3.json加入到config.json中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jq -s &apos;.[0] * &#123;&quot;channel_group&quot;:&#123;&quot;groups&quot;:&#123;&quot;Application&quot;:&#123;&quot;groups&quot;: &#123;&quot;Org3MSP&quot;:.[1]&#125;&#125;&#125;&#125;&#125;&apos; config.json ./channel-artifacts/org3.json &gt; modified_config.json</span><br></pre></td></tr></table></figure>
<p>上面的命令类似格式化输出，<code>-s</code>指定了格式，<code>.[0]，.[1]</code>代表了第1个参数和第2个参数，效果就是增加了更org1、org2平级的org3的配置，然后保存到新的配置文件<code>modified_config.json</code>，可以使用diff对比。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">diff config.json modified_config.json</span><br><span class="line">&gt;           &#125;,</span><br><span class="line">&gt;           &quot;Org3MSP&quot;: &#123;</span><br><span class="line">&gt;             &quot;groups&quot;: &#123;&#125;,</span><br><span class="line">&gt;             &quot;mod_policy&quot;: &quot;Admins&quot;,</span><br><span class="line">...</span><br><span class="line">&gt;               &#125;</span><br><span class="line">&gt;             &#125;,</span><br><span class="line">&gt;             &quot;version&quot;: &quot;0&quot;</span><br></pre></td></tr></table></figure>
<p>接下来要做3件事：</p>
<ol>
<li>config.json -&gt; config.pb</li>
<li>modified_config.json -&gt; modified_config.pb</li>
<li>modified_config.pb - config.pb -&gt; org3_update.pb</li>
</ol>
<p>目的是利用pb类型的配置文件的差集，生成升级配置的配置文件<code>org3_update.pb</code>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">configtxlator proto_encode --input config.json --type common.Config --output config.pb</span><br><span class="line">configtxlator proto_encode --input modified_config.json --type common.Config --output modified_config.pb</span><br><span class="line">configtxlator compute_update --channel_id $CHANNEL_NAME --original config.pb --updated modified_config.pb --output org3_update.pb</span><br></pre></td></tr></table></figure>
<p>然而，<code>org3_update.pb</code>也不是能直接用来升级的，但是距离升级又进了一步，再在它外面封装一层，就可以用来升级了。但是，封装这一层，需要使用json来处理，所以需要把<code>org3_update.pb</code>转为json格式，封装完成，再转为pb格式。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">configtxlator proto_decode --input org3_update.pb --type common.ConfigUpdate | jq . &gt; org3_update.json</span><br><span class="line">echo &apos;&#123;&quot;payload&quot;:&#123;&quot;header&quot;:&#123;&quot;channel_header&quot;:&#123;&quot;channel_id&quot;:&quot;mychannel&quot;, &quot;type&quot;:2&#125;&#125;,&quot;data&quot;:&#123;&quot;config_update&quot;:&apos;$(cat org3_update.json)&apos;&#125;&#125;&#125;&apos; | jq . &gt; org3_update_in_envelope.json</span><br><span class="line">configtxlator proto_encode --input org3_update_in_envelope.json --type common.Envelope --output org3_update_in_envelope.pb</span><br></pre></td></tr></table></figure>
<p><code>org3_update_in_envelope.pb</code>就是用来升级的。</p>
<blockquote>
<p>搞了这么一大圈，怎么不用modified_config.json和config.json直接来生成org3_update.json？</p>
</blockquote>
<h2 id="对更新配置进行签名"><a href="#对更新配置进行签名" class="headerlink" title="对更新配置进行签名"></a>对更新配置进行签名</h2><p>通道的默认修改策略是MAJORITY，即需要多数的org的Admin账号进行签名。</p>
<p>因为cli中的环境变量就是设置的org1 admin的，所以可以直接签名：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer channel signconfigtx -f org3_update_in_envelope.pb</span><br></pre></td></tr></table></figure>
<p>导出org2的环境变量设置，然后重新执行签名命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">export CORE_PEER_LOCALMSPID=&quot;Org2MSP&quot;</span><br><span class="line">export CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt</span><br><span class="line">export CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp</span><br><span class="line">export CORE_PEER_ADDRESS=peer0.org2.example.com:9051</span><br></pre></td></tr></table></figure>
<blockquote>
<p>签名的结果在哪？就在pb文件里。</p>
</blockquote>
<h2 id="发送更新通道配置的交易"><a href="#发送更新通道配置的交易" class="headerlink" title="发送更新通道配置的交易"></a>发送更新通道配置的交易</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer channel update -f org3_update_in_envelope.pb -c $CHANNEL_NAME -o orderer.example.com:7050 --tls --cafile $ORDERER_CA</span><br></pre></td></tr></table></figure>
<p>交易提交成功：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2019-07-31 06:17:58.376 UTC [channelCmd] update -&gt; INFO 04d Successfully submitted channel update</span><br></pre></td></tr></table></figure>
<h2 id="配置选举以接收区块"><a href="#配置选举以接收区块" class="headerlink" title="配置选举以接收区块"></a>配置选举以接收区块</h2><p>新加入的组织节点只能使用genesis区块启动，创世块不包含他们已经加入到通道的配置，所以它们无法利用gossip验证它们从本组织其他peer发来的区块，直到他们接收到了它们加入通道的配置交易。所以新加入的节点必须，配置它们从哪接收区块的排序服务。</p>
<p>如果利用的静态leader模式，使用如下配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CORE_PEER_GOSSIP_USELEADERELECTION=false</span><br><span class="line">CORE_PEER_GOSSIP_ORGLEADER=true</span><br></pre></td></tr></table></figure>
<p>否则如果是动态leader，使用如下配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CORE_PEER_GOSSIP_USELEADERELECTION=true</span><br><span class="line">CORE_PEER_GOSSIP_ORGLEADER=false</span><br></pre></td></tr></table></figure>
<p>这样新组织的peer都宣称自己是leader，加速了获取区块，等他们接收到它们自己的配置交易，就会只有1个leader peer代表本组织。</p>
<h2 id="启动新组织节点"><a href="#启动新组织节点" class="headerlink" title="启动新组织节点"></a>启动新组织节点</h2><h3 id="启动容器"><a href="#启动容器" class="headerlink" title="启动容器"></a>启动容器</h3><p>指定组织的compose文件，启动组织的容器。这会创建3个容器，peer1.org3, peer2.org3和org3cli，其中org3cli是为org3特制的cli，里面已经设置好了org3的环境变量。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose -f docker-compose-org3.yaml up -d</span><br></pre></td></tr></table></figure>
<p>后续都是连接到org3cli进行操作。</p>
<p>设置orderer的信息。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export ORDERER_CA=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem &amp;&amp; export CHANNEL_NAME=mychannel</span><br></pre></td></tr></table></figure>
<h3 id="拉取mychannel的创世块"><a href="#拉取mychannel的创世块" class="headerlink" title="拉取mychannel的创世块"></a>拉取mychannel的创世块</h3><p><code>peer channel fetch 0</code>指拉去0号区块，也就是mychannel的创世区块，保存到mychannel.block。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer channel fetch 0 mychannel.block -o orderer.example.com:7050 -c $CHANNEL_NAME --tls --cafile $ORDERER_CA</span><br></pre></td></tr></table></figure>
<h3 id="加入通道"><a href="#加入通道" class="headerlink" title="加入通道"></a>加入通道</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer channel join -b mychannel.block</span><br></pre></td></tr></table></figure>
<h3 id="设置新组织锚节点"><a href="#设置新组织锚节点" class="headerlink" title="设置新组织锚节点"></a>设置新组织锚节点</h3><p>设置锚节点也需要更新通道配置，但流程与初始的锚节点不太一致，因为新组织的配置不在<code>configtx.yanml</code>中，设置新组织锚节点跟添加新组织的流程一样，具体见：<br><a href="https://hyperledger-fabric.readthedocs.io/en/release-1.4/channel_update_tutorial.html?highlight=eyfn#updating-the-channel-config-to-include-an-org3-anchor-peer-optional" target="_blank" rel="noopener">Updating the Channel Config to include an Org3 Anchor Peer (Optional)</a>。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ol>
<li><a href="https://hyperledger-fabric.readthedocs.io/en/release-1.4/channel_update_tutorial.html?highlight=eyfn" target="_blank" rel="noopener">官方文档</a></li>
<li><a href="https://github.com/hyperledger/fabric-samples/blob/release-1.4/first-network/eyfn.sh" target="_blank" rel="noopener">first network项目中的eyfn</a>，运行脚本可以看到具体流程。</li>
</ol>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://lessisbetter.site/2019/08/01/fabric-parse-block/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="大彬">
      <meta itemprop="description" content="区块链、Go语言">
      <meta itemprop="image" content="http://img.lessisbetter.site/gzh-qrcode-logo-small.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Go语言充电站">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/08/01/fabric-parse-block/" class="post-title-link" itemprop="url">利用工具解析Fabric区块与工具详解</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-08-01 19:41:28" itemprop="dateCreated datePublished" datetime="2019-08-01T19:41:28+08:00">2019-08-01</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-08-13 16:18:50" itemprop="dateModified" datetime="2019-08-13T16:18:50+08:00">2019-08-13</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>获取人类可读的区块内容分2步：</p>
<ol>
<li>从账本里把区块取出来，格式为protobuf</li>
<li>把protobuf格式的区块，转换为JSON格式</li>
</ol>
<p>所以这篇文章3步走：</p>
<ol>
<li>获取区块</li>
<li>解析区块</li>
<li>常见区块类型样例</li>
</ol>
<h2 id="获取区块"><a href="#获取区块" class="headerlink" title="获取区块"></a>获取区块</h2><h3 id="拉取应用通道区块"><a href="#拉取应用通道区块" class="headerlink" title="拉取应用通道区块"></a>拉取应用通道区块</h3><p><code>peer channel fetch</code>能够拉去某个通道最新、最老、特定高度的区块，只不过得到的区块是protobuf格式的，人眼不可读。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">root@eedf1a41eb00:/opt/gopath/src/github.com/hyperledger/fabric/peer# peer channel fetch -h</span><br><span class="line">Fetch a specified block, writing it to a file.</span><br><span class="line"></span><br><span class="line">Usage:</span><br><span class="line">  peer channel fetch &lt;newest|oldest|config|(number)&gt; [outputfile] [flags]</span><br><span class="line"></span><br><span class="line">Flags:</span><br><span class="line">      --bestEffort         Whether fetch requests should ignore errors and return blocks on a best effort basis</span><br><span class="line">  -c, --channelID string   In case of a newChain command, the channel ID to create. It must be all lower case, less than 250 characters long and match the regular expression: [a-z][a-z0-9.-]*</span><br><span class="line">  -h, --help               help for fetch</span><br><span class="line"></span><br><span class="line">Global Flags:</span><br><span class="line">      --cafile string                       Path to file containing PEM-encoded trusted certificate(s) for the ordering endpoint</span><br><span class="line">      --certfile string                     Path to file containing PEM-encoded X509 public key to use for mutual TLS communication with the orderer endpoint</span><br><span class="line">      --clientauth                          Use mutual TLS when communicating with the orderer endpoint</span><br><span class="line">      --connTimeout duration                Timeout for client to connect (default 3s)</span><br><span class="line">      --keyfile string                      Path to file containing PEM-encoded private key to use for mutual TLS communication with the orderer endpoint</span><br><span class="line">  -o, --orderer string                      Ordering service endpoint</span><br><span class="line">      --ordererTLSHostnameOverride string   The hostname override to use when validating the TLS connection to the orderer.</span><br><span class="line">      --tls                                 Use TLS when communicating with the orderer endpoint</span><br></pre></td></tr></table></figure>
<p>以下命令下载了指定channel的第0个区块，即此channel的创世块，区块保存为mychannel.block。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer channel fetch 0 mychannel.block  -c mychannel</span><br></pre></td></tr></table></figure>
<p>如果不指定保存的区块名，会自动生成，格式：通道名_区块号，比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer channel fetch 3 -c mychannel</span><br></pre></td></tr></table></figure>
<p>操作：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@ca8843f81b89:/opt/gopath/src/github.com/hyperledger/fabric/peer# peer channel fetch 3 -c mychannel</span><br><span class="line">2019-08-01 02:20:45.378 UTC [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized</span><br><span class="line">2019-08-01 02:20:45.382 UTC [cli.common] readBlock -&gt; INFO 002 Received block: 3</span><br><span class="line">root@ca8843f81b89:/opt/gopath/src/github.com/hyperledger/fabric/peer#</span><br><span class="line">root@ca8843f81b89:/opt/gopath/src/github.com/hyperledger/fabric/peer# ls</span><br><span class="line">channel-artifacts  crypto  log.txt  mychannel.block  mychannel_3.block  scripts</span><br></pre></td></tr></table></figure>
<h3 id="获取通道配置去块"><a href="#获取通道配置去块" class="headerlink" title="获取通道配置去块"></a>获取通道配置去块</h3><p>如果使用<code>peer channel fetch config</code>可以获取某个通道的最新配置所在的区块。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer channel fetch config -c mychannel</span><br></pre></td></tr></table></figure>
<p>命令执行结果的最后一行会显示配置所在的区块号，区块文件保存为<code>mychannel_config.block</code>。</p>
<h3 id="拉取系统通道区块"><a href="#拉取系统通道区块" class="headerlink" title="拉取系统通道区块"></a>拉取系统通道区块</h3><p>拉取系统通道通常是为了获取系统配置，系统配置存在系统区块中，下面就是获取系统区块的方法。</p>
<p>系统通道区块是保存在orderer节点上的，需要在获取的时候指定orderer配置和证书，然后使用config而不是区块号，直接获取最新的配置，创世块使用区块0获取。</p>
<ol>
<li><p>连接到orderer节点，查询系统通道名称</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls /var/hyperledger/production/orderer/chains/</span><br></pre></td></tr></table></figure>
</li>
<li><p>cli上设置orderer的设置，设置上面查询的通道名字，获取的区块与通道同名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">export CHANNEL_NAME=byfn-sys-channel</span><br><span class="line">export ORDERER_CA=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem</span><br><span class="line">export CORE_PEER_ADDRESS=orderer.example.com:7050</span><br><span class="line">export CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem</span><br><span class="line">export CORE_PEER_LOCALMSPID=&quot;OrdererMSP&quot;</span><br><span class="line">export CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp</span><br><span class="line">export ORDERER_CA=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem</span><br><span class="line"></span><br><span class="line">peer channel fetch config $CHANNEL_NAME.block -o orderer.example.com:7050 -c $CHANNEL_NAME --tls --cafile $ORDERER_CA</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>以上命令执行结果的最后一行，会显示当前配置所在的区块高度。</p>
<h2 id="解析工具"><a href="#解析工具" class="headerlink" title="解析工具"></a>解析工具</h2><p><code>configtxlator</code>是一个fabric中protbuf和JSON格式之间的转换工具，fabric中任何的使用Protobuf定义的类型，都可使用该工具进行转换。</p>
<h4 id="解析示例"><a href="#解析示例" class="headerlink" title="解析示例"></a>解析示例</h4><p>比如创建通道交易：<code>channel.tx</code>也是protobuf格式的，可以利用此工具解析：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">configtxlator proto_decode  --type common.Envelope --input channel.tx</span><br></pre></td></tr></table></figure>
<ul>
<li><code>--type xxx</code>：阅读源码，找出该proto格式数据对应的数据类型</li>
<li><code>--input xxx</code>：proto格式数据文件</li>
</ul>
<p>结果：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"payload"</span>: &#123;</span><br><span class="line">		<span class="attr">"data"</span>: &#123;</span><br><span class="line">			<span class="attr">"config_update"</span>: &#123;</span><br><span class="line">				<span class="attr">"channel_id"</span>: <span class="string">"mychannel"</span>,</span><br><span class="line">				<span class="attr">"isolated_data"</span>: &#123;&#125;,</span><br><span class="line">				<span class="attr">"read_set"</span>: &#123;</span><br><span class="line">					<span class="attr">"groups"</span>: &#123;</span><br><span class="line">						<span class="attr">"Application"</span>: &#123;</span><br><span class="line">							<span class="attr">"groups"</span>: &#123;</span><br><span class="line">								<span class="attr">"Org1MSP"</span>: &#123;</span><br><span class="line">									<span class="attr">"groups"</span>: &#123;&#125;,</span><br><span class="line">									<span class="attr">"mod_policy"</span>: <span class="string">""</span>,</span><br><span class="line">									<span class="attr">"policies"</span>: &#123;&#125;,</span><br><span class="line">									<span class="attr">"values"</span>: &#123;&#125;,</span><br><span class="line">									<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">								&#125;,</span><br><span class="line">								<span class="attr">"Org2MSP"</span>: &#123;</span><br><span class="line">									<span class="attr">"groups"</span>: &#123;&#125;,</span><br><span class="line">									<span class="attr">"mod_policy"</span>: <span class="string">""</span>,</span><br><span class="line">									<span class="attr">"policies"</span>: &#123;&#125;,</span><br><span class="line">									<span class="attr">"values"</span>: &#123;&#125;,</span><br><span class="line">									<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">								&#125;</span><br><span class="line">							&#125;,</span><br><span class="line">							<span class="attr">"mod_policy"</span>: <span class="string">""</span>,</span><br><span class="line">							<span class="attr">"policies"</span>: &#123;&#125;,</span><br><span class="line">							<span class="attr">"values"</span>: &#123;&#125;,</span><br><span class="line">							<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">						&#125;</span><br><span class="line">					&#125;,</span><br><span class="line">					<span class="attr">"mod_policy"</span>: <span class="string">""</span>,</span><br><span class="line">					<span class="attr">"policies"</span>: &#123;&#125;,</span><br><span class="line">					<span class="attr">"values"</span>: &#123;</span><br><span class="line">						<span class="attr">"Consortium"</span>: &#123;</span><br><span class="line">							<span class="attr">"mod_policy"</span>: <span class="string">""</span>,</span><br><span class="line">							<span class="attr">"value"</span>: <span class="literal">null</span>,</span><br><span class="line">							<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">						&#125;</span><br><span class="line">					&#125;,</span><br><span class="line">					<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">				&#125;,</span><br><span class="line">				<span class="attr">"write_set"</span>: &#123;</span><br><span class="line">					<span class="attr">"groups"</span>: &#123;</span><br><span class="line">						<span class="attr">"Application"</span>: &#123;</span><br><span class="line">							<span class="attr">"groups"</span>: &#123;</span><br><span class="line">								<span class="attr">"Org1MSP"</span>: &#123;</span><br><span class="line">									<span class="attr">"groups"</span>: &#123;&#125;,</span><br><span class="line">									<span class="attr">"mod_policy"</span>: <span class="string">""</span>,</span><br><span class="line">									<span class="attr">"policies"</span>: &#123;&#125;,</span><br><span class="line">									<span class="attr">"values"</span>: &#123;&#125;,</span><br><span class="line">									<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">								&#125;,</span><br><span class="line">								<span class="attr">"Org2MSP"</span>: &#123;</span><br><span class="line">									<span class="attr">"groups"</span>: &#123;&#125;,</span><br><span class="line">									<span class="attr">"mod_policy"</span>: <span class="string">""</span>,</span><br><span class="line">									<span class="attr">"policies"</span>: &#123;&#125;,</span><br><span class="line">									<span class="attr">"values"</span>: &#123;&#125;,</span><br><span class="line">									<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">								&#125;</span><br><span class="line">							&#125;,</span><br><span class="line">							<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">							<span class="attr">"policies"</span>: &#123;</span><br><span class="line">								<span class="attr">"Admins"</span>: &#123;</span><br><span class="line">									<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">									<span class="attr">"policy"</span>: &#123;</span><br><span class="line">										<span class="attr">"type"</span>: <span class="number">3</span>,</span><br><span class="line">										<span class="attr">"value"</span>: &#123;</span><br><span class="line">											<span class="attr">"rule"</span>: <span class="string">"MAJORITY"</span>,</span><br><span class="line">											<span class="attr">"sub_policy"</span>: <span class="string">"Admins"</span></span><br><span class="line">										&#125;</span><br><span class="line">									&#125;,</span><br><span class="line">									<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">								&#125;,</span><br><span class="line">								<span class="attr">"Readers"</span>: &#123;</span><br><span class="line">									<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">									<span class="attr">"policy"</span>: &#123;</span><br><span class="line">										<span class="attr">"type"</span>: <span class="number">3</span>,</span><br><span class="line">										<span class="attr">"value"</span>: &#123;</span><br><span class="line">											<span class="attr">"rule"</span>: <span class="string">"ANY"</span>,</span><br><span class="line">											<span class="attr">"sub_policy"</span>: <span class="string">"Readers"</span></span><br><span class="line">										&#125;</span><br><span class="line">									&#125;,</span><br><span class="line">									<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">								&#125;,</span><br><span class="line">								<span class="attr">"Writers"</span>: &#123;</span><br><span class="line">									<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">									<span class="attr">"policy"</span>: &#123;</span><br><span class="line">										<span class="attr">"type"</span>: <span class="number">3</span>,</span><br><span class="line">										<span class="attr">"value"</span>: &#123;</span><br><span class="line">											<span class="attr">"rule"</span>: <span class="string">"ANY"</span>,</span><br><span class="line">											<span class="attr">"sub_policy"</span>: <span class="string">"Writers"</span></span><br><span class="line">										&#125;</span><br><span class="line">									&#125;,</span><br><span class="line">									<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">								&#125;</span><br><span class="line">							&#125;,</span><br><span class="line">							<span class="attr">"values"</span>: &#123;</span><br><span class="line">								<span class="attr">"Capabilities"</span>: &#123;</span><br><span class="line">									<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">									<span class="attr">"value"</span>: &#123;</span><br><span class="line">										<span class="attr">"capabilities"</span>: &#123;</span><br><span class="line">											<span class="attr">"V1_3"</span>: &#123;&#125;</span><br><span class="line">										&#125;</span><br><span class="line">									&#125;,</span><br><span class="line">									<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">								&#125;</span><br><span class="line">							&#125;,</span><br><span class="line">							<span class="attr">"version"</span>: <span class="string">"1"</span></span><br><span class="line">						&#125;</span><br><span class="line">					&#125;,</span><br><span class="line">					<span class="attr">"mod_policy"</span>: <span class="string">""</span>,</span><br><span class="line">					<span class="attr">"policies"</span>: &#123;&#125;,</span><br><span class="line">					<span class="attr">"values"</span>: &#123;</span><br><span class="line">						<span class="attr">"Consortium"</span>: &#123;</span><br><span class="line">							<span class="attr">"mod_policy"</span>: <span class="string">""</span>,</span><br><span class="line">							<span class="attr">"value"</span>: &#123;</span><br><span class="line">								<span class="attr">"name"</span>: <span class="string">"SampleConsortium"</span></span><br><span class="line">							&#125;,</span><br><span class="line">							<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">						&#125;</span><br><span class="line">					&#125;,</span><br><span class="line">					<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">				&#125;</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="attr">"signatures"</span>: []</span><br><span class="line">		&#125;,</span><br><span class="line">		<span class="attr">"header"</span>: &#123;</span><br><span class="line">			<span class="attr">"channel_header"</span>: &#123;</span><br><span class="line">				<span class="attr">"channel_id"</span>: <span class="string">"mychannel"</span>,</span><br><span class="line">				<span class="attr">"epoch"</span>: <span class="string">"0"</span>,</span><br><span class="line">				<span class="attr">"extension"</span>: <span class="literal">null</span>,</span><br><span class="line">				<span class="attr">"timestamp"</span>: <span class="string">"2019-08-01T06:30:01Z"</span>,</span><br><span class="line">				<span class="attr">"tls_cert_hash"</span>: <span class="literal">null</span>,</span><br><span class="line">				<span class="attr">"tx_id"</span>: <span class="string">""</span>,</span><br><span class="line">				<span class="attr">"type"</span>: <span class="number">2</span>,</span><br><span class="line">				<span class="attr">"version"</span>: <span class="number">0</span></span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="attr">"signature_header"</span>: <span class="literal">null</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">"signature"</span>: <span class="literal">null</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="解析区块"><a href="#解析区块" class="headerlink" title="解析区块"></a>解析区块</h3><p>使用<code>configtxlator</code>可以把区块从protobuf解析成JSON格式，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">configtxlator proto_decode  --type common.Block --input mychannel.block &gt; mychannel.block.json</span><br></pre></td></tr></table></figure>
<p>结果见<a href="常见区块样例">样例</a>。</p>
<h3 id="拓展查询"><a href="#拓展查询" class="headerlink" title="拓展查询"></a>拓展查询</h3><p>Fabric提供了使用<code>peer channel fetch</code>获取区块的功能，但没有提供查询交易、db等信息的接口，那如何办？</p>
<p>获取交易，有方法：<code>GetTransactionByID</code>。</p>
<p>获取DB，有方法：<code>GetStateLevelDBData</code>。</p>
<p>如果结果是非结构体格式的<code>[]byte</code>或者<code>string</code>，可以直接组装成JSON格式，比如<code>GetStateLevelDBData</code>。<code>GetTransactionByID</code>是返回protobuf定义的结构体，可以直接使用<code>configtxlator</code>调用的接口<code>DeepMarshalJSON</code>把结构体转换为JSON字符串。</p>
<p><code>DeepMarshalJSON</code>是tools <code>protolator</code>提供的一个接口，<code>protolator</code>这个工具是完成protobuf数据和JSON数据之间转换的实际工具。利用这些工具和简单的Web框架，可以搭建出查询通道、区块、交易、数据(KV)的简易网站。</p>
<h2 id="常见区块样例"><a href="#常见区块样例" class="headerlink" title="常见区块样例"></a>常见区块样例</h2><p>fabric里包含了2大类区块：</p>
<ol>
<li>配置区块</li>
<li>普通区块</li>
</ol>
<p>区块0是配置区块，又被称为创世块，后续对配置的每一次改动都会生成1个配置块存入所修改配置的通道以及系统通道。</p>
<h3 id="系统通道创世块"><a href="#系统通道创世块" class="headerlink" title="系统通道创世块"></a>系统通道创世块</h3><p>主要是包含了一下配置：</p>
<ol>
<li>组织</li>
<li>通道</li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"data"</span>: &#123;</span><br><span class="line">		<span class="attr">"data"</span>: [&#123;</span><br><span class="line">			<span class="attr">"payload"</span>: &#123;</span><br><span class="line">				<span class="attr">"data"</span>: &#123;</span><br><span class="line">					<span class="attr">"config"</span>: &#123;</span><br><span class="line">						<span class="attr">"channel_group"</span>: &#123;</span><br><span class="line">							<span class="attr">"groups"</span>: &#123;</span><br><span class="line">								<span class="attr">"Consortiums"</span>: &#123;</span><br><span class="line">									<span class="attr">"groups"</span>: &#123;</span><br><span class="line">										<span class="attr">"SampleConsortium"</span>: &#123;</span><br><span class="line">											<span class="attr">"groups"</span>: &#123;</span><br><span class="line">												<span class="attr">"Org1MSP"</span>: &#123;</span><br><span class="line">													<span class="attr">"groups"</span>: &#123;&#125;,</span><br><span class="line">													<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">													<span class="attr">"policies"</span>: &#123;</span><br><span class="line">														<span class="attr">"Admins"</span>: &#123;</span><br><span class="line">															<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">															<span class="attr">"policy"</span>: &#123;</span><br><span class="line">																<span class="attr">"type"</span>: <span class="number">1</span>,</span><br><span class="line">																<span class="attr">"value"</span>: &#123;</span><br><span class="line">																	<span class="attr">"identities"</span>: [&#123;</span><br><span class="line">																		<span class="attr">"principal"</span>: &#123;</span><br><span class="line">																			<span class="attr">"msp_identifier"</span>: <span class="string">"Org1MSP"</span>,</span><br><span class="line">																			<span class="attr">"role"</span>: <span class="string">"ADMIN"</span></span><br><span class="line">																		&#125;,</span><br><span class="line">																		<span class="attr">"principal_classification"</span>: <span class="string">"ROLE"</span></span><br><span class="line">																	&#125;],</span><br><span class="line">																	<span class="attr">"rule"</span>: &#123;</span><br><span class="line">																		<span class="attr">"n_out_of"</span>: &#123;</span><br><span class="line">																			<span class="attr">"n"</span>: <span class="number">1</span>,</span><br><span class="line">																			<span class="attr">"rules"</span>: [&#123;</span><br><span class="line">																				<span class="attr">"signed_by"</span>: <span class="number">0</span></span><br><span class="line">																			&#125;]</span><br><span class="line">																		&#125;</span><br><span class="line">																	&#125;,</span><br><span class="line">																	<span class="attr">"version"</span>: <span class="number">0</span></span><br><span class="line">																&#125;</span><br><span class="line">															&#125;,</span><br><span class="line">															<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">														&#125;,</span><br><span class="line">														<span class="attr">"Readers"</span>: &#123;</span><br><span class="line">															<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">															<span class="attr">"policy"</span>: &#123;</span><br><span class="line">																<span class="attr">"type"</span>: <span class="number">1</span>,</span><br><span class="line">																<span class="attr">"value"</span>: &#123;</span><br><span class="line">																	<span class="attr">"identities"</span>: [&#123;</span><br><span class="line">																			<span class="attr">"principal"</span>: &#123;</span><br><span class="line">																				<span class="attr">"msp_identifier"</span>: <span class="string">"Org1MSP"</span>,</span><br><span class="line">																				<span class="attr">"role"</span>: <span class="string">"ADMIN"</span></span><br><span class="line">																			&#125;,</span><br><span class="line">																			<span class="attr">"principal_classification"</span>: <span class="string">"ROLE"</span></span><br><span class="line">																		&#125;,</span><br><span class="line">																		&#123;</span><br><span class="line">																			<span class="attr">"principal"</span>: &#123;</span><br><span class="line">																				<span class="attr">"msp_identifier"</span>: <span class="string">"Org1MSP"</span>,</span><br><span class="line">																				<span class="attr">"role"</span>: <span class="string">"PEER"</span></span><br><span class="line">																			&#125;,</span><br><span class="line">																			<span class="attr">"principal_classification"</span>: <span class="string">"ROLE"</span></span><br><span class="line">																		&#125;,</span><br><span class="line">																		&#123;</span><br><span class="line">																			<span class="attr">"principal"</span>: &#123;</span><br><span class="line">																				<span class="attr">"msp_identifier"</span>: <span class="string">"Org1MSP"</span>,</span><br><span class="line">																				<span class="attr">"role"</span>: <span class="string">"CLIENT"</span></span><br><span class="line">																			&#125;,</span><br><span class="line">																			<span class="attr">"principal_classification"</span>: <span class="string">"ROLE"</span></span><br><span class="line">																		&#125;</span><br><span class="line">																	],</span><br><span class="line">																	<span class="attr">"rule"</span>: &#123;</span><br><span class="line">																		<span class="attr">"n_out_of"</span>: &#123;</span><br><span class="line">																			<span class="attr">"n"</span>: <span class="number">1</span>,</span><br><span class="line">																			<span class="attr">"rules"</span>: [&#123;</span><br><span class="line">																					<span class="attr">"signed_by"</span>: <span class="number">0</span></span><br><span class="line">																				&#125;,</span><br><span class="line">																				&#123;</span><br><span class="line">																					<span class="attr">"signed_by"</span>: <span class="number">1</span></span><br><span class="line">																				&#125;,</span><br><span class="line">																				&#123;</span><br><span class="line">																					<span class="attr">"signed_by"</span>: <span class="number">2</span></span><br><span class="line">																				&#125;</span><br><span class="line">																			]</span><br><span class="line">																		&#125;</span><br><span class="line">																	&#125;,</span><br><span class="line">																	<span class="attr">"version"</span>: <span class="number">0</span></span><br><span class="line">																&#125;</span><br><span class="line">															&#125;,</span><br><span class="line">															<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">														&#125;,</span><br><span class="line">														<span class="attr">"Writers"</span>: &#123;</span><br><span class="line">															<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">															<span class="attr">"policy"</span>: &#123;</span><br><span class="line">																<span class="attr">"type"</span>: <span class="number">1</span>,</span><br><span class="line">																<span class="attr">"value"</span>: &#123;</span><br><span class="line">																	<span class="attr">"identities"</span>: [&#123;</span><br><span class="line">																			<span class="attr">"principal"</span>: &#123;</span><br><span class="line">																				<span class="attr">"msp_identifier"</span>: <span class="string">"Org1MSP"</span>,</span><br><span class="line">																				<span class="attr">"role"</span>: <span class="string">"ADMIN"</span></span><br><span class="line">																			&#125;,</span><br><span class="line">																			<span class="attr">"principal_classification"</span>: <span class="string">"ROLE"</span></span><br><span class="line">																		&#125;,</span><br><span class="line">																		&#123;</span><br><span class="line">																			<span class="attr">"principal"</span>: &#123;</span><br><span class="line">																				<span class="attr">"msp_identifier"</span>: <span class="string">"Org1MSP"</span>,</span><br><span class="line">																				<span class="attr">"role"</span>: <span class="string">"CLIENT"</span></span><br><span class="line">																			&#125;,</span><br><span class="line">																			<span class="attr">"principal_classification"</span>: <span class="string">"ROLE"</span></span><br><span class="line">																		&#125;</span><br><span class="line">																	],</span><br><span class="line">																	<span class="attr">"rule"</span>: &#123;</span><br><span class="line">																		<span class="attr">"n_out_of"</span>: &#123;</span><br><span class="line">																			<span class="attr">"n"</span>: <span class="number">1</span>,</span><br><span class="line">																			<span class="attr">"rules"</span>: [&#123;</span><br><span class="line">																					<span class="attr">"signed_by"</span>: <span class="number">0</span></span><br><span class="line">																				&#125;,</span><br><span class="line">																				&#123;</span><br><span class="line">																					<span class="attr">"signed_by"</span>: <span class="number">1</span></span><br><span class="line">																				&#125;</span><br><span class="line">																			]</span><br><span class="line">																		&#125;</span><br><span class="line">																	&#125;,</span><br><span class="line">																	<span class="attr">"version"</span>: <span class="number">0</span></span><br><span class="line">																&#125;</span><br><span class="line">															&#125;,</span><br><span class="line">															<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">														&#125;</span><br><span class="line">													&#125;,</span><br><span class="line">													<span class="attr">"values"</span>: &#123;</span><br><span class="line">														<span class="attr">"MSP"</span>: &#123;</span><br><span class="line">															<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">															<span class="attr">"value"</span>: &#123;</span><br><span class="line">																<span class="attr">"config"</span>: &#123;</span><br><span class="line">																	<span class="attr">"admins"</span>: [</span><br><span class="line">																		<span class="string">"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNLVENDQWRDZ0F3SUJBZ0lRUEtTRHJHNWRTT0liVHRLM3pqcEhlVEFLQmdncWhrak9QUVFEQWpCek1Rc3cKQ1FZRFZRUUdFd0pWVXpFVE1CRUdBMVVFQ0JNS1EyRnNhV1p2Y201cFlURVdNQlFHQTFVRUJ4TU5VMkZ1SUVaeQpZVzVqYVhOamJ6RVpNQmNHQTFVRUNoTVFiM0puTVM1bGVHRnRjR3hsTG1OdmJURWNNQm9HQTFVRUF4TVRZMkV1CmIzSm5NUzVsZUdGdGNHeGxMbU52YlRBZUZ3MHhPVEE0TURFd01qRTBNREJhRncweU9UQTNNamt3TWpFME1EQmEKTUd3eEN6QUpCZ05WQkFZVEFsVlRNUk13RVFZRFZRUUlFd3BEWVd4cFptOXlibWxoTVJZd0ZBWURWUVFIRXcxVApZVzRnUm5KaGJtTnBjMk52TVE4d0RRWURWUVFMRXdaamJHbGxiblF4SHpBZEJnTlZCQU1NRmtGa2JXbHVRRzl5Clp6RXVaWGhoYlhCc1pTNWpiMjB3V1RBVEJnY3Foa2pPUFFJQkJnZ3Foa2pPUFFNQkJ3TkNBQVFiNEZydmg1V2oKclBSOTFIdFdSaFVORVpxQXFOL2pEYkhUbUtDSXBkY3k3K2JGTUduaUprdTExaTl2ajN6TnNQMGQrSWlSRDdiMgpJSlhVaGxZbVJjcXVvMDB3U3pBT0JnTlZIUThCQWY4RUJBTUNCNEF3REFZRFZSMFRBUUgvQkFJd0FEQXJCZ05WCkhTTUVKREFpZ0NCVUdsTldyVThlZFBPakorMkc3M2UyU1FEdjVYdFUzSWYrSTJEMmo4VWdFREFLQmdncWhrak8KUFFRREFnTkhBREJFQWlBRFB6Qk5uKytROURXd0VUS0ErRTQyNG5vekVzZjRFd2JzQWxuUCtXNU10UUlnSDc3Two3dEVJUFZacTRvVUtSb1I5QWsvUEUrWUFzYk4vdHZhVlZlZ2dLTGc9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K"</span></span><br><span class="line">																	],</span><br><span class="line">																	<span class="attr">"crypto_config"</span>: &#123;</span><br><span class="line">																		<span class="attr">"identity_identifier_hash_function"</span>: <span class="string">"SHA256"</span>,</span><br><span class="line">																		<span class="attr">"signature_hash_family"</span>: <span class="string">"SHA2"</span></span><br><span class="line">																	&#125;,</span><br><span class="line">																	<span class="attr">"fabric_node_ous"</span>: &#123;</span><br><span class="line">																		<span class="attr">"client_ou_identifier"</span>: &#123;</span><br><span class="line">																			<span class="attr">"certificate"</span>: <span class="string">"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNVRENDQWZlZ0F3SUJBZ0lRSnJqamM3b1RSLy8zSG9wcDFYY0Y4VEFLQmdncWhrak9QUVFEQWpCek1Rc3cKQ1FZRFZRUUdFd0pWVXpFVE1CRUdBMVVFQ0JNS1EyRnNhV1p2Y201cFlURVdNQlFHQTFVRUJ4TU5VMkZ1SUVaeQpZVzVqYVhOamJ6RVpNQmNHQTFVRUNoTVFiM0puTVM1bGVHRnRjR3hsTG1OdmJURWNNQm9HQTFVRUF4TVRZMkV1CmIzSm5NUzVsZUdGdGNHeGxMbU52YlRBZUZ3MHhPVEE0TURFd01qRTBNREJhRncweU9UQTNNamt3TWpFME1EQmEKTUhNeEN6QUpCZ05WQkFZVEFsVlRNUk13RVFZRFZRUUlFd3BEWVd4cFptOXlibWxoTVJZd0ZBWURWUVFIRXcxVApZVzRnUm5KaGJtTnBjMk52TVJrd0Z3WURWUVFLRXhCdmNtY3hMbVY0WVcxd2JHVXVZMjl0TVJ3d0dnWURWUVFECkV4TmpZUzV2Y21jeExtVjRZVzF3YkdVdVkyOXRNRmt3RXdZSEtvWkl6ajBDQVFZSUtvWkl6ajBEQVFjRFFnQUUKSmNFQkUvUlF1Ty9JR2h0QWJjSnhnTEhyMHNEbENFS0dpQnA3NXlRYytjdUFQK21NWDI4TGtWTERJaGhELzV5MgpiMTJUM1o4Z1Y1N2tMOHdrUTM1SXpxTnRNR3N3RGdZRFZSMFBBUUgvQkFRREFnR21NQjBHQTFVZEpRUVdNQlFHCkNDc0dBUVVGQndNQ0JnZ3JCZ0VGQlFjREFUQVBCZ05WSFJNQkFmOEVCVEFEQVFIL01Da0dBMVVkRGdRaUJDQlUKR2xOV3JVOGVkUE9qSisyRzczZTJTUUR2NVh0VTNJZitJMkQyajhVZ0VEQUtCZ2dxaGtqT1BRUURBZ05IQURCRQpBaUF3YzVYMVZLVGZQM0ZqL0o1Tk9wVHlNU08vU2MzcnFhbmxOelRUbk5VRmZnSWdNZi9HVWpjcjhra1V2Y2hBCjlzM0NIc1VYZ1loTWNPaHVxWFJmZHdTRC9XRT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo="</span>,</span><br><span class="line">																			<span class="attr">"organizational_unit_identifier"</span>: <span class="string">"client"</span></span><br><span class="line">																		&#125;,</span><br><span class="line">																		<span class="attr">"enable"</span>: <span class="literal">true</span>,</span><br><span class="line">																		<span class="attr">"peer_ou_identifier"</span>: &#123;</span><br><span class="line">																			<span class="attr">"certificate"</span>: <span class="string">"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNVRENDQWZlZ0F3SUJBZ0lRSnJqamM3b1RSLy8zSG9wcDFYY0Y4VEFLQmdncWhrak9QUVFEQWpCek1Rc3cKQ1FZRFZRUUdFd0pWVXpFVE1CRUdBMVVFQ0JNS1EyRnNhV1p2Y201cFlURVdNQlFHQTFVRUJ4TU5VMkZ1SUVaeQpZVzVqYVhOamJ6RVpNQmNHQTFVRUNoTVFiM0puTVM1bGVHRnRjR3hsTG1OdmJURWNNQm9HQTFVRUF4TVRZMkV1CmIzSm5NUzVsZUdGdGNHeGxMbU52YlRBZUZ3MHhPVEE0TURFd01qRTBNREJhRncweU9UQTNNamt3TWpFME1EQmEKTUhNeEN6QUpCZ05WQkFZVEFsVlRNUk13RVFZRFZRUUlFd3BEWVd4cFptOXlibWxoTVJZd0ZBWURWUVFIRXcxVApZVzRnUm5KaGJtTnBjMk52TVJrd0Z3WURWUVFLRXhCdmNtY3hMbVY0WVcxd2JHVXVZMjl0TVJ3d0dnWURWUVFECkV4TmpZUzV2Y21jeExtVjRZVzF3YkdVdVkyOXRNRmt3RXdZSEtvWkl6ajBDQVFZSUtvWkl6ajBEQVFjRFFnQUUKSmNFQkUvUlF1Ty9JR2h0QWJjSnhnTEhyMHNEbENFS0dpQnA3NXlRYytjdUFQK21NWDI4TGtWTERJaGhELzV5MgpiMTJUM1o4Z1Y1N2tMOHdrUTM1SXpxTnRNR3N3RGdZRFZSMFBBUUgvQkFRREFnR21NQjBHQTFVZEpRUVdNQlFHCkNDc0dBUVVGQndNQ0JnZ3JCZ0VGQlFjREFUQVBCZ05WSFJNQkFmOEVCVEFEQVFIL01Da0dBMVVkRGdRaUJDQlUKR2xOV3JVOGVkUE9qSisyRzczZTJTUUR2NVh0VTNJZitJMkQyajhVZ0VEQUtCZ2dxaGtqT1BRUURBZ05IQURCRQpBaUF3YzVYMVZLVGZQM0ZqL0o1Tk9wVHlNU08vU2MzcnFhbmxOelRUbk5VRmZnSWdNZi9HVWpjcjhra1V2Y2hBCjlzM0NIc1VYZ1loTWNPaHVxWFJmZHdTRC9XRT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo="</span>,</span><br><span class="line">																			<span class="attr">"organizational_unit_identifier"</span>: <span class="string">"peer"</span></span><br><span class="line">																		&#125;</span><br><span class="line">																	&#125;,</span><br><span class="line">																	<span class="attr">"intermediate_certs"</span>: [],</span><br><span class="line">																	<span class="attr">"name"</span>: <span class="string">"Org1MSP"</span>,</span><br><span class="line">																	<span class="attr">"organizational_unit_identifiers"</span>: [],</span><br><span class="line">																	<span class="attr">"revocation_list"</span>: [],</span><br><span class="line">																	<span class="attr">"root_certs"</span>: [</span><br><span class="line">																		<span class="string">"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNVRENDQWZlZ0F3SUJBZ0lRSnJqamM3b1RSLy8zSG9wcDFYY0Y4VEFLQmdncWhrak9QUVFEQWpCek1Rc3cKQ1FZRFZRUUdFd0pWVXpFVE1CRUdBMVVFQ0JNS1EyRnNhV1p2Y201cFlURVdNQlFHQTFVRUJ4TU5VMkZ1SUVaeQpZVzVqYVhOamJ6RVpNQmNHQTFVRUNoTVFiM0puTVM1bGVHRnRjR3hsTG1OdmJURWNNQm9HQTFVRUF4TVRZMkV1CmIzSm5NUzVsZUdGdGNHeGxMbU52YlRBZUZ3MHhPVEE0TURFd01qRTBNREJhRncweU9UQTNNamt3TWpFME1EQmEKTUhNeEN6QUpCZ05WQkFZVEFsVlRNUk13RVFZRFZRUUlFd3BEWVd4cFptOXlibWxoTVJZd0ZBWURWUVFIRXcxVApZVzRnUm5KaGJtTnBjMk52TVJrd0Z3WURWUVFLRXhCdmNtY3hMbVY0WVcxd2JHVXVZMjl0TVJ3d0dnWURWUVFECkV4TmpZUzV2Y21jeExtVjRZVzF3YkdVdVkyOXRNRmt3RXdZSEtvWkl6ajBDQVFZSUtvWkl6ajBEQVFjRFFnQUUKSmNFQkUvUlF1Ty9JR2h0QWJjSnhnTEhyMHNEbENFS0dpQnA3NXlRYytjdUFQK21NWDI4TGtWTERJaGhELzV5MgpiMTJUM1o4Z1Y1N2tMOHdrUTM1SXpxTnRNR3N3RGdZRFZSMFBBUUgvQkFRREFnR21NQjBHQTFVZEpRUVdNQlFHCkNDc0dBUVVGQndNQ0JnZ3JCZ0VGQlFjREFUQVBCZ05WSFJNQkFmOEVCVEFEQVFIL01Da0dBMVVkRGdRaUJDQlUKR2xOV3JVOGVkUE9qSisyRzczZTJTUUR2NVh0VTNJZitJMkQyajhVZ0VEQUtCZ2dxaGtqT1BRUURBZ05IQURCRQpBaUF3YzVYMVZLVGZQM0ZqL0o1Tk9wVHlNU08vU2MzcnFhbmxOelRUbk5VRmZnSWdNZi9HVWpjcjhra1V2Y2hBCjlzM0NIc1VYZ1loTWNPaHVxWFJmZHdTRC9XRT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo="</span></span><br><span class="line">																	],</span><br><span class="line">																	<span class="attr">"signing_identity"</span>: <span class="literal">null</span>,</span><br><span class="line">																	<span class="attr">"tls_intermediate_certs"</span>: [],</span><br><span class="line">																	<span class="attr">"tls_root_certs"</span>: [</span><br><span class="line">																		<span class="string">"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNWakNDQWYyZ0F3SUJBZ0lRQldDNzUzQUphWXVOSkhqeVpGb1JvVEFLQmdncWhrak9QUVFEQWpCMk1Rc3cKQ1FZRFZRUUdFd0pWVXpFVE1CRUdBMVVFQ0JNS1EyRnNhV1p2Y201cFlURVdNQlFHQTFVRUJ4TU5VMkZ1SUVaeQpZVzVqYVhOamJ6RVpNQmNHQTFVRUNoTVFiM0puTVM1bGVHRnRjR3hsTG1OdmJURWZNQjBHQTFVRUF4TVdkR3h6ClkyRXViM0puTVM1bGVHRnRjR3hsTG1OdmJUQWVGdzB4T1RBNE1ERXdNakUwTURCYUZ3MHlPVEEzTWprd01qRTAKTURCYU1IWXhDekFKQmdOVkJBWVRBbFZUTVJNd0VRWURWUVFJRXdwRFlXeHBabTl5Ym1saE1SWXdGQVlEVlFRSApFdzFUWVc0Z1JuSmhibU5wYzJOdk1Sa3dGd1lEVlFRS0V4QnZjbWN4TG1WNFlXMXdiR1V1WTI5dE1SOHdIUVlEClZRUURFeFowYkhOallTNXZjbWN4TG1WNFlXMXdiR1V1WTI5dE1Ga3dFd1lIS29aSXpqMENBUVlJS29aSXpqMEQKQVFjRFFnQUVJcWRZYWtLRmtKRm1NZEhDRnVGdkJIVXZMMFhUa0RJTG40Qm5vdW5GWUFaWmRFNFdpQ1lkcnJsSwpjTmpQWG1pNXZEajcrQmhoWXBaQjRnbHZRbUpDb2FOdE1Hc3dEZ1lEVlIwUEFRSC9CQVFEQWdHbU1CMEdBMVVkCkpRUVdNQlFHQ0NzR0FRVUZCd01DQmdnckJnRUZCUWNEQVRBUEJnTlZIUk1CQWY4RUJUQURBUUgvTUNrR0ExVWQKRGdRaUJDQ0JzMVk5ZjhzTjFBYndZdnFzcEdLRzBIenhTQ2RyWEdHdUVvc2dGb3BQcVRBS0JnZ3Foa2pPUFFRRApBZ05IQURCRUFpQnF5VzBOL0xhMTRlTVh4SXIzNWVQbXVXdXpQQnJrd1h4RG9pd1RtdXJzZ1FJZ0JRRkZJdVl5CmRSVk4zOHdZSU5vUU16eW5Uek93NFNBMXpRdUs3QzViZGk0PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg=="</span></span><br><span class="line">																	]</span><br><span class="line">																&#125;,</span><br><span class="line">																<span class="attr">"type"</span>: <span class="number">0</span></span><br><span class="line">															&#125;,</span><br><span class="line">															<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">														&#125;</span><br><span class="line">													&#125;,</span><br><span class="line">													<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">												&#125;,</span><br><span class="line">												<span class="attr">"Org2MSP"</span>: &#123;</span><br><span class="line">													<span class="attr">"groups"</span>: &#123;&#125;,</span><br><span class="line">													<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">													<span class="attr">"policies"</span>: &#123;</span><br><span class="line">														<span class="attr">"Admins"</span>: &#123;</span><br><span class="line">															<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">															<span class="attr">"policy"</span>: &#123;</span><br><span class="line">																<span class="attr">"type"</span>: <span class="number">1</span>,</span><br><span class="line">																<span class="attr">"value"</span>: &#123;</span><br><span class="line">																	<span class="attr">"identities"</span>: [&#123;</span><br><span class="line">																		<span class="attr">"principal"</span>: &#123;</span><br><span class="line">																			<span class="attr">"msp_identifier"</span>: <span class="string">"Org2MSP"</span>,</span><br><span class="line">																			<span class="attr">"role"</span>: <span class="string">"ADMIN"</span></span><br><span class="line">																		&#125;,</span><br><span class="line">																		<span class="attr">"principal_classification"</span>: <span class="string">"ROLE"</span></span><br><span class="line">																	&#125;],</span><br><span class="line">																	<span class="attr">"rule"</span>: &#123;</span><br><span class="line">																		<span class="attr">"n_out_of"</span>: &#123;</span><br><span class="line">																			<span class="attr">"n"</span>: <span class="number">1</span>,</span><br><span class="line">																			<span class="attr">"rules"</span>: [&#123;</span><br><span class="line">																				<span class="attr">"signed_by"</span>: <span class="number">0</span></span><br><span class="line">																			&#125;]</span><br><span class="line">																		&#125;</span><br><span class="line">																	&#125;,</span><br><span class="line">																	<span class="attr">"version"</span>: <span class="number">0</span></span><br><span class="line">																&#125;</span><br><span class="line">															&#125;,</span><br><span class="line">															<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">														&#125;,</span><br><span class="line">														<span class="attr">"Readers"</span>: &#123;</span><br><span class="line">															<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">															<span class="attr">"policy"</span>: &#123;</span><br><span class="line">																<span class="attr">"type"</span>: <span class="number">1</span>,</span><br><span class="line">																<span class="attr">"value"</span>: &#123;</span><br><span class="line">																	<span class="attr">"identities"</span>: [&#123;</span><br><span class="line">																			<span class="attr">"principal"</span>: &#123;</span><br><span class="line">																				<span class="attr">"msp_identifier"</span>: <span class="string">"Org2MSP"</span>,</span><br><span class="line">																				<span class="attr">"role"</span>: <span class="string">"ADMIN"</span></span><br><span class="line">																			&#125;,</span><br><span class="line">																			<span class="attr">"principal_classification"</span>: <span class="string">"ROLE"</span></span><br><span class="line">																		&#125;,</span><br><span class="line">																		&#123;</span><br><span class="line">																			<span class="attr">"principal"</span>: &#123;</span><br><span class="line">																				<span class="attr">"msp_identifier"</span>: <span class="string">"Org2MSP"</span>,</span><br><span class="line">																				<span class="attr">"role"</span>: <span class="string">"PEER"</span></span><br><span class="line">																			&#125;,</span><br><span class="line">																			<span class="attr">"principal_classification"</span>: <span class="string">"ROLE"</span></span><br><span class="line">																		&#125;,</span><br><span class="line">																		&#123;</span><br><span class="line">																			<span class="attr">"principal"</span>: &#123;</span><br><span class="line">																				<span class="attr">"msp_identifier"</span>: <span class="string">"Org2MSP"</span>,</span><br><span class="line">																				<span class="attr">"role"</span>: <span class="string">"CLIENT"</span></span><br><span class="line">																			&#125;,</span><br><span class="line">																			<span class="attr">"principal_classification"</span>: <span class="string">"ROLE"</span></span><br><span class="line">																		&#125;</span><br><span class="line">																	],</span><br><span class="line">																	<span class="attr">"rule"</span>: &#123;</span><br><span class="line">																		<span class="attr">"n_out_of"</span>: &#123;</span><br><span class="line">																			<span class="attr">"n"</span>: <span class="number">1</span>,</span><br><span class="line">																			<span class="attr">"rules"</span>: [&#123;</span><br><span class="line">																					<span class="attr">"signed_by"</span>: <span class="number">0</span></span><br><span class="line">																				&#125;,</span><br><span class="line">																				&#123;</span><br><span class="line">																					<span class="attr">"signed_by"</span>: <span class="number">1</span></span><br><span class="line">																				&#125;,</span><br><span class="line">																				&#123;</span><br><span class="line">																					<span class="attr">"signed_by"</span>: <span class="number">2</span></span><br><span class="line">																				&#125;</span><br><span class="line">																			]</span><br><span class="line">																		&#125;</span><br><span class="line">																	&#125;,</span><br><span class="line">																	<span class="attr">"version"</span>: <span class="number">0</span></span><br><span class="line">																&#125;</span><br><span class="line">															&#125;,</span><br><span class="line">															<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">														&#125;,</span><br><span class="line">														<span class="attr">"Writers"</span>: &#123;</span><br><span class="line">															<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">															<span class="attr">"policy"</span>: &#123;</span><br><span class="line">																<span class="attr">"type"</span>: <span class="number">1</span>,</span><br><span class="line">																<span class="attr">"value"</span>: &#123;</span><br><span class="line">																	<span class="attr">"identities"</span>: [&#123;</span><br><span class="line">																			<span class="attr">"principal"</span>: &#123;</span><br><span class="line">																				<span class="attr">"msp_identifier"</span>: <span class="string">"Org2MSP"</span>,</span><br><span class="line">																				<span class="attr">"role"</span>: <span class="string">"ADMIN"</span></span><br><span class="line">																			&#125;,</span><br><span class="line">																			<span class="attr">"principal_classification"</span>: <span class="string">"ROLE"</span></span><br><span class="line">																		&#125;,</span><br><span class="line">																		&#123;</span><br><span class="line">																			<span class="attr">"principal"</span>: &#123;</span><br><span class="line">																				<span class="attr">"msp_identifier"</span>: <span class="string">"Org2MSP"</span>,</span><br><span class="line">																				<span class="attr">"role"</span>: <span class="string">"CLIENT"</span></span><br><span class="line">																			&#125;,</span><br><span class="line">																			<span class="attr">"principal_classification"</span>: <span class="string">"ROLE"</span></span><br><span class="line">																		&#125;</span><br><span class="line">																	],</span><br><span class="line">																	<span class="attr">"rule"</span>: &#123;</span><br><span class="line">																		<span class="attr">"n_out_of"</span>: &#123;</span><br><span class="line">																			<span class="attr">"n"</span>: <span class="number">1</span>,</span><br><span class="line">																			<span class="attr">"rules"</span>: [&#123;</span><br><span class="line">																					<span class="attr">"signed_by"</span>: <span class="number">0</span></span><br><span class="line">																				&#125;,</span><br><span class="line">																				&#123;</span><br><span class="line">																					<span class="attr">"signed_by"</span>: <span class="number">1</span></span><br><span class="line">																				&#125;</span><br><span class="line">																			]</span><br><span class="line">																		&#125;</span><br><span class="line">																	&#125;,</span><br><span class="line">																	<span class="attr">"version"</span>: <span class="number">0</span></span><br><span class="line">																&#125;</span><br><span class="line">															&#125;,</span><br><span class="line">															<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">														&#125;</span><br><span class="line">													&#125;,</span><br><span class="line">													<span class="attr">"values"</span>: &#123;</span><br><span class="line">														<span class="attr">"MSP"</span>: &#123;</span><br><span class="line">															<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">															<span class="attr">"value"</span>: &#123;</span><br><span class="line">																<span class="attr">"config"</span>: &#123;</span><br><span class="line">																	<span class="attr">"admins"</span>: [</span><br><span class="line">																		<span class="string">"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNLekNDQWRHZ0F3SUJBZ0lSQUo5YnI3UHJmQWg5cHVVcDFMZkJ3V0V3Q2dZSUtvWkl6ajBFQXdJd2N6RUwKTUFrR0ExVUVCaE1DVlZNeEV6QVJCZ05WQkFnVENrTmhiR2xtYjNKdWFXRXhGakFVQmdOVkJBY1REVk5oYmlCRwpjbUZ1WTJselkyOHhHVEFYQmdOVkJBb1RFRzl5WnpJdVpYaGhiWEJzWlM1amIyMHhIREFhQmdOVkJBTVRFMk5oCkxtOXlaekl1WlhoaGJYQnNaUzVqYjIwd0hoY05NVGt3T0RBeE1ESXhOREF3V2hjTk1qa3dOekk1TURJeE5EQXcKV2pCc01Rc3dDUVlEVlFRR0V3SlZVekVUTUJFR0ExVUVDQk1LUTJGc2FXWnZjbTVwWVRFV01CUUdBMVVFQnhNTgpVMkZ1SUVaeVlXNWphWE5qYnpFUE1BMEdBMVVFQ3hNR1kyeHBaVzUwTVI4d0hRWURWUVFEREJaQlpHMXBia0J2CmNtY3lMbVY0WVcxd2JHVXVZMjl0TUZrd0V3WUhLb1pJemowQ0FRWUlLb1pJemowREFRY0RRZ0FFZndwdkRmOHoKWVdVaWxwclcxQ2hsc3hBaDhVcjBLQXpUYm9oc0oyQjFNWk40ZkVUakhKTHRnWjZDT0ZRaVFoNy9BK1NyNVhYdApDRnpvNUZWSlNSNmc2YU5OTUVzd0RnWURWUjBQQVFIL0JBUURBZ2VBTUF3R0ExVWRFd0VCL3dRQ01BQXdLd1lEClZSMGpCQ1F3SW9BZ21RRjBZbjNvczlwUEhXQ01ra3U4VXUzYks0cmY1QUllUTYwUVgyNHh4cjh3Q2dZSUtvWkkKemowRUF3SURTQUF3UlFJaEFPVUZRWUMvZE1ZMGZ0U2JNYVFLL213Uy83a0JyRWZicXFNaHBwWjlqWG1uQWlCeQpjczdFalFuZHJ2RHRMZnVPUEY4QnJyVGZPdWZDTTVNN09YSDl4S2ZQdVE9PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg=="</span></span><br><span class="line">																	],</span><br><span class="line">																	<span class="attr">"crypto_config"</span>: &#123;</span><br><span class="line">																		<span class="attr">"identity_identifier_hash_function"</span>: <span class="string">"SHA256"</span>,</span><br><span class="line">																		<span class="attr">"signature_hash_family"</span>: <span class="string">"SHA2"</span></span><br><span class="line">																	&#125;,</span><br><span class="line">																	<span class="attr">"fabric_node_ous"</span>: &#123;</span><br><span class="line">																		<span class="attr">"client_ou_identifier"</span>: &#123;</span><br><span class="line">																			<span class="attr">"certificate"</span>: <span class="string">"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNVakNDQWZpZ0F3SUJBZ0lSQU1rYVQ5em1XTEo2bFVNUlhRZmgrSTh3Q2dZSUtvWkl6ajBFQXdJd2N6RUwKTUFrR0ExVUVCaE1DVlZNeEV6QVJCZ05WQkFnVENrTmhiR2xtYjNKdWFXRXhGakFVQmdOVkJBY1REVk5oYmlCRwpjbUZ1WTJselkyOHhHVEFYQmdOVkJBb1RFRzl5WnpJdVpYaGhiWEJzWlM1amIyMHhIREFhQmdOVkJBTVRFMk5oCkxtOXlaekl1WlhoaGJYQnNaUzVqYjIwd0hoY05NVGt3T0RBeE1ESXhOREF3V2hjTk1qa3dOekk1TURJeE5EQXcKV2pCek1Rc3dDUVlEVlFRR0V3SlZVekVUTUJFR0ExVUVDQk1LUTJGc2FXWnZjbTVwWVRFV01CUUdBMVVFQnhNTgpVMkZ1SUVaeVlXNWphWE5qYnpFWk1CY0dBMVVFQ2hNUWIzSm5NaTVsZUdGdGNHeGxMbU52YlRFY01Cb0dBMVVFCkF4TVRZMkV1YjNKbk1pNWxlR0Z0Y0d4bExtTnZiVEJaTUJNR0J5cUdTTTQ5QWdFR0NDcUdTTTQ5QXdFSEEwSUEKQkpZSEEzOVNmbjczdXFIT0JrTzJ0R1pucFdvR09NRHFmRkJwZG9FOXhCTzNCdFZaT2hMblBYY01MRGErcTdJMQpxbFJHQmh4TTVpLzZ1L0V4Z2psaTVVK2piVEJyTUE0R0ExVWREd0VCL3dRRUF3SUJwakFkQmdOVkhTVUVGakFVCkJnZ3JCZ0VGQlFjREFnWUlLd1lCQlFVSEF3RXdEd1lEVlIwVEFRSC9CQVV3QXdFQi96QXBCZ05WSFE0RUlnUWcKbVFGMFluM29zOXBQSFdDTWtrdThVdTNiSzRyZjVBSWVRNjBRWDI0eHhyOHdDZ1lJS29aSXpqMEVBd0lEU0FBdwpSUUloQUpzYVBHWklWTkU4S09zbjJzZ2ZSSlo1ek1BbEpIS1p3V1lJQTljVVNWS1FBaUF6ZkIrL0VMUFQrbFFmCjZUNmhEQXU1bkwwRGpoUUxqa0ZmL3RXNUVDMzlCQT09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K"</span>,</span><br><span class="line">																			<span class="attr">"organizational_unit_identifier"</span>: <span class="string">"client"</span></span><br><span class="line">																		&#125;,</span><br><span class="line">																		<span class="attr">"enable"</span>: <span class="literal">true</span>,</span><br><span class="line">																		<span class="attr">"peer_ou_identifier"</span>: &#123;</span><br><span class="line">																			<span class="attr">"certificate"</span>: <span class="string">"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNVakNDQWZpZ0F3SUJBZ0lSQU1rYVQ5em1XTEo2bFVNUlhRZmgrSTh3Q2dZSUtvWkl6ajBFQXdJd2N6RUwKTUFrR0ExVUVCaE1DVlZNeEV6QVJCZ05WQkFnVENrTmhiR2xtYjNKdWFXRXhGakFVQmdOVkJBY1REVk5oYmlCRwpjbUZ1WTJselkyOHhHVEFYQmdOVkJBb1RFRzl5WnpJdVpYaGhiWEJzWlM1amIyMHhIREFhQmdOVkJBTVRFMk5oCkxtOXlaekl1WlhoaGJYQnNaUzVqYjIwd0hoY05NVGt3T0RBeE1ESXhOREF3V2hjTk1qa3dOekk1TURJeE5EQXcKV2pCek1Rc3dDUVlEVlFRR0V3SlZVekVUTUJFR0ExVUVDQk1LUTJGc2FXWnZjbTVwWVRFV01CUUdBMVVFQnhNTgpVMkZ1SUVaeVlXNWphWE5qYnpFWk1CY0dBMVVFQ2hNUWIzSm5NaTVsZUdGdGNHeGxMbU52YlRFY01Cb0dBMVVFCkF4TVRZMkV1YjNKbk1pNWxlR0Z0Y0d4bExtTnZiVEJaTUJNR0J5cUdTTTQ5QWdFR0NDcUdTTTQ5QXdFSEEwSUEKQkpZSEEzOVNmbjczdXFIT0JrTzJ0R1pucFdvR09NRHFmRkJwZG9FOXhCTzNCdFZaT2hMblBYY01MRGErcTdJMQpxbFJHQmh4TTVpLzZ1L0V4Z2psaTVVK2piVEJyTUE0R0ExVWREd0VCL3dRRUF3SUJwakFkQmdOVkhTVUVGakFVCkJnZ3JCZ0VGQlFjREFnWUlLd1lCQlFVSEF3RXdEd1lEVlIwVEFRSC9CQVV3QXdFQi96QXBCZ05WSFE0RUlnUWcKbVFGMFluM29zOXBQSFdDTWtrdThVdTNiSzRyZjVBSWVRNjBRWDI0eHhyOHdDZ1lJS29aSXpqMEVBd0lEU0FBdwpSUUloQUpzYVBHWklWTkU4S09zbjJzZ2ZSSlo1ek1BbEpIS1p3V1lJQTljVVNWS1FBaUF6ZkIrL0VMUFQrbFFmCjZUNmhEQXU1bkwwRGpoUUxqa0ZmL3RXNUVDMzlCQT09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K"</span>,</span><br><span class="line">																			<span class="attr">"organizational_unit_identifier"</span>: <span class="string">"peer"</span></span><br><span class="line">																		&#125;</span><br><span class="line">																	&#125;,</span><br><span class="line">																	<span class="attr">"intermediate_certs"</span>: [],</span><br><span class="line">																	<span class="attr">"name"</span>: <span class="string">"Org2MSP"</span>,</span><br><span class="line">																	<span class="attr">"organizational_unit_identifiers"</span>: [],</span><br><span class="line">																	<span class="attr">"revocation_list"</span>: [],</span><br><span class="line">																	<span class="attr">"root_certs"</span>: [</span><br><span class="line">																		<span class="string">"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNVakNDQWZpZ0F3SUJBZ0lSQU1rYVQ5em1XTEo2bFVNUlhRZmgrSTh3Q2dZSUtvWkl6ajBFQXdJd2N6RUwKTUFrR0ExVUVCaE1DVlZNeEV6QVJCZ05WQkFnVENrTmhiR2xtYjNKdWFXRXhGakFVQmdOVkJBY1REVk5oYmlCRwpjbUZ1WTJselkyOHhHVEFYQmdOVkJBb1RFRzl5WnpJdVpYaGhiWEJzWlM1amIyMHhIREFhQmdOVkJBTVRFMk5oCkxtOXlaekl1WlhoaGJYQnNaUzVqYjIwd0hoY05NVGt3T0RBeE1ESXhOREF3V2hjTk1qa3dOekk1TURJeE5EQXcKV2pCek1Rc3dDUVlEVlFRR0V3SlZVekVUTUJFR0ExVUVDQk1LUTJGc2FXWnZjbTVwWVRFV01CUUdBMVVFQnhNTgpVMkZ1SUVaeVlXNWphWE5qYnpFWk1CY0dBMVVFQ2hNUWIzSm5NaTVsZUdGdGNHeGxMbU52YlRFY01Cb0dBMVVFCkF4TVRZMkV1YjNKbk1pNWxlR0Z0Y0d4bExtTnZiVEJaTUJNR0J5cUdTTTQ5QWdFR0NDcUdTTTQ5QXdFSEEwSUEKQkpZSEEzOVNmbjczdXFIT0JrTzJ0R1pucFdvR09NRHFmRkJwZG9FOXhCTzNCdFZaT2hMblBYY01MRGErcTdJMQpxbFJHQmh4TTVpLzZ1L0V4Z2psaTVVK2piVEJyTUE0R0ExVWREd0VCL3dRRUF3SUJwakFkQmdOVkhTVUVGakFVCkJnZ3JCZ0VGQlFjREFnWUlLd1lCQlFVSEF3RXdEd1lEVlIwVEFRSC9CQVV3QXdFQi96QXBCZ05WSFE0RUlnUWcKbVFGMFluM29zOXBQSFdDTWtrdThVdTNiSzRyZjVBSWVRNjBRWDI0eHhyOHdDZ1lJS29aSXpqMEVBd0lEU0FBdwpSUUloQUpzYVBHWklWTkU4S09zbjJzZ2ZSSlo1ek1BbEpIS1p3V1lJQTljVVNWS1FBaUF6ZkIrL0VMUFQrbFFmCjZUNmhEQXU1bkwwRGpoUUxqa0ZmL3RXNUVDMzlCQT09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K"</span></span><br><span class="line">																	],</span><br><span class="line">																	<span class="attr">"signing_identity"</span>: <span class="literal">null</span>,</span><br><span class="line">																	<span class="attr">"tls_intermediate_certs"</span>: [],</span><br><span class="line">																	<span class="attr">"tls_root_certs"</span>: [</span><br><span class="line">																		<span class="string">"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNWekNDQWYyZ0F3SUJBZ0lRVGV5ZHpHQWVpNzB1ZkZzbTBmTWY1VEFLQmdncWhrak9QUVFEQWpCMk1Rc3cKQ1FZRFZRUUdFd0pWVXpFVE1CRUdBMVVFQ0JNS1EyRnNhV1p2Y201cFlURVdNQlFHQTFVRUJ4TU5VMkZ1SUVaeQpZVzVqYVhOamJ6RVpNQmNHQTFVRUNoTVFiM0puTWk1bGVHRnRjR3hsTG1OdmJURWZNQjBHQTFVRUF4TVdkR3h6ClkyRXViM0puTWk1bGVHRnRjR3hsTG1OdmJUQWVGdzB4T1RBNE1ERXdNakUwTURCYUZ3MHlPVEEzTWprd01qRTAKTURCYU1IWXhDekFKQmdOVkJBWVRBbFZUTVJNd0VRWURWUVFJRXdwRFlXeHBabTl5Ym1saE1SWXdGQVlEVlFRSApFdzFUWVc0Z1JuSmhibU5wYzJOdk1Sa3dGd1lEVlFRS0V4QnZjbWN5TG1WNFlXMXdiR1V1WTI5dE1SOHdIUVlEClZRUURFeFowYkhOallTNXZjbWN5TG1WNFlXMXdiR1V1WTI5dE1Ga3dFd1lIS29aSXpqMENBUVlJS29aSXpqMEQKQVFjRFFnQUVadTg3U0JzYWpnNXRTcFZKeGlZaE9YaWpOd3J0TmQvTFpuYkozWjUvY0dhaXZHeTZwQTB6Y1RjcApvdHN1YWJscE9BNHkxREEvbk5xaWtQa1dVVHZQcHFOdE1Hc3dEZ1lEVlIwUEFRSC9CQVFEQWdHbU1CMEdBMVVkCkpRUVdNQlFHQ0NzR0FRVUZCd01DQmdnckJnRUZCUWNEQVRBUEJnTlZIUk1CQWY4RUJUQURBUUgvTUNrR0ExVWQKRGdRaUJDQUh4MDhOZ1FwdW9IR0tZWU9IYWh3VDg0cW9BN3p3dzFRTVNZT0h2VlZCWERBS0JnZ3Foa2pPUFFRRApBZ05JQURCRkFpRUF5QlBlakFHWjZtNXdWS244WHFhblFsMWUzYjNpUFBJVFdHaVN0dDBuZ3JJQ0lIUUJKRFd6CjFubzBMbnp0Nis4eEw5R25oY1NrZnZsWXR5MmhQcjdnTThFYgotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg=="</span></span><br><span class="line">																	]</span><br><span class="line">																&#125;,</span><br><span class="line">																<span class="attr">"type"</span>: <span class="number">0</span></span><br><span class="line">															&#125;,</span><br><span class="line">															<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">														&#125;</span><br><span class="line">													&#125;,</span><br><span class="line">													<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">												&#125;</span><br><span class="line">											&#125;,</span><br><span class="line">											<span class="attr">"mod_policy"</span>: <span class="string">"/Channel/Orderer/Admins"</span>,</span><br><span class="line">											<span class="attr">"policies"</span>: &#123;&#125;,</span><br><span class="line">											<span class="attr">"values"</span>: &#123;</span><br><span class="line">												<span class="attr">"ChannelCreationPolicy"</span>: &#123;</span><br><span class="line">													<span class="attr">"mod_policy"</span>: <span class="string">"/Channel/Orderer/Admins"</span>,</span><br><span class="line">													<span class="attr">"value"</span>: &#123;</span><br><span class="line">														<span class="attr">"type"</span>: <span class="number">3</span>,</span><br><span class="line">														<span class="attr">"value"</span>: &#123;</span><br><span class="line">															<span class="attr">"rule"</span>: <span class="string">"ANY"</span>,</span><br><span class="line">															<span class="attr">"sub_policy"</span>: <span class="string">"Admins"</span></span><br><span class="line">														&#125;</span><br><span class="line">													&#125;,</span><br><span class="line">													<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">												&#125;</span><br><span class="line">											&#125;,</span><br><span class="line">											<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">										&#125;</span><br><span class="line">									&#125;,</span><br><span class="line">									<span class="attr">"mod_policy"</span>: <span class="string">"/Channel/Orderer/Admins"</span>,</span><br><span class="line">									<span class="attr">"policies"</span>: &#123;</span><br><span class="line">										<span class="attr">"Admins"</span>: &#123;</span><br><span class="line">											<span class="attr">"mod_policy"</span>: <span class="string">"/Channel/Orderer/Admins"</span>,</span><br><span class="line">											<span class="attr">"policy"</span>: &#123;</span><br><span class="line">												<span class="attr">"type"</span>: <span class="number">1</span>,</span><br><span class="line">												<span class="attr">"value"</span>: &#123;</span><br><span class="line">													<span class="attr">"identities"</span>: [],</span><br><span class="line">													<span class="attr">"rule"</span>: &#123;</span><br><span class="line">														<span class="attr">"n_out_of"</span>: &#123;</span><br><span class="line">															<span class="attr">"n"</span>: <span class="number">0</span>,</span><br><span class="line">															<span class="attr">"rules"</span>: []</span><br><span class="line">														&#125;</span><br><span class="line">													&#125;,</span><br><span class="line">													<span class="attr">"version"</span>: <span class="number">0</span></span><br><span class="line">												&#125;</span><br><span class="line">											&#125;,</span><br><span class="line">											<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">										&#125;</span><br><span class="line">									&#125;,</span><br><span class="line">									<span class="attr">"values"</span>: &#123;&#125;,</span><br><span class="line">									<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">								&#125;,</span><br><span class="line">								<span class="attr">"Orderer"</span>: &#123;</span><br><span class="line">									<span class="attr">"groups"</span>: &#123;</span><br><span class="line">										<span class="attr">"OrdererOrg"</span>: &#123;</span><br><span class="line">											<span class="attr">"groups"</span>: &#123;&#125;,</span><br><span class="line">											<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">											<span class="attr">"policies"</span>: &#123;</span><br><span class="line">												<span class="attr">"Admins"</span>: &#123;</span><br><span class="line">													<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">													<span class="attr">"policy"</span>: &#123;</span><br><span class="line">														<span class="attr">"type"</span>: <span class="number">1</span>,</span><br><span class="line">														<span class="attr">"value"</span>: &#123;</span><br><span class="line">															<span class="attr">"identities"</span>: [&#123;</span><br><span class="line">																<span class="attr">"principal"</span>: &#123;</span><br><span class="line">																	<span class="attr">"msp_identifier"</span>: <span class="string">"OrdererMSP"</span>,</span><br><span class="line">																	<span class="attr">"role"</span>: <span class="string">"ADMIN"</span></span><br><span class="line">																&#125;,</span><br><span class="line">																<span class="attr">"principal_classification"</span>: <span class="string">"ROLE"</span></span><br><span class="line">															&#125;],</span><br><span class="line">															<span class="attr">"rule"</span>: &#123;</span><br><span class="line">																<span class="attr">"n_out_of"</span>: &#123;</span><br><span class="line">																	<span class="attr">"n"</span>: <span class="number">1</span>,</span><br><span class="line">																	<span class="attr">"rules"</span>: [&#123;</span><br><span class="line">																		<span class="attr">"signed_by"</span>: <span class="number">0</span></span><br><span class="line">																	&#125;]</span><br><span class="line">																&#125;</span><br><span class="line">															&#125;,</span><br><span class="line">															<span class="attr">"version"</span>: <span class="number">0</span></span><br><span class="line">														&#125;</span><br><span class="line">													&#125;,</span><br><span class="line">													<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">												&#125;,</span><br><span class="line">												<span class="attr">"Readers"</span>: &#123;</span><br><span class="line">													<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">													<span class="attr">"policy"</span>: &#123;</span><br><span class="line">														<span class="attr">"type"</span>: <span class="number">1</span>,</span><br><span class="line">														<span class="attr">"value"</span>: &#123;</span><br><span class="line">															<span class="attr">"identities"</span>: [&#123;</span><br><span class="line">																<span class="attr">"principal"</span>: &#123;</span><br><span class="line">																	<span class="attr">"msp_identifier"</span>: <span class="string">"OrdererMSP"</span>,</span><br><span class="line">																	<span class="attr">"role"</span>: <span class="string">"MEMBER"</span></span><br><span class="line">																&#125;,</span><br><span class="line">																<span class="attr">"principal_classification"</span>: <span class="string">"ROLE"</span></span><br><span class="line">															&#125;],</span><br><span class="line">															<span class="attr">"rule"</span>: &#123;</span><br><span class="line">																<span class="attr">"n_out_of"</span>: &#123;</span><br><span class="line">																	<span class="attr">"n"</span>: <span class="number">1</span>,</span><br><span class="line">																	<span class="attr">"rules"</span>: [&#123;</span><br><span class="line">																		<span class="attr">"signed_by"</span>: <span class="number">0</span></span><br><span class="line">																	&#125;]</span><br><span class="line">																&#125;</span><br><span class="line">															&#125;,</span><br><span class="line">															<span class="attr">"version"</span>: <span class="number">0</span></span><br><span class="line">														&#125;</span><br><span class="line">													&#125;,</span><br><span class="line">													<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">												&#125;,</span><br><span class="line">												<span class="attr">"Writers"</span>: &#123;</span><br><span class="line">													<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">													<span class="attr">"policy"</span>: &#123;</span><br><span class="line">														<span class="attr">"type"</span>: <span class="number">1</span>,</span><br><span class="line">														<span class="attr">"value"</span>: &#123;</span><br><span class="line">															<span class="attr">"identities"</span>: [&#123;</span><br><span class="line">																<span class="attr">"principal"</span>: &#123;</span><br><span class="line">																	<span class="attr">"msp_identifier"</span>: <span class="string">"OrdererMSP"</span>,</span><br><span class="line">																	<span class="attr">"role"</span>: <span class="string">"MEMBER"</span></span><br><span class="line">																&#125;,</span><br><span class="line">																<span class="attr">"principal_classification"</span>: <span class="string">"ROLE"</span></span><br><span class="line">															&#125;],</span><br><span class="line">															<span class="attr">"rule"</span>: &#123;</span><br><span class="line">																<span class="attr">"n_out_of"</span>: &#123;</span><br><span class="line">																	<span class="attr">"n"</span>: <span class="number">1</span>,</span><br><span class="line">																	<span class="attr">"rules"</span>: [&#123;</span><br><span class="line">																		<span class="attr">"signed_by"</span>: <span class="number">0</span></span><br><span class="line">																	&#125;]</span><br><span class="line">																&#125;</span><br><span class="line">															&#125;,</span><br><span class="line">															<span class="attr">"version"</span>: <span class="number">0</span></span><br><span class="line">														&#125;</span><br><span class="line">													&#125;,</span><br><span class="line">													<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">												&#125;</span><br><span class="line">											&#125;,</span><br><span class="line">											<span class="attr">"values"</span>: &#123;</span><br><span class="line">												<span class="attr">"MSP"</span>: &#123;</span><br><span class="line">													<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">													<span class="attr">"value"</span>: &#123;</span><br><span class="line">														<span class="attr">"config"</span>: &#123;</span><br><span class="line">															<span class="attr">"admins"</span>: [</span><br><span class="line">																<span class="string">"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNDekNDQWJHZ0F3SUJBZ0lSQUtuelI3NFZjN3RqOE5aQ21QV29QaWN3Q2dZSUtvWkl6ajBFQXdJd2FURUwKTUFrR0ExVUVCaE1DVlZNeEV6QVJCZ05WQkFnVENrTmhiR2xtYjNKdWFXRXhGakFVQmdOVkJBY1REVk5oYmlCRwpjbUZ1WTJselkyOHhGREFTQmdOVkJBb1RDMlY0WVcxd2JHVXVZMjl0TVJjd0ZRWURWUVFERXc1allTNWxlR0Z0CmNHeGxMbU52YlRBZUZ3MHhPVEE0TURFd01qRTBNREJhRncweU9UQTNNamt3TWpFME1EQmFNRll4Q3pBSkJnTlYKQkFZVEFsVlRNUk13RVFZRFZRUUlFd3BEWVd4cFptOXlibWxoTVJZd0ZBWURWUVFIRXcxVFlXNGdSbkpoYm1OcApjMk52TVJvd0dBWURWUVFEREJGQlpHMXBia0JsZUdGdGNHeGxMbU52YlRCWk1CTUdCeXFHU000OUFnRUdDQ3FHClNNNDlBd0VIQTBJQUJNUGUyNUtPU0hscUVZelJFVE83YXRjYWRvT0xnckRxelJQTjNjQ2RpR3A4QU4wdmdiTnAKTEEvTFJ0alFKbzdQaTZFZFlHaWh1MUNuRWgvNUxnYk90TmVqVFRCTE1BNEdBMVVkRHdFQi93UUVBd0lIZ0RBTQpCZ05WSFJNQkFmOEVBakFBTUNzR0ExVWRJd1FrTUNLQUlFQ0pBOWZTbDlUN0xsVWZ3QVhwM1V1cyt2YVpRbkZPCm9PSXJ2cmFrUDE3QU1Bb0dDQ3FHU000OUJBTUNBMGdBTUVVQ0lRQ1BjZVpmekNXa29MZ0N0NTMwbmEramY0a2cKN3BIWWwwY2NMTTZ4QkU0em5RSWdFVU52N2Q3MjQ2N1dnN0pMckZDb0x6eFhWUlMrN2UyWVJYSUlKOS9NVTJRPQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg=="</span></span><br><span class="line">															],</span><br><span class="line">															<span class="attr">"crypto_config"</span>: &#123;</span><br><span class="line">																<span class="attr">"identity_identifier_hash_function"</span>: <span class="string">"SHA256"</span>,</span><br><span class="line">																<span class="attr">"signature_hash_family"</span>: <span class="string">"SHA2"</span></span><br><span class="line">															&#125;,</span><br><span class="line">															<span class="attr">"fabric_node_ous"</span>: <span class="literal">null</span>,</span><br><span class="line">															<span class="attr">"intermediate_certs"</span>: [],</span><br><span class="line">															<span class="attr">"name"</span>: <span class="string">"OrdererMSP"</span>,</span><br><span class="line">															<span class="attr">"organizational_unit_identifiers"</span>: [],</span><br><span class="line">															<span class="attr">"revocation_list"</span>: [],</span><br><span class="line">															<span class="attr">"root_certs"</span>: [</span><br><span class="line">																<span class="string">"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNQRENDQWVPZ0F3SUJBZ0lRSm9TdloyVE5oVTZjN0kvZ3VRNHYvVEFLQmdncWhrak9QUVFEQWpCcE1Rc3cKQ1FZRFZRUUdFd0pWVXpFVE1CRUdBMVVFQ0JNS1EyRnNhV1p2Y201cFlURVdNQlFHQTFVRUJ4TU5VMkZ1SUVaeQpZVzVqYVhOamJ6RVVNQklHQTFVRUNoTUxaWGhoYlhCc1pTNWpiMjB4RnpBVkJnTlZCQU1URG1OaExtVjRZVzF3CmJHVXVZMjl0TUI0WERURTVNRGd3TVRBeU1UUXdNRm9YRFRJNU1EY3lPVEF5TVRRd01Gb3dhVEVMTUFrR0ExVUUKQmhNQ1ZWTXhFekFSQmdOVkJBZ1RDa05oYkdsbWIzSnVhV0V4RmpBVUJnTlZCQWNURFZOaGJpQkdjbUZ1WTJsegpZMjh4RkRBU0JnTlZCQW9UQzJWNFlXMXdiR1V1WTI5dE1SY3dGUVlEVlFRREV3NWpZUzVsZUdGdGNHeGxMbU52CmJUQlpNQk1HQnlxR1NNNDlBZ0VHQ0NxR1NNNDlBd0VIQTBJQUJFaUxuejB5TXp6K0dPNTlLZ3NMV0E1SVNaTXgKaUdRMVkrVHB3a1hZQXhjQnZENXZMMGhXcCtwWDdmSCtqaU9TOFBCMDFkamQ0TVJsb0lCQTgzYkxxdktqYlRCcgpNQTRHQTFVZER3RUIvd1FFQXdJQnBqQWRCZ05WSFNVRUZqQVVCZ2dyQmdFRkJRY0RBZ1lJS3dZQkJRVUhBd0V3CkR3WURWUjBUQVFIL0JBVXdBd0VCL3pBcEJnTlZIUTRFSWdRZ1FJa0QxOUtYMVBzdVZSL0FCZW5kUzZ6NjlwbEMKY1U2ZzRpdSt0cVEvWHNBd0NnWUlLb1pJemowRUF3SURSd0F3UkFJZ2JmRWVkMjJGRHFFSStwU0pKTXZrQi9GQQpFRitIUlg5OW91bGRLVlBqcDgwQ0lBS1VISmxlR01HYzF6dHRNSStCcHBldG53UU5nWjRsUDY5MUs0bENnU2hMCi0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K"</span></span><br><span class="line">															],</span><br><span class="line">															<span class="attr">"signing_identity"</span>: <span class="literal">null</span>,</span><br><span class="line">															<span class="attr">"tls_intermediate_certs"</span>: [],</span><br><span class="line">															<span class="attr">"tls_root_certs"</span>: [</span><br><span class="line">																<span class="string">"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNRekNDQWVxZ0F3SUJBZ0lSQVBWKy9UOVlSTjV0YmFXVGlETjg5Mmt3Q2dZSUtvWkl6ajBFQXdJd2JERUwKTUFrR0ExVUVCaE1DVlZNeEV6QVJCZ05WQkFnVENrTmhiR2xtYjNKdWFXRXhGakFVQmdOVkJBY1REVk5oYmlCRwpjbUZ1WTJselkyOHhGREFTQmdOVkJBb1RDMlY0WVcxd2JHVXVZMjl0TVJvd0dBWURWUVFERXhGMGJITmpZUzVsCmVHRnRjR3hsTG1OdmJUQWVGdzB4T1RBNE1ERXdNakUwTURCYUZ3MHlPVEEzTWprd01qRTBNREJhTUd3eEN6QUoKQmdOVkJBWVRBbFZUTVJNd0VRWURWUVFJRXdwRFlXeHBabTl5Ym1saE1SWXdGQVlEVlFRSEV3MVRZVzRnUm5KaApibU5wYzJOdk1SUXdFZ1lEVlFRS0V3dGxlR0Z0Y0d4bExtTnZiVEVhTUJnR0ExVUVBeE1SZEd4elkyRXVaWGhoCmJYQnNaUzVqYjIwd1dUQVRCZ2NxaGtqT1BRSUJCZ2dxaGtqT1BRTUJCd05DQUFSUkxQK2ZLeFpnd2tFa2JIREoKb1JQak5ySXZBWWx2SHBMUTJoSXE1aXJQQnJlcEU4akRNTERyVklZR0NRdDBydGxjWFZTT3dZVTFkMXNOUy9USApSb1JvbzIwd2F6QU9CZ05WSFE4QkFmOEVCQU1DQWFZd0hRWURWUjBsQkJZd0ZBWUlLd1lCQlFVSEF3SUdDQ3NHCkFRVUZCd01CTUE4R0ExVWRFd0VCL3dRRk1BTUJBZjh3S1FZRFZSME9CQ0lFSUJWM1owTGw1TnpOcUdqVlpmbHIKUHRqRXFrNUtvUWFweXpJOFNrTnJQQVpWTUFvR0NDcUdTTTQ5QkFNQ0EwY0FNRVFDSUQ5Z3U5bU9TejVLaTd5cQpGU2czd1FGdXphb2pRakdiNVN4YUwwVzJTOUxXQWlCSzZIOXhNSENuZm5BV291bVpsdXNHd3RsOU5PVDhkdXFVCnR2eHRPOVY4S1E9PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg=="</span></span><br><span class="line">															]</span><br><span class="line">														&#125;,</span><br><span class="line">														<span class="attr">"type"</span>: <span class="number">0</span></span><br><span class="line">													&#125;,</span><br><span class="line">													<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">												&#125;</span><br><span class="line">											&#125;,</span><br><span class="line">											<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">										&#125;</span><br><span class="line">									&#125;,</span><br><span class="line">									<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">									<span class="attr">"policies"</span>: &#123;</span><br><span class="line">										<span class="attr">"Admins"</span>: &#123;</span><br><span class="line">											<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">											<span class="attr">"policy"</span>: &#123;</span><br><span class="line">												<span class="attr">"type"</span>: <span class="number">3</span>,</span><br><span class="line">												<span class="attr">"value"</span>: &#123;</span><br><span class="line">													<span class="attr">"rule"</span>: <span class="string">"MAJORITY"</span>,</span><br><span class="line">													<span class="attr">"sub_policy"</span>: <span class="string">"Admins"</span></span><br><span class="line">												&#125;</span><br><span class="line">											&#125;,</span><br><span class="line">											<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">										&#125;,</span><br><span class="line">										<span class="attr">"BlockValidation"</span>: &#123;</span><br><span class="line">											<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">											<span class="attr">"policy"</span>: &#123;</span><br><span class="line">												<span class="attr">"type"</span>: <span class="number">3</span>,</span><br><span class="line">												<span class="attr">"value"</span>: &#123;</span><br><span class="line">													<span class="attr">"rule"</span>: <span class="string">"ANY"</span>,</span><br><span class="line">													<span class="attr">"sub_policy"</span>: <span class="string">"Writers"</span></span><br><span class="line">												&#125;</span><br><span class="line">											&#125;,</span><br><span class="line">											<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">										&#125;,</span><br><span class="line">										<span class="attr">"Readers"</span>: &#123;</span><br><span class="line">											<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">											<span class="attr">"policy"</span>: &#123;</span><br><span class="line">												<span class="attr">"type"</span>: <span class="number">3</span>,</span><br><span class="line">												<span class="attr">"value"</span>: &#123;</span><br><span class="line">													<span class="attr">"rule"</span>: <span class="string">"ANY"</span>,</span><br><span class="line">													<span class="attr">"sub_policy"</span>: <span class="string">"Readers"</span></span><br><span class="line">												&#125;</span><br><span class="line">											&#125;,</span><br><span class="line">											<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">										&#125;,</span><br><span class="line">										<span class="attr">"Writers"</span>: &#123;</span><br><span class="line">											<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">											<span class="attr">"policy"</span>: &#123;</span><br><span class="line">												<span class="attr">"type"</span>: <span class="number">3</span>,</span><br><span class="line">												<span class="attr">"value"</span>: &#123;</span><br><span class="line">													<span class="attr">"rule"</span>: <span class="string">"ANY"</span>,</span><br><span class="line">													<span class="attr">"sub_policy"</span>: <span class="string">"Writers"</span></span><br><span class="line">												&#125;</span><br><span class="line">											&#125;,</span><br><span class="line">											<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">										&#125;</span><br><span class="line">									&#125;,</span><br><span class="line">									<span class="attr">"values"</span>: &#123;</span><br><span class="line">										<span class="attr">"BatchSize"</span>: &#123;</span><br><span class="line">											<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">											<span class="attr">"value"</span>: &#123;</span><br><span class="line">												<span class="attr">"absolute_max_bytes"</span>: <span class="number">103809024</span>,</span><br><span class="line">												<span class="attr">"max_message_count"</span>: <span class="number">10</span>,</span><br><span class="line">												<span class="attr">"preferred_max_bytes"</span>: <span class="number">524288</span></span><br><span class="line">											&#125;,</span><br><span class="line">											<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">										&#125;,</span><br><span class="line">										<span class="attr">"BatchTimeout"</span>: &#123;</span><br><span class="line">											<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">											<span class="attr">"value"</span>: &#123;</span><br><span class="line">												<span class="attr">"timeout"</span>: <span class="string">"2s"</span></span><br><span class="line">											&#125;,</span><br><span class="line">											<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">										&#125;,</span><br><span class="line">										<span class="attr">"Capabilities"</span>: &#123;</span><br><span class="line">											<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">											<span class="attr">"value"</span>: &#123;</span><br><span class="line">												<span class="attr">"capabilities"</span>: &#123;</span><br><span class="line">													<span class="attr">"V1_1"</span>: &#123;&#125;</span><br><span class="line">												&#125;</span><br><span class="line">											&#125;,</span><br><span class="line">											<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">										&#125;,</span><br><span class="line">										<span class="attr">"ChannelRestrictions"</span>: &#123;</span><br><span class="line">											<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">											<span class="attr">"value"</span>: <span class="literal">null</span>,</span><br><span class="line">											<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">										&#125;,</span><br><span class="line">										<span class="attr">"ConsensusType"</span>: &#123;</span><br><span class="line">											<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">											<span class="attr">"value"</span>: &#123;</span><br><span class="line">												<span class="attr">"metadata"</span>: <span class="literal">null</span>,</span><br><span class="line">												<span class="attr">"state"</span>: <span class="string">"STATE_NORMAL"</span>,</span><br><span class="line">												<span class="attr">"type"</span>: <span class="string">"solo"</span></span><br><span class="line">											&#125;,</span><br><span class="line">											<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">										&#125;</span><br><span class="line">									&#125;,</span><br><span class="line">									<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">								&#125;</span><br><span class="line">							&#125;,</span><br><span class="line">							<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">							<span class="attr">"policies"</span>: &#123;</span><br><span class="line">								<span class="attr">"Admins"</span>: &#123;</span><br><span class="line">									<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">									<span class="attr">"policy"</span>: &#123;</span><br><span class="line">										<span class="attr">"type"</span>: <span class="number">3</span>,</span><br><span class="line">										<span class="attr">"value"</span>: &#123;</span><br><span class="line">											<span class="attr">"rule"</span>: <span class="string">"MAJORITY"</span>,</span><br><span class="line">											<span class="attr">"sub_policy"</span>: <span class="string">"Admins"</span></span><br><span class="line">										&#125;</span><br><span class="line">									&#125;,</span><br><span class="line">									<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">								&#125;,</span><br><span class="line">								<span class="attr">"Readers"</span>: &#123;</span><br><span class="line">									<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">									<span class="attr">"policy"</span>: &#123;</span><br><span class="line">										<span class="attr">"type"</span>: <span class="number">3</span>,</span><br><span class="line">										<span class="attr">"value"</span>: &#123;</span><br><span class="line">											<span class="attr">"rule"</span>: <span class="string">"ANY"</span>,</span><br><span class="line">											<span class="attr">"sub_policy"</span>: <span class="string">"Readers"</span></span><br><span class="line">										&#125;</span><br><span class="line">									&#125;,</span><br><span class="line">									<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">								&#125;,</span><br><span class="line">								<span class="attr">"Writers"</span>: &#123;</span><br><span class="line">									<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">									<span class="attr">"policy"</span>: &#123;</span><br><span class="line">										<span class="attr">"type"</span>: <span class="number">3</span>,</span><br><span class="line">										<span class="attr">"value"</span>: &#123;</span><br><span class="line">											<span class="attr">"rule"</span>: <span class="string">"ANY"</span>,</span><br><span class="line">											<span class="attr">"sub_policy"</span>: <span class="string">"Writers"</span></span><br><span class="line">										&#125;</span><br><span class="line">									&#125;,</span><br><span class="line">									<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">								&#125;</span><br><span class="line">							&#125;,</span><br><span class="line">							<span class="attr">"values"</span>: &#123;</span><br><span class="line">								<span class="attr">"BlockDataHashingStructure"</span>: &#123;</span><br><span class="line">									<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">									<span class="attr">"value"</span>: &#123;</span><br><span class="line">										<span class="attr">"width"</span>: <span class="number">4294967295</span></span><br><span class="line">									&#125;,</span><br><span class="line">									<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">								&#125;,</span><br><span class="line">								<span class="attr">"Capabilities"</span>: &#123;</span><br><span class="line">									<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">									<span class="attr">"value"</span>: &#123;</span><br><span class="line">										<span class="attr">"capabilities"</span>: &#123;</span><br><span class="line">											<span class="attr">"V1_3"</span>: &#123;&#125;</span><br><span class="line">										&#125;</span><br><span class="line">									&#125;,</span><br><span class="line">									<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">								&#125;,</span><br><span class="line">								<span class="attr">"HashingAlgorithm"</span>: &#123;</span><br><span class="line">									<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">									<span class="attr">"value"</span>: &#123;</span><br><span class="line">										<span class="attr">"name"</span>: <span class="string">"SHA256"</span></span><br><span class="line">									&#125;,</span><br><span class="line">									<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">								&#125;,</span><br><span class="line">								<span class="attr">"OrdererAddresses"</span>: &#123;</span><br><span class="line">									<span class="attr">"mod_policy"</span>: <span class="string">"/Channel/Orderer/Admins"</span>,</span><br><span class="line">									<span class="attr">"value"</span>: &#123;</span><br><span class="line">										<span class="attr">"addresses"</span>: [</span><br><span class="line">											<span class="string">"orderer.example.com:7050"</span></span><br><span class="line">										]</span><br><span class="line">									&#125;,</span><br><span class="line">									<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">								&#125;</span><br><span class="line">							&#125;,</span><br><span class="line">							<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">						&#125;,</span><br><span class="line">						<span class="attr">"sequence"</span>: <span class="string">"0"</span></span><br><span class="line">					&#125;,</span><br><span class="line">					<span class="attr">"last_update"</span>: <span class="literal">null</span></span><br><span class="line">				&#125;,</span><br><span class="line">				<span class="attr">"header"</span>: &#123;</span><br><span class="line">					<span class="attr">"channel_header"</span>: &#123;</span><br><span class="line">						<span class="attr">"channel_id"</span>: <span class="string">"byfn-sys-channel"</span>,</span><br><span class="line">						<span class="attr">"epoch"</span>: <span class="string">"0"</span>,</span><br><span class="line">						<span class="attr">"extension"</span>: <span class="literal">null</span>,</span><br><span class="line">						<span class="attr">"timestamp"</span>: <span class="string">"2019-08-01T02:18:40Z"</span>,</span><br><span class="line">						<span class="attr">"tls_cert_hash"</span>: <span class="literal">null</span>,</span><br><span class="line">						<span class="attr">"tx_id"</span>: <span class="string">"1c988034ab1d1658ebe508f89acd5f1e4e7bc2eeb6355e9d6084c36fba8ea562"</span>,</span><br><span class="line">						<span class="attr">"type"</span>: <span class="number">1</span>,</span><br><span class="line">						<span class="attr">"version"</span>: <span class="number">1</span></span><br><span class="line">					&#125;,</span><br><span class="line">					<span class="attr">"signature_header"</span>: &#123;</span><br><span class="line">						<span class="attr">"creator"</span>: <span class="literal">null</span>,</span><br><span class="line">						<span class="attr">"nonce"</span>: <span class="string">"vPlG4HADPlXSQNWhjggubdDnUWXuH+wP"</span></span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="attr">"signature"</span>: <span class="literal">null</span></span><br><span class="line">		&#125;]</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">"header"</span>: &#123;</span><br><span class="line">		<span class="attr">"data_hash"</span>: <span class="string">"uzdDxPqI54ONV6pv/4m/l2OXNBFKuprirariF2kW278="</span>,</span><br><span class="line">		<span class="attr">"number"</span>: <span class="string">"0"</span>,</span><br><span class="line">		<span class="attr">"previous_hash"</span>: <span class="literal">null</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">"metadata"</span>: &#123;</span><br><span class="line">		<span class="attr">"metadata"</span>: [</span><br><span class="line">			<span class="string">""</span>,</span><br><span class="line">			<span class="string">""</span>,</span><br><span class="line">			<span class="string">""</span>,</span><br><span class="line">			<span class="string">""</span></span><br><span class="line">		]</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="应用通道创世块"><a href="#应用通道创世块" class="headerlink" title="应用通道创世块"></a>应用通道创世块</h3><p>系通道的配置的信息主要是：</p>
<ol>
<li>组织关系，权限、证书</li>
<li>配置更新策略</li>
</ol>
<blockquote>
<p>某个链码的配置包含在链码里，不在通道的配置里。</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"data"</span>: &#123;</span><br><span class="line">		<span class="attr">"data"</span>: [&#123;</span><br><span class="line">			<span class="attr">"payload"</span>: &#123;</span><br><span class="line">				<span class="attr">"data"</span>: &#123;</span><br><span class="line">					<span class="attr">"config"</span>: &#123;</span><br><span class="line">						<span class="attr">"channel_group"</span>: &#123;</span><br><span class="line">							<span class="attr">"groups"</span>: &#123;</span><br><span class="line">								<span class="attr">"Application"</span>: &#123;</span><br><span class="line">									<span class="attr">"groups"</span>: &#123;</span><br><span class="line">										<span class="attr">"Org1MSP"</span>: &#123;</span><br><span class="line">											<span class="attr">"groups"</span>: &#123;&#125;,</span><br><span class="line">											<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">											<span class="attr">"policies"</span>: &#123;</span><br><span class="line">												<span class="attr">"Admins"</span>: &#123;</span><br><span class="line">													<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">													<span class="attr">"policy"</span>: &#123;</span><br><span class="line">														<span class="attr">"type"</span>: <span class="number">1</span>,</span><br><span class="line">														<span class="attr">"value"</span>: &#123;</span><br><span class="line">															<span class="attr">"identities"</span>: [&#123;</span><br><span class="line">																<span class="attr">"principal"</span>: &#123;</span><br><span class="line">																	<span class="attr">"msp_identifier"</span>: <span class="string">"Org1MSP"</span>,</span><br><span class="line">																	<span class="attr">"role"</span>: <span class="string">"ADMIN"</span></span><br><span class="line">																&#125;,</span><br><span class="line">																<span class="attr">"principal_classification"</span>: <span class="string">"ROLE"</span></span><br><span class="line">															&#125;],</span><br><span class="line">															<span class="attr">"rule"</span>: &#123;</span><br><span class="line">																<span class="attr">"n_out_of"</span>: &#123;</span><br><span class="line">																	<span class="attr">"n"</span>: <span class="number">1</span>,</span><br><span class="line">																	<span class="attr">"rules"</span>: [&#123;</span><br><span class="line">																		<span class="attr">"signed_by"</span>: <span class="number">0</span></span><br><span class="line">																	&#125;]</span><br><span class="line">																&#125;</span><br><span class="line">															&#125;,</span><br><span class="line">															<span class="attr">"version"</span>: <span class="number">0</span></span><br><span class="line">														&#125;</span><br><span class="line">													&#125;,</span><br><span class="line">													<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">												&#125;,</span><br><span class="line">												<span class="attr">"Readers"</span>: &#123;</span><br><span class="line">													<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">													<span class="attr">"policy"</span>: &#123;</span><br><span class="line">														<span class="attr">"type"</span>: <span class="number">1</span>,</span><br><span class="line">														<span class="attr">"value"</span>: &#123;</span><br><span class="line">															<span class="attr">"identities"</span>: [&#123;</span><br><span class="line">																	<span class="attr">"principal"</span>: &#123;</span><br><span class="line">																		<span class="attr">"msp_identifier"</span>: <span class="string">"Org1MSP"</span>,</span><br><span class="line">																		<span class="attr">"role"</span>: <span class="string">"ADMIN"</span></span><br><span class="line">																	&#125;,</span><br><span class="line">																	<span class="attr">"principal_classification"</span>: <span class="string">"ROLE"</span></span><br><span class="line">																&#125;,</span><br><span class="line">																&#123;</span><br><span class="line">																	<span class="attr">"principal"</span>: &#123;</span><br><span class="line">																		<span class="attr">"msp_identifier"</span>: <span class="string">"Org1MSP"</span>,</span><br><span class="line">																		<span class="attr">"role"</span>: <span class="string">"PEER"</span></span><br><span class="line">																	&#125;,</span><br><span class="line">																	<span class="attr">"principal_classification"</span>: <span class="string">"ROLE"</span></span><br><span class="line">																&#125;,</span><br><span class="line">																&#123;</span><br><span class="line">																	<span class="attr">"principal"</span>: &#123;</span><br><span class="line">																		<span class="attr">"msp_identifier"</span>: <span class="string">"Org1MSP"</span>,</span><br><span class="line">																		<span class="attr">"role"</span>: <span class="string">"CLIENT"</span></span><br><span class="line">																	&#125;,</span><br><span class="line">																	<span class="attr">"principal_classification"</span>: <span class="string">"ROLE"</span></span><br><span class="line">																&#125;</span><br><span class="line">															],</span><br><span class="line">															<span class="attr">"rule"</span>: &#123;</span><br><span class="line">																<span class="attr">"n_out_of"</span>: &#123;</span><br><span class="line">																	<span class="attr">"n"</span>: <span class="number">1</span>,</span><br><span class="line">																	<span class="attr">"rules"</span>: [&#123;</span><br><span class="line">																			<span class="attr">"signed_by"</span>: <span class="number">0</span></span><br><span class="line">																		&#125;,</span><br><span class="line">																		&#123;</span><br><span class="line">																			<span class="attr">"signed_by"</span>: <span class="number">1</span></span><br><span class="line">																		&#125;,</span><br><span class="line">																		&#123;</span><br><span class="line">																			<span class="attr">"signed_by"</span>: <span class="number">2</span></span><br><span class="line">																		&#125;</span><br><span class="line">																	]</span><br><span class="line">																&#125;</span><br><span class="line">															&#125;,</span><br><span class="line">															<span class="attr">"version"</span>: <span class="number">0</span></span><br><span class="line">														&#125;</span><br><span class="line">													&#125;,</span><br><span class="line">													<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">												&#125;,</span><br><span class="line">												<span class="attr">"Writers"</span>: &#123;</span><br><span class="line">													<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">													<span class="attr">"policy"</span>: &#123;</span><br><span class="line">														<span class="attr">"type"</span>: <span class="number">1</span>,</span><br><span class="line">														<span class="attr">"value"</span>: &#123;</span><br><span class="line">															<span class="attr">"identities"</span>: [&#123;</span><br><span class="line">																	<span class="attr">"principal"</span>: &#123;</span><br><span class="line">																		<span class="attr">"msp_identifier"</span>: <span class="string">"Org1MSP"</span>,</span><br><span class="line">																		<span class="attr">"role"</span>: <span class="string">"ADMIN"</span></span><br><span class="line">																	&#125;,</span><br><span class="line">																	<span class="attr">"principal_classification"</span>: <span class="string">"ROLE"</span></span><br><span class="line">																&#125;,</span><br><span class="line">																&#123;</span><br><span class="line">																	<span class="attr">"principal"</span>: &#123;</span><br><span class="line">																		<span class="attr">"msp_identifier"</span>: <span class="string">"Org1MSP"</span>,</span><br><span class="line">																		<span class="attr">"role"</span>: <span class="string">"CLIENT"</span></span><br><span class="line">																	&#125;,</span><br><span class="line">																	<span class="attr">"principal_classification"</span>: <span class="string">"ROLE"</span></span><br><span class="line">																&#125;</span><br><span class="line">															],</span><br><span class="line">															<span class="attr">"rule"</span>: &#123;</span><br><span class="line">																<span class="attr">"n_out_of"</span>: &#123;</span><br><span class="line">																	<span class="attr">"n"</span>: <span class="number">1</span>,</span><br><span class="line">																	<span class="attr">"rules"</span>: [&#123;</span><br><span class="line">																			<span class="attr">"signed_by"</span>: <span class="number">0</span></span><br><span class="line">																		&#125;,</span><br><span class="line">																		&#123;</span><br><span class="line">																			<span class="attr">"signed_by"</span>: <span class="number">1</span></span><br><span class="line">																		&#125;</span><br><span class="line">																	]</span><br><span class="line">																&#125;</span><br><span class="line">															&#125;,</span><br><span class="line">															<span class="attr">"version"</span>: <span class="number">0</span></span><br><span class="line">														&#125;</span><br><span class="line">													&#125;,</span><br><span class="line">													<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">												&#125;</span><br><span class="line">											&#125;,</span><br><span class="line">											<span class="attr">"values"</span>: &#123;</span><br><span class="line">												<span class="attr">"MSP"</span>: &#123;</span><br><span class="line">													<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">													<span class="attr">"value"</span>: &#123;</span><br><span class="line">														<span class="attr">"config"</span>: &#123;</span><br><span class="line">															<span class="attr">"admins"</span>: [</span><br><span class="line">																<span class="string">"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNLVENDQWRDZ0F3SUJBZ0lRUEtTRHJHNWRTT0liVHRLM3pqcEhlVEFLQmdncWhrak9QUVFEQWpCek1Rc3cKQ1FZRFZRUUdFd0pWVXpFVE1CRUdBMVVFQ0JNS1EyRnNhV1p2Y201cFlURVdNQlFHQTFVRUJ4TU5VMkZ1SUVaeQpZVzVqYVhOamJ6RVpNQmNHQTFVRUNoTVFiM0puTVM1bGVHRnRjR3hsTG1OdmJURWNNQm9HQTFVRUF4TVRZMkV1CmIzSm5NUzVsZUdGdGNHeGxMbU52YlRBZUZ3MHhPVEE0TURFd01qRTBNREJhRncweU9UQTNNamt3TWpFME1EQmEKTUd3eEN6QUpCZ05WQkFZVEFsVlRNUk13RVFZRFZRUUlFd3BEWVd4cFptOXlibWxoTVJZd0ZBWURWUVFIRXcxVApZVzRnUm5KaGJtTnBjMk52TVE4d0RRWURWUVFMRXdaamJHbGxiblF4SHpBZEJnTlZCQU1NRmtGa2JXbHVRRzl5Clp6RXVaWGhoYlhCc1pTNWpiMjB3V1RBVEJnY3Foa2pPUFFJQkJnZ3Foa2pPUFFNQkJ3TkNBQVFiNEZydmg1V2oKclBSOTFIdFdSaFVORVpxQXFOL2pEYkhUbUtDSXBkY3k3K2JGTUduaUprdTExaTl2ajN6TnNQMGQrSWlSRDdiMgpJSlhVaGxZbVJjcXVvMDB3U3pBT0JnTlZIUThCQWY4RUJBTUNCNEF3REFZRFZSMFRBUUgvQkFJd0FEQXJCZ05WCkhTTUVKREFpZ0NCVUdsTldyVThlZFBPakorMkc3M2UyU1FEdjVYdFUzSWYrSTJEMmo4VWdFREFLQmdncWhrak8KUFFRREFnTkhBREJFQWlBRFB6Qk5uKytROURXd0VUS0ErRTQyNG5vekVzZjRFd2JzQWxuUCtXNU10UUlnSDc3Two3dEVJUFZacTRvVUtSb1I5QWsvUEUrWUFzYk4vdHZhVlZlZ2dLTGc9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K"</span></span><br><span class="line">															],</span><br><span class="line">															<span class="attr">"crypto_config"</span>: &#123;</span><br><span class="line">																<span class="attr">"identity_identifier_hash_function"</span>: <span class="string">"SHA256"</span>,</span><br><span class="line">																<span class="attr">"signature_hash_family"</span>: <span class="string">"SHA2"</span></span><br><span class="line">															&#125;,</span><br><span class="line">															<span class="attr">"fabric_node_ous"</span>: &#123;</span><br><span class="line">																<span class="attr">"client_ou_identifier"</span>: &#123;</span><br><span class="line">																	<span class="attr">"certificate"</span>: <span class="string">"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNVRENDQWZlZ0F3SUJBZ0lRSnJqamM3b1RSLy8zSG9wcDFYY0Y4VEFLQmdncWhrak9QUVFEQWpCek1Rc3cKQ1FZRFZRUUdFd0pWVXpFVE1CRUdBMVVFQ0JNS1EyRnNhV1p2Y201cFlURVdNQlFHQTFVRUJ4TU5VMkZ1SUVaeQpZVzVqYVhOamJ6RVpNQmNHQTFVRUNoTVFiM0puTVM1bGVHRnRjR3hsTG1OdmJURWNNQm9HQTFVRUF4TVRZMkV1CmIzSm5NUzVsZUdGdGNHeGxMbU52YlRBZUZ3MHhPVEE0TURFd01qRTBNREJhRncweU9UQTNNamt3TWpFME1EQmEKTUhNeEN6QUpCZ05WQkFZVEFsVlRNUk13RVFZRFZRUUlFd3BEWVd4cFptOXlibWxoTVJZd0ZBWURWUVFIRXcxVApZVzRnUm5KaGJtTnBjMk52TVJrd0Z3WURWUVFLRXhCdmNtY3hMbVY0WVcxd2JHVXVZMjl0TVJ3d0dnWURWUVFECkV4TmpZUzV2Y21jeExtVjRZVzF3YkdVdVkyOXRNRmt3RXdZSEtvWkl6ajBDQVFZSUtvWkl6ajBEQVFjRFFnQUUKSmNFQkUvUlF1Ty9JR2h0QWJjSnhnTEhyMHNEbENFS0dpQnA3NXlRYytjdUFQK21NWDI4TGtWTERJaGhELzV5MgpiMTJUM1o4Z1Y1N2tMOHdrUTM1SXpxTnRNR3N3RGdZRFZSMFBBUUgvQkFRREFnR21NQjBHQTFVZEpRUVdNQlFHCkNDc0dBUVVGQndNQ0JnZ3JCZ0VGQlFjREFUQVBCZ05WSFJNQkFmOEVCVEFEQVFIL01Da0dBMVVkRGdRaUJDQlUKR2xOV3JVOGVkUE9qSisyRzczZTJTUUR2NVh0VTNJZitJMkQyajhVZ0VEQUtCZ2dxaGtqT1BRUURBZ05IQURCRQpBaUF3YzVYMVZLVGZQM0ZqL0o1Tk9wVHlNU08vU2MzcnFhbmxOelRUbk5VRmZnSWdNZi9HVWpjcjhra1V2Y2hBCjlzM0NIc1VYZ1loTWNPaHVxWFJmZHdTRC9XRT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo="</span>,</span><br><span class="line">																	<span class="attr">"organizational_unit_identifier"</span>: <span class="string">"client"</span></span><br><span class="line">																&#125;,</span><br><span class="line">																<span class="attr">"enable"</span>: <span class="literal">true</span>,</span><br><span class="line">																<span class="attr">"peer_ou_identifier"</span>: &#123;</span><br><span class="line">																	<span class="attr">"certificate"</span>: <span class="string">"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNVRENDQWZlZ0F3SUJBZ0lRSnJqamM3b1RSLy8zSG9wcDFYY0Y4VEFLQmdncWhrak9QUVFEQWpCek1Rc3cKQ1FZRFZRUUdFd0pWVXpFVE1CRUdBMVVFQ0JNS1EyRnNhV1p2Y201cFlURVdNQlFHQTFVRUJ4TU5VMkZ1SUVaeQpZVzVqYVhOamJ6RVpNQmNHQTFVRUNoTVFiM0puTVM1bGVHRnRjR3hsTG1OdmJURWNNQm9HQTFVRUF4TVRZMkV1CmIzSm5NUzVsZUdGdGNHeGxMbU52YlRBZUZ3MHhPVEE0TURFd01qRTBNREJhRncweU9UQTNNamt3TWpFME1EQmEKTUhNeEN6QUpCZ05WQkFZVEFsVlRNUk13RVFZRFZRUUlFd3BEWVd4cFptOXlibWxoTVJZd0ZBWURWUVFIRXcxVApZVzRnUm5KaGJtTnBjMk52TVJrd0Z3WURWUVFLRXhCdmNtY3hMbVY0WVcxd2JHVXVZMjl0TVJ3d0dnWURWUVFECkV4TmpZUzV2Y21jeExtVjRZVzF3YkdVdVkyOXRNRmt3RXdZSEtvWkl6ajBDQVFZSUtvWkl6ajBEQVFjRFFnQUUKSmNFQkUvUlF1Ty9JR2h0QWJjSnhnTEhyMHNEbENFS0dpQnA3NXlRYytjdUFQK21NWDI4TGtWTERJaGhELzV5MgpiMTJUM1o4Z1Y1N2tMOHdrUTM1SXpxTnRNR3N3RGdZRFZSMFBBUUgvQkFRREFnR21NQjBHQTFVZEpRUVdNQlFHCkNDc0dBUVVGQndNQ0JnZ3JCZ0VGQlFjREFUQVBCZ05WSFJNQkFmOEVCVEFEQVFIL01Da0dBMVVkRGdRaUJDQlUKR2xOV3JVOGVkUE9qSisyRzczZTJTUUR2NVh0VTNJZitJMkQyajhVZ0VEQUtCZ2dxaGtqT1BRUURBZ05IQURCRQpBaUF3YzVYMVZLVGZQM0ZqL0o1Tk9wVHlNU08vU2MzcnFhbmxOelRUbk5VRmZnSWdNZi9HVWpjcjhra1V2Y2hBCjlzM0NIc1VYZ1loTWNPaHVxWFJmZHdTRC9XRT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo="</span>,</span><br><span class="line">																	<span class="attr">"organizational_unit_identifier"</span>: <span class="string">"peer"</span></span><br><span class="line">																&#125;</span><br><span class="line">															&#125;,</span><br><span class="line">															<span class="attr">"intermediate_certs"</span>: [],</span><br><span class="line">															<span class="attr">"name"</span>: <span class="string">"Org1MSP"</span>,</span><br><span class="line">															<span class="attr">"organizational_unit_identifiers"</span>: [],</span><br><span class="line">															<span class="attr">"revocation_list"</span>: [],</span><br><span class="line">															<span class="attr">"root_certs"</span>: [</span><br><span class="line">																<span class="string">"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNVRENDQWZlZ0F3SUJBZ0lRSnJqamM3b1RSLy8zSG9wcDFYY0Y4VEFLQmdncWhrak9QUVFEQWpCek1Rc3cKQ1FZRFZRUUdFd0pWVXpFVE1CRUdBMVVFQ0JNS1EyRnNhV1p2Y201cFlURVdNQlFHQTFVRUJ4TU5VMkZ1SUVaeQpZVzVqYVhOamJ6RVpNQmNHQTFVRUNoTVFiM0puTVM1bGVHRnRjR3hsTG1OdmJURWNNQm9HQTFVRUF4TVRZMkV1CmIzSm5NUzVsZUdGdGNHeGxMbU52YlRBZUZ3MHhPVEE0TURFd01qRTBNREJhRncweU9UQTNNamt3TWpFME1EQmEKTUhNeEN6QUpCZ05WQkFZVEFsVlRNUk13RVFZRFZRUUlFd3BEWVd4cFptOXlibWxoTVJZd0ZBWURWUVFIRXcxVApZVzRnUm5KaGJtTnBjMk52TVJrd0Z3WURWUVFLRXhCdmNtY3hMbVY0WVcxd2JHVXVZMjl0TVJ3d0dnWURWUVFECkV4TmpZUzV2Y21jeExtVjRZVzF3YkdVdVkyOXRNRmt3RXdZSEtvWkl6ajBDQVFZSUtvWkl6ajBEQVFjRFFnQUUKSmNFQkUvUlF1Ty9JR2h0QWJjSnhnTEhyMHNEbENFS0dpQnA3NXlRYytjdUFQK21NWDI4TGtWTERJaGhELzV5MgpiMTJUM1o4Z1Y1N2tMOHdrUTM1SXpxTnRNR3N3RGdZRFZSMFBBUUgvQkFRREFnR21NQjBHQTFVZEpRUVdNQlFHCkNDc0dBUVVGQndNQ0JnZ3JCZ0VGQlFjREFUQVBCZ05WSFJNQkFmOEVCVEFEQVFIL01Da0dBMVVkRGdRaUJDQlUKR2xOV3JVOGVkUE9qSisyRzczZTJTUUR2NVh0VTNJZitJMkQyajhVZ0VEQUtCZ2dxaGtqT1BRUURBZ05IQURCRQpBaUF3YzVYMVZLVGZQM0ZqL0o1Tk9wVHlNU08vU2MzcnFhbmxOelRUbk5VRmZnSWdNZi9HVWpjcjhra1V2Y2hBCjlzM0NIc1VYZ1loTWNPaHVxWFJmZHdTRC9XRT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo="</span></span><br><span class="line">															],</span><br><span class="line">															<span class="attr">"signing_identity"</span>: <span class="literal">null</span>,</span><br><span class="line">															<span class="attr">"tls_intermediate_certs"</span>: [],</span><br><span class="line">															<span class="attr">"tls_root_certs"</span>: [</span><br><span class="line">																<span class="string">"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNWakNDQWYyZ0F3SUJBZ0lRQldDNzUzQUphWXVOSkhqeVpGb1JvVEFLQmdncWhrak9QUVFEQWpCMk1Rc3cKQ1FZRFZRUUdFd0pWVXpFVE1CRUdBMVVFQ0JNS1EyRnNhV1p2Y201cFlURVdNQlFHQTFVRUJ4TU5VMkZ1SUVaeQpZVzVqYVhOamJ6RVpNQmNHQTFVRUNoTVFiM0puTVM1bGVHRnRjR3hsTG1OdmJURWZNQjBHQTFVRUF4TVdkR3h6ClkyRXViM0puTVM1bGVHRnRjR3hsTG1OdmJUQWVGdzB4T1RBNE1ERXdNakUwTURCYUZ3MHlPVEEzTWprd01qRTAKTURCYU1IWXhDekFKQmdOVkJBWVRBbFZUTVJNd0VRWURWUVFJRXdwRFlXeHBabTl5Ym1saE1SWXdGQVlEVlFRSApFdzFUWVc0Z1JuSmhibU5wYzJOdk1Sa3dGd1lEVlFRS0V4QnZjbWN4TG1WNFlXMXdiR1V1WTI5dE1SOHdIUVlEClZRUURFeFowYkhOallTNXZjbWN4TG1WNFlXMXdiR1V1WTI5dE1Ga3dFd1lIS29aSXpqMENBUVlJS29aSXpqMEQKQVFjRFFnQUVJcWRZYWtLRmtKRm1NZEhDRnVGdkJIVXZMMFhUa0RJTG40Qm5vdW5GWUFaWmRFNFdpQ1lkcnJsSwpjTmpQWG1pNXZEajcrQmhoWXBaQjRnbHZRbUpDb2FOdE1Hc3dEZ1lEVlIwUEFRSC9CQVFEQWdHbU1CMEdBMVVkCkpRUVdNQlFHQ0NzR0FRVUZCd01DQmdnckJnRUZCUWNEQVRBUEJnTlZIUk1CQWY4RUJUQURBUUgvTUNrR0ExVWQKRGdRaUJDQ0JzMVk5ZjhzTjFBYndZdnFzcEdLRzBIenhTQ2RyWEdHdUVvc2dGb3BQcVRBS0JnZ3Foa2pPUFFRRApBZ05IQURCRUFpQnF5VzBOL0xhMTRlTVh4SXIzNWVQbXVXdXpQQnJrd1h4RG9pd1RtdXJzZ1FJZ0JRRkZJdVl5CmRSVk4zOHdZSU5vUU16eW5Uek93NFNBMXpRdUs3QzViZGk0PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg=="</span></span><br><span class="line">															]</span><br><span class="line">														&#125;,</span><br><span class="line">														<span class="attr">"type"</span>: <span class="number">0</span></span><br><span class="line">													&#125;,</span><br><span class="line">													<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">												&#125;</span><br><span class="line">											&#125;,</span><br><span class="line">											<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">										&#125;,</span><br><span class="line">										<span class="attr">"Org2MSP"</span>: &#123;</span><br><span class="line">											<span class="attr">"groups"</span>: &#123;&#125;,</span><br><span class="line">											<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">											<span class="attr">"policies"</span>: &#123;</span><br><span class="line">												<span class="attr">"Admins"</span>: &#123;</span><br><span class="line">													<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">													<span class="attr">"policy"</span>: &#123;</span><br><span class="line">														<span class="attr">"type"</span>: <span class="number">1</span>,</span><br><span class="line">														<span class="attr">"value"</span>: &#123;</span><br><span class="line">															<span class="attr">"identities"</span>: [&#123;</span><br><span class="line">																<span class="attr">"principal"</span>: &#123;</span><br><span class="line">																	<span class="attr">"msp_identifier"</span>: <span class="string">"Org2MSP"</span>,</span><br><span class="line">																	<span class="attr">"role"</span>: <span class="string">"ADMIN"</span></span><br><span class="line">																&#125;,</span><br><span class="line">																<span class="attr">"principal_classification"</span>: <span class="string">"ROLE"</span></span><br><span class="line">															&#125;],</span><br><span class="line">															<span class="attr">"rule"</span>: &#123;</span><br><span class="line">																<span class="attr">"n_out_of"</span>: &#123;</span><br><span class="line">																	<span class="attr">"n"</span>: <span class="number">1</span>,</span><br><span class="line">																	<span class="attr">"rules"</span>: [&#123;</span><br><span class="line">																		<span class="attr">"signed_by"</span>: <span class="number">0</span></span><br><span class="line">																	&#125;]</span><br><span class="line">																&#125;</span><br><span class="line">															&#125;,</span><br><span class="line">															<span class="attr">"version"</span>: <span class="number">0</span></span><br><span class="line">														&#125;</span><br><span class="line">													&#125;,</span><br><span class="line">													<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">												&#125;,</span><br><span class="line">												<span class="attr">"Readers"</span>: &#123;</span><br><span class="line">													<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">													<span class="attr">"policy"</span>: &#123;</span><br><span class="line">														<span class="attr">"type"</span>: <span class="number">1</span>,</span><br><span class="line">														<span class="attr">"value"</span>: &#123;</span><br><span class="line">															<span class="attr">"identities"</span>: [&#123;</span><br><span class="line">																	<span class="attr">"principal"</span>: &#123;</span><br><span class="line">																		<span class="attr">"msp_identifier"</span>: <span class="string">"Org2MSP"</span>,</span><br><span class="line">																		<span class="attr">"role"</span>: <span class="string">"ADMIN"</span></span><br><span class="line">																	&#125;,</span><br><span class="line">																	<span class="attr">"principal_classification"</span>: <span class="string">"ROLE"</span></span><br><span class="line">																&#125;,</span><br><span class="line">																&#123;</span><br><span class="line">																	<span class="attr">"principal"</span>: &#123;</span><br><span class="line">																		<span class="attr">"msp_identifier"</span>: <span class="string">"Org2MSP"</span>,</span><br><span class="line">																		<span class="attr">"role"</span>: <span class="string">"PEER"</span></span><br><span class="line">																	&#125;,</span><br><span class="line">																	<span class="attr">"principal_classification"</span>: <span class="string">"ROLE"</span></span><br><span class="line">																&#125;,</span><br><span class="line">																&#123;</span><br><span class="line">																	<span class="attr">"principal"</span>: &#123;</span><br><span class="line">																		<span class="attr">"msp_identifier"</span>: <span class="string">"Org2MSP"</span>,</span><br><span class="line">																		<span class="attr">"role"</span>: <span class="string">"CLIENT"</span></span><br><span class="line">																	&#125;,</span><br><span class="line">																	<span class="attr">"principal_classification"</span>: <span class="string">"ROLE"</span></span><br><span class="line">																&#125;</span><br><span class="line">															],</span><br><span class="line">															<span class="attr">"rule"</span>: &#123;</span><br><span class="line">																<span class="attr">"n_out_of"</span>: &#123;</span><br><span class="line">																	<span class="attr">"n"</span>: <span class="number">1</span>,</span><br><span class="line">																	<span class="attr">"rules"</span>: [&#123;</span><br><span class="line">																			<span class="attr">"signed_by"</span>: <span class="number">0</span></span><br><span class="line">																		&#125;,</span><br><span class="line">																		&#123;</span><br><span class="line">																			<span class="attr">"signed_by"</span>: <span class="number">1</span></span><br><span class="line">																		&#125;,</span><br><span class="line">																		&#123;</span><br><span class="line">																			<span class="attr">"signed_by"</span>: <span class="number">2</span></span><br><span class="line">																		&#125;</span><br><span class="line">																	]</span><br><span class="line">																&#125;</span><br><span class="line">															&#125;,</span><br><span class="line">															<span class="attr">"version"</span>: <span class="number">0</span></span><br><span class="line">														&#125;</span><br><span class="line">													&#125;,</span><br><span class="line">													<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">												&#125;,</span><br><span class="line">												<span class="attr">"Writers"</span>: &#123;</span><br><span class="line">													<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">													<span class="attr">"policy"</span>: &#123;</span><br><span class="line">														<span class="attr">"type"</span>: <span class="number">1</span>,</span><br><span class="line">														<span class="attr">"value"</span>: &#123;</span><br><span class="line">															<span class="attr">"identities"</span>: [&#123;</span><br><span class="line">																	<span class="attr">"principal"</span>: &#123;</span><br><span class="line">																		<span class="attr">"msp_identifier"</span>: <span class="string">"Org2MSP"</span>,</span><br><span class="line">																		<span class="attr">"role"</span>: <span class="string">"ADMIN"</span></span><br><span class="line">																	&#125;,</span><br><span class="line">																	<span class="attr">"principal_classification"</span>: <span class="string">"ROLE"</span></span><br><span class="line">																&#125;,</span><br><span class="line">																&#123;</span><br><span class="line">																	<span class="attr">"principal"</span>: &#123;</span><br><span class="line">																		<span class="attr">"msp_identifier"</span>: <span class="string">"Org2MSP"</span>,</span><br><span class="line">																		<span class="attr">"role"</span>: <span class="string">"CLIENT"</span></span><br><span class="line">																	&#125;,</span><br><span class="line">																	<span class="attr">"principal_classification"</span>: <span class="string">"ROLE"</span></span><br><span class="line">																&#125;</span><br><span class="line">															],</span><br><span class="line">															<span class="attr">"rule"</span>: &#123;</span><br><span class="line">																<span class="attr">"n_out_of"</span>: &#123;</span><br><span class="line">																	<span class="attr">"n"</span>: <span class="number">1</span>,</span><br><span class="line">																	<span class="attr">"rules"</span>: [&#123;</span><br><span class="line">																			<span class="attr">"signed_by"</span>: <span class="number">0</span></span><br><span class="line">																		&#125;,</span><br><span class="line">																		&#123;</span><br><span class="line">																			<span class="attr">"signed_by"</span>: <span class="number">1</span></span><br><span class="line">																		&#125;</span><br><span class="line">																	]</span><br><span class="line">																&#125;</span><br><span class="line">															&#125;,</span><br><span class="line">															<span class="attr">"version"</span>: <span class="number">0</span></span><br><span class="line">														&#125;</span><br><span class="line">													&#125;,</span><br><span class="line">													<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">												&#125;</span><br><span class="line">											&#125;,</span><br><span class="line">											<span class="attr">"values"</span>: &#123;</span><br><span class="line">												<span class="attr">"MSP"</span>: &#123;</span><br><span class="line">													<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">													<span class="attr">"value"</span>: &#123;</span><br><span class="line">														<span class="attr">"config"</span>: &#123;</span><br><span class="line">															<span class="attr">"admins"</span>: [</span><br><span class="line">																<span class="string">"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNLekNDQWRHZ0F3SUJBZ0lSQUo5YnI3UHJmQWg5cHVVcDFMZkJ3V0V3Q2dZSUtvWkl6ajBFQXdJd2N6RUwKTUFrR0ExVUVCaE1DVlZNeEV6QVJCZ05WQkFnVENrTmhiR2xtYjNKdWFXRXhGakFVQmdOVkJBY1REVk5oYmlCRwpjbUZ1WTJselkyOHhHVEFYQmdOVkJBb1RFRzl5WnpJdVpYaGhiWEJzWlM1amIyMHhIREFhQmdOVkJBTVRFMk5oCkxtOXlaekl1WlhoaGJYQnNaUzVqYjIwd0hoY05NVGt3T0RBeE1ESXhOREF3V2hjTk1qa3dOekk1TURJeE5EQXcKV2pCc01Rc3dDUVlEVlFRR0V3SlZVekVUTUJFR0ExVUVDQk1LUTJGc2FXWnZjbTVwWVRFV01CUUdBMVVFQnhNTgpVMkZ1SUVaeVlXNWphWE5qYnpFUE1BMEdBMVVFQ3hNR1kyeHBaVzUwTVI4d0hRWURWUVFEREJaQlpHMXBia0J2CmNtY3lMbVY0WVcxd2JHVXVZMjl0TUZrd0V3WUhLb1pJemowQ0FRWUlLb1pJemowREFRY0RRZ0FFZndwdkRmOHoKWVdVaWxwclcxQ2hsc3hBaDhVcjBLQXpUYm9oc0oyQjFNWk40ZkVUakhKTHRnWjZDT0ZRaVFoNy9BK1NyNVhYdApDRnpvNUZWSlNSNmc2YU5OTUVzd0RnWURWUjBQQVFIL0JBUURBZ2VBTUF3R0ExVWRFd0VCL3dRQ01BQXdLd1lEClZSMGpCQ1F3SW9BZ21RRjBZbjNvczlwUEhXQ01ra3U4VXUzYks0cmY1QUllUTYwUVgyNHh4cjh3Q2dZSUtvWkkKemowRUF3SURTQUF3UlFJaEFPVUZRWUMvZE1ZMGZ0U2JNYVFLL213Uy83a0JyRWZicXFNaHBwWjlqWG1uQWlCeQpjczdFalFuZHJ2RHRMZnVPUEY4QnJyVGZPdWZDTTVNN09YSDl4S2ZQdVE9PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg=="</span></span><br><span class="line">															],</span><br><span class="line">															<span class="attr">"crypto_config"</span>: &#123;</span><br><span class="line">																<span class="attr">"identity_identifier_hash_function"</span>: <span class="string">"SHA256"</span>,</span><br><span class="line">																<span class="attr">"signature_hash_family"</span>: <span class="string">"SHA2"</span></span><br><span class="line">															&#125;,</span><br><span class="line">															<span class="attr">"fabric_node_ous"</span>: &#123;</span><br><span class="line">																<span class="attr">"client_ou_identifier"</span>: &#123;</span><br><span class="line">																	<span class="attr">"certificate"</span>: <span class="string">"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNVakNDQWZpZ0F3SUJBZ0lSQU1rYVQ5em1XTEo2bFVNUlhRZmgrSTh3Q2dZSUtvWkl6ajBFQXdJd2N6RUwKTUFrR0ExVUVCaE1DVlZNeEV6QVJCZ05WQkFnVENrTmhiR2xtYjNKdWFXRXhGakFVQmdOVkJBY1REVk5oYmlCRwpjbUZ1WTJselkyOHhHVEFYQmdOVkJBb1RFRzl5WnpJdVpYaGhiWEJzWlM1amIyMHhIREFhQmdOVkJBTVRFMk5oCkxtOXlaekl1WlhoaGJYQnNaUzVqYjIwd0hoY05NVGt3T0RBeE1ESXhOREF3V2hjTk1qa3dOekk1TURJeE5EQXcKV2pCek1Rc3dDUVlEVlFRR0V3SlZVekVUTUJFR0ExVUVDQk1LUTJGc2FXWnZjbTVwWVRFV01CUUdBMVVFQnhNTgpVMkZ1SUVaeVlXNWphWE5qYnpFWk1CY0dBMVVFQ2hNUWIzSm5NaTVsZUdGdGNHeGxMbU52YlRFY01Cb0dBMVVFCkF4TVRZMkV1YjNKbk1pNWxlR0Z0Y0d4bExtTnZiVEJaTUJNR0J5cUdTTTQ5QWdFR0NDcUdTTTQ5QXdFSEEwSUEKQkpZSEEzOVNmbjczdXFIT0JrTzJ0R1pucFdvR09NRHFmRkJwZG9FOXhCTzNCdFZaT2hMblBYY01MRGErcTdJMQpxbFJHQmh4TTVpLzZ1L0V4Z2psaTVVK2piVEJyTUE0R0ExVWREd0VCL3dRRUF3SUJwakFkQmdOVkhTVUVGakFVCkJnZ3JCZ0VGQlFjREFnWUlLd1lCQlFVSEF3RXdEd1lEVlIwVEFRSC9CQVV3QXdFQi96QXBCZ05WSFE0RUlnUWcKbVFGMFluM29zOXBQSFdDTWtrdThVdTNiSzRyZjVBSWVRNjBRWDI0eHhyOHdDZ1lJS29aSXpqMEVBd0lEU0FBdwpSUUloQUpzYVBHWklWTkU4S09zbjJzZ2ZSSlo1ek1BbEpIS1p3V1lJQTljVVNWS1FBaUF6ZkIrL0VMUFQrbFFmCjZUNmhEQXU1bkwwRGpoUUxqa0ZmL3RXNUVDMzlCQT09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K"</span>,</span><br><span class="line">																	<span class="attr">"organizational_unit_identifier"</span>: <span class="string">"client"</span></span><br><span class="line">																&#125;,</span><br><span class="line">																<span class="attr">"enable"</span>: <span class="literal">true</span>,</span><br><span class="line">																<span class="attr">"peer_ou_identifier"</span>: &#123;</span><br><span class="line">																	<span class="attr">"certificate"</span>: <span class="string">"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNVakNDQWZpZ0F3SUJBZ0lSQU1rYVQ5em1XTEo2bFVNUlhRZmgrSTh3Q2dZSUtvWkl6ajBFQXdJd2N6RUwKTUFrR0ExVUVCaE1DVlZNeEV6QVJCZ05WQkFnVENrTmhiR2xtYjNKdWFXRXhGakFVQmdOVkJBY1REVk5oYmlCRwpjbUZ1WTJselkyOHhHVEFYQmdOVkJBb1RFRzl5WnpJdVpYaGhiWEJzWlM1amIyMHhIREFhQmdOVkJBTVRFMk5oCkxtOXlaekl1WlhoaGJYQnNaUzVqYjIwd0hoY05NVGt3T0RBeE1ESXhOREF3V2hjTk1qa3dOekk1TURJeE5EQXcKV2pCek1Rc3dDUVlEVlFRR0V3SlZVekVUTUJFR0ExVUVDQk1LUTJGc2FXWnZjbTVwWVRFV01CUUdBMVVFQnhNTgpVMkZ1SUVaeVlXNWphWE5qYnpFWk1CY0dBMVVFQ2hNUWIzSm5NaTVsZUdGdGNHeGxMbU52YlRFY01Cb0dBMVVFCkF4TVRZMkV1YjNKbk1pNWxlR0Z0Y0d4bExtTnZiVEJaTUJNR0J5cUdTTTQ5QWdFR0NDcUdTTTQ5QXdFSEEwSUEKQkpZSEEzOVNmbjczdXFIT0JrTzJ0R1pucFdvR09NRHFmRkJwZG9FOXhCTzNCdFZaT2hMblBYY01MRGErcTdJMQpxbFJHQmh4TTVpLzZ1L0V4Z2psaTVVK2piVEJyTUE0R0ExVWREd0VCL3dRRUF3SUJwakFkQmdOVkhTVUVGakFVCkJnZ3JCZ0VGQlFjREFnWUlLd1lCQlFVSEF3RXdEd1lEVlIwVEFRSC9CQVV3QXdFQi96QXBCZ05WSFE0RUlnUWcKbVFGMFluM29zOXBQSFdDTWtrdThVdTNiSzRyZjVBSWVRNjBRWDI0eHhyOHdDZ1lJS29aSXpqMEVBd0lEU0FBdwpSUUloQUpzYVBHWklWTkU4S09zbjJzZ2ZSSlo1ek1BbEpIS1p3V1lJQTljVVNWS1FBaUF6ZkIrL0VMUFQrbFFmCjZUNmhEQXU1bkwwRGpoUUxqa0ZmL3RXNUVDMzlCQT09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K"</span>,</span><br><span class="line">																	<span class="attr">"organizational_unit_identifier"</span>: <span class="string">"peer"</span></span><br><span class="line">																&#125;</span><br><span class="line">															&#125;,</span><br><span class="line">															<span class="attr">"intermediate_certs"</span>: [],</span><br><span class="line">															<span class="attr">"name"</span>: <span class="string">"Org2MSP"</span>,</span><br><span class="line">															<span class="attr">"organizational_unit_identifiers"</span>: [],</span><br><span class="line">															<span class="attr">"revocation_list"</span>: [],</span><br><span class="line">															<span class="attr">"root_certs"</span>: [</span><br><span class="line">																<span class="string">"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNVakNDQWZpZ0F3SUJBZ0lSQU1rYVQ5em1XTEo2bFVNUlhRZmgrSTh3Q2dZSUtvWkl6ajBFQXdJd2N6RUwKTUFrR0ExVUVCaE1DVlZNeEV6QVJCZ05WQkFnVENrTmhiR2xtYjNKdWFXRXhGakFVQmdOVkJBY1REVk5oYmlCRwpjbUZ1WTJselkyOHhHVEFYQmdOVkJBb1RFRzl5WnpJdVpYaGhiWEJzWlM1amIyMHhIREFhQmdOVkJBTVRFMk5oCkxtOXlaekl1WlhoaGJYQnNaUzVqYjIwd0hoY05NVGt3T0RBeE1ESXhOREF3V2hjTk1qa3dOekk1TURJeE5EQXcKV2pCek1Rc3dDUVlEVlFRR0V3SlZVekVUTUJFR0ExVUVDQk1LUTJGc2FXWnZjbTVwWVRFV01CUUdBMVVFQnhNTgpVMkZ1SUVaeVlXNWphWE5qYnpFWk1CY0dBMVVFQ2hNUWIzSm5NaTVsZUdGdGNHeGxMbU52YlRFY01Cb0dBMVVFCkF4TVRZMkV1YjNKbk1pNWxlR0Z0Y0d4bExtTnZiVEJaTUJNR0J5cUdTTTQ5QWdFR0NDcUdTTTQ5QXdFSEEwSUEKQkpZSEEzOVNmbjczdXFIT0JrTzJ0R1pucFdvR09NRHFmRkJwZG9FOXhCTzNCdFZaT2hMblBYY01MRGErcTdJMQpxbFJHQmh4TTVpLzZ1L0V4Z2psaTVVK2piVEJyTUE0R0ExVWREd0VCL3dRRUF3SUJwakFkQmdOVkhTVUVGakFVCkJnZ3JCZ0VGQlFjREFnWUlLd1lCQlFVSEF3RXdEd1lEVlIwVEFRSC9CQVV3QXdFQi96QXBCZ05WSFE0RUlnUWcKbVFGMFluM29zOXBQSFdDTWtrdThVdTNiSzRyZjVBSWVRNjBRWDI0eHhyOHdDZ1lJS29aSXpqMEVBd0lEU0FBdwpSUUloQUpzYVBHWklWTkU4S09zbjJzZ2ZSSlo1ek1BbEpIS1p3V1lJQTljVVNWS1FBaUF6ZkIrL0VMUFQrbFFmCjZUNmhEQXU1bkwwRGpoUUxqa0ZmL3RXNUVDMzlCQT09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K"</span></span><br><span class="line">															],</span><br><span class="line">															<span class="attr">"signing_identity"</span>: <span class="literal">null</span>,</span><br><span class="line">															<span class="attr">"tls_intermediate_certs"</span>: [],</span><br><span class="line">															<span class="attr">"tls_root_certs"</span>: [</span><br><span class="line">																<span class="string">"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNWekNDQWYyZ0F3SUJBZ0lRVGV5ZHpHQWVpNzB1ZkZzbTBmTWY1VEFLQmdncWhrak9QUVFEQWpCMk1Rc3cKQ1FZRFZRUUdFd0pWVXpFVE1CRUdBMVVFQ0JNS1EyRnNhV1p2Y201cFlURVdNQlFHQTFVRUJ4TU5VMkZ1SUVaeQpZVzVqYVhOamJ6RVpNQmNHQTFVRUNoTVFiM0puTWk1bGVHRnRjR3hsTG1OdmJURWZNQjBHQTFVRUF4TVdkR3h6ClkyRXViM0puTWk1bGVHRnRjR3hsTG1OdmJUQWVGdzB4T1RBNE1ERXdNakUwTURCYUZ3MHlPVEEzTWprd01qRTAKTURCYU1IWXhDekFKQmdOVkJBWVRBbFZUTVJNd0VRWURWUVFJRXdwRFlXeHBabTl5Ym1saE1SWXdGQVlEVlFRSApFdzFUWVc0Z1JuSmhibU5wYzJOdk1Sa3dGd1lEVlFRS0V4QnZjbWN5TG1WNFlXMXdiR1V1WTI5dE1SOHdIUVlEClZRUURFeFowYkhOallTNXZjbWN5TG1WNFlXMXdiR1V1WTI5dE1Ga3dFd1lIS29aSXpqMENBUVlJS29aSXpqMEQKQVFjRFFnQUVadTg3U0JzYWpnNXRTcFZKeGlZaE9YaWpOd3J0TmQvTFpuYkozWjUvY0dhaXZHeTZwQTB6Y1RjcApvdHN1YWJscE9BNHkxREEvbk5xaWtQa1dVVHZQcHFOdE1Hc3dEZ1lEVlIwUEFRSC9CQVFEQWdHbU1CMEdBMVVkCkpRUVdNQlFHQ0NzR0FRVUZCd01DQmdnckJnRUZCUWNEQVRBUEJnTlZIUk1CQWY4RUJUQURBUUgvTUNrR0ExVWQKRGdRaUJDQUh4MDhOZ1FwdW9IR0tZWU9IYWh3VDg0cW9BN3p3dzFRTVNZT0h2VlZCWERBS0JnZ3Foa2pPUFFRRApBZ05JQURCRkFpRUF5QlBlakFHWjZtNXdWS244WHFhblFsMWUzYjNpUFBJVFdHaVN0dDBuZ3JJQ0lIUUJKRFd6CjFubzBMbnp0Nis4eEw5R25oY1NrZnZsWXR5MmhQcjdnTThFYgotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg=="</span></span><br><span class="line">															]</span><br><span class="line">														&#125;,</span><br><span class="line">														<span class="attr">"type"</span>: <span class="number">0</span></span><br><span class="line">													&#125;,</span><br><span class="line">													<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">												&#125;</span><br><span class="line">											&#125;,</span><br><span class="line">											<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">										&#125;</span><br><span class="line">									&#125;,</span><br><span class="line">									<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">									<span class="attr">"policies"</span>: &#123;</span><br><span class="line">										<span class="attr">"Admins"</span>: &#123;</span><br><span class="line">											<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">											<span class="attr">"policy"</span>: &#123;</span><br><span class="line">												<span class="attr">"type"</span>: <span class="number">3</span>,</span><br><span class="line">												<span class="attr">"value"</span>: &#123;</span><br><span class="line">													<span class="attr">"rule"</span>: <span class="string">"MAJORITY"</span>,</span><br><span class="line">													<span class="attr">"sub_policy"</span>: <span class="string">"Admins"</span></span><br><span class="line">												&#125;</span><br><span class="line">											&#125;,</span><br><span class="line">											<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">										&#125;,</span><br><span class="line">										<span class="attr">"Readers"</span>: &#123;</span><br><span class="line">											<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">											<span class="attr">"policy"</span>: &#123;</span><br><span class="line">												<span class="attr">"type"</span>: <span class="number">3</span>,</span><br><span class="line">												<span class="attr">"value"</span>: &#123;</span><br><span class="line">													<span class="attr">"rule"</span>: <span class="string">"ANY"</span>,</span><br><span class="line">													<span class="attr">"sub_policy"</span>: <span class="string">"Readers"</span></span><br><span class="line">												&#125;</span><br><span class="line">											&#125;,</span><br><span class="line">											<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">										&#125;,</span><br><span class="line">										<span class="attr">"Writers"</span>: &#123;</span><br><span class="line">											<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">											<span class="attr">"policy"</span>: &#123;</span><br><span class="line">												<span class="attr">"type"</span>: <span class="number">3</span>,</span><br><span class="line">												<span class="attr">"value"</span>: &#123;</span><br><span class="line">													<span class="attr">"rule"</span>: <span class="string">"ANY"</span>,</span><br><span class="line">													<span class="attr">"sub_policy"</span>: <span class="string">"Writers"</span></span><br><span class="line">												&#125;</span><br><span class="line">											&#125;,</span><br><span class="line">											<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">										&#125;</span><br><span class="line">									&#125;,</span><br><span class="line">									<span class="attr">"values"</span>: &#123;</span><br><span class="line">										<span class="attr">"Capabilities"</span>: &#123;</span><br><span class="line">											<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">											<span class="attr">"value"</span>: &#123;</span><br><span class="line">												<span class="attr">"capabilities"</span>: &#123;</span><br><span class="line">													<span class="attr">"V1_3"</span>: &#123;&#125;</span><br><span class="line">												&#125;</span><br><span class="line">											&#125;,</span><br><span class="line">											<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">										&#125;</span><br><span class="line">									&#125;,</span><br><span class="line">									<span class="attr">"version"</span>: <span class="string">"1"</span></span><br><span class="line">								&#125;,</span><br><span class="line">								<span class="attr">"Orderer"</span>: &#123;</span><br><span class="line">									<span class="attr">"groups"</span>: &#123;</span><br><span class="line">										<span class="attr">"OrdererOrg"</span>: &#123;</span><br><span class="line">											<span class="attr">"groups"</span>: &#123;&#125;,</span><br><span class="line">											<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">											<span class="attr">"policies"</span>: &#123;</span><br><span class="line">												<span class="attr">"Admins"</span>: &#123;</span><br><span class="line">													<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">													<span class="attr">"policy"</span>: &#123;</span><br><span class="line">														<span class="attr">"type"</span>: <span class="number">1</span>,</span><br><span class="line">														<span class="attr">"value"</span>: &#123;</span><br><span class="line">															<span class="attr">"identities"</span>: [&#123;</span><br><span class="line">																<span class="attr">"principal"</span>: &#123;</span><br><span class="line">																	<span class="attr">"msp_identifier"</span>: <span class="string">"OrdererMSP"</span>,</span><br><span class="line">																	<span class="attr">"role"</span>: <span class="string">"ADMIN"</span></span><br><span class="line">																&#125;,</span><br><span class="line">																<span class="attr">"principal_classification"</span>: <span class="string">"ROLE"</span></span><br><span class="line">															&#125;],</span><br><span class="line">															<span class="attr">"rule"</span>: &#123;</span><br><span class="line">																<span class="attr">"n_out_of"</span>: &#123;</span><br><span class="line">																	<span class="attr">"n"</span>: <span class="number">1</span>,</span><br><span class="line">																	<span class="attr">"rules"</span>: [&#123;</span><br><span class="line">																		<span class="attr">"signed_by"</span>: <span class="number">0</span></span><br><span class="line">																	&#125;]</span><br><span class="line">																&#125;</span><br><span class="line">															&#125;,</span><br><span class="line">															<span class="attr">"version"</span>: <span class="number">0</span></span><br><span class="line">														&#125;</span><br><span class="line">													&#125;,</span><br><span class="line">													<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">												&#125;,</span><br><span class="line">												<span class="attr">"Readers"</span>: &#123;</span><br><span class="line">													<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">													<span class="attr">"policy"</span>: &#123;</span><br><span class="line">														<span class="attr">"type"</span>: <span class="number">1</span>,</span><br><span class="line">														<span class="attr">"value"</span>: &#123;</span><br><span class="line">															<span class="attr">"identities"</span>: [&#123;</span><br><span class="line">																<span class="attr">"principal"</span>: &#123;</span><br><span class="line">																	<span class="attr">"msp_identifier"</span>: <span class="string">"OrdererMSP"</span>,</span><br><span class="line">																	<span class="attr">"role"</span>: <span class="string">"MEMBER"</span></span><br><span class="line">																&#125;,</span><br><span class="line">																<span class="attr">"principal_classification"</span>: <span class="string">"ROLE"</span></span><br><span class="line">															&#125;],</span><br><span class="line">															<span class="attr">"rule"</span>: &#123;</span><br><span class="line">																<span class="attr">"n_out_of"</span>: &#123;</span><br><span class="line">																	<span class="attr">"n"</span>: <span class="number">1</span>,</span><br><span class="line">																	<span class="attr">"rules"</span>: [&#123;</span><br><span class="line">																		<span class="attr">"signed_by"</span>: <span class="number">0</span></span><br><span class="line">																	&#125;]</span><br><span class="line">																&#125;</span><br><span class="line">															&#125;,</span><br><span class="line">															<span class="attr">"version"</span>: <span class="number">0</span></span><br><span class="line">														&#125;</span><br><span class="line">													&#125;,</span><br><span class="line">													<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">												&#125;,</span><br><span class="line">												<span class="attr">"Writers"</span>: &#123;</span><br><span class="line">													<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">													<span class="attr">"policy"</span>: &#123;</span><br><span class="line">														<span class="attr">"type"</span>: <span class="number">1</span>,</span><br><span class="line">														<span class="attr">"value"</span>: &#123;</span><br><span class="line">															<span class="attr">"identities"</span>: [&#123;</span><br><span class="line">																<span class="attr">"principal"</span>: &#123;</span><br><span class="line">																	<span class="attr">"msp_identifier"</span>: <span class="string">"OrdererMSP"</span>,</span><br><span class="line">																	<span class="attr">"role"</span>: <span class="string">"MEMBER"</span></span><br><span class="line">																&#125;,</span><br><span class="line">																<span class="attr">"principal_classification"</span>: <span class="string">"ROLE"</span></span><br><span class="line">															&#125;],</span><br><span class="line">															<span class="attr">"rule"</span>: &#123;</span><br><span class="line">																<span class="attr">"n_out_of"</span>: &#123;</span><br><span class="line">																	<span class="attr">"n"</span>: <span class="number">1</span>,</span><br><span class="line">																	<span class="attr">"rules"</span>: [&#123;</span><br><span class="line">																		<span class="attr">"signed_by"</span>: <span class="number">0</span></span><br><span class="line">																	&#125;]</span><br><span class="line">																&#125;</span><br><span class="line">															&#125;,</span><br><span class="line">															<span class="attr">"version"</span>: <span class="number">0</span></span><br><span class="line">														&#125;</span><br><span class="line">													&#125;,</span><br><span class="line">													<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">												&#125;</span><br><span class="line">											&#125;,</span><br><span class="line">											<span class="attr">"values"</span>: &#123;</span><br><span class="line">												<span class="attr">"MSP"</span>: &#123;</span><br><span class="line">													<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">													<span class="attr">"value"</span>: &#123;</span><br><span class="line">														<span class="attr">"config"</span>: &#123;</span><br><span class="line">															<span class="attr">"admins"</span>: [</span><br><span class="line">																<span class="string">"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNDekNDQWJHZ0F3SUJBZ0lSQUtuelI3NFZjN3RqOE5aQ21QV29QaWN3Q2dZSUtvWkl6ajBFQXdJd2FURUwKTUFrR0ExVUVCaE1DVlZNeEV6QVJCZ05WQkFnVENrTmhiR2xtYjNKdWFXRXhGakFVQmdOVkJBY1REVk5oYmlCRwpjbUZ1WTJselkyOHhGREFTQmdOVkJBb1RDMlY0WVcxd2JHVXVZMjl0TVJjd0ZRWURWUVFERXc1allTNWxlR0Z0CmNHeGxMbU52YlRBZUZ3MHhPVEE0TURFd01qRTBNREJhRncweU9UQTNNamt3TWpFME1EQmFNRll4Q3pBSkJnTlYKQkFZVEFsVlRNUk13RVFZRFZRUUlFd3BEWVd4cFptOXlibWxoTVJZd0ZBWURWUVFIRXcxVFlXNGdSbkpoYm1OcApjMk52TVJvd0dBWURWUVFEREJGQlpHMXBia0JsZUdGdGNHeGxMbU52YlRCWk1CTUdCeXFHU000OUFnRUdDQ3FHClNNNDlBd0VIQTBJQUJNUGUyNUtPU0hscUVZelJFVE83YXRjYWRvT0xnckRxelJQTjNjQ2RpR3A4QU4wdmdiTnAKTEEvTFJ0alFKbzdQaTZFZFlHaWh1MUNuRWgvNUxnYk90TmVqVFRCTE1BNEdBMVVkRHdFQi93UUVBd0lIZ0RBTQpCZ05WSFJNQkFmOEVBakFBTUNzR0ExVWRJd1FrTUNLQUlFQ0pBOWZTbDlUN0xsVWZ3QVhwM1V1cyt2YVpRbkZPCm9PSXJ2cmFrUDE3QU1Bb0dDQ3FHU000OUJBTUNBMGdBTUVVQ0lRQ1BjZVpmekNXa29MZ0N0NTMwbmEramY0a2cKN3BIWWwwY2NMTTZ4QkU0em5RSWdFVU52N2Q3MjQ2N1dnN0pMckZDb0x6eFhWUlMrN2UyWVJYSUlKOS9NVTJRPQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg=="</span></span><br><span class="line">															],</span><br><span class="line">															<span class="attr">"crypto_config"</span>: &#123;</span><br><span class="line">																<span class="attr">"identity_identifier_hash_function"</span>: <span class="string">"SHA256"</span>,</span><br><span class="line">																<span class="attr">"signature_hash_family"</span>: <span class="string">"SHA2"</span></span><br><span class="line">															&#125;,</span><br><span class="line">															<span class="attr">"fabric_node_ous"</span>: <span class="literal">null</span>,</span><br><span class="line">															<span class="attr">"intermediate_certs"</span>: [],</span><br><span class="line">															<span class="attr">"name"</span>: <span class="string">"OrdererMSP"</span>,</span><br><span class="line">															<span class="attr">"organizational_unit_identifiers"</span>: [],</span><br><span class="line">															<span class="attr">"revocation_list"</span>: [],</span><br><span class="line">															<span class="attr">"root_certs"</span>: [</span><br><span class="line">																<span class="string">"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNQRENDQWVPZ0F3SUJBZ0lRSm9TdloyVE5oVTZjN0kvZ3VRNHYvVEFLQmdncWhrak9QUVFEQWpCcE1Rc3cKQ1FZRFZRUUdFd0pWVXpFVE1CRUdBMVVFQ0JNS1EyRnNhV1p2Y201cFlURVdNQlFHQTFVRUJ4TU5VMkZ1SUVaeQpZVzVqYVhOamJ6RVVNQklHQTFVRUNoTUxaWGhoYlhCc1pTNWpiMjB4RnpBVkJnTlZCQU1URG1OaExtVjRZVzF3CmJHVXVZMjl0TUI0WERURTVNRGd3TVRBeU1UUXdNRm9YRFRJNU1EY3lPVEF5TVRRd01Gb3dhVEVMTUFrR0ExVUUKQmhNQ1ZWTXhFekFSQmdOVkJBZ1RDa05oYkdsbWIzSnVhV0V4RmpBVUJnTlZCQWNURFZOaGJpQkdjbUZ1WTJsegpZMjh4RkRBU0JnTlZCQW9UQzJWNFlXMXdiR1V1WTI5dE1SY3dGUVlEVlFRREV3NWpZUzVsZUdGdGNHeGxMbU52CmJUQlpNQk1HQnlxR1NNNDlBZ0VHQ0NxR1NNNDlBd0VIQTBJQUJFaUxuejB5TXp6K0dPNTlLZ3NMV0E1SVNaTXgKaUdRMVkrVHB3a1hZQXhjQnZENXZMMGhXcCtwWDdmSCtqaU9TOFBCMDFkamQ0TVJsb0lCQTgzYkxxdktqYlRCcgpNQTRHQTFVZER3RUIvd1FFQXdJQnBqQWRCZ05WSFNVRUZqQVVCZ2dyQmdFRkJRY0RBZ1lJS3dZQkJRVUhBd0V3CkR3WURWUjBUQVFIL0JBVXdBd0VCL3pBcEJnTlZIUTRFSWdRZ1FJa0QxOUtYMVBzdVZSL0FCZW5kUzZ6NjlwbEMKY1U2ZzRpdSt0cVEvWHNBd0NnWUlLb1pJemowRUF3SURSd0F3UkFJZ2JmRWVkMjJGRHFFSStwU0pKTXZrQi9GQQpFRitIUlg5OW91bGRLVlBqcDgwQ0lBS1VISmxlR01HYzF6dHRNSStCcHBldG53UU5nWjRsUDY5MUs0bENnU2hMCi0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K"</span></span><br><span class="line">															],</span><br><span class="line">															<span class="attr">"signing_identity"</span>: <span class="literal">null</span>,</span><br><span class="line">															<span class="attr">"tls_intermediate_certs"</span>: [],</span><br><span class="line">															<span class="attr">"tls_root_certs"</span>: [</span><br><span class="line">																<span class="string">"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNRekNDQWVxZ0F3SUJBZ0lSQVBWKy9UOVlSTjV0YmFXVGlETjg5Mmt3Q2dZSUtvWkl6ajBFQXdJd2JERUwKTUFrR0ExVUVCaE1DVlZNeEV6QVJCZ05WQkFnVENrTmhiR2xtYjNKdWFXRXhGakFVQmdOVkJBY1REVk5oYmlCRwpjbUZ1WTJselkyOHhGREFTQmdOVkJBb1RDMlY0WVcxd2JHVXVZMjl0TVJvd0dBWURWUVFERXhGMGJITmpZUzVsCmVHRnRjR3hsTG1OdmJUQWVGdzB4T1RBNE1ERXdNakUwTURCYUZ3MHlPVEEzTWprd01qRTBNREJhTUd3eEN6QUoKQmdOVkJBWVRBbFZUTVJNd0VRWURWUVFJRXdwRFlXeHBabTl5Ym1saE1SWXdGQVlEVlFRSEV3MVRZVzRnUm5KaApibU5wYzJOdk1SUXdFZ1lEVlFRS0V3dGxlR0Z0Y0d4bExtTnZiVEVhTUJnR0ExVUVBeE1SZEd4elkyRXVaWGhoCmJYQnNaUzVqYjIwd1dUQVRCZ2NxaGtqT1BRSUJCZ2dxaGtqT1BRTUJCd05DQUFSUkxQK2ZLeFpnd2tFa2JIREoKb1JQak5ySXZBWWx2SHBMUTJoSXE1aXJQQnJlcEU4akRNTERyVklZR0NRdDBydGxjWFZTT3dZVTFkMXNOUy9USApSb1JvbzIwd2F6QU9CZ05WSFE4QkFmOEVCQU1DQWFZd0hRWURWUjBsQkJZd0ZBWUlLd1lCQlFVSEF3SUdDQ3NHCkFRVUZCd01CTUE4R0ExVWRFd0VCL3dRRk1BTUJBZjh3S1FZRFZSME9CQ0lFSUJWM1owTGw1TnpOcUdqVlpmbHIKUHRqRXFrNUtvUWFweXpJOFNrTnJQQVpWTUFvR0NDcUdTTTQ5QkFNQ0EwY0FNRVFDSUQ5Z3U5bU9TejVLaTd5cQpGU2czd1FGdXphb2pRakdiNVN4YUwwVzJTOUxXQWlCSzZIOXhNSENuZm5BV291bVpsdXNHd3RsOU5PVDhkdXFVCnR2eHRPOVY4S1E9PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg=="</span></span><br><span class="line">															]</span><br><span class="line">														&#125;,</span><br><span class="line">														<span class="attr">"type"</span>: <span class="number">0</span></span><br><span class="line">													&#125;,</span><br><span class="line">													<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">												&#125;</span><br><span class="line">											&#125;,</span><br><span class="line">											<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">										&#125;</span><br><span class="line">									&#125;,</span><br><span class="line">									<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">									<span class="attr">"policies"</span>: &#123;</span><br><span class="line">										<span class="attr">"Admins"</span>: &#123;</span><br><span class="line">											<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">											<span class="attr">"policy"</span>: &#123;</span><br><span class="line">												<span class="attr">"type"</span>: <span class="number">3</span>,</span><br><span class="line">												<span class="attr">"value"</span>: &#123;</span><br><span class="line">													<span class="attr">"rule"</span>: <span class="string">"MAJORITY"</span>,</span><br><span class="line">													<span class="attr">"sub_policy"</span>: <span class="string">"Admins"</span></span><br><span class="line">												&#125;</span><br><span class="line">											&#125;,</span><br><span class="line">											<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">										&#125;,</span><br><span class="line">										<span class="attr">"BlockValidation"</span>: &#123;</span><br><span class="line">											<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">											<span class="attr">"policy"</span>: &#123;</span><br><span class="line">												<span class="attr">"type"</span>: <span class="number">3</span>,</span><br><span class="line">												<span class="attr">"value"</span>: &#123;</span><br><span class="line">													<span class="attr">"rule"</span>: <span class="string">"ANY"</span>,</span><br><span class="line">													<span class="attr">"sub_policy"</span>: <span class="string">"Writers"</span></span><br><span class="line">												&#125;</span><br><span class="line">											&#125;,</span><br><span class="line">											<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">										&#125;,</span><br><span class="line">										<span class="attr">"Readers"</span>: &#123;</span><br><span class="line">											<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">											<span class="attr">"policy"</span>: &#123;</span><br><span class="line">												<span class="attr">"type"</span>: <span class="number">3</span>,</span><br><span class="line">												<span class="attr">"value"</span>: &#123;</span><br><span class="line">													<span class="attr">"rule"</span>: <span class="string">"ANY"</span>,</span><br><span class="line">													<span class="attr">"sub_policy"</span>: <span class="string">"Readers"</span></span><br><span class="line">												&#125;</span><br><span class="line">											&#125;,</span><br><span class="line">											<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">										&#125;,</span><br><span class="line">										<span class="attr">"Writers"</span>: &#123;</span><br><span class="line">											<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">											<span class="attr">"policy"</span>: &#123;</span><br><span class="line">												<span class="attr">"type"</span>: <span class="number">3</span>,</span><br><span class="line">												<span class="attr">"value"</span>: &#123;</span><br><span class="line">													<span class="attr">"rule"</span>: <span class="string">"ANY"</span>,</span><br><span class="line">													<span class="attr">"sub_policy"</span>: <span class="string">"Writers"</span></span><br><span class="line">												&#125;</span><br><span class="line">											&#125;,</span><br><span class="line">											<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">										&#125;</span><br><span class="line">									&#125;,</span><br><span class="line">									<span class="attr">"values"</span>: &#123;</span><br><span class="line">										<span class="attr">"BatchSize"</span>: &#123;</span><br><span class="line">											<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">											<span class="attr">"value"</span>: &#123;</span><br><span class="line">												<span class="attr">"absolute_max_bytes"</span>: <span class="number">103809024</span>,</span><br><span class="line">												<span class="attr">"max_message_count"</span>: <span class="number">10</span>,</span><br><span class="line">												<span class="attr">"preferred_max_bytes"</span>: <span class="number">524288</span></span><br><span class="line">											&#125;,</span><br><span class="line">											<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">										&#125;,</span><br><span class="line">										<span class="attr">"BatchTimeout"</span>: &#123;</span><br><span class="line">											<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">											<span class="attr">"value"</span>: &#123;</span><br><span class="line">												<span class="attr">"timeout"</span>: <span class="string">"2s"</span></span><br><span class="line">											&#125;,</span><br><span class="line">											<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">										&#125;,</span><br><span class="line">										<span class="attr">"Capabilities"</span>: &#123;</span><br><span class="line">											<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">											<span class="attr">"value"</span>: &#123;</span><br><span class="line">												<span class="attr">"capabilities"</span>: &#123;</span><br><span class="line">													<span class="attr">"V1_1"</span>: &#123;&#125;</span><br><span class="line">												&#125;</span><br><span class="line">											&#125;,</span><br><span class="line">											<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">										&#125;,</span><br><span class="line">										<span class="attr">"ChannelRestrictions"</span>: &#123;</span><br><span class="line">											<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">											<span class="attr">"value"</span>: <span class="literal">null</span>,</span><br><span class="line">											<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">										&#125;,</span><br><span class="line">										<span class="attr">"ConsensusType"</span>: &#123;</span><br><span class="line">											<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">											<span class="attr">"value"</span>: &#123;</span><br><span class="line">												<span class="attr">"metadata"</span>: <span class="literal">null</span>,</span><br><span class="line">												<span class="attr">"state"</span>: <span class="string">"STATE_NORMAL"</span>,</span><br><span class="line">												<span class="attr">"type"</span>: <span class="string">"solo"</span></span><br><span class="line">											&#125;,</span><br><span class="line">											<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">										&#125;</span><br><span class="line">									&#125;,</span><br><span class="line">									<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">								&#125;</span><br><span class="line">							&#125;,</span><br><span class="line">							<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">							<span class="attr">"policies"</span>: &#123;</span><br><span class="line">								<span class="attr">"Admins"</span>: &#123;</span><br><span class="line">									<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">									<span class="attr">"policy"</span>: &#123;</span><br><span class="line">										<span class="attr">"type"</span>: <span class="number">3</span>,</span><br><span class="line">										<span class="attr">"value"</span>: &#123;</span><br><span class="line">											<span class="attr">"rule"</span>: <span class="string">"MAJORITY"</span>,</span><br><span class="line">											<span class="attr">"sub_policy"</span>: <span class="string">"Admins"</span></span><br><span class="line">										&#125;</span><br><span class="line">									&#125;,</span><br><span class="line">									<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">								&#125;,</span><br><span class="line">								<span class="attr">"Readers"</span>: &#123;</span><br><span class="line">									<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">									<span class="attr">"policy"</span>: &#123;</span><br><span class="line">										<span class="attr">"type"</span>: <span class="number">3</span>,</span><br><span class="line">										<span class="attr">"value"</span>: &#123;</span><br><span class="line">											<span class="attr">"rule"</span>: <span class="string">"ANY"</span>,</span><br><span class="line">											<span class="attr">"sub_policy"</span>: <span class="string">"Readers"</span></span><br><span class="line">										&#125;</span><br><span class="line">									&#125;,</span><br><span class="line">									<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">								&#125;,</span><br><span class="line">								<span class="attr">"Writers"</span>: &#123;</span><br><span class="line">									<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">									<span class="attr">"policy"</span>: &#123;</span><br><span class="line">										<span class="attr">"type"</span>: <span class="number">3</span>,</span><br><span class="line">										<span class="attr">"value"</span>: &#123;</span><br><span class="line">											<span class="attr">"rule"</span>: <span class="string">"ANY"</span>,</span><br><span class="line">											<span class="attr">"sub_policy"</span>: <span class="string">"Writers"</span></span><br><span class="line">										&#125;</span><br><span class="line">									&#125;,</span><br><span class="line">									<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">								&#125;</span><br><span class="line">							&#125;,</span><br><span class="line">							<span class="attr">"values"</span>: &#123;</span><br><span class="line">								<span class="attr">"BlockDataHashingStructure"</span>: &#123;</span><br><span class="line">									<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">									<span class="attr">"value"</span>: &#123;</span><br><span class="line">										<span class="attr">"width"</span>: <span class="number">4294967295</span></span><br><span class="line">									&#125;,</span><br><span class="line">									<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">								&#125;,</span><br><span class="line">								<span class="attr">"Capabilities"</span>: &#123;</span><br><span class="line">									<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">									<span class="attr">"value"</span>: &#123;</span><br><span class="line">										<span class="attr">"capabilities"</span>: &#123;</span><br><span class="line">											<span class="attr">"V1_3"</span>: &#123;&#125;</span><br><span class="line">										&#125;</span><br><span class="line">									&#125;,</span><br><span class="line">									<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">								&#125;,</span><br><span class="line">								<span class="attr">"Consortium"</span>: &#123;</span><br><span class="line">									<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">									<span class="attr">"value"</span>: &#123;</span><br><span class="line">										<span class="attr">"name"</span>: <span class="string">"SampleConsortium"</span></span><br><span class="line">									&#125;,</span><br><span class="line">									<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">								&#125;,</span><br><span class="line">								<span class="attr">"HashingAlgorithm"</span>: &#123;</span><br><span class="line">									<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">									<span class="attr">"value"</span>: &#123;</span><br><span class="line">										<span class="attr">"name"</span>: <span class="string">"SHA256"</span></span><br><span class="line">									&#125;,</span><br><span class="line">									<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">								&#125;,</span><br><span class="line">								<span class="attr">"OrdererAddresses"</span>: &#123;</span><br><span class="line">									<span class="attr">"mod_policy"</span>: <span class="string">"/Channel/Orderer/Admins"</span>,</span><br><span class="line">									<span class="attr">"value"</span>: &#123;</span><br><span class="line">										<span class="attr">"addresses"</span>: [</span><br><span class="line">											<span class="string">"orderer.example.com:7050"</span></span><br><span class="line">										]</span><br><span class="line">									&#125;,</span><br><span class="line">									<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">								&#125;</span><br><span class="line">							&#125;,</span><br><span class="line">							<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">						&#125;,</span><br><span class="line">						<span class="attr">"sequence"</span>: <span class="string">"1"</span></span><br><span class="line">					&#125;,</span><br><span class="line">					<span class="attr">"last_update"</span>: &#123;</span><br><span class="line">						<span class="attr">"payload"</span>: &#123;</span><br><span class="line">							<span class="attr">"data"</span>: &#123;</span><br><span class="line">								<span class="attr">"config_update"</span>: &#123;</span><br><span class="line">									<span class="attr">"channel_id"</span>: <span class="string">"mychannel"</span>,</span><br><span class="line">									<span class="attr">"isolated_data"</span>: &#123;&#125;,</span><br><span class="line">									<span class="attr">"read_set"</span>: &#123;</span><br><span class="line">										<span class="attr">"groups"</span>: &#123;</span><br><span class="line">											<span class="attr">"Application"</span>: &#123;</span><br><span class="line">												<span class="attr">"groups"</span>: &#123;</span><br><span class="line">													<span class="attr">"Org1MSP"</span>: &#123;</span><br><span class="line">														<span class="attr">"groups"</span>: &#123;&#125;,</span><br><span class="line">														<span class="attr">"mod_policy"</span>: <span class="string">""</span>,</span><br><span class="line">														<span class="attr">"policies"</span>: &#123;&#125;,</span><br><span class="line">														<span class="attr">"values"</span>: &#123;&#125;,</span><br><span class="line">														<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">													&#125;,</span><br><span class="line">													<span class="attr">"Org2MSP"</span>: &#123;</span><br><span class="line">														<span class="attr">"groups"</span>: &#123;&#125;,</span><br><span class="line">														<span class="attr">"mod_policy"</span>: <span class="string">""</span>,</span><br><span class="line">														<span class="attr">"policies"</span>: &#123;&#125;,</span><br><span class="line">														<span class="attr">"values"</span>: &#123;&#125;,</span><br><span class="line">														<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">													&#125;</span><br><span class="line">												&#125;,</span><br><span class="line">												<span class="attr">"mod_policy"</span>: <span class="string">""</span>,</span><br><span class="line">												<span class="attr">"policies"</span>: &#123;&#125;,</span><br><span class="line">												<span class="attr">"values"</span>: &#123;&#125;,</span><br><span class="line">												<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">											&#125;</span><br><span class="line">										&#125;,</span><br><span class="line">										<span class="attr">"mod_policy"</span>: <span class="string">""</span>,</span><br><span class="line">										<span class="attr">"policies"</span>: &#123;&#125;,</span><br><span class="line">										<span class="attr">"values"</span>: &#123;</span><br><span class="line">											<span class="attr">"Consortium"</span>: &#123;</span><br><span class="line">												<span class="attr">"mod_policy"</span>: <span class="string">""</span>,</span><br><span class="line">												<span class="attr">"value"</span>: <span class="literal">null</span>,</span><br><span class="line">												<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">											&#125;</span><br><span class="line">										&#125;,</span><br><span class="line">										<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">									&#125;,</span><br><span class="line">									<span class="attr">"write_set"</span>: &#123;</span><br><span class="line">										<span class="attr">"groups"</span>: &#123;</span><br><span class="line">											<span class="attr">"Application"</span>: &#123;</span><br><span class="line">												<span class="attr">"groups"</span>: &#123;</span><br><span class="line">													<span class="attr">"Org1MSP"</span>: &#123;</span><br><span class="line">														<span class="attr">"groups"</span>: &#123;&#125;,</span><br><span class="line">														<span class="attr">"mod_policy"</span>: <span class="string">""</span>,</span><br><span class="line">														<span class="attr">"policies"</span>: &#123;&#125;,</span><br><span class="line">														<span class="attr">"values"</span>: &#123;&#125;,</span><br><span class="line">														<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">													&#125;,</span><br><span class="line">													<span class="attr">"Org2MSP"</span>: &#123;</span><br><span class="line">														<span class="attr">"groups"</span>: &#123;&#125;,</span><br><span class="line">														<span class="attr">"mod_policy"</span>: <span class="string">""</span>,</span><br><span class="line">														<span class="attr">"policies"</span>: &#123;&#125;,</span><br><span class="line">														<span class="attr">"values"</span>: &#123;&#125;,</span><br><span class="line">														<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">													&#125;</span><br><span class="line">												&#125;,</span><br><span class="line">												<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">												<span class="attr">"policies"</span>: &#123;</span><br><span class="line">													<span class="attr">"Admins"</span>: &#123;</span><br><span class="line">														<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">														<span class="attr">"policy"</span>: &#123;</span><br><span class="line">															<span class="attr">"type"</span>: <span class="number">3</span>,</span><br><span class="line">															<span class="attr">"value"</span>: &#123;</span><br><span class="line">																<span class="attr">"rule"</span>: <span class="string">"MAJORITY"</span>,</span><br><span class="line">																<span class="attr">"sub_policy"</span>: <span class="string">"Admins"</span></span><br><span class="line">															&#125;</span><br><span class="line">														&#125;,</span><br><span class="line">														<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">													&#125;,</span><br><span class="line">													<span class="attr">"Readers"</span>: &#123;</span><br><span class="line">														<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">														<span class="attr">"policy"</span>: &#123;</span><br><span class="line">															<span class="attr">"type"</span>: <span class="number">3</span>,</span><br><span class="line">															<span class="attr">"value"</span>: &#123;</span><br><span class="line">																<span class="attr">"rule"</span>: <span class="string">"ANY"</span>,</span><br><span class="line">																<span class="attr">"sub_policy"</span>: <span class="string">"Readers"</span></span><br><span class="line">															&#125;</span><br><span class="line">														&#125;,</span><br><span class="line">														<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">													&#125;,</span><br><span class="line">													<span class="attr">"Writers"</span>: &#123;</span><br><span class="line">														<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">														<span class="attr">"policy"</span>: &#123;</span><br><span class="line">															<span class="attr">"type"</span>: <span class="number">3</span>,</span><br><span class="line">															<span class="attr">"value"</span>: &#123;</span><br><span class="line">																<span class="attr">"rule"</span>: <span class="string">"ANY"</span>,</span><br><span class="line">																<span class="attr">"sub_policy"</span>: <span class="string">"Writers"</span></span><br><span class="line">															&#125;</span><br><span class="line">														&#125;,</span><br><span class="line">														<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">													&#125;</span><br><span class="line">												&#125;,</span><br><span class="line">												<span class="attr">"values"</span>: &#123;</span><br><span class="line">													<span class="attr">"Capabilities"</span>: &#123;</span><br><span class="line">														<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">														<span class="attr">"value"</span>: &#123;</span><br><span class="line">															<span class="attr">"capabilities"</span>: &#123;</span><br><span class="line">																<span class="attr">"V1_3"</span>: &#123;&#125;</span><br><span class="line">															&#125;</span><br><span class="line">														&#125;,</span><br><span class="line">														<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">													&#125;</span><br><span class="line">												&#125;,</span><br><span class="line">												<span class="attr">"version"</span>: <span class="string">"1"</span></span><br><span class="line">											&#125;</span><br><span class="line">										&#125;,</span><br><span class="line">										<span class="attr">"mod_policy"</span>: <span class="string">""</span>,</span><br><span class="line">										<span class="attr">"policies"</span>: &#123;&#125;,</span><br><span class="line">										<span class="attr">"values"</span>: &#123;</span><br><span class="line">											<span class="attr">"Consortium"</span>: &#123;</span><br><span class="line">												<span class="attr">"mod_policy"</span>: <span class="string">""</span>,</span><br><span class="line">												<span class="attr">"value"</span>: &#123;</span><br><span class="line">													<span class="attr">"name"</span>: <span class="string">"SampleConsortium"</span></span><br><span class="line">												&#125;,</span><br><span class="line">												<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">											&#125;</span><br><span class="line">										&#125;,</span><br><span class="line">										<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">									&#125;</span><br><span class="line">								&#125;,</span><br><span class="line">								<span class="attr">"signatures"</span>: [&#123;</span><br><span class="line">									<span class="attr">"signature"</span>: <span class="string">"MEQCIEuHMvFeH442rJZ8BURKXjseQ3MMpGO0VprPj8WdW5nOAiB1aDbHtIKo5ThxqvWCCJEdsXiKtAAbzN8DkE5VV4hUrg=="</span>,</span><br><span class="line">									<span class="attr">"signature_header"</span>: &#123;</span><br><span class="line">										<span class="attr">"creator"</span>: &#123;</span><br><span class="line">											<span class="attr">"id_bytes"</span>: <span class="string">"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNLVENDQWRDZ0F3SUJBZ0lRUEtTRHJHNWRTT0liVHRLM3pqcEhlVEFLQmdncWhrak9QUVFEQWpCek1Rc3cKQ1FZRFZRUUdFd0pWVXpFVE1CRUdBMVVFQ0JNS1EyRnNhV1p2Y201cFlURVdNQlFHQTFVRUJ4TU5VMkZ1SUVaeQpZVzVqYVhOamJ6RVpNQmNHQTFVRUNoTVFiM0puTVM1bGVHRnRjR3hsTG1OdmJURWNNQm9HQTFVRUF4TVRZMkV1CmIzSm5NUzVsZUdGdGNHeGxMbU52YlRBZUZ3MHhPVEE0TURFd01qRTBNREJhRncweU9UQTNNamt3TWpFME1EQmEKTUd3eEN6QUpCZ05WQkFZVEFsVlRNUk13RVFZRFZRUUlFd3BEWVd4cFptOXlibWxoTVJZd0ZBWURWUVFIRXcxVApZVzRnUm5KaGJtTnBjMk52TVE4d0RRWURWUVFMRXdaamJHbGxiblF4SHpBZEJnTlZCQU1NRmtGa2JXbHVRRzl5Clp6RXVaWGhoYlhCc1pTNWpiMjB3V1RBVEJnY3Foa2pPUFFJQkJnZ3Foa2pPUFFNQkJ3TkNBQVFiNEZydmg1V2oKclBSOTFIdFdSaFVORVpxQXFOL2pEYkhUbUtDSXBkY3k3K2JGTUduaUprdTExaTl2ajN6TnNQMGQrSWlSRDdiMgpJSlhVaGxZbVJjcXVvMDB3U3pBT0JnTlZIUThCQWY4RUJBTUNCNEF3REFZRFZSMFRBUUgvQkFJd0FEQXJCZ05WCkhTTUVKREFpZ0NCVUdsTldyVThlZFBPakorMkc3M2UyU1FEdjVYdFUzSWYrSTJEMmo4VWdFREFLQmdncWhrak8KUFFRREFnTkhBREJFQWlBRFB6Qk5uKytROURXd0VUS0ErRTQyNG5vekVzZjRFd2JzQWxuUCtXNU10UUlnSDc3Two3dEVJUFZacTRvVUtSb1I5QWsvUEUrWUFzYk4vdHZhVlZlZ2dLTGc9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K"</span>,</span><br><span class="line">											<span class="attr">"mspid"</span>: <span class="string">"Org1MSP"</span></span><br><span class="line">										&#125;,</span><br><span class="line">										<span class="attr">"nonce"</span>: <span class="string">"d3VBJn3yTRNFp7JKJCL/XFObhMe3pS3W"</span></span><br><span class="line">									&#125;</span><br><span class="line">								&#125;]</span><br><span class="line">							&#125;,</span><br><span class="line">							<span class="attr">"header"</span>: &#123;</span><br><span class="line">								<span class="attr">"channel_header"</span>: &#123;</span><br><span class="line">									<span class="attr">"channel_id"</span>: <span class="string">"mychannel"</span>,</span><br><span class="line">									<span class="attr">"epoch"</span>: <span class="string">"0"</span>,</span><br><span class="line">									<span class="attr">"extension"</span>: <span class="literal">null</span>,</span><br><span class="line">									<span class="attr">"timestamp"</span>: <span class="string">"2019-08-01T02:18:45Z"</span>,</span><br><span class="line">									<span class="attr">"tls_cert_hash"</span>: <span class="literal">null</span>,</span><br><span class="line">									<span class="attr">"tx_id"</span>: <span class="string">""</span>,</span><br><span class="line">									<span class="attr">"type"</span>: <span class="number">2</span>,</span><br><span class="line">									<span class="attr">"version"</span>: <span class="number">0</span></span><br><span class="line">								&#125;,</span><br><span class="line">								<span class="attr">"signature_header"</span>: &#123;</span><br><span class="line">									<span class="attr">"creator"</span>: &#123;</span><br><span class="line">										<span class="attr">"id_bytes"</span>: <span class="string">"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNLVENDQWRDZ0F3SUJBZ0lRUEtTRHJHNWRTT0liVHRLM3pqcEhlVEFLQmdncWhrak9QUVFEQWpCek1Rc3cKQ1FZRFZRUUdFd0pWVXpFVE1CRUdBMVVFQ0JNS1EyRnNhV1p2Y201cFlURVdNQlFHQTFVRUJ4TU5VMkZ1SUVaeQpZVzVqYVhOamJ6RVpNQmNHQTFVRUNoTVFiM0puTVM1bGVHRnRjR3hsTG1OdmJURWNNQm9HQTFVRUF4TVRZMkV1CmIzSm5NUzVsZUdGdGNHeGxMbU52YlRBZUZ3MHhPVEE0TURFd01qRTBNREJhRncweU9UQTNNamt3TWpFME1EQmEKTUd3eEN6QUpCZ05WQkFZVEFsVlRNUk13RVFZRFZRUUlFd3BEWVd4cFptOXlibWxoTVJZd0ZBWURWUVFIRXcxVApZVzRnUm5KaGJtTnBjMk52TVE4d0RRWURWUVFMRXdaamJHbGxiblF4SHpBZEJnTlZCQU1NRmtGa2JXbHVRRzl5Clp6RXVaWGhoYlhCc1pTNWpiMjB3V1RBVEJnY3Foa2pPUFFJQkJnZ3Foa2pPUFFNQkJ3TkNBQVFiNEZydmg1V2oKclBSOTFIdFdSaFVORVpxQXFOL2pEYkhUbUtDSXBkY3k3K2JGTUduaUprdTExaTl2ajN6TnNQMGQrSWlSRDdiMgpJSlhVaGxZbVJjcXVvMDB3U3pBT0JnTlZIUThCQWY4RUJBTUNCNEF3REFZRFZSMFRBUUgvQkFJd0FEQXJCZ05WCkhTTUVKREFpZ0NCVUdsTldyVThlZFBPakorMkc3M2UyU1FEdjVYdFUzSWYrSTJEMmo4VWdFREFLQmdncWhrak8KUFFRREFnTkhBREJFQWlBRFB6Qk5uKytROURXd0VUS0ErRTQyNG5vekVzZjRFd2JzQWxuUCtXNU10UUlnSDc3Two3dEVJUFZacTRvVUtSb1I5QWsvUEUrWUFzYk4vdHZhVlZlZ2dLTGc9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K"</span>,</span><br><span class="line">										<span class="attr">"mspid"</span>: <span class="string">"Org1MSP"</span></span><br><span class="line">									&#125;,</span><br><span class="line">									<span class="attr">"nonce"</span>: <span class="string">"tGLvhwDbf/Py2be3k/WLsZzKRPcry9po"</span></span><br><span class="line">								&#125;</span><br><span class="line">							&#125;</span><br><span class="line">						&#125;,</span><br><span class="line">						<span class="attr">"signature"</span>: <span class="string">"MEUCIQDmxLlWl9H6CdVqUbQ6OPmeZ1JnJYRYDtD18KQ1b82WkwIgNxFDuaYCdBs3ZzZxvsF2CD7pAtrbER4ZDOq3SkKie7E="</span></span><br><span class="line">					&#125;</span><br><span class="line">				&#125;,</span><br><span class="line">				<span class="attr">"header"</span>: &#123;</span><br><span class="line">					<span class="attr">"channel_header"</span>: &#123;</span><br><span class="line">						<span class="attr">"channel_id"</span>: <span class="string">"mychannel"</span>,</span><br><span class="line">						<span class="attr">"epoch"</span>: <span class="string">"0"</span>,</span><br><span class="line">						<span class="attr">"extension"</span>: <span class="literal">null</span>,</span><br><span class="line">						<span class="attr">"timestamp"</span>: <span class="string">"2019-08-01T02:18:45Z"</span>,</span><br><span class="line">						<span class="attr">"tls_cert_hash"</span>: <span class="literal">null</span>,</span><br><span class="line">						<span class="attr">"tx_id"</span>: <span class="string">""</span>,</span><br><span class="line">						<span class="attr">"type"</span>: <span class="number">1</span>,</span><br><span class="line">						<span class="attr">"version"</span>: <span class="number">0</span></span><br><span class="line">					&#125;,</span><br><span class="line">					<span class="attr">"signature_header"</span>: &#123;</span><br><span class="line">						<span class="attr">"creator"</span>: &#123;</span><br><span class="line">							<span class="attr">"id_bytes"</span>: <span class="string">"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNEVENDQWJPZ0F3SUJBZ0lSQU0rUFQ2YTJsYm1EY0NpNEVhTEFSeFl3Q2dZSUtvWkl6ajBFQXdJd2FURUwKTUFrR0ExVUVCaE1DVlZNeEV6QVJCZ05WQkFnVENrTmhiR2xtYjNKdWFXRXhGakFVQmdOVkJBY1REVk5oYmlCRwpjbUZ1WTJselkyOHhGREFTQmdOVkJBb1RDMlY0WVcxd2JHVXVZMjl0TVJjd0ZRWURWUVFERXc1allTNWxlR0Z0CmNHeGxMbU52YlRBZUZ3MHhPVEE0TURFd01qRTBNREJhRncweU9UQTNNamt3TWpFME1EQmFNRmd4Q3pBSkJnTlYKQkFZVEFsVlRNUk13RVFZRFZRUUlFd3BEWVd4cFptOXlibWxoTVJZd0ZBWURWUVFIRXcxVFlXNGdSbkpoYm1OcApjMk52TVJ3d0dnWURWUVFERXhOdmNtUmxjbVZ5TG1WNFlXMXdiR1V1WTI5dE1Ga3dFd1lIS29aSXpqMENBUVlJCktvWkl6ajBEQVFjRFFnQUVZVGcwdXZJMVZ0dEsrb2o2MG9LRjRtWlc4YlFXN0FIRFpZcFZueEdoTE5Kems2cmwKTU1uS0RiRmxibElETE9qK0tiakVwOW9WdEN6OVBsbk4xTmhHSEtOTk1Fc3dEZ1lEVlIwUEFRSC9CQVFEQWdlQQpNQXdHQTFVZEV3RUIvd1FDTUFBd0t3WURWUjBqQkNRd0lvQWdRSWtEMTlLWDFQc3VWUi9BQmVuZFM2ejY5cGxDCmNVNmc0aXUrdHFRL1hzQXdDZ1lJS29aSXpqMEVBd0lEU0FBd1JRSWhBTnd0cDQzMUdkYkdqb3pXRU1DQWdwNWIKeFdnMHNRMVlGbG9TYzF1MFFRU3FBaUF1TVNkc1AvMXZoclhVcGtoT1Voa3NwRjYrYVl1V2ozazZaVE84RWV3agpqdz09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K"</span>,</span><br><span class="line">							<span class="attr">"mspid"</span>: <span class="string">"OrdererMSP"</span></span><br><span class="line">						&#125;,</span><br><span class="line">						<span class="attr">"nonce"</span>: <span class="string">"xfIU/l1eFdFbtagz4fuZaJzuPW/hroRx"</span></span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="attr">"signature"</span>: <span class="string">"MEUCIQDm/oh3UE8/ZQu0Cad7rJw/FaUsCu4SsXZfxY3VSaMsCQIgbEsRitpgRb9vy80u9C7z103nj1/kQtka1LRiGSLy/6I="</span></span><br><span class="line">		&#125;]</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">"header"</span>: &#123;</span><br><span class="line">		<span class="attr">"data_hash"</span>: <span class="string">"tJk5enGTIZYB/+XlYPbOwpjRH9341YajXd5YaWv86/k="</span>,</span><br><span class="line">		<span class="attr">"number"</span>: <span class="string">"0"</span>,</span><br><span class="line">		<span class="attr">"previous_hash"</span>: <span class="literal">null</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">"metadata"</span>: &#123;</span><br><span class="line">		<span class="attr">"metadata"</span>: [</span><br><span class="line">			<span class="string">""</span>,</span><br><span class="line">			<span class="string">""</span>,</span><br><span class="line">			<span class="string">"AA=="</span>,</span><br><span class="line">			<span class="string">""</span></span><br><span class="line">		]</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="应用通道配置块"><a href="#应用通道配置块" class="headerlink" title="应用通道配置块"></a>应用通道配置块</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"data"</span>: &#123;</span><br><span class="line">		<span class="attr">"data"</span>: [&#123;</span><br><span class="line">			<span class="attr">"payload"</span>: &#123;</span><br><span class="line">				<span class="attr">"data"</span>: &#123;</span><br><span class="line">					<span class="attr">"config"</span>: &#123;</span><br><span class="line">						<span class="attr">"channel_group"</span>: &#123;</span><br><span class="line">							<span class="attr">"groups"</span>: &#123;</span><br><span class="line">								<span class="attr">"Application"</span>: &#123;</span><br><span class="line">									<span class="attr">"groups"</span>: &#123;</span><br><span class="line">										<span class="attr">"Org1MSP"</span>: &#123;</span><br><span class="line">											<span class="attr">"groups"</span>: &#123;&#125;,</span><br><span class="line">											<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">											<span class="attr">"policies"</span>: &#123;</span><br><span class="line">												<span class="attr">"Admins"</span>: &#123;</span><br><span class="line">													<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">													<span class="attr">"policy"</span>: &#123;</span><br><span class="line">														<span class="attr">"type"</span>: <span class="number">1</span>,</span><br><span class="line">														<span class="attr">"value"</span>: &#123;</span><br><span class="line">															<span class="attr">"identities"</span>: [&#123;</span><br><span class="line">																<span class="attr">"principal"</span>: &#123;</span><br><span class="line">																	<span class="attr">"msp_identifier"</span>: <span class="string">"Org1MSP"</span>,</span><br><span class="line">																	<span class="attr">"role"</span>: <span class="string">"ADMIN"</span></span><br><span class="line">																&#125;,</span><br><span class="line">																<span class="attr">"principal_classification"</span>: <span class="string">"ROLE"</span></span><br><span class="line">															&#125;],</span><br><span class="line">															<span class="attr">"rule"</span>: &#123;</span><br><span class="line">																<span class="attr">"n_out_of"</span>: &#123;</span><br><span class="line">																	<span class="attr">"n"</span>: <span class="number">1</span>,</span><br><span class="line">																	<span class="attr">"rules"</span>: [&#123;</span><br><span class="line">																		<span class="attr">"signed_by"</span>: <span class="number">0</span></span><br><span class="line">																	&#125;]</span><br><span class="line">																&#125;</span><br><span class="line">															&#125;,</span><br><span class="line">															<span class="attr">"version"</span>: <span class="number">0</span></span><br><span class="line">														&#125;</span><br><span class="line">													&#125;,</span><br><span class="line">													<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">												&#125;,</span><br><span class="line">												<span class="attr">"Readers"</span>: &#123;</span><br><span class="line">													<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">													<span class="attr">"policy"</span>: &#123;</span><br><span class="line">														<span class="attr">"type"</span>: <span class="number">1</span>,</span><br><span class="line">														<span class="attr">"value"</span>: &#123;</span><br><span class="line">															<span class="attr">"identities"</span>: [&#123;</span><br><span class="line">																	<span class="attr">"principal"</span>: &#123;</span><br><span class="line">																		<span class="attr">"msp_identifier"</span>: <span class="string">"Org1MSP"</span>,</span><br><span class="line">																		<span class="attr">"role"</span>: <span class="string">"ADMIN"</span></span><br><span class="line">																	&#125;,</span><br><span class="line">																	<span class="attr">"principal_classification"</span>: <span class="string">"ROLE"</span></span><br><span class="line">																&#125;,</span><br><span class="line">																&#123;</span><br><span class="line">																	<span class="attr">"principal"</span>: &#123;</span><br><span class="line">																		<span class="attr">"msp_identifier"</span>: <span class="string">"Org1MSP"</span>,</span><br><span class="line">																		<span class="attr">"role"</span>: <span class="string">"PEER"</span></span><br><span class="line">																	&#125;,</span><br><span class="line">																	<span class="attr">"principal_classification"</span>: <span class="string">"ROLE"</span></span><br><span class="line">																&#125;,</span><br><span class="line">																&#123;</span><br><span class="line">																	<span class="attr">"principal"</span>: &#123;</span><br><span class="line">																		<span class="attr">"msp_identifier"</span>: <span class="string">"Org1MSP"</span>,</span><br><span class="line">																		<span class="attr">"role"</span>: <span class="string">"CLIENT"</span></span><br><span class="line">																	&#125;,</span><br><span class="line">																	<span class="attr">"principal_classification"</span>: <span class="string">"ROLE"</span></span><br><span class="line">																&#125;</span><br><span class="line">															],</span><br><span class="line">															<span class="attr">"rule"</span>: &#123;</span><br><span class="line">																<span class="attr">"n_out_of"</span>: &#123;</span><br><span class="line">																	<span class="attr">"n"</span>: <span class="number">1</span>,</span><br><span class="line">																	<span class="attr">"rules"</span>: [&#123;</span><br><span class="line">																			<span class="attr">"signed_by"</span>: <span class="number">0</span></span><br><span class="line">																		&#125;,</span><br><span class="line">																		&#123;</span><br><span class="line">																			<span class="attr">"signed_by"</span>: <span class="number">1</span></span><br><span class="line">																		&#125;,</span><br><span class="line">																		&#123;</span><br><span class="line">																			<span class="attr">"signed_by"</span>: <span class="number">2</span></span><br><span class="line">																		&#125;</span><br><span class="line">																	]</span><br><span class="line">																&#125;</span><br><span class="line">															&#125;,</span><br><span class="line">															<span class="attr">"version"</span>: <span class="number">0</span></span><br><span class="line">														&#125;</span><br><span class="line">													&#125;,</span><br><span class="line">													<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">												&#125;,</span><br><span class="line">												<span class="attr">"Writers"</span>: &#123;</span><br><span class="line">													<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">													<span class="attr">"policy"</span>: &#123;</span><br><span class="line">														<span class="attr">"type"</span>: <span class="number">1</span>,</span><br><span class="line">														<span class="attr">"value"</span>: &#123;</span><br><span class="line">															<span class="attr">"identities"</span>: [&#123;</span><br><span class="line">																	<span class="attr">"principal"</span>: &#123;</span><br><span class="line">																		<span class="attr">"msp_identifier"</span>: <span class="string">"Org1MSP"</span>,</span><br><span class="line">																		<span class="attr">"role"</span>: <span class="string">"ADMIN"</span></span><br><span class="line">																	&#125;,</span><br><span class="line">																	<span class="attr">"principal_classification"</span>: <span class="string">"ROLE"</span></span><br><span class="line">																&#125;,</span><br><span class="line">																&#123;</span><br><span class="line">																	<span class="attr">"principal"</span>: &#123;</span><br><span class="line">																		<span class="attr">"msp_identifier"</span>: <span class="string">"Org1MSP"</span>,</span><br><span class="line">																		<span class="attr">"role"</span>: <span class="string">"CLIENT"</span></span><br><span class="line">																	&#125;,</span><br><span class="line">																	<span class="attr">"principal_classification"</span>: <span class="string">"ROLE"</span></span><br><span class="line">																&#125;</span><br><span class="line">															],</span><br><span class="line">															<span class="attr">"rule"</span>: &#123;</span><br><span class="line">																<span class="attr">"n_out_of"</span>: &#123;</span><br><span class="line">																	<span class="attr">"n"</span>: <span class="number">1</span>,</span><br><span class="line">																	<span class="attr">"rules"</span>: [&#123;</span><br><span class="line">																			<span class="attr">"signed_by"</span>: <span class="number">0</span></span><br><span class="line">																		&#125;,</span><br><span class="line">																		&#123;</span><br><span class="line">																			<span class="attr">"signed_by"</span>: <span class="number">1</span></span><br><span class="line">																		&#125;</span><br><span class="line">																	]</span><br><span class="line">																&#125;</span><br><span class="line">															&#125;,</span><br><span class="line">															<span class="attr">"version"</span>: <span class="number">0</span></span><br><span class="line">														&#125;</span><br><span class="line">													&#125;,</span><br><span class="line">													<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">												&#125;</span><br><span class="line">											&#125;,</span><br><span class="line">											<span class="attr">"values"</span>: &#123;</span><br><span class="line">												<span class="attr">"AnchorPeers"</span>: &#123;</span><br><span class="line">													<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">													<span class="attr">"value"</span>: &#123;</span><br><span class="line">														<span class="attr">"anchor_peers"</span>: [&#123;</span><br><span class="line">															<span class="attr">"host"</span>: <span class="string">"peer0.org1.example.com"</span>,</span><br><span class="line">															<span class="attr">"port"</span>: <span class="number">7051</span></span><br><span class="line">														&#125;]</span><br><span class="line">													&#125;,</span><br><span class="line">													<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">												&#125;,</span><br><span class="line">												<span class="attr">"MSP"</span>: &#123;</span><br><span class="line">													<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">													<span class="attr">"value"</span>: &#123;</span><br><span class="line">														<span class="attr">"config"</span>: &#123;</span><br><span class="line">															<span class="attr">"admins"</span>: [</span><br><span class="line">																<span class="string">"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNLVENDQWRDZ0F3SUJBZ0lRUEtTRHJHNWRTT0liVHRLM3pqcEhlVEFLQmdncWhrak9QUVFEQWpCek1Rc3cKQ1FZRFZRUUdFd0pWVXpFVE1CRUdBMVVFQ0JNS1EyRnNhV1p2Y201cFlURVdNQlFHQTFVRUJ4TU5VMkZ1SUVaeQpZVzVqYVhOamJ6RVpNQmNHQTFVRUNoTVFiM0puTVM1bGVHRnRjR3hsTG1OdmJURWNNQm9HQTFVRUF4TVRZMkV1CmIzSm5NUzVsZUdGdGNHeGxMbU52YlRBZUZ3MHhPVEE0TURFd01qRTBNREJhRncweU9UQTNNamt3TWpFME1EQmEKTUd3eEN6QUpCZ05WQkFZVEFsVlRNUk13RVFZRFZRUUlFd3BEWVd4cFptOXlibWxoTVJZd0ZBWURWUVFIRXcxVApZVzRnUm5KaGJtTnBjMk52TVE4d0RRWURWUVFMRXdaamJHbGxiblF4SHpBZEJnTlZCQU1NRmtGa2JXbHVRRzl5Clp6RXVaWGhoYlhCc1pTNWpiMjB3V1RBVEJnY3Foa2pPUFFJQkJnZ3Foa2pPUFFNQkJ3TkNBQVFiNEZydmg1V2oKclBSOTFIdFdSaFVORVpxQXFOL2pEYkhUbUtDSXBkY3k3K2JGTUduaUprdTExaTl2ajN6TnNQMGQrSWlSRDdiMgpJSlhVaGxZbVJjcXVvMDB3U3pBT0JnTlZIUThCQWY4RUJBTUNCNEF3REFZRFZSMFRBUUgvQkFJd0FEQXJCZ05WCkhTTUVKREFpZ0NCVUdsTldyVThlZFBPakorMkc3M2UyU1FEdjVYdFUzSWYrSTJEMmo4VWdFREFLQmdncWhrak8KUFFRREFnTkhBREJFQWlBRFB6Qk5uKytROURXd0VUS0ErRTQyNG5vekVzZjRFd2JzQWxuUCtXNU10UUlnSDc3Two3dEVJUFZacTRvVUtSb1I5QWsvUEUrWUFzYk4vdHZhVlZlZ2dLTGc9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K"</span></span><br><span class="line">															],</span><br><span class="line">															<span class="attr">"crypto_config"</span>: &#123;</span><br><span class="line">																<span class="attr">"identity_identifier_hash_function"</span>: <span class="string">"SHA256"</span>,</span><br><span class="line">																<span class="attr">"signature_hash_family"</span>: <span class="string">"SHA2"</span></span><br><span class="line">															&#125;,</span><br><span class="line">															<span class="attr">"fabric_node_ous"</span>: &#123;</span><br><span class="line">																<span class="attr">"client_ou_identifier"</span>: &#123;</span><br><span class="line">																	<span class="attr">"certificate"</span>: <span class="string">"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNVRENDQWZlZ0F3SUJBZ0lRSnJqamM3b1RSLy8zSG9wcDFYY0Y4VEFLQmdncWhrak9QUVFEQWpCek1Rc3cKQ1FZRFZRUUdFd0pWVXpFVE1CRUdBMVVFQ0JNS1EyRnNhV1p2Y201cFlURVdNQlFHQTFVRUJ4TU5VMkZ1SUVaeQpZVzVqYVhOamJ6RVpNQmNHQTFVRUNoTVFiM0puTVM1bGVHRnRjR3hsTG1OdmJURWNNQm9HQTFVRUF4TVRZMkV1CmIzSm5NUzVsZUdGdGNHeGxMbU52YlRBZUZ3MHhPVEE0TURFd01qRTBNREJhRncweU9UQTNNamt3TWpFME1EQmEKTUhNeEN6QUpCZ05WQkFZVEFsVlRNUk13RVFZRFZRUUlFd3BEWVd4cFptOXlibWxoTVJZd0ZBWURWUVFIRXcxVApZVzRnUm5KaGJtTnBjMk52TVJrd0Z3WURWUVFLRXhCdmNtY3hMbVY0WVcxd2JHVXVZMjl0TVJ3d0dnWURWUVFECkV4TmpZUzV2Y21jeExtVjRZVzF3YkdVdVkyOXRNRmt3RXdZSEtvWkl6ajBDQVFZSUtvWkl6ajBEQVFjRFFnQUUKSmNFQkUvUlF1Ty9JR2h0QWJjSnhnTEhyMHNEbENFS0dpQnA3NXlRYytjdUFQK21NWDI4TGtWTERJaGhELzV5MgpiMTJUM1o4Z1Y1N2tMOHdrUTM1SXpxTnRNR3N3RGdZRFZSMFBBUUgvQkFRREFnR21NQjBHQTFVZEpRUVdNQlFHCkNDc0dBUVVGQndNQ0JnZ3JCZ0VGQlFjREFUQVBCZ05WSFJNQkFmOEVCVEFEQVFIL01Da0dBMVVkRGdRaUJDQlUKR2xOV3JVOGVkUE9qSisyRzczZTJTUUR2NVh0VTNJZitJMkQyajhVZ0VEQUtCZ2dxaGtqT1BRUURBZ05IQURCRQpBaUF3YzVYMVZLVGZQM0ZqL0o1Tk9wVHlNU08vU2MzcnFhbmxOelRUbk5VRmZnSWdNZi9HVWpjcjhra1V2Y2hBCjlzM0NIc1VYZ1loTWNPaHVxWFJmZHdTRC9XRT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo="</span>,</span><br><span class="line">																	<span class="attr">"organizational_unit_identifier"</span>: <span class="string">"client"</span></span><br><span class="line">																&#125;,</span><br><span class="line">																<span class="attr">"enable"</span>: <span class="literal">true</span>,</span><br><span class="line">																<span class="attr">"peer_ou_identifier"</span>: &#123;</span><br><span class="line">																	<span class="attr">"certificate"</span>: <span class="string">"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNVRENDQWZlZ0F3SUJBZ0lRSnJqamM3b1RSLy8zSG9wcDFYY0Y4VEFLQmdncWhrak9QUVFEQWpCek1Rc3cKQ1FZRFZRUUdFd0pWVXpFVE1CRUdBMVVFQ0JNS1EyRnNhV1p2Y201cFlURVdNQlFHQTFVRUJ4TU5VMkZ1SUVaeQpZVzVqYVhOamJ6RVpNQmNHQTFVRUNoTVFiM0puTVM1bGVHRnRjR3hsTG1OdmJURWNNQm9HQTFVRUF4TVRZMkV1CmIzSm5NUzVsZUdGdGNHeGxMbU52YlRBZUZ3MHhPVEE0TURFd01qRTBNREJhRncweU9UQTNNamt3TWpFME1EQmEKTUhNeEN6QUpCZ05WQkFZVEFsVlRNUk13RVFZRFZRUUlFd3BEWVd4cFptOXlibWxoTVJZd0ZBWURWUVFIRXcxVApZVzRnUm5KaGJtTnBjMk52TVJrd0Z3WURWUVFLRXhCdmNtY3hMbVY0WVcxd2JHVXVZMjl0TVJ3d0dnWURWUVFECkV4TmpZUzV2Y21jeExtVjRZVzF3YkdVdVkyOXRNRmt3RXdZSEtvWkl6ajBDQVFZSUtvWkl6ajBEQVFjRFFnQUUKSmNFQkUvUlF1Ty9JR2h0QWJjSnhnTEhyMHNEbENFS0dpQnA3NXlRYytjdUFQK21NWDI4TGtWTERJaGhELzV5MgpiMTJUM1o4Z1Y1N2tMOHdrUTM1SXpxTnRNR3N3RGdZRFZSMFBBUUgvQkFRREFnR21NQjBHQTFVZEpRUVdNQlFHCkNDc0dBUVVGQndNQ0JnZ3JCZ0VGQlFjREFUQVBCZ05WSFJNQkFmOEVCVEFEQVFIL01Da0dBMVVkRGdRaUJDQlUKR2xOV3JVOGVkUE9qSisyRzczZTJTUUR2NVh0VTNJZitJMkQyajhVZ0VEQUtCZ2dxaGtqT1BRUURBZ05IQURCRQpBaUF3YzVYMVZLVGZQM0ZqL0o1Tk9wVHlNU08vU2MzcnFhbmxOelRUbk5VRmZnSWdNZi9HVWpjcjhra1V2Y2hBCjlzM0NIc1VYZ1loTWNPaHVxWFJmZHdTRC9XRT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo="</span>,</span><br><span class="line">																	<span class="attr">"organizational_unit_identifier"</span>: <span class="string">"peer"</span></span><br><span class="line">																&#125;</span><br><span class="line">															&#125;,</span><br><span class="line">															<span class="attr">"intermediate_certs"</span>: [],</span><br><span class="line">															<span class="attr">"name"</span>: <span class="string">"Org1MSP"</span>,</span><br><span class="line">															<span class="attr">"organizational_unit_identifiers"</span>: [],</span><br><span class="line">															<span class="attr">"revocation_list"</span>: [],</span><br><span class="line">															<span class="attr">"root_certs"</span>: [</span><br><span class="line">																<span class="string">"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNVRENDQWZlZ0F3SUJBZ0lRSnJqamM3b1RSLy8zSG9wcDFYY0Y4VEFLQmdncWhrak9QUVFEQWpCek1Rc3cKQ1FZRFZRUUdFd0pWVXpFVE1CRUdBMVVFQ0JNS1EyRnNhV1p2Y201cFlURVdNQlFHQTFVRUJ4TU5VMkZ1SUVaeQpZVzVqYVhOamJ6RVpNQmNHQTFVRUNoTVFiM0puTVM1bGVHRnRjR3hsTG1OdmJURWNNQm9HQTFVRUF4TVRZMkV1CmIzSm5NUzVsZUdGdGNHeGxMbU52YlRBZUZ3MHhPVEE0TURFd01qRTBNREJhRncweU9UQTNNamt3TWpFME1EQmEKTUhNeEN6QUpCZ05WQkFZVEFsVlRNUk13RVFZRFZRUUlFd3BEWVd4cFptOXlibWxoTVJZd0ZBWURWUVFIRXcxVApZVzRnUm5KaGJtTnBjMk52TVJrd0Z3WURWUVFLRXhCdmNtY3hMbVY0WVcxd2JHVXVZMjl0TVJ3d0dnWURWUVFECkV4TmpZUzV2Y21jeExtVjRZVzF3YkdVdVkyOXRNRmt3RXdZSEtvWkl6ajBDQVFZSUtvWkl6ajBEQVFjRFFnQUUKSmNFQkUvUlF1Ty9JR2h0QWJjSnhnTEhyMHNEbENFS0dpQnA3NXlRYytjdUFQK21NWDI4TGtWTERJaGhELzV5MgpiMTJUM1o4Z1Y1N2tMOHdrUTM1SXpxTnRNR3N3RGdZRFZSMFBBUUgvQkFRREFnR21NQjBHQTFVZEpRUVdNQlFHCkNDc0dBUVVGQndNQ0JnZ3JCZ0VGQlFjREFUQVBCZ05WSFJNQkFmOEVCVEFEQVFIL01Da0dBMVVkRGdRaUJDQlUKR2xOV3JVOGVkUE9qSisyRzczZTJTUUR2NVh0VTNJZitJMkQyajhVZ0VEQUtCZ2dxaGtqT1BRUURBZ05IQURCRQpBaUF3YzVYMVZLVGZQM0ZqL0o1Tk9wVHlNU08vU2MzcnFhbmxOelRUbk5VRmZnSWdNZi9HVWpjcjhra1V2Y2hBCjlzM0NIc1VYZ1loTWNPaHVxWFJmZHdTRC9XRT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo="</span></span><br><span class="line">															],</span><br><span class="line">															<span class="attr">"signing_identity"</span>: <span class="literal">null</span>,</span><br><span class="line">															<span class="attr">"tls_intermediate_certs"</span>: [],</span><br><span class="line">															<span class="attr">"tls_root_certs"</span>: [</span><br><span class="line">																<span class="string">"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNWakNDQWYyZ0F3SUJBZ0lRQldDNzUzQUphWXVOSkhqeVpGb1JvVEFLQmdncWhrak9QUVFEQWpCMk1Rc3cKQ1FZRFZRUUdFd0pWVXpFVE1CRUdBMVVFQ0JNS1EyRnNhV1p2Y201cFlURVdNQlFHQTFVRUJ4TU5VMkZ1SUVaeQpZVzVqYVhOamJ6RVpNQmNHQTFVRUNoTVFiM0puTVM1bGVHRnRjR3hsTG1OdmJURWZNQjBHQTFVRUF4TVdkR3h6ClkyRXViM0puTVM1bGVHRnRjR3hsTG1OdmJUQWVGdzB4T1RBNE1ERXdNakUwTURCYUZ3MHlPVEEzTWprd01qRTAKTURCYU1IWXhDekFKQmdOVkJBWVRBbFZUTVJNd0VRWURWUVFJRXdwRFlXeHBabTl5Ym1saE1SWXdGQVlEVlFRSApFdzFUWVc0Z1JuSmhibU5wYzJOdk1Sa3dGd1lEVlFRS0V4QnZjbWN4TG1WNFlXMXdiR1V1WTI5dE1SOHdIUVlEClZRUURFeFowYkhOallTNXZjbWN4TG1WNFlXMXdiR1V1WTI5dE1Ga3dFd1lIS29aSXpqMENBUVlJS29aSXpqMEQKQVFjRFFnQUVJcWRZYWtLRmtKRm1NZEhDRnVGdkJIVXZMMFhUa0RJTG40Qm5vdW5GWUFaWmRFNFdpQ1lkcnJsSwpjTmpQWG1pNXZEajcrQmhoWXBaQjRnbHZRbUpDb2FOdE1Hc3dEZ1lEVlIwUEFRSC9CQVFEQWdHbU1CMEdBMVVkCkpRUVdNQlFHQ0NzR0FRVUZCd01DQmdnckJnRUZCUWNEQVRBUEJnTlZIUk1CQWY4RUJUQURBUUgvTUNrR0ExVWQKRGdRaUJDQ0JzMVk5ZjhzTjFBYndZdnFzcEdLRzBIenhTQ2RyWEdHdUVvc2dGb3BQcVRBS0JnZ3Foa2pPUFFRRApBZ05IQURCRUFpQnF5VzBOL0xhMTRlTVh4SXIzNWVQbXVXdXpQQnJrd1h4RG9pd1RtdXJzZ1FJZ0JRRkZJdVl5CmRSVk4zOHdZSU5vUU16eW5Uek93NFNBMXpRdUs3QzViZGk0PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg=="</span></span><br><span class="line">															]</span><br><span class="line">														&#125;,</span><br><span class="line">														<span class="attr">"type"</span>: <span class="number">0</span></span><br><span class="line">													&#125;,</span><br><span class="line">													<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">												&#125;</span><br><span class="line">											&#125;,</span><br><span class="line">											<span class="attr">"version"</span>: <span class="string">"1"</span></span><br><span class="line">										&#125;,</span><br><span class="line">										<span class="attr">"Org2MSP"</span>: &#123;</span><br><span class="line">											<span class="attr">"groups"</span>: &#123;&#125;,</span><br><span class="line">											<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">											<span class="attr">"policies"</span>: &#123;</span><br><span class="line">												<span class="attr">"Admins"</span>: &#123;</span><br><span class="line">													<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">													<span class="attr">"policy"</span>: &#123;</span><br><span class="line">														<span class="attr">"type"</span>: <span class="number">1</span>,</span><br><span class="line">														<span class="attr">"value"</span>: &#123;</span><br><span class="line">															<span class="attr">"identities"</span>: [&#123;</span><br><span class="line">																<span class="attr">"principal"</span>: &#123;</span><br><span class="line">																	<span class="attr">"msp_identifier"</span>: <span class="string">"Org2MSP"</span>,</span><br><span class="line">																	<span class="attr">"role"</span>: <span class="string">"ADMIN"</span></span><br><span class="line">																&#125;,</span><br><span class="line">																<span class="attr">"principal_classification"</span>: <span class="string">"ROLE"</span></span><br><span class="line">															&#125;],</span><br><span class="line">															<span class="attr">"rule"</span>: &#123;</span><br><span class="line">																<span class="attr">"n_out_of"</span>: &#123;</span><br><span class="line">																	<span class="attr">"n"</span>: <span class="number">1</span>,</span><br><span class="line">																	<span class="attr">"rules"</span>: [&#123;</span><br><span class="line">																		<span class="attr">"signed_by"</span>: <span class="number">0</span></span><br><span class="line">																	&#125;]</span><br><span class="line">																&#125;</span><br><span class="line">															&#125;,</span><br><span class="line">															<span class="attr">"version"</span>: <span class="number">0</span></span><br><span class="line">														&#125;</span><br><span class="line">													&#125;,</span><br><span class="line">													<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">												&#125;,</span><br><span class="line">												<span class="attr">"Readers"</span>: &#123;</span><br><span class="line">													<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">													<span class="attr">"policy"</span>: &#123;</span><br><span class="line">														<span class="attr">"type"</span>: <span class="number">1</span>,</span><br><span class="line">														<span class="attr">"value"</span>: &#123;</span><br><span class="line">															<span class="attr">"identities"</span>: [&#123;</span><br><span class="line">																	<span class="attr">"principal"</span>: &#123;</span><br><span class="line">																		<span class="attr">"msp_identifier"</span>: <span class="string">"Org2MSP"</span>,</span><br><span class="line">																		<span class="attr">"role"</span>: <span class="string">"ADMIN"</span></span><br><span class="line">																	&#125;,</span><br><span class="line">																	<span class="attr">"principal_classification"</span>: <span class="string">"ROLE"</span></span><br><span class="line">																&#125;,</span><br><span class="line">																&#123;</span><br><span class="line">																	<span class="attr">"principal"</span>: &#123;</span><br><span class="line">																		<span class="attr">"msp_identifier"</span>: <span class="string">"Org2MSP"</span>,</span><br><span class="line">																		<span class="attr">"role"</span>: <span class="string">"PEER"</span></span><br><span class="line">																	&#125;,</span><br><span class="line">																	<span class="attr">"principal_classification"</span>: <span class="string">"ROLE"</span></span><br><span class="line">																&#125;,</span><br><span class="line">																&#123;</span><br><span class="line">																	<span class="attr">"principal"</span>: &#123;</span><br><span class="line">																		<span class="attr">"msp_identifier"</span>: <span class="string">"Org2MSP"</span>,</span><br><span class="line">																		<span class="attr">"role"</span>: <span class="string">"CLIENT"</span></span><br><span class="line">																	&#125;,</span><br><span class="line">																	<span class="attr">"principal_classification"</span>: <span class="string">"ROLE"</span></span><br><span class="line">																&#125;</span><br><span class="line">															],</span><br><span class="line">															<span class="attr">"rule"</span>: &#123;</span><br><span class="line">																<span class="attr">"n_out_of"</span>: &#123;</span><br><span class="line">																	<span class="attr">"n"</span>: <span class="number">1</span>,</span><br><span class="line">																	<span class="attr">"rules"</span>: [&#123;</span><br><span class="line">																			<span class="attr">"signed_by"</span>: <span class="number">0</span></span><br><span class="line">																		&#125;,</span><br><span class="line">																		&#123;</span><br><span class="line">																			<span class="attr">"signed_by"</span>: <span class="number">1</span></span><br><span class="line">																		&#125;,</span><br><span class="line">																		&#123;</span><br><span class="line">																			<span class="attr">"signed_by"</span>: <span class="number">2</span></span><br><span class="line">																		&#125;</span><br><span class="line">																	]</span><br><span class="line">																&#125;</span><br><span class="line">															&#125;,</span><br><span class="line">															<span class="attr">"version"</span>: <span class="number">0</span></span><br><span class="line">														&#125;</span><br><span class="line">													&#125;,</span><br><span class="line">													<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">												&#125;,</span><br><span class="line">												<span class="attr">"Writers"</span>: &#123;</span><br><span class="line">													<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">													<span class="attr">"policy"</span>: &#123;</span><br><span class="line">														<span class="attr">"type"</span>: <span class="number">1</span>,</span><br><span class="line">														<span class="attr">"value"</span>: &#123;</span><br><span class="line">															<span class="attr">"identities"</span>: [&#123;</span><br><span class="line">																	<span class="attr">"principal"</span>: &#123;</span><br><span class="line">																		<span class="attr">"msp_identifier"</span>: <span class="string">"Org2MSP"</span>,</span><br><span class="line">																		<span class="attr">"role"</span>: <span class="string">"ADMIN"</span></span><br><span class="line">																	&#125;,</span><br><span class="line">																	<span class="attr">"principal_classification"</span>: <span class="string">"ROLE"</span></span><br><span class="line">																&#125;,</span><br><span class="line">																&#123;</span><br><span class="line">																	<span class="attr">"principal"</span>: &#123;</span><br><span class="line">																		<span class="attr">"msp_identifier"</span>: <span class="string">"Org2MSP"</span>,</span><br><span class="line">																		<span class="attr">"role"</span>: <span class="string">"CLIENT"</span></span><br><span class="line">																	&#125;,</span><br><span class="line">																	<span class="attr">"principal_classification"</span>: <span class="string">"ROLE"</span></span><br><span class="line">																&#125;</span><br><span class="line">															],</span><br><span class="line">															<span class="attr">"rule"</span>: &#123;</span><br><span class="line">																<span class="attr">"n_out_of"</span>: &#123;</span><br><span class="line">																	<span class="attr">"n"</span>: <span class="number">1</span>,</span><br><span class="line">																	<span class="attr">"rules"</span>: [&#123;</span><br><span class="line">																			<span class="attr">"signed_by"</span>: <span class="number">0</span></span><br><span class="line">																		&#125;,</span><br><span class="line">																		&#123;</span><br><span class="line">																			<span class="attr">"signed_by"</span>: <span class="number">1</span></span><br><span class="line">																		&#125;</span><br><span class="line">																	]</span><br><span class="line">																&#125;</span><br><span class="line">															&#125;,</span><br><span class="line">															<span class="attr">"version"</span>: <span class="number">0</span></span><br><span class="line">														&#125;</span><br><span class="line">													&#125;,</span><br><span class="line">													<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">												&#125;</span><br><span class="line">											&#125;,</span><br><span class="line">											<span class="attr">"values"</span>: &#123;</span><br><span class="line">												<span class="attr">"AnchorPeers"</span>: &#123;</span><br><span class="line">													<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">													<span class="attr">"value"</span>: &#123;</span><br><span class="line">														<span class="attr">"anchor_peers"</span>: [&#123;</span><br><span class="line">															<span class="attr">"host"</span>: <span class="string">"peer0.org2.example.com"</span>,</span><br><span class="line">															<span class="attr">"port"</span>: <span class="number">9051</span></span><br><span class="line">														&#125;]</span><br><span class="line">													&#125;,</span><br><span class="line">													<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">												&#125;,</span><br><span class="line">												<span class="attr">"MSP"</span>: &#123;</span><br><span class="line">													<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">													<span class="attr">"value"</span>: &#123;</span><br><span class="line">														<span class="attr">"config"</span>: &#123;</span><br><span class="line">															<span class="attr">"admins"</span>: [</span><br><span class="line">																<span class="string">"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNLekNDQWRHZ0F3SUJBZ0lSQUo5YnI3UHJmQWg5cHVVcDFMZkJ3V0V3Q2dZSUtvWkl6ajBFQXdJd2N6RUwKTUFrR0ExVUVCaE1DVlZNeEV6QVJCZ05WQkFnVENrTmhiR2xtYjNKdWFXRXhGakFVQmdOVkJBY1REVk5oYmlCRwpjbUZ1WTJselkyOHhHVEFYQmdOVkJBb1RFRzl5WnpJdVpYaGhiWEJzWlM1amIyMHhIREFhQmdOVkJBTVRFMk5oCkxtOXlaekl1WlhoaGJYQnNaUzVqYjIwd0hoY05NVGt3T0RBeE1ESXhOREF3V2hjTk1qa3dOekk1TURJeE5EQXcKV2pCc01Rc3dDUVlEVlFRR0V3SlZVekVUTUJFR0ExVUVDQk1LUTJGc2FXWnZjbTVwWVRFV01CUUdBMVVFQnhNTgpVMkZ1SUVaeVlXNWphWE5qYnpFUE1BMEdBMVVFQ3hNR1kyeHBaVzUwTVI4d0hRWURWUVFEREJaQlpHMXBia0J2CmNtY3lMbVY0WVcxd2JHVXVZMjl0TUZrd0V3WUhLb1pJemowQ0FRWUlLb1pJemowREFRY0RRZ0FFZndwdkRmOHoKWVdVaWxwclcxQ2hsc3hBaDhVcjBLQXpUYm9oc0oyQjFNWk40ZkVUakhKTHRnWjZDT0ZRaVFoNy9BK1NyNVhYdApDRnpvNUZWSlNSNmc2YU5OTUVzd0RnWURWUjBQQVFIL0JBUURBZ2VBTUF3R0ExVWRFd0VCL3dRQ01BQXdLd1lEClZSMGpCQ1F3SW9BZ21RRjBZbjNvczlwUEhXQ01ra3U4VXUzYks0cmY1QUllUTYwUVgyNHh4cjh3Q2dZSUtvWkkKemowRUF3SURTQUF3UlFJaEFPVUZRWUMvZE1ZMGZ0U2JNYVFLL213Uy83a0JyRWZicXFNaHBwWjlqWG1uQWlCeQpjczdFalFuZHJ2RHRMZnVPUEY4QnJyVGZPdWZDTTVNN09YSDl4S2ZQdVE9PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg=="</span></span><br><span class="line">															],</span><br><span class="line">															<span class="attr">"crypto_config"</span>: &#123;</span><br><span class="line">																<span class="attr">"identity_identifier_hash_function"</span>: <span class="string">"SHA256"</span>,</span><br><span class="line">																<span class="attr">"signature_hash_family"</span>: <span class="string">"SHA2"</span></span><br><span class="line">															&#125;,</span><br><span class="line">															<span class="attr">"fabric_node_ous"</span>: &#123;</span><br><span class="line">																<span class="attr">"client_ou_identifier"</span>: &#123;</span><br><span class="line">																	<span class="attr">"certificate"</span>: <span class="string">"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNVakNDQWZpZ0F3SUJBZ0lSQU1rYVQ5em1XTEo2bFVNUlhRZmgrSTh3Q2dZSUtvWkl6ajBFQXdJd2N6RUwKTUFrR0ExVUVCaE1DVlZNeEV6QVJCZ05WQkFnVENrTmhiR2xtYjNKdWFXRXhGakFVQmdOVkJBY1REVk5oYmlCRwpjbUZ1WTJselkyOHhHVEFYQmdOVkJBb1RFRzl5WnpJdVpYaGhiWEJzWlM1amIyMHhIREFhQmdOVkJBTVRFMk5oCkxtOXlaekl1WlhoaGJYQnNaUzVqYjIwd0hoY05NVGt3T0RBeE1ESXhOREF3V2hjTk1qa3dOekk1TURJeE5EQXcKV2pCek1Rc3dDUVlEVlFRR0V3SlZVekVUTUJFR0ExVUVDQk1LUTJGc2FXWnZjbTVwWVRFV01CUUdBMVVFQnhNTgpVMkZ1SUVaeVlXNWphWE5qYnpFWk1CY0dBMVVFQ2hNUWIzSm5NaTVsZUdGdGNHeGxMbU52YlRFY01Cb0dBMVVFCkF4TVRZMkV1YjNKbk1pNWxlR0Z0Y0d4bExtTnZiVEJaTUJNR0J5cUdTTTQ5QWdFR0NDcUdTTTQ5QXdFSEEwSUEKQkpZSEEzOVNmbjczdXFIT0JrTzJ0R1pucFdvR09NRHFmRkJwZG9FOXhCTzNCdFZaT2hMblBYY01MRGErcTdJMQpxbFJHQmh4TTVpLzZ1L0V4Z2psaTVVK2piVEJyTUE0R0ExVWREd0VCL3dRRUF3SUJwakFkQmdOVkhTVUVGakFVCkJnZ3JCZ0VGQlFjREFnWUlLd1lCQlFVSEF3RXdEd1lEVlIwVEFRSC9CQVV3QXdFQi96QXBCZ05WSFE0RUlnUWcKbVFGMFluM29zOXBQSFdDTWtrdThVdTNiSzRyZjVBSWVRNjBRWDI0eHhyOHdDZ1lJS29aSXpqMEVBd0lEU0FBdwpSUUloQUpzYVBHWklWTkU4S09zbjJzZ2ZSSlo1ek1BbEpIS1p3V1lJQTljVVNWS1FBaUF6ZkIrL0VMUFQrbFFmCjZUNmhEQXU1bkwwRGpoUUxqa0ZmL3RXNUVDMzlCQT09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K"</span>,</span><br><span class="line">																	<span class="attr">"organizational_unit_identifier"</span>: <span class="string">"client"</span></span><br><span class="line">																&#125;,</span><br><span class="line">																<span class="attr">"enable"</span>: <span class="literal">true</span>,</span><br><span class="line">																<span class="attr">"peer_ou_identifier"</span>: &#123;</span><br><span class="line">																	<span class="attr">"certificate"</span>: <span class="string">"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNVakNDQWZpZ0F3SUJBZ0lSQU1rYVQ5em1XTEo2bFVNUlhRZmgrSTh3Q2dZSUtvWkl6ajBFQXdJd2N6RUwKTUFrR0ExVUVCaE1DVlZNeEV6QVJCZ05WQkFnVENrTmhiR2xtYjNKdWFXRXhGakFVQmdOVkJBY1REVk5oYmlCRwpjbUZ1WTJselkyOHhHVEFYQmdOVkJBb1RFRzl5WnpJdVpYaGhiWEJzWlM1amIyMHhIREFhQmdOVkJBTVRFMk5oCkxtOXlaekl1WlhoaGJYQnNaUzVqYjIwd0hoY05NVGt3T0RBeE1ESXhOREF3V2hjTk1qa3dOekk1TURJeE5EQXcKV2pCek1Rc3dDUVlEVlFRR0V3SlZVekVUTUJFR0ExVUVDQk1LUTJGc2FXWnZjbTVwWVRFV01CUUdBMVVFQnhNTgpVMkZ1SUVaeVlXNWphWE5qYnpFWk1CY0dBMVVFQ2hNUWIzSm5NaTVsZUdGdGNHeGxMbU52YlRFY01Cb0dBMVVFCkF4TVRZMkV1YjNKbk1pNWxlR0Z0Y0d4bExtTnZiVEJaTUJNR0J5cUdTTTQ5QWdFR0NDcUdTTTQ5QXdFSEEwSUEKQkpZSEEzOVNmbjczdXFIT0JrTzJ0R1pucFdvR09NRHFmRkJwZG9FOXhCTzNCdFZaT2hMblBYY01MRGErcTdJMQpxbFJHQmh4TTVpLzZ1L0V4Z2psaTVVK2piVEJyTUE0R0ExVWREd0VCL3dRRUF3SUJwakFkQmdOVkhTVUVGakFVCkJnZ3JCZ0VGQlFjREFnWUlLd1lCQlFVSEF3RXdEd1lEVlIwVEFRSC9CQVV3QXdFQi96QXBCZ05WSFE0RUlnUWcKbVFGMFluM29zOXBQSFdDTWtrdThVdTNiSzRyZjVBSWVRNjBRWDI0eHhyOHdDZ1lJS29aSXpqMEVBd0lEU0FBdwpSUUloQUpzYVBHWklWTkU4S09zbjJzZ2ZSSlo1ek1BbEpIS1p3V1lJQTljVVNWS1FBaUF6ZkIrL0VMUFQrbFFmCjZUNmhEQXU1bkwwRGpoUUxqa0ZmL3RXNUVDMzlCQT09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K"</span>,</span><br><span class="line">																	<span class="attr">"organizational_unit_identifier"</span>: <span class="string">"peer"</span></span><br><span class="line">																&#125;</span><br><span class="line">															&#125;,</span><br><span class="line">															<span class="attr">"intermediate_certs"</span>: [],</span><br><span class="line">															<span class="attr">"name"</span>: <span class="string">"Org2MSP"</span>,</span><br><span class="line">															<span class="attr">"organizational_unit_identifiers"</span>: [],</span><br><span class="line">															<span class="attr">"revocation_list"</span>: [],</span><br><span class="line">															<span class="attr">"root_certs"</span>: [</span><br><span class="line">																<span class="string">"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNVakNDQWZpZ0F3SUJBZ0lSQU1rYVQ5em1XTEo2bFVNUlhRZmgrSTh3Q2dZSUtvWkl6ajBFQXdJd2N6RUwKTUFrR0ExVUVCaE1DVlZNeEV6QVJCZ05WQkFnVENrTmhiR2xtYjNKdWFXRXhGakFVQmdOVkJBY1REVk5oYmlCRwpjbUZ1WTJselkyOHhHVEFYQmdOVkJBb1RFRzl5WnpJdVpYaGhiWEJzWlM1amIyMHhIREFhQmdOVkJBTVRFMk5oCkxtOXlaekl1WlhoaGJYQnNaUzVqYjIwd0hoY05NVGt3T0RBeE1ESXhOREF3V2hjTk1qa3dOekk1TURJeE5EQXcKV2pCek1Rc3dDUVlEVlFRR0V3SlZVekVUTUJFR0ExVUVDQk1LUTJGc2FXWnZjbTVwWVRFV01CUUdBMVVFQnhNTgpVMkZ1SUVaeVlXNWphWE5qYnpFWk1CY0dBMVVFQ2hNUWIzSm5NaTVsZUdGdGNHeGxMbU52YlRFY01Cb0dBMVVFCkF4TVRZMkV1YjNKbk1pNWxlR0Z0Y0d4bExtTnZiVEJaTUJNR0J5cUdTTTQ5QWdFR0NDcUdTTTQ5QXdFSEEwSUEKQkpZSEEzOVNmbjczdXFIT0JrTzJ0R1pucFdvR09NRHFmRkJwZG9FOXhCTzNCdFZaT2hMblBYY01MRGErcTdJMQpxbFJHQmh4TTVpLzZ1L0V4Z2psaTVVK2piVEJyTUE0R0ExVWREd0VCL3dRRUF3SUJwakFkQmdOVkhTVUVGakFVCkJnZ3JCZ0VGQlFjREFnWUlLd1lCQlFVSEF3RXdEd1lEVlIwVEFRSC9CQVV3QXdFQi96QXBCZ05WSFE0RUlnUWcKbVFGMFluM29zOXBQSFdDTWtrdThVdTNiSzRyZjVBSWVRNjBRWDI0eHhyOHdDZ1lJS29aSXpqMEVBd0lEU0FBdwpSUUloQUpzYVBHWklWTkU4S09zbjJzZ2ZSSlo1ek1BbEpIS1p3V1lJQTljVVNWS1FBaUF6ZkIrL0VMUFQrbFFmCjZUNmhEQXU1bkwwRGpoUUxqa0ZmL3RXNUVDMzlCQT09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K"</span></span><br><span class="line">															],</span><br><span class="line">															<span class="attr">"signing_identity"</span>: <span class="literal">null</span>,</span><br><span class="line">															<span class="attr">"tls_intermediate_certs"</span>: [],</span><br><span class="line">															<span class="attr">"tls_root_certs"</span>: [</span><br><span class="line">																<span class="string">"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNWekNDQWYyZ0F3SUJBZ0lRVGV5ZHpHQWVpNzB1ZkZzbTBmTWY1VEFLQmdncWhrak9QUVFEQWpCMk1Rc3cKQ1FZRFZRUUdFd0pWVXpFVE1CRUdBMVVFQ0JNS1EyRnNhV1p2Y201cFlURVdNQlFHQTFVRUJ4TU5VMkZ1SUVaeQpZVzVqYVhOamJ6RVpNQmNHQTFVRUNoTVFiM0puTWk1bGVHRnRjR3hsTG1OdmJURWZNQjBHQTFVRUF4TVdkR3h6ClkyRXViM0puTWk1bGVHRnRjR3hsTG1OdmJUQWVGdzB4T1RBNE1ERXdNakUwTURCYUZ3MHlPVEEzTWprd01qRTAKTURCYU1IWXhDekFKQmdOVkJBWVRBbFZUTVJNd0VRWURWUVFJRXdwRFlXeHBabTl5Ym1saE1SWXdGQVlEVlFRSApFdzFUWVc0Z1JuSmhibU5wYzJOdk1Sa3dGd1lEVlFRS0V4QnZjbWN5TG1WNFlXMXdiR1V1WTI5dE1SOHdIUVlEClZRUURFeFowYkhOallTNXZjbWN5TG1WNFlXMXdiR1V1WTI5dE1Ga3dFd1lIS29aSXpqMENBUVlJS29aSXpqMEQKQVFjRFFnQUVadTg3U0JzYWpnNXRTcFZKeGlZaE9YaWpOd3J0TmQvTFpuYkozWjUvY0dhaXZHeTZwQTB6Y1RjcApvdHN1YWJscE9BNHkxREEvbk5xaWtQa1dVVHZQcHFOdE1Hc3dEZ1lEVlIwUEFRSC9CQVFEQWdHbU1CMEdBMVVkCkpRUVdNQlFHQ0NzR0FRVUZCd01DQmdnckJnRUZCUWNEQVRBUEJnTlZIUk1CQWY4RUJUQURBUUgvTUNrR0ExVWQKRGdRaUJDQUh4MDhOZ1FwdW9IR0tZWU9IYWh3VDg0cW9BN3p3dzFRTVNZT0h2VlZCWERBS0JnZ3Foa2pPUFFRRApBZ05JQURCRkFpRUF5QlBlakFHWjZtNXdWS244WHFhblFsMWUzYjNpUFBJVFdHaVN0dDBuZ3JJQ0lIUUJKRFd6CjFubzBMbnp0Nis4eEw5R25oY1NrZnZsWXR5MmhQcjdnTThFYgotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg=="</span></span><br><span class="line">															]</span><br><span class="line">														&#125;,</span><br><span class="line">														<span class="attr">"type"</span>: <span class="number">0</span></span><br><span class="line">													&#125;,</span><br><span class="line">													<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">												&#125;</span><br><span class="line">											&#125;,</span><br><span class="line">											<span class="attr">"version"</span>: <span class="string">"1"</span></span><br><span class="line">										&#125;</span><br><span class="line">									&#125;,</span><br><span class="line">									<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">									<span class="attr">"policies"</span>: &#123;</span><br><span class="line">										<span class="attr">"Admins"</span>: &#123;</span><br><span class="line">											<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">											<span class="attr">"policy"</span>: &#123;</span><br><span class="line">												<span class="attr">"type"</span>: <span class="number">3</span>,</span><br><span class="line">												<span class="attr">"value"</span>: &#123;</span><br><span class="line">													<span class="attr">"rule"</span>: <span class="string">"MAJORITY"</span>,</span><br><span class="line">													<span class="attr">"sub_policy"</span>: <span class="string">"Admins"</span></span><br><span class="line">												&#125;</span><br><span class="line">											&#125;,</span><br><span class="line">											<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">										&#125;,</span><br><span class="line">										<span class="attr">"Readers"</span>: &#123;</span><br><span class="line">											<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">											<span class="attr">"policy"</span>: &#123;</span><br><span class="line">												<span class="attr">"type"</span>: <span class="number">3</span>,</span><br><span class="line">												<span class="attr">"value"</span>: &#123;</span><br><span class="line">													<span class="attr">"rule"</span>: <span class="string">"ANY"</span>,</span><br><span class="line">													<span class="attr">"sub_policy"</span>: <span class="string">"Readers"</span></span><br><span class="line">												&#125;</span><br><span class="line">											&#125;,</span><br><span class="line">											<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">										&#125;,</span><br><span class="line">										<span class="attr">"Writers"</span>: &#123;</span><br><span class="line">											<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">											<span class="attr">"policy"</span>: &#123;</span><br><span class="line">												<span class="attr">"type"</span>: <span class="number">3</span>,</span><br><span class="line">												<span class="attr">"value"</span>: &#123;</span><br><span class="line">													<span class="attr">"rule"</span>: <span class="string">"ANY"</span>,</span><br><span class="line">													<span class="attr">"sub_policy"</span>: <span class="string">"Writers"</span></span><br><span class="line">												&#125;</span><br><span class="line">											&#125;,</span><br><span class="line">											<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">										&#125;</span><br><span class="line">									&#125;,</span><br><span class="line">									<span class="attr">"values"</span>: &#123;</span><br><span class="line">										<span class="attr">"Capabilities"</span>: &#123;</span><br><span class="line">											<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">											<span class="attr">"value"</span>: &#123;</span><br><span class="line">												<span class="attr">"capabilities"</span>: &#123;</span><br><span class="line">													<span class="attr">"V1_3"</span>: &#123;&#125;</span><br><span class="line">												&#125;</span><br><span class="line">											&#125;,</span><br><span class="line">											<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">										&#125;</span><br><span class="line">									&#125;,</span><br><span class="line">									<span class="attr">"version"</span>: <span class="string">"1"</span></span><br><span class="line">								&#125;,</span><br><span class="line">								<span class="attr">"Orderer"</span>: &#123;</span><br><span class="line">									<span class="attr">"groups"</span>: &#123;</span><br><span class="line">										<span class="attr">"OrdererOrg"</span>: &#123;</span><br><span class="line">											<span class="attr">"groups"</span>: &#123;&#125;,</span><br><span class="line">											<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">											<span class="attr">"policies"</span>: &#123;</span><br><span class="line">												<span class="attr">"Admins"</span>: &#123;</span><br><span class="line">													<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">													<span class="attr">"policy"</span>: &#123;</span><br><span class="line">														<span class="attr">"type"</span>: <span class="number">1</span>,</span><br><span class="line">														<span class="attr">"value"</span>: &#123;</span><br><span class="line">															<span class="attr">"identities"</span>: [&#123;</span><br><span class="line">																<span class="attr">"principal"</span>: &#123;</span><br><span class="line">																	<span class="attr">"msp_identifier"</span>: <span class="string">"OrdererMSP"</span>,</span><br><span class="line">																	<span class="attr">"role"</span>: <span class="string">"ADMIN"</span></span><br><span class="line">																&#125;,</span><br><span class="line">																<span class="attr">"principal_classification"</span>: <span class="string">"ROLE"</span></span><br><span class="line">															&#125;],</span><br><span class="line">															<span class="attr">"rule"</span>: &#123;</span><br><span class="line">																<span class="attr">"n_out_of"</span>: &#123;</span><br><span class="line">																	<span class="attr">"n"</span>: <span class="number">1</span>,</span><br><span class="line">																	<span class="attr">"rules"</span>: [&#123;</span><br><span class="line">																		<span class="attr">"signed_by"</span>: <span class="number">0</span></span><br><span class="line">																	&#125;]</span><br><span class="line">																&#125;</span><br><span class="line">															&#125;,</span><br><span class="line">															<span class="attr">"version"</span>: <span class="number">0</span></span><br><span class="line">														&#125;</span><br><span class="line">													&#125;,</span><br><span class="line">													<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">												&#125;,</span><br><span class="line">												<span class="attr">"Readers"</span>: &#123;</span><br><span class="line">													<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">													<span class="attr">"policy"</span>: &#123;</span><br><span class="line">														<span class="attr">"type"</span>: <span class="number">1</span>,</span><br><span class="line">														<span class="attr">"value"</span>: &#123;</span><br><span class="line">															<span class="attr">"identities"</span>: [&#123;</span><br><span class="line">																<span class="attr">"principal"</span>: &#123;</span><br><span class="line">																	<span class="attr">"msp_identifier"</span>: <span class="string">"OrdererMSP"</span>,</span><br><span class="line">																	<span class="attr">"role"</span>: <span class="string">"MEMBER"</span></span><br><span class="line">																&#125;,</span><br><span class="line">																<span class="attr">"principal_classification"</span>: <span class="string">"ROLE"</span></span><br><span class="line">															&#125;],</span><br><span class="line">															<span class="attr">"rule"</span>: &#123;</span><br><span class="line">																<span class="attr">"n_out_of"</span>: &#123;</span><br><span class="line">																	<span class="attr">"n"</span>: <span class="number">1</span>,</span><br><span class="line">																	<span class="attr">"rules"</span>: [&#123;</span><br><span class="line">																		<span class="attr">"signed_by"</span>: <span class="number">0</span></span><br><span class="line">																	&#125;]</span><br><span class="line">																&#125;</span><br><span class="line">															&#125;,</span><br><span class="line">															<span class="attr">"version"</span>: <span class="number">0</span></span><br><span class="line">														&#125;</span><br><span class="line">													&#125;,</span><br><span class="line">													<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">												&#125;,</span><br><span class="line">												<span class="attr">"Writers"</span>: &#123;</span><br><span class="line">													<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">													<span class="attr">"policy"</span>: &#123;</span><br><span class="line">														<span class="attr">"type"</span>: <span class="number">1</span>,</span><br><span class="line">														<span class="attr">"value"</span>: &#123;</span><br><span class="line">															<span class="attr">"identities"</span>: [&#123;</span><br><span class="line">																<span class="attr">"principal"</span>: &#123;</span><br><span class="line">																	<span class="attr">"msp_identifier"</span>: <span class="string">"OrdererMSP"</span>,</span><br><span class="line">																	<span class="attr">"role"</span>: <span class="string">"MEMBER"</span></span><br><span class="line">																&#125;,</span><br><span class="line">																<span class="attr">"principal_classification"</span>: <span class="string">"ROLE"</span></span><br><span class="line">															&#125;],</span><br><span class="line">															<span class="attr">"rule"</span>: &#123;</span><br><span class="line">																<span class="attr">"n_out_of"</span>: &#123;</span><br><span class="line">																	<span class="attr">"n"</span>: <span class="number">1</span>,</span><br><span class="line">																	<span class="attr">"rules"</span>: [&#123;</span><br><span class="line">																		<span class="attr">"signed_by"</span>: <span class="number">0</span></span><br><span class="line">																	&#125;]</span><br><span class="line">																&#125;</span><br><span class="line">															&#125;,</span><br><span class="line">															<span class="attr">"version"</span>: <span class="number">0</span></span><br><span class="line">														&#125;</span><br><span class="line">													&#125;,</span><br><span class="line">													<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">												&#125;</span><br><span class="line">											&#125;,</span><br><span class="line">											<span class="attr">"values"</span>: &#123;</span><br><span class="line">												<span class="attr">"MSP"</span>: &#123;</span><br><span class="line">													<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">													<span class="attr">"value"</span>: &#123;</span><br><span class="line">														<span class="attr">"config"</span>: &#123;</span><br><span class="line">															<span class="attr">"admins"</span>: [</span><br><span class="line">																<span class="string">"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNDekNDQWJHZ0F3SUJBZ0lSQUtuelI3NFZjN3RqOE5aQ21QV29QaWN3Q2dZSUtvWkl6ajBFQXdJd2FURUwKTUFrR0ExVUVCaE1DVlZNeEV6QVJCZ05WQkFnVENrTmhiR2xtYjNKdWFXRXhGakFVQmdOVkJBY1REVk5oYmlCRwpjbUZ1WTJselkyOHhGREFTQmdOVkJBb1RDMlY0WVcxd2JHVXVZMjl0TVJjd0ZRWURWUVFERXc1allTNWxlR0Z0CmNHeGxMbU52YlRBZUZ3MHhPVEE0TURFd01qRTBNREJhRncweU9UQTNNamt3TWpFME1EQmFNRll4Q3pBSkJnTlYKQkFZVEFsVlRNUk13RVFZRFZRUUlFd3BEWVd4cFptOXlibWxoTVJZd0ZBWURWUVFIRXcxVFlXNGdSbkpoYm1OcApjMk52TVJvd0dBWURWUVFEREJGQlpHMXBia0JsZUdGdGNHeGxMbU52YlRCWk1CTUdCeXFHU000OUFnRUdDQ3FHClNNNDlBd0VIQTBJQUJNUGUyNUtPU0hscUVZelJFVE83YXRjYWRvT0xnckRxelJQTjNjQ2RpR3A4QU4wdmdiTnAKTEEvTFJ0alFKbzdQaTZFZFlHaWh1MUNuRWgvNUxnYk90TmVqVFRCTE1BNEdBMVVkRHdFQi93UUVBd0lIZ0RBTQpCZ05WSFJNQkFmOEVBakFBTUNzR0ExVWRJd1FrTUNLQUlFQ0pBOWZTbDlUN0xsVWZ3QVhwM1V1cyt2YVpRbkZPCm9PSXJ2cmFrUDE3QU1Bb0dDQ3FHU000OUJBTUNBMGdBTUVVQ0lRQ1BjZVpmekNXa29MZ0N0NTMwbmEramY0a2cKN3BIWWwwY2NMTTZ4QkU0em5RSWdFVU52N2Q3MjQ2N1dnN0pMckZDb0x6eFhWUlMrN2UyWVJYSUlKOS9NVTJRPQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg=="</span></span><br><span class="line">															],</span><br><span class="line">															<span class="attr">"crypto_config"</span>: &#123;</span><br><span class="line">																<span class="attr">"identity_identifier_hash_function"</span>: <span class="string">"SHA256"</span>,</span><br><span class="line">																<span class="attr">"signature_hash_family"</span>: <span class="string">"SHA2"</span></span><br><span class="line">															&#125;,</span><br><span class="line">															<span class="attr">"fabric_node_ous"</span>: <span class="literal">null</span>,</span><br><span class="line">															<span class="attr">"intermediate_certs"</span>: [],</span><br><span class="line">															<span class="attr">"name"</span>: <span class="string">"OrdererMSP"</span>,</span><br><span class="line">															<span class="attr">"organizational_unit_identifiers"</span>: [],</span><br><span class="line">															<span class="attr">"revocation_list"</span>: [],</span><br><span class="line">															<span class="attr">"root_certs"</span>: [</span><br><span class="line">																<span class="string">"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNQRENDQWVPZ0F3SUJBZ0lRSm9TdloyVE5oVTZjN0kvZ3VRNHYvVEFLQmdncWhrak9QUVFEQWpCcE1Rc3cKQ1FZRFZRUUdFd0pWVXpFVE1CRUdBMVVFQ0JNS1EyRnNhV1p2Y201cFlURVdNQlFHQTFVRUJ4TU5VMkZ1SUVaeQpZVzVqYVhOamJ6RVVNQklHQTFVRUNoTUxaWGhoYlhCc1pTNWpiMjB4RnpBVkJnTlZCQU1URG1OaExtVjRZVzF3CmJHVXVZMjl0TUI0WERURTVNRGd3TVRBeU1UUXdNRm9YRFRJNU1EY3lPVEF5TVRRd01Gb3dhVEVMTUFrR0ExVUUKQmhNQ1ZWTXhFekFSQmdOVkJBZ1RDa05oYkdsbWIzSnVhV0V4RmpBVUJnTlZCQWNURFZOaGJpQkdjbUZ1WTJsegpZMjh4RkRBU0JnTlZCQW9UQzJWNFlXMXdiR1V1WTI5dE1SY3dGUVlEVlFRREV3NWpZUzVsZUdGdGNHeGxMbU52CmJUQlpNQk1HQnlxR1NNNDlBZ0VHQ0NxR1NNNDlBd0VIQTBJQUJFaUxuejB5TXp6K0dPNTlLZ3NMV0E1SVNaTXgKaUdRMVkrVHB3a1hZQXhjQnZENXZMMGhXcCtwWDdmSCtqaU9TOFBCMDFkamQ0TVJsb0lCQTgzYkxxdktqYlRCcgpNQTRHQTFVZER3RUIvd1FFQXdJQnBqQWRCZ05WSFNVRUZqQVVCZ2dyQmdFRkJRY0RBZ1lJS3dZQkJRVUhBd0V3CkR3WURWUjBUQVFIL0JBVXdBd0VCL3pBcEJnTlZIUTRFSWdRZ1FJa0QxOUtYMVBzdVZSL0FCZW5kUzZ6NjlwbEMKY1U2ZzRpdSt0cVEvWHNBd0NnWUlLb1pJemowRUF3SURSd0F3UkFJZ2JmRWVkMjJGRHFFSStwU0pKTXZrQi9GQQpFRitIUlg5OW91bGRLVlBqcDgwQ0lBS1VISmxlR01HYzF6dHRNSStCcHBldG53UU5nWjRsUDY5MUs0bENnU2hMCi0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K"</span></span><br><span class="line">															],</span><br><span class="line">															<span class="attr">"signing_identity"</span>: <span class="literal">null</span>,</span><br><span class="line">															<span class="attr">"tls_intermediate_certs"</span>: [],</span><br><span class="line">															<span class="attr">"tls_root_certs"</span>: [</span><br><span class="line">																<span class="string">"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNRekNDQWVxZ0F3SUJBZ0lSQVBWKy9UOVlSTjV0YmFXVGlETjg5Mmt3Q2dZSUtvWkl6ajBFQXdJd2JERUwKTUFrR0ExVUVCaE1DVlZNeEV6QVJCZ05WQkFnVENrTmhiR2xtYjNKdWFXRXhGakFVQmdOVkJBY1REVk5oYmlCRwpjbUZ1WTJselkyOHhGREFTQmdOVkJBb1RDMlY0WVcxd2JHVXVZMjl0TVJvd0dBWURWUVFERXhGMGJITmpZUzVsCmVHRnRjR3hsTG1OdmJUQWVGdzB4T1RBNE1ERXdNakUwTURCYUZ3MHlPVEEzTWprd01qRTBNREJhTUd3eEN6QUoKQmdOVkJBWVRBbFZUTVJNd0VRWURWUVFJRXdwRFlXeHBabTl5Ym1saE1SWXdGQVlEVlFRSEV3MVRZVzRnUm5KaApibU5wYzJOdk1SUXdFZ1lEVlFRS0V3dGxlR0Z0Y0d4bExtTnZiVEVhTUJnR0ExVUVBeE1SZEd4elkyRXVaWGhoCmJYQnNaUzVqYjIwd1dUQVRCZ2NxaGtqT1BRSUJCZ2dxaGtqT1BRTUJCd05DQUFSUkxQK2ZLeFpnd2tFa2JIREoKb1JQak5ySXZBWWx2SHBMUTJoSXE1aXJQQnJlcEU4akRNTERyVklZR0NRdDBydGxjWFZTT3dZVTFkMXNOUy9USApSb1JvbzIwd2F6QU9CZ05WSFE4QkFmOEVCQU1DQWFZd0hRWURWUjBsQkJZd0ZBWUlLd1lCQlFVSEF3SUdDQ3NHCkFRVUZCd01CTUE4R0ExVWRFd0VCL3dRRk1BTUJBZjh3S1FZRFZSME9CQ0lFSUJWM1owTGw1TnpOcUdqVlpmbHIKUHRqRXFrNUtvUWFweXpJOFNrTnJQQVpWTUFvR0NDcUdTTTQ5QkFNQ0EwY0FNRVFDSUQ5Z3U5bU9TejVLaTd5cQpGU2czd1FGdXphb2pRakdiNVN4YUwwVzJTOUxXQWlCSzZIOXhNSENuZm5BV291bVpsdXNHd3RsOU5PVDhkdXFVCnR2eHRPOVY4S1E9PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg=="</span></span><br><span class="line">															]</span><br><span class="line">														&#125;,</span><br><span class="line">														<span class="attr">"type"</span>: <span class="number">0</span></span><br><span class="line">													&#125;,</span><br><span class="line">													<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">												&#125;</span><br><span class="line">											&#125;,</span><br><span class="line">											<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">										&#125;</span><br><span class="line">									&#125;,</span><br><span class="line">									<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">									<span class="attr">"policies"</span>: &#123;</span><br><span class="line">										<span class="attr">"Admins"</span>: &#123;</span><br><span class="line">											<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">											<span class="attr">"policy"</span>: &#123;</span><br><span class="line">												<span class="attr">"type"</span>: <span class="number">3</span>,</span><br><span class="line">												<span class="attr">"value"</span>: &#123;</span><br><span class="line">													<span class="attr">"rule"</span>: <span class="string">"MAJORITY"</span>,</span><br><span class="line">													<span class="attr">"sub_policy"</span>: <span class="string">"Admins"</span></span><br><span class="line">												&#125;</span><br><span class="line">											&#125;,</span><br><span class="line">											<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">										&#125;,</span><br><span class="line">										<span class="attr">"BlockValidation"</span>: &#123;</span><br><span class="line">											<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">											<span class="attr">"policy"</span>: &#123;</span><br><span class="line">												<span class="attr">"type"</span>: <span class="number">3</span>,</span><br><span class="line">												<span class="attr">"value"</span>: &#123;</span><br><span class="line">													<span class="attr">"rule"</span>: <span class="string">"ANY"</span>,</span><br><span class="line">													<span class="attr">"sub_policy"</span>: <span class="string">"Writers"</span></span><br><span class="line">												&#125;</span><br><span class="line">											&#125;,</span><br><span class="line">											<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">										&#125;,</span><br><span class="line">										<span class="attr">"Readers"</span>: &#123;</span><br><span class="line">											<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">											<span class="attr">"policy"</span>: &#123;</span><br><span class="line">												<span class="attr">"type"</span>: <span class="number">3</span>,</span><br><span class="line">												<span class="attr">"value"</span>: &#123;</span><br><span class="line">													<span class="attr">"rule"</span>: <span class="string">"ANY"</span>,</span><br><span class="line">													<span class="attr">"sub_policy"</span>: <span class="string">"Readers"</span></span><br><span class="line">												&#125;</span><br><span class="line">											&#125;,</span><br><span class="line">											<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">										&#125;,</span><br><span class="line">										<span class="attr">"Writers"</span>: &#123;</span><br><span class="line">											<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">											<span class="attr">"policy"</span>: &#123;</span><br><span class="line">												<span class="attr">"type"</span>: <span class="number">3</span>,</span><br><span class="line">												<span class="attr">"value"</span>: &#123;</span><br><span class="line">													<span class="attr">"rule"</span>: <span class="string">"ANY"</span>,</span><br><span class="line">													<span class="attr">"sub_policy"</span>: <span class="string">"Writers"</span></span><br><span class="line">												&#125;</span><br><span class="line">											&#125;,</span><br><span class="line">											<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">										&#125;</span><br><span class="line">									&#125;,</span><br><span class="line">									<span class="attr">"values"</span>: &#123;</span><br><span class="line">										<span class="attr">"BatchSize"</span>: &#123;</span><br><span class="line">											<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">											<span class="attr">"value"</span>: &#123;</span><br><span class="line">												<span class="attr">"absolute_max_bytes"</span>: <span class="number">103809024</span>,</span><br><span class="line">												<span class="attr">"max_message_count"</span>: <span class="number">10</span>,</span><br><span class="line">												<span class="attr">"preferred_max_bytes"</span>: <span class="number">524288</span></span><br><span class="line">											&#125;,</span><br><span class="line">											<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">										&#125;,</span><br><span class="line">										<span class="attr">"BatchTimeout"</span>: &#123;</span><br><span class="line">											<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">											<span class="attr">"value"</span>: &#123;</span><br><span class="line">												<span class="attr">"timeout"</span>: <span class="string">"2s"</span></span><br><span class="line">											&#125;,</span><br><span class="line">											<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">										&#125;,</span><br><span class="line">										<span class="attr">"Capabilities"</span>: &#123;</span><br><span class="line">											<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">											<span class="attr">"value"</span>: &#123;</span><br><span class="line">												<span class="attr">"capabilities"</span>: &#123;</span><br><span class="line">													<span class="attr">"V1_1"</span>: &#123;&#125;</span><br><span class="line">												&#125;</span><br><span class="line">											&#125;,</span><br><span class="line">											<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">										&#125;,</span><br><span class="line">										<span class="attr">"ChannelRestrictions"</span>: &#123;</span><br><span class="line">											<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">											<span class="attr">"value"</span>: <span class="literal">null</span>,</span><br><span class="line">											<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">										&#125;,</span><br><span class="line">										<span class="attr">"ConsensusType"</span>: &#123;</span><br><span class="line">											<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">											<span class="attr">"value"</span>: &#123;</span><br><span class="line">												<span class="attr">"metadata"</span>: <span class="literal">null</span>,</span><br><span class="line">												<span class="attr">"state"</span>: <span class="string">"STATE_NORMAL"</span>,</span><br><span class="line">												<span class="attr">"type"</span>: <span class="string">"solo"</span></span><br><span class="line">											&#125;,</span><br><span class="line">											<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">										&#125;</span><br><span class="line">									&#125;,</span><br><span class="line">									<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">								&#125;</span><br><span class="line">							&#125;,</span><br><span class="line">							<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">							<span class="attr">"policies"</span>: &#123;</span><br><span class="line">								<span class="attr">"Admins"</span>: &#123;</span><br><span class="line">									<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">									<span class="attr">"policy"</span>: &#123;</span><br><span class="line">										<span class="attr">"type"</span>: <span class="number">3</span>,</span><br><span class="line">										<span class="attr">"value"</span>: &#123;</span><br><span class="line">											<span class="attr">"rule"</span>: <span class="string">"MAJORITY"</span>,</span><br><span class="line">											<span class="attr">"sub_policy"</span>: <span class="string">"Admins"</span></span><br><span class="line">										&#125;</span><br><span class="line">									&#125;,</span><br><span class="line">									<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">								&#125;,</span><br><span class="line">								<span class="attr">"Readers"</span>: &#123;</span><br><span class="line">									<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">									<span class="attr">"policy"</span>: &#123;</span><br><span class="line">										<span class="attr">"type"</span>: <span class="number">3</span>,</span><br><span class="line">										<span class="attr">"value"</span>: &#123;</span><br><span class="line">											<span class="attr">"rule"</span>: <span class="string">"ANY"</span>,</span><br><span class="line">											<span class="attr">"sub_policy"</span>: <span class="string">"Readers"</span></span><br><span class="line">										&#125;</span><br><span class="line">									&#125;,</span><br><span class="line">									<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">								&#125;,</span><br><span class="line">								<span class="attr">"Writers"</span>: &#123;</span><br><span class="line">									<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">									<span class="attr">"policy"</span>: &#123;</span><br><span class="line">										<span class="attr">"type"</span>: <span class="number">3</span>,</span><br><span class="line">										<span class="attr">"value"</span>: &#123;</span><br><span class="line">											<span class="attr">"rule"</span>: <span class="string">"ANY"</span>,</span><br><span class="line">											<span class="attr">"sub_policy"</span>: <span class="string">"Writers"</span></span><br><span class="line">										&#125;</span><br><span class="line">									&#125;,</span><br><span class="line">									<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">								&#125;</span><br><span class="line">							&#125;,</span><br><span class="line">							<span class="attr">"values"</span>: &#123;</span><br><span class="line">								<span class="attr">"BlockDataHashingStructure"</span>: &#123;</span><br><span class="line">									<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">									<span class="attr">"value"</span>: &#123;</span><br><span class="line">										<span class="attr">"width"</span>: <span class="number">4294967295</span></span><br><span class="line">									&#125;,</span><br><span class="line">									<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">								&#125;,</span><br><span class="line">								<span class="attr">"Capabilities"</span>: &#123;</span><br><span class="line">									<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">									<span class="attr">"value"</span>: &#123;</span><br><span class="line">										<span class="attr">"capabilities"</span>: &#123;</span><br><span class="line">											<span class="attr">"V1_3"</span>: &#123;&#125;</span><br><span class="line">										&#125;</span><br><span class="line">									&#125;,</span><br><span class="line">									<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">								&#125;,</span><br><span class="line">								<span class="attr">"Consortium"</span>: &#123;</span><br><span class="line">									<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">									<span class="attr">"value"</span>: &#123;</span><br><span class="line">										<span class="attr">"name"</span>: <span class="string">"SampleConsortium"</span></span><br><span class="line">									&#125;,</span><br><span class="line">									<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">								&#125;,</span><br><span class="line">								<span class="attr">"HashingAlgorithm"</span>: &#123;</span><br><span class="line">									<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">									<span class="attr">"value"</span>: &#123;</span><br><span class="line">										<span class="attr">"name"</span>: <span class="string">"SHA256"</span></span><br><span class="line">									&#125;,</span><br><span class="line">									<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">								&#125;,</span><br><span class="line">								<span class="attr">"OrdererAddresses"</span>: &#123;</span><br><span class="line">									<span class="attr">"mod_policy"</span>: <span class="string">"/Channel/Orderer/Admins"</span>,</span><br><span class="line">									<span class="attr">"value"</span>: &#123;</span><br><span class="line">										<span class="attr">"addresses"</span>: [</span><br><span class="line">											<span class="string">"orderer.example.com:7050"</span></span><br><span class="line">										]</span><br><span class="line">									&#125;,</span><br><span class="line">									<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">								&#125;</span><br><span class="line">							&#125;,</span><br><span class="line">							<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">						&#125;,</span><br><span class="line">						<span class="attr">"sequence"</span>: <span class="string">"3"</span></span><br><span class="line">					&#125;,</span><br><span class="line">					<span class="attr">"last_update"</span>: &#123;</span><br><span class="line">						<span class="attr">"payload"</span>: &#123;</span><br><span class="line">							<span class="attr">"data"</span>: &#123;</span><br><span class="line">								<span class="attr">"config_update"</span>: &#123;</span><br><span class="line">									<span class="attr">"channel_id"</span>: <span class="string">"mychannel"</span>,</span><br><span class="line">									<span class="attr">"isolated_data"</span>: &#123;&#125;,</span><br><span class="line">									<span class="attr">"read_set"</span>: &#123;</span><br><span class="line">										<span class="attr">"groups"</span>: &#123;</span><br><span class="line">											<span class="attr">"Application"</span>: &#123;</span><br><span class="line">												<span class="attr">"groups"</span>: &#123;</span><br><span class="line">													<span class="attr">"Org2MSP"</span>: &#123;</span><br><span class="line">														<span class="attr">"groups"</span>: &#123;&#125;,</span><br><span class="line">														<span class="attr">"mod_policy"</span>: <span class="string">""</span>,</span><br><span class="line">														<span class="attr">"policies"</span>: &#123;</span><br><span class="line">															<span class="attr">"Admins"</span>: &#123;</span><br><span class="line">																<span class="attr">"mod_policy"</span>: <span class="string">""</span>,</span><br><span class="line">																<span class="attr">"policy"</span>: <span class="literal">null</span>,</span><br><span class="line">																<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">															&#125;,</span><br><span class="line">															<span class="attr">"Readers"</span>: &#123;</span><br><span class="line">																<span class="attr">"mod_policy"</span>: <span class="string">""</span>,</span><br><span class="line">																<span class="attr">"policy"</span>: <span class="literal">null</span>,</span><br><span class="line">																<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">															&#125;,</span><br><span class="line">															<span class="attr">"Writers"</span>: &#123;</span><br><span class="line">																<span class="attr">"mod_policy"</span>: <span class="string">""</span>,</span><br><span class="line">																<span class="attr">"policy"</span>: <span class="literal">null</span>,</span><br><span class="line">																<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">															&#125;</span><br><span class="line">														&#125;,</span><br><span class="line">														<span class="attr">"values"</span>: &#123;</span><br><span class="line">															<span class="attr">"MSP"</span>: &#123;</span><br><span class="line">																<span class="attr">"mod_policy"</span>: <span class="string">""</span>,</span><br><span class="line">																<span class="attr">"value"</span>: <span class="literal">null</span>,</span><br><span class="line">																<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">															&#125;</span><br><span class="line">														&#125;,</span><br><span class="line">														<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">													&#125;</span><br><span class="line">												&#125;,</span><br><span class="line">												<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">												<span class="attr">"policies"</span>: &#123;&#125;,</span><br><span class="line">												<span class="attr">"values"</span>: &#123;&#125;,</span><br><span class="line">												<span class="attr">"version"</span>: <span class="string">"1"</span></span><br><span class="line">											&#125;</span><br><span class="line">										&#125;,</span><br><span class="line">										<span class="attr">"mod_policy"</span>: <span class="string">""</span>,</span><br><span class="line">										<span class="attr">"policies"</span>: &#123;&#125;,</span><br><span class="line">										<span class="attr">"values"</span>: &#123;&#125;,</span><br><span class="line">										<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">									&#125;,</span><br><span class="line">									<span class="attr">"write_set"</span>: &#123;</span><br><span class="line">										<span class="attr">"groups"</span>: &#123;</span><br><span class="line">											<span class="attr">"Application"</span>: &#123;</span><br><span class="line">												<span class="attr">"groups"</span>: &#123;</span><br><span class="line">													<span class="attr">"Org2MSP"</span>: &#123;</span><br><span class="line">														<span class="attr">"groups"</span>: &#123;&#125;,</span><br><span class="line">														<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">														<span class="attr">"policies"</span>: &#123;</span><br><span class="line">															<span class="attr">"Admins"</span>: &#123;</span><br><span class="line">																<span class="attr">"mod_policy"</span>: <span class="string">""</span>,</span><br><span class="line">																<span class="attr">"policy"</span>: <span class="literal">null</span>,</span><br><span class="line">																<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">															&#125;,</span><br><span class="line">															<span class="attr">"Readers"</span>: &#123;</span><br><span class="line">																<span class="attr">"mod_policy"</span>: <span class="string">""</span>,</span><br><span class="line">																<span class="attr">"policy"</span>: <span class="literal">null</span>,</span><br><span class="line">																<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">															&#125;,</span><br><span class="line">															<span class="attr">"Writers"</span>: &#123;</span><br><span class="line">																<span class="attr">"mod_policy"</span>: <span class="string">""</span>,</span><br><span class="line">																<span class="attr">"policy"</span>: <span class="literal">null</span>,</span><br><span class="line">																<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">															&#125;</span><br><span class="line">														&#125;,</span><br><span class="line">														<span class="attr">"values"</span>: &#123;</span><br><span class="line">															<span class="attr">"AnchorPeers"</span>: &#123;</span><br><span class="line">																<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">																<span class="attr">"value"</span>: &#123;</span><br><span class="line">																	<span class="attr">"anchor_peers"</span>: [&#123;</span><br><span class="line">																		<span class="attr">"host"</span>: <span class="string">"peer0.org2.example.com"</span>,</span><br><span class="line">																		<span class="attr">"port"</span>: <span class="number">9051</span></span><br><span class="line">																	&#125;]</span><br><span class="line">																&#125;,</span><br><span class="line">																<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">															&#125;,</span><br><span class="line">															<span class="attr">"MSP"</span>: &#123;</span><br><span class="line">																<span class="attr">"mod_policy"</span>: <span class="string">""</span>,</span><br><span class="line">																<span class="attr">"value"</span>: <span class="literal">null</span>,</span><br><span class="line">																<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">															&#125;</span><br><span class="line">														&#125;,</span><br><span class="line">														<span class="attr">"version"</span>: <span class="string">"1"</span></span><br><span class="line">													&#125;</span><br><span class="line">												&#125;,</span><br><span class="line">												<span class="attr">"mod_policy"</span>: <span class="string">"Admins"</span>,</span><br><span class="line">												<span class="attr">"policies"</span>: &#123;&#125;,</span><br><span class="line">												<span class="attr">"values"</span>: &#123;&#125;,</span><br><span class="line">												<span class="attr">"version"</span>: <span class="string">"1"</span></span><br><span class="line">											&#125;</span><br><span class="line">										&#125;,</span><br><span class="line">										<span class="attr">"mod_policy"</span>: <span class="string">""</span>,</span><br><span class="line">										<span class="attr">"policies"</span>: &#123;&#125;,</span><br><span class="line">										<span class="attr">"values"</span>: &#123;&#125;,</span><br><span class="line">										<span class="attr">"version"</span>: <span class="string">"0"</span></span><br><span class="line">									&#125;</span><br><span class="line">								&#125;,</span><br><span class="line">								<span class="attr">"signatures"</span>: [&#123;</span><br><span class="line">									<span class="attr">"signature"</span>: <span class="string">"MEQCIG3LXxjcsZ+8jSCZEZbUMqWOslJGqFAzNz1zz/JlqssmAiBaO8xvVXT1vusIAQaLsldAXXU9np280n5UwYyJLsuYBw=="</span>,</span><br><span class="line">									<span class="attr">"signature_header"</span>: &#123;</span><br><span class="line">										<span class="attr">"creator"</span>: &#123;</span><br><span class="line">											<span class="attr">"id_bytes"</span>: <span class="string">"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNLekNDQWRHZ0F3SUJBZ0lSQUo5YnI3UHJmQWg5cHVVcDFMZkJ3V0V3Q2dZSUtvWkl6ajBFQXdJd2N6RUwKTUFrR0ExVUVCaE1DVlZNeEV6QVJCZ05WQkFnVENrTmhiR2xtYjNKdWFXRXhGakFVQmdOVkJBY1REVk5oYmlCRwpjbUZ1WTJselkyOHhHVEFYQmdOVkJBb1RFRzl5WnpJdVpYaGhiWEJzWlM1amIyMHhIREFhQmdOVkJBTVRFMk5oCkxtOXlaekl1WlhoaGJYQnNaUzVqYjIwd0hoY05NVGt3T0RBeE1ESXhOREF3V2hjTk1qa3dOekk1TURJeE5EQXcKV2pCc01Rc3dDUVlEVlFRR0V3SlZVekVUTUJFR0ExVUVDQk1LUTJGc2FXWnZjbTVwWVRFV01CUUdBMVVFQnhNTgpVMkZ1SUVaeVlXNWphWE5qYnpFUE1BMEdBMVVFQ3hNR1kyeHBaVzUwTVI4d0hRWURWUVFEREJaQlpHMXBia0J2CmNtY3lMbVY0WVcxd2JHVXVZMjl0TUZrd0V3WUhLb1pJemowQ0FRWUlLb1pJemowREFRY0RRZ0FFZndwdkRmOHoKWVdVaWxwclcxQ2hsc3hBaDhVcjBLQXpUYm9oc0oyQjFNWk40ZkVUakhKTHRnWjZDT0ZRaVFoNy9BK1NyNVhYdApDRnpvNUZWSlNSNmc2YU5OTUVzd0RnWURWUjBQQVFIL0JBUURBZ2VBTUF3R0ExVWRFd0VCL3dRQ01BQXdLd1lEClZSMGpCQ1F3SW9BZ21RRjBZbjNvczlwUEhXQ01ra3U4VXUzYks0cmY1QUllUTYwUVgyNHh4cjh3Q2dZSUtvWkkKemowRUF3SURTQUF3UlFJaEFPVUZRWUMvZE1ZMGZ0U2JNYVFLL213Uy83a0JyRWZicXFNaHBwWjlqWG1uQWlCeQpjczdFalFuZHJ2RHRMZnVPUEY4QnJyVGZPdWZDTTVNN09YSDl4S2ZQdVE9PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg=="</span>,</span><br><span class="line">											<span class="attr">"mspid"</span>: <span class="string">"Org2MSP"</span></span><br><span class="line">										&#125;,</span><br><span class="line">										<span class="attr">"nonce"</span>: <span class="string">"InlUsKBi6xaHgTtivM0cOO5Vabiw6oSS"</span></span><br><span class="line">									&#125;</span><br><span class="line">								&#125;]</span><br><span class="line">							&#125;,</span><br><span class="line">							<span class="attr">"header"</span>: &#123;</span><br><span class="line">								<span class="attr">"channel_header"</span>: &#123;</span><br><span class="line">									<span class="attr">"channel_id"</span>: <span class="string">"mychannel"</span>,</span><br><span class="line">									<span class="attr">"epoch"</span>: <span class="string">"0"</span>,</span><br><span class="line">									<span class="attr">"extension"</span>: <span class="literal">null</span>,</span><br><span class="line">									<span class="attr">"timestamp"</span>: <span class="string">"2019-08-01T02:19:01Z"</span>,</span><br><span class="line">									<span class="attr">"tls_cert_hash"</span>: <span class="literal">null</span>,</span><br><span class="line">									<span class="attr">"tx_id"</span>: <span class="string">""</span>,</span><br><span class="line">									<span class="attr">"type"</span>: <span class="number">2</span>,</span><br><span class="line">									<span class="attr">"version"</span>: <span class="number">0</span></span><br><span class="line">								&#125;,</span><br><span class="line">								<span class="attr">"signature_header"</span>: &#123;</span><br><span class="line">									<span class="attr">"creator"</span>: &#123;</span><br><span class="line">										<span class="attr">"id_bytes"</span>: <span class="string">"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNLekNDQWRHZ0F3SUJBZ0lSQUo5YnI3UHJmQWg5cHVVcDFMZkJ3V0V3Q2dZSUtvWkl6ajBFQXdJd2N6RUwKTUFrR0ExVUVCaE1DVlZNeEV6QVJCZ05WQkFnVENrTmhiR2xtYjNKdWFXRXhGakFVQmdOVkJBY1REVk5oYmlCRwpjbUZ1WTJselkyOHhHVEFYQmdOVkJBb1RFRzl5WnpJdVpYaGhiWEJzWlM1amIyMHhIREFhQmdOVkJBTVRFMk5oCkxtOXlaekl1WlhoaGJYQnNaUzVqYjIwd0hoY05NVGt3T0RBeE1ESXhOREF3V2hjTk1qa3dOekk1TURJeE5EQXcKV2pCc01Rc3dDUVlEVlFRR0V3SlZVekVUTUJFR0ExVUVDQk1LUTJGc2FXWnZjbTVwWVRFV01CUUdBMVVFQnhNTgpVMkZ1SUVaeVlXNWphWE5qYnpFUE1BMEdBMVVFQ3hNR1kyeHBaVzUwTVI4d0hRWURWUVFEREJaQlpHMXBia0J2CmNtY3lMbVY0WVcxd2JHVXVZMjl0TUZrd0V3WUhLb1pJemowQ0FRWUlLb1pJemowREFRY0RRZ0FFZndwdkRmOHoKWVdVaWxwclcxQ2hsc3hBaDhVcjBLQXpUYm9oc0oyQjFNWk40ZkVUakhKTHRnWjZDT0ZRaVFoNy9BK1NyNVhYdApDRnpvNUZWSlNSNmc2YU5OTUVzd0RnWURWUjBQQVFIL0JBUURBZ2VBTUF3R0ExVWRFd0VCL3dRQ01BQXdLd1lEClZSMGpCQ1F3SW9BZ21RRjBZbjNvczlwUEhXQ01ra3U4VXUzYks0cmY1QUllUTYwUVgyNHh4cjh3Q2dZSUtvWkkKemowRUF3SURTQUF3UlFJaEFPVUZRWUMvZE1ZMGZ0U2JNYVFLL213Uy83a0JyRWZicXFNaHBwWjlqWG1uQWlCeQpjczdFalFuZHJ2RHRMZnVPUEY4QnJyVGZPdWZDTTVNN09YSDl4S2ZQdVE9PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg=="</span>,</span><br><span class="line">										<span class="attr">"mspid"</span>: <span class="string">"Org2MSP"</span></span><br><span class="line">									&#125;,</span><br><span class="line">									<span class="attr">"nonce"</span>: <span class="string">"5U3mT268xjTWiMCBXcO2+wEJcikv2YJj"</span></span><br><span class="line">								&#125;</span><br><span class="line">							&#125;</span><br><span class="line">						&#125;,</span><br><span class="line">						<span class="attr">"signature"</span>: <span class="string">"MEUCIQCpsp/8oaQEmtp5baG8ogkrXgP+unRtBIQzLgsVf9AlbQIgLrQ6mG1TyxMEdFtL1rjaLLj9iL3A/qzFSh3jTiUH7ME="</span></span><br><span class="line">					&#125;</span><br><span class="line">				&#125;,</span><br><span class="line">				<span class="attr">"header"</span>: &#123;</span><br><span class="line">					<span class="attr">"channel_header"</span>: &#123;</span><br><span class="line">						<span class="attr">"channel_id"</span>: <span class="string">"mychannel"</span>,</span><br><span class="line">						<span class="attr">"epoch"</span>: <span class="string">"0"</span>,</span><br><span class="line">						<span class="attr">"extension"</span>: <span class="literal">null</span>,</span><br><span class="line">						<span class="attr">"timestamp"</span>: <span class="string">"2019-08-01T02:19:01Z"</span>,</span><br><span class="line">						<span class="attr">"tls_cert_hash"</span>: <span class="literal">null</span>,</span><br><span class="line">						<span class="attr">"tx_id"</span>: <span class="string">""</span>,</span><br><span class="line">						<span class="attr">"type"</span>: <span class="number">1</span>,</span><br><span class="line">						<span class="attr">"version"</span>: <span class="number">0</span></span><br><span class="line">					&#125;,</span><br><span class="line">					<span class="attr">"signature_header"</span>: &#123;</span><br><span class="line">						<span class="attr">"creator"</span>: &#123;</span><br><span class="line">							<span class="attr">"id_bytes"</span>: <span class="string">"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNEVENDQWJPZ0F3SUJBZ0lSQU0rUFQ2YTJsYm1EY0NpNEVhTEFSeFl3Q2dZSUtvWkl6ajBFQXdJd2FURUwKTUFrR0ExVUVCaE1DVlZNeEV6QVJCZ05WQkFnVENrTmhiR2xtYjNKdWFXRXhGakFVQmdOVkJBY1REVk5oYmlCRwpjbUZ1WTJselkyOHhGREFTQmdOVkJBb1RDMlY0WVcxd2JHVXVZMjl0TVJjd0ZRWURWUVFERXc1allTNWxlR0Z0CmNHeGxMbU52YlRBZUZ3MHhPVEE0TURFd01qRTBNREJhRncweU9UQTNNamt3TWpFME1EQmFNRmd4Q3pBSkJnTlYKQkFZVEFsVlRNUk13RVFZRFZRUUlFd3BEWVd4cFptOXlibWxoTVJZd0ZBWURWUVFIRXcxVFlXNGdSbkpoYm1OcApjMk52TVJ3d0dnWURWUVFERXhOdmNtUmxjbVZ5TG1WNFlXMXdiR1V1WTI5dE1Ga3dFd1lIS29aSXpqMENBUVlJCktvWkl6ajBEQVFjRFFnQUVZVGcwdXZJMVZ0dEsrb2o2MG9LRjRtWlc4YlFXN0FIRFpZcFZueEdoTE5Kems2cmwKTU1uS0RiRmxibElETE9qK0tiakVwOW9WdEN6OVBsbk4xTmhHSEtOTk1Fc3dEZ1lEVlIwUEFRSC9CQVFEQWdlQQpNQXdHQTFVZEV3RUIvd1FDTUFBd0t3WURWUjBqQkNRd0lvQWdRSWtEMTlLWDFQc3VWUi9BQmVuZFM2ejY5cGxDCmNVNmc0aXUrdHFRL1hzQXdDZ1lJS29aSXpqMEVBd0lEU0FBd1JRSWhBTnd0cDQzMUdkYkdqb3pXRU1DQWdwNWIKeFdnMHNRMVlGbG9TYzF1MFFRU3FBaUF1TVNkc1AvMXZoclhVcGtoT1Voa3NwRjYrYVl1V2ozazZaVE84RWV3agpqdz09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K"</span>,</span><br><span class="line">							<span class="attr">"mspid"</span>: <span class="string">"OrdererMSP"</span></span><br><span class="line">						&#125;,</span><br><span class="line">						<span class="attr">"nonce"</span>: <span class="string">"6oiXowzUUpo6JFlSyB50x1Ma12ZoFUba"</span></span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="attr">"signature"</span>: <span class="string">"MEQCIBNyEeC+cWzOCLq9J9haktAwM3e+BBjNeEQc55xiB2yPAiAIF+KkWEh+RARJM/iA15JSfgvCP9zwgIrvSxO/Ki/KQQ=="</span></span><br><span class="line">		&#125;]</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">"header"</span>: &#123;</span><br><span class="line">		<span class="attr">"data_hash"</span>: <span class="string">"35xdxe58OecLRLqrdJREGDaw+XEVSDFvN4Vk8v/GNPA="</span>,</span><br><span class="line">		<span class="attr">"number"</span>: <span class="string">"2"</span>,</span><br><span class="line">		<span class="attr">"previous_hash"</span>: <span class="string">"6xJ0rP3gVYFZpwcBDW/i84IIkTi8Jj0cWBeX2GXsCUQ="</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">"metadata"</span>: &#123;</span><br><span class="line">		<span class="attr">"metadata"</span>: [</span><br><span class="line">			<span class="string">"CgQKAggCEv0GCrIGCpUGCgpPcmRlcmVyTVNQEoYGLS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNEVENDQWJPZ0F3SUJBZ0lSQU0rUFQ2YTJsYm1EY0NpNEVhTEFSeFl3Q2dZSUtvWkl6ajBFQXdJd2FURUwKTUFrR0ExVUVCaE1DVlZNeEV6QVJCZ05WQkFnVENrTmhiR2xtYjNKdWFXRXhGakFVQmdOVkJBY1REVk5oYmlCRwpjbUZ1WTJselkyOHhGREFTQmdOVkJBb1RDMlY0WVcxd2JHVXVZMjl0TVJjd0ZRWURWUVFERXc1allTNWxlR0Z0CmNHeGxMbU52YlRBZUZ3MHhPVEE0TURFd01qRTBNREJhRncweU9UQTNNamt3TWpFME1EQmFNRmd4Q3pBSkJnTlYKQkFZVEFsVlRNUk13RVFZRFZRUUlFd3BEWVd4cFptOXlibWxoTVJZd0ZBWURWUVFIRXcxVFlXNGdSbkpoYm1OcApjMk52TVJ3d0dnWURWUVFERXhOdmNtUmxjbVZ5TG1WNFlXMXdiR1V1WTI5dE1Ga3dFd1lIS29aSXpqMENBUVlJCktvWkl6ajBEQVFjRFFnQUVZVGcwdXZJMVZ0dEsrb2o2MG9LRjRtWlc4YlFXN0FIRFpZcFZueEdoTE5Kems2cmwKTU1uS0RiRmxibElETE9qK0tiakVwOW9WdEN6OVBsbk4xTmhHSEtOTk1Fc3dEZ1lEVlIwUEFRSC9CQVFEQWdlQQpNQXdHQTFVZEV3RUIvd1FDTUFBd0t3WURWUjBqQkNRd0lvQWdRSWtEMTlLWDFQc3VWUi9BQmVuZFM2ejY5cGxDCmNVNmc0aXUrdHFRL1hzQXdDZ1lJS29aSXpqMEVBd0lEU0FBd1JRSWhBTnd0cDQzMUdkYkdqb3pXRU1DQWdwNWIKeFdnMHNRMVlGbG9TYzF1MFFRU3FBaUF1TVNkc1AvMXZoclhVcGtoT1Voa3NwRjYrYVl1V2ozazZaVE84RWV3agpqdz09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0KEhig4rR9Ua6PViqus4vI1MI7T5OdGzlRTykSRjBEAiBI+JDzNh3q5fzUahojTbQkWxVBf+QksfhsRNdTtEVYfgIgJqbdOquXXkWQ8kB7xKjub/sfbX1Cnm2Vo2uHlSZAIG4="</span>,</span><br><span class="line">			<span class="string">"CgIIAg=="</span>,</span><br><span class="line">			<span class="string">"AA=="</span>,</span><br><span class="line">			<span class="string">""</span></span><br><span class="line">		]</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="应用通道普通区块"><a href="#应用通道普通区块" class="headerlink" title="应用通道普通区块"></a>应用通道普通区块</h3><p>普通区块指不修改配置的区块，里面包含2类交易：</p>
<ol>
<li>实例化链码的交易</li>
<li>调用链码的交易</li>
</ol>
<p>实例化实际Invoke的是LSCC，调用应用chaincode，也会先用到LSCC，再到应用chaincode，那么怎么区分当前到底是Invoke哪个chaincode？区块中的<code>chaincode_proposal_payload</code>，代表了当前操作的chaincode。</p>
<p><code>ns_rwset</code>是操作过程的读写集，包含LSCC和应用chaincode的。</p>
<h4 id="实例化chaincode"><a href="#实例化chaincode" class="headerlink" title="实例化chaincode"></a>实例化chaincode</h4><p><code>ns_rwset</code>包含2个<code>collection_hashed_rwset</code>：</p>
<ul>
<li>第1个：说明了当前操作的是lscc，读<code>mycc</code>没结果，然后把<code>mycc</code>放到写集，这是创建合约的典型过程。</li>
<li>第2个：是进行chaincode的初始化，也是只写入，这里是设置a和b的值。</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"data"</span>: &#123;</span><br><span class="line">		<span class="attr">"data"</span>: [&#123;</span><br><span class="line">			<span class="attr">"payload"</span>: &#123;</span><br><span class="line">				<span class="attr">"data"</span>: &#123;</span><br><span class="line">					<span class="attr">"actions"</span>: [&#123;</span><br><span class="line">						<span class="attr">"header"</span>: &#123;</span><br><span class="line">							<span class="attr">"creator"</span>: &#123;</span><br><span class="line">								<span class="attr">"id_bytes"</span>: <span class="string">"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNLekNDQWRHZ0F3SUJBZ0lSQUo5YnI3UHJmQWg5cHVVcDFMZkJ3V0V3Q2dZSUtvWkl6ajBFQXdJd2N6RUwKTUFrR0ExVUVCaE1DVlZNeEV6QVJCZ05WQkFnVENrTmhiR2xtYjNKdWFXRXhGakFVQmdOVkJBY1REVk5oYmlCRwpjbUZ1WTJselkyOHhHVEFYQmdOVkJBb1RFRzl5WnpJdVpYaGhiWEJzWlM1amIyMHhIREFhQmdOVkJBTVRFMk5oCkxtOXlaekl1WlhoaGJYQnNaUzVqYjIwd0hoY05NVGt3T0RBeE1ESXhOREF3V2hjTk1qa3dOekk1TURJeE5EQXcKV2pCc01Rc3dDUVlEVlFRR0V3SlZVekVUTUJFR0ExVUVDQk1LUTJGc2FXWnZjbTVwWVRFV01CUUdBMVVFQnhNTgpVMkZ1SUVaeVlXNWphWE5qYnpFUE1BMEdBMVVFQ3hNR1kyeHBaVzUwTVI4d0hRWURWUVFEREJaQlpHMXBia0J2CmNtY3lMbVY0WVcxd2JHVXVZMjl0TUZrd0V3WUhLb1pJemowQ0FRWUlLb1pJemowREFRY0RRZ0FFZndwdkRmOHoKWVdVaWxwclcxQ2hsc3hBaDhVcjBLQXpUYm9oc0oyQjFNWk40ZkVUakhKTHRnWjZDT0ZRaVFoNy9BK1NyNVhYdApDRnpvNUZWSlNSNmc2YU5OTUVzd0RnWURWUjBQQVFIL0JBUURBZ2VBTUF3R0ExVWRFd0VCL3dRQ01BQXdLd1lEClZSMGpCQ1F3SW9BZ21RRjBZbjNvczlwUEhXQ01ra3U4VXUzYks0cmY1QUllUTYwUVgyNHh4cjh3Q2dZSUtvWkkKemowRUF3SURTQUF3UlFJaEFPVUZRWUMvZE1ZMGZ0U2JNYVFLL213Uy83a0JyRWZicXFNaHBwWjlqWG1uQWlCeQpjczdFalFuZHJ2RHRMZnVPUEY4QnJyVGZPdWZDTTVNN09YSDl4S2ZQdVE9PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg=="</span>,</span><br><span class="line">								<span class="attr">"mspid"</span>: <span class="string">"Org2MSP"</span></span><br><span class="line">							&#125;,</span><br><span class="line">							<span class="attr">"nonce"</span>: <span class="string">"CLJ2euIe3YSE7LhNiTuXdBCS2DnvabH2"</span></span><br><span class="line">						&#125;,</span><br><span class="line">						<span class="attr">"payload"</span>: &#123;</span><br><span class="line">							<span class="attr">"action"</span>: &#123;</span><br><span class="line">								<span class="attr">"endorsements"</span>: [&#123;</span><br><span class="line">									<span class="attr">"endorser"</span>: <span class="string">"CgdPcmcyTVNQEqYGLS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNKekNDQWM2Z0F3SUJBZ0lRVHA5QTREM25oa2NJaVdXRk4xRUZQakFLQmdncWhrak9QUVFEQWpCek1Rc3cKQ1FZRFZRUUdFd0pWVXpFVE1CRUdBMVVFQ0JNS1EyRnNhV1p2Y201cFlURVdNQlFHQTFVRUJ4TU5VMkZ1SUVaeQpZVzVqYVhOamJ6RVpNQmNHQTFVRUNoTVFiM0puTWk1bGVHRnRjR3hsTG1OdmJURWNNQm9HQTFVRUF4TVRZMkV1CmIzSm5NaTVsZUdGdGNHeGxMbU52YlRBZUZ3MHhPVEE0TURFd01qRTBNREJhRncweU9UQTNNamt3TWpFME1EQmEKTUdveEN6QUpCZ05WQkFZVEFsVlRNUk13RVFZRFZRUUlFd3BEWVd4cFptOXlibWxoTVJZd0ZBWURWUVFIRXcxVApZVzRnUm5KaGJtTnBjMk52TVEwd0N3WURWUVFMRXdSd1pXVnlNUjh3SFFZRFZRUURFeFp3WldWeU1DNXZjbWN5CkxtVjRZVzF3YkdVdVkyOXRNRmt3RXdZSEtvWkl6ajBDQVFZSUtvWkl6ajBEQVFjRFFnQUVSRjBFV0NuQW5oMm8KcnFFazhmRTlLdEFCdmJIc1FYTHhMRnZZdlZYVlFPS1crVDBpVk44eWdQbTZlM0kxcG5FTS9hK3Vha2dtYWNmOApzVnVZVERMSythTk5NRXN3RGdZRFZSMFBBUUgvQkFRREFnZUFNQXdHQTFVZEV3RUIvd1FDTUFBd0t3WURWUjBqCkJDUXdJb0FnbVFGMFluM29zOXBQSFdDTWtrdThVdTNiSzRyZjVBSWVRNjBRWDI0eHhyOHdDZ1lJS29aSXpqMEUKQXdJRFJ3QXdSQUlnVTMwdllnVHpCYS84ZGFaZlpBYThzLzN3RFdZdlRpL1BEY3RuWFJBT043QUNJQmNvQzlXSgpYK28rdHFUUDZybS8vdWxpUU02Rk53cUtBSDlYQWxOcVdhbWsKLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo="</span>,</span><br><span class="line">									<span class="attr">"signature"</span>: <span class="string">"MEUCIQCRu+F6XBVrfy24JtxuAiy9+3PNYy6tRmKDmgtmGx0OLAIgQeMPTKzPhh9fH39tmZEDjJCGet/ob2BzbRExZIYq2po="</span></span><br><span class="line">								&#125;],</span><br><span class="line">								<span class="attr">"proposal_response_payload"</span>: &#123;</span><br><span class="line">									<span class="attr">"extension"</span>: &#123;</span><br><span class="line">										<span class="attr">"chaincode_id"</span>: &#123;</span><br><span class="line">											<span class="attr">"name"</span>: <span class="string">"lscc"</span>,</span><br><span class="line">											<span class="attr">"path"</span>: <span class="string">""</span>,</span><br><span class="line">											<span class="attr">"version"</span>: <span class="string">"1.4.2"</span></span><br><span class="line">										&#125;,</span><br><span class="line">										<span class="attr">"events"</span>: <span class="literal">null</span>,</span><br><span class="line">										<span class="attr">"response"</span>: &#123;</span><br><span class="line">											<span class="attr">"message"</span>: <span class="string">""</span>,</span><br><span class="line">											<span class="attr">"payload"</span>: <span class="string">"CgRteWNjEgMxLjAaBGVzY2MiBHZzY2MqLBIMEgoIAhICCAASAggBGg0SCwoHT3JnMU1TUBADGg0SCwoHT3JnMk1TUBADMkQKIJJH+4JOIdCHD/55PPBgJOZehvHg5Ytk6QxbGU9uNzQAEiAHHxQpHhUrsq6I5/355ad00xNha6MVSoT2oNRaF19jJjogR2/KGpSSdAAZcfHsKDbLCTIfC3Emizdi1okxyT8hgTRCLBIMEgoIARICCAASAggBGg0SCwoHT3JnMU1TUBABGg0SCwoHT3JnMk1TUBAB"</span>,</span><br><span class="line">											<span class="attr">"status"</span>: <span class="number">200</span></span><br><span class="line">										&#125;,</span><br><span class="line">										<span class="attr">"results"</span>: &#123;</span><br><span class="line">											<span class="attr">"data_model"</span>: <span class="string">"KV"</span>,</span><br><span class="line">											<span class="attr">"ns_rwset"</span>: [&#123;</span><br><span class="line">													<span class="attr">"collection_hashed_rwset"</span>: [],</span><br><span class="line">													<span class="attr">"namespace"</span>: <span class="string">"lscc"</span>,</span><br><span class="line">													<span class="attr">"rwset"</span>: &#123;</span><br><span class="line">														<span class="attr">"metadata_writes"</span>: [],</span><br><span class="line">														<span class="attr">"range_queries_info"</span>: [],</span><br><span class="line">														<span class="attr">"reads"</span>: [&#123;</span><br><span class="line">															<span class="attr">"key"</span>: <span class="string">"mycc"</span>,</span><br><span class="line">															<span class="attr">"version"</span>: <span class="literal">null</span></span><br><span class="line">														&#125;],</span><br><span class="line">														<span class="attr">"writes"</span>: [&#123;</span><br><span class="line">															<span class="attr">"is_delete"</span>: <span class="literal">false</span>,</span><br><span class="line">															<span class="attr">"key"</span>: <span class="string">"mycc"</span>,</span><br><span class="line">															<span class="attr">"value"</span>: <span class="string">"CgRteWNjEgMxLjAaBGVzY2MiBHZzY2MqLBIMEgoIAhICCAASAggBGg0SCwoHT3JnMU1TUBADGg0SCwoHT3JnMk1TUBADMkQKIJJH+4JOIdCHD/55PPBgJOZehvHg5Ytk6QxbGU9uNzQAEiAHHxQpHhUrsq6I5/355ad00xNha6MVSoT2oNRaF19jJjogR2/KGpSSdAAZcfHsKDbLCTIfC3Emizdi1okxyT8hgTRCLBIMEgoIARICCAASAggBGg0SCwoHT3JnMU1TUBABGg0SCwoHT3JnMk1TUBAB"</span></span><br><span class="line">														&#125;]</span><br><span class="line">													&#125;</span><br><span class="line">												&#125;,</span><br><span class="line">												&#123;</span><br><span class="line">													<span class="attr">"collection_hashed_rwset"</span>: [],</span><br><span class="line">													<span class="attr">"namespace"</span>: <span class="string">"mycc"</span>,</span><br><span class="line">													<span class="attr">"rwset"</span>: &#123;</span><br><span class="line">														<span class="attr">"metadata_writes"</span>: [],</span><br><span class="line">														<span class="attr">"range_queries_info"</span>: [],</span><br><span class="line">														<span class="attr">"reads"</span>: [],</span><br><span class="line">														<span class="attr">"writes"</span>: [&#123;</span><br><span class="line">																<span class="attr">"is_delete"</span>: <span class="literal">false</span>,</span><br><span class="line">																<span class="attr">"key"</span>: <span class="string">"a"</span>,</span><br><span class="line">																<span class="attr">"value"</span>: <span class="string">"MTAw"</span></span><br><span class="line">															&#125;,</span><br><span class="line">															&#123;</span><br><span class="line">																<span class="attr">"is_delete"</span>: <span class="literal">false</span>,</span><br><span class="line">																<span class="attr">"key"</span>: <span class="string">"b"</span>,</span><br><span class="line">																<span class="attr">"value"</span>: <span class="string">"MjAw"</span></span><br><span class="line">															&#125;</span><br><span class="line">														]</span><br><span class="line">													&#125;</span><br><span class="line">												&#125;</span><br><span class="line">											]</span><br><span class="line">										&#125;,</span><br><span class="line">										<span class="attr">"token_expectation"</span>: <span class="literal">null</span></span><br><span class="line">									&#125;,</span><br><span class="line">									<span class="attr">"proposal_hash"</span>: <span class="string">"QFsKOSAIcsdRQ/3UYkYrUuK36Apj4iulCKW/LKmtAAs="</span></span><br><span class="line">								&#125;</span><br><span class="line">							&#125;,</span><br><span class="line">							<span class="attr">"chaincode_proposal_payload"</span>: &#123;</span><br><span class="line">								<span class="attr">"TransientMap"</span>: &#123;&#125;,</span><br><span class="line">								<span class="attr">"input"</span>: &#123;</span><br><span class="line">									<span class="attr">"chaincode_spec"</span>: &#123;</span><br><span class="line">										<span class="attr">"chaincode_id"</span>: &#123;</span><br><span class="line">											<span class="attr">"name"</span>: <span class="string">"lscc"</span>,</span><br><span class="line">											<span class="attr">"path"</span>: <span class="string">""</span>,</span><br><span class="line">											<span class="attr">"version"</span>: <span class="string">""</span></span><br><span class="line">										&#125;,</span><br><span class="line">										<span class="attr">"input"</span>: &#123;</span><br><span class="line">											<span class="attr">"args"</span>: [</span><br><span class="line">												<span class="string">"ZGVwbG95"</span>,</span><br><span class="line">												<span class="string">"bXljaGFubmVs"</span>,</span><br><span class="line">												<span class="string">"CicIARILEgRteWNjGgMxLjAaFgoEaW5pdAoBYQoDMTAwCgFiCgMyMDA="</span>,</span><br><span class="line">												<span class="string">"EgwSCggCEgIIABICCAEaDRILCgdPcmcxTVNQEAMaDRILCgdPcmcyTVNQEAM="</span>,</span><br><span class="line">												<span class="string">"ZXNjYw=="</span>,</span><br><span class="line">												<span class="string">"dnNjYw=="</span></span><br><span class="line">											],</span><br><span class="line">											<span class="attr">"decorations"</span>: &#123;&#125;</span><br><span class="line">										&#125;,</span><br><span class="line">										<span class="attr">"timeout"</span>: <span class="number">0</span>,</span><br><span class="line">										<span class="attr">"type"</span>: <span class="string">"GOLANG"</span></span><br><span class="line">									&#125;</span><br><span class="line">								&#125;</span><br><span class="line">							&#125;</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;]</span><br><span class="line">				&#125;,</span><br><span class="line">				<span class="attr">"header"</span>: &#123;</span><br><span class="line">					<span class="attr">"channel_header"</span>: &#123;</span><br><span class="line">						<span class="attr">"channel_id"</span>: <span class="string">"mychannel"</span>,</span><br><span class="line">						<span class="attr">"epoch"</span>: <span class="string">"0"</span>,</span><br><span class="line">						<span class="attr">"extension"</span>: <span class="string">"EgYSBGxzY2M="</span>,</span><br><span class="line">						<span class="attr">"timestamp"</span>: <span class="string">"2019-08-01T02:19:04.887742126Z"</span>,</span><br><span class="line">						<span class="attr">"tls_cert_hash"</span>: <span class="literal">null</span>,</span><br><span class="line">						<span class="attr">"tx_id"</span>: <span class="string">"91c8e4c4e6c91db19eb8e40f95e2b29cea3d916b2a3249459b9fa83b44fc445a"</span>,</span><br><span class="line">						<span class="attr">"type"</span>: <span class="number">3</span>,</span><br><span class="line">						<span class="attr">"version"</span>: <span class="number">0</span></span><br><span class="line">					&#125;,</span><br><span class="line">					<span class="attr">"signature_header"</span>: &#123;</span><br><span class="line">						<span class="attr">"creator"</span>: &#123;</span><br><span class="line">							<span class="attr">"id_bytes"</span>: <span class="string">"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNLekNDQWRHZ0F3SUJBZ0lSQUo5YnI3UHJmQWg5cHVVcDFMZkJ3V0V3Q2dZSUtvWkl6ajBFQXdJd2N6RUwKTUFrR0ExVUVCaE1DVlZNeEV6QVJCZ05WQkFnVENrTmhiR2xtYjNKdWFXRXhGakFVQmdOVkJBY1REVk5oYmlCRwpjbUZ1WTJselkyOHhHVEFYQmdOVkJBb1RFRzl5WnpJdVpYaGhiWEJzWlM1amIyMHhIREFhQmdOVkJBTVRFMk5oCkxtOXlaekl1WlhoaGJYQnNaUzVqYjIwd0hoY05NVGt3T0RBeE1ESXhOREF3V2hjTk1qa3dOekk1TURJeE5EQXcKV2pCc01Rc3dDUVlEVlFRR0V3SlZVekVUTUJFR0ExVUVDQk1LUTJGc2FXWnZjbTVwWVRFV01CUUdBMVVFQnhNTgpVMkZ1SUVaeVlXNWphWE5qYnpFUE1BMEdBMVVFQ3hNR1kyeHBaVzUwTVI4d0hRWURWUVFEREJaQlpHMXBia0J2CmNtY3lMbVY0WVcxd2JHVXVZMjl0TUZrd0V3WUhLb1pJemowQ0FRWUlLb1pJemowREFRY0RRZ0FFZndwdkRmOHoKWVdVaWxwclcxQ2hsc3hBaDhVcjBLQXpUYm9oc0oyQjFNWk40ZkVUakhKTHRnWjZDT0ZRaVFoNy9BK1NyNVhYdApDRnpvNUZWSlNSNmc2YU5OTUVzd0RnWURWUjBQQVFIL0JBUURBZ2VBTUF3R0ExVWRFd0VCL3dRQ01BQXdLd1lEClZSMGpCQ1F3SW9BZ21RRjBZbjNvczlwUEhXQ01ra3U4VXUzYks0cmY1QUllUTYwUVgyNHh4cjh3Q2dZSUtvWkkKemowRUF3SURTQUF3UlFJaEFPVUZRWUMvZE1ZMGZ0U2JNYVFLL213Uy83a0JyRWZicXFNaHBwWjlqWG1uQWlCeQpjczdFalFuZHJ2RHRMZnVPUEY4QnJyVGZPdWZDTTVNN09YSDl4S2ZQdVE9PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg=="</span>,</span><br><span class="line">							<span class="attr">"mspid"</span>: <span class="string">"Org2MSP"</span></span><br><span class="line">						&#125;,</span><br><span class="line">						<span class="attr">"nonce"</span>: <span class="string">"CLJ2euIe3YSE7LhNiTuXdBCS2DnvabH2"</span></span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="attr">"signature"</span>: <span class="string">"MEUCIQD0jJ2zDEbsKIi8ekG3E5xF//EddpMJdKL5nF0anvHp7QIgTNsEJk3N344hq4fklJn/c0fVojzeos4t4w17r7VOJSg="</span></span><br><span class="line">		&#125;]</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">"header"</span>: &#123;</span><br><span class="line">		<span class="attr">"data_hash"</span>: <span class="string">"w8fXJmELmqvXJAWXPge6oCH0SxwoR4nube3o//fYz4A="</span>,</span><br><span class="line">		<span class="attr">"number"</span>: <span class="string">"3"</span>,</span><br><span class="line">		<span class="attr">"previous_hash"</span>: <span class="string">"qpUWyIdR36SuQa/xqGEnwm1wjpaQxIeU8aaA8RFeN/8="</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">"metadata"</span>: &#123;</span><br><span class="line">		<span class="attr">"metadata"</span>: [</span><br><span class="line">			<span class="string">"CgQKAggCEv0GCrIGCpUGCgpPcmRlcmVyTVNQEoYGLS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNEVENDQWJPZ0F3SUJBZ0lSQU0rUFQ2YTJsYm1EY0NpNEVhTEFSeFl3Q2dZSUtvWkl6ajBFQXdJd2FURUwKTUFrR0ExVUVCaE1DVlZNeEV6QVJCZ05WQkFnVENrTmhiR2xtYjNKdWFXRXhGakFVQmdOVkJBY1REVk5oYmlCRwpjbUZ1WTJselkyOHhGREFTQmdOVkJBb1RDMlY0WVcxd2JHVXVZMjl0TVJjd0ZRWURWUVFERXc1allTNWxlR0Z0CmNHeGxMbU52YlRBZUZ3MHhPVEE0TURFd01qRTBNREJhRncweU9UQTNNamt3TWpFME1EQmFNRmd4Q3pBSkJnTlYKQkFZVEFsVlRNUk13RVFZRFZRUUlFd3BEWVd4cFptOXlibWxoTVJZd0ZBWURWUVFIRXcxVFlXNGdSbkpoYm1OcApjMk52TVJ3d0dnWURWUVFERXhOdmNtUmxjbVZ5TG1WNFlXMXdiR1V1WTI5dE1Ga3dFd1lIS29aSXpqMENBUVlJCktvWkl6ajBEQVFjRFFnQUVZVGcwdXZJMVZ0dEsrb2o2MG9LRjRtWlc4YlFXN0FIRFpZcFZueEdoTE5Kems2cmwKTU1uS0RiRmxibElETE9qK0tiakVwOW9WdEN6OVBsbk4xTmhHSEtOTk1Fc3dEZ1lEVlIwUEFRSC9CQVFEQWdlQQpNQXdHQTFVZEV3RUIvd1FDTUFBd0t3WURWUjBqQkNRd0lvQWdRSWtEMTlLWDFQc3VWUi9BQmVuZFM2ejY5cGxDCmNVNmc0aXUrdHFRL1hzQXdDZ1lJS29aSXpqMEVBd0lEU0FBd1JRSWhBTnd0cDQzMUdkYkdqb3pXRU1DQWdwNWIKeFdnMHNRMVlGbG9TYzF1MFFRU3FBaUF1TVNkc1AvMXZoclhVcGtoT1Voa3NwRjYrYVl1V2ozazZaVE84RWV3agpqdz09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0KEhjerftAXzK8sFOlQ17D0d7A0oP73xf29PkSRjBEAiAp7vqkuMOhC4XzOjwov/HlydZHpMgKuVfeBITm8T752AIgDl9dQHLeaLXEmjFXgv+38H1tFgv/ohHNxdraFexmlrg="</span>,</span><br><span class="line">			<span class="string">"CgIIAg=="</span>,</span><br><span class="line">			<span class="string">"AA=="</span>,</span><br><span class="line">			<span class="string">""</span></span><br><span class="line">		]</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="调用chaincode"><a href="#调用chaincode" class="headerlink" title="调用chaincode"></a>调用chaincode</h4><p><code>ns_rwset</code>包含2个<code>collection_hashed_rwset</code>：</p>
<ul>
<li>第1个：说明了当前操作的是lscc，从区块3里把mycc读取出来。</li>
<li>第2个：说明操作的是mycc，先把a和b读取出来，然后又把a和b的结果写回mycc。</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"data"</span>: &#123;</span><br><span class="line">		<span class="attr">"data"</span>: [&#123;</span><br><span class="line">			<span class="attr">"payload"</span>: &#123;</span><br><span class="line">				<span class="attr">"data"</span>: &#123;</span><br><span class="line">					<span class="attr">"actions"</span>: [&#123;</span><br><span class="line">						<span class="attr">"header"</span>: &#123;</span><br><span class="line">							<span class="attr">"creator"</span>: &#123;</span><br><span class="line">								<span class="attr">"id_bytes"</span>: <span class="string">"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNLekNDQWRHZ0F3SUJBZ0lSQUo5YnI3UHJmQWg5cHVVcDFMZkJ3V0V3Q2dZSUtvWkl6ajBFQXdJd2N6RUwKTUFrR0ExVUVCaE1DVlZNeEV6QVJCZ05WQkFnVENrTmhiR2xtYjNKdWFXRXhGakFVQmdOVkJBY1REVk5oYmlCRwpjbUZ1WTJselkyOHhHVEFYQmdOVkJBb1RFRzl5WnpJdVpYaGhiWEJzWlM1amIyMHhIREFhQmdOVkJBTVRFMk5oCkxtOXlaekl1WlhoaGJYQnNaUzVqYjIwd0hoY05NVGt3T0RBeE1ESXhOREF3V2hjTk1qa3dOekk1TURJeE5EQXcKV2pCc01Rc3dDUVlEVlFRR0V3SlZVekVUTUJFR0ExVUVDQk1LUTJGc2FXWnZjbTVwWVRFV01CUUdBMVVFQnhNTgpVMkZ1SUVaeVlXNWphWE5qYnpFUE1BMEdBMVVFQ3hNR1kyeHBaVzUwTVI4d0hRWURWUVFEREJaQlpHMXBia0J2CmNtY3lMbVY0WVcxd2JHVXVZMjl0TUZrd0V3WUhLb1pJemowQ0FRWUlLb1pJemowREFRY0RRZ0FFZndwdkRmOHoKWVdVaWxwclcxQ2hsc3hBaDhVcjBLQXpUYm9oc0oyQjFNWk40ZkVUakhKTHRnWjZDT0ZRaVFoNy9BK1NyNVhYdApDRnpvNUZWSlNSNmc2YU5OTUVzd0RnWURWUjBQQVFIL0JBUURBZ2VBTUF3R0ExVWRFd0VCL3dRQ01BQXdLd1lEClZSMGpCQ1F3SW9BZ21RRjBZbjNvczlwUEhXQ01ra3U4VXUzYks0cmY1QUllUTYwUVgyNHh4cjh3Q2dZSUtvWkkKemowRUF3SURTQUF3UlFJaEFPVUZRWUMvZE1ZMGZ0U2JNYVFLL213Uy83a0JyRWZicXFNaHBwWjlqWG1uQWlCeQpjczdFalFuZHJ2RHRMZnVPUEY4QnJyVGZPdWZDTTVNN09YSDl4S2ZQdVE9PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg=="</span>,</span><br><span class="line">								<span class="attr">"mspid"</span>: <span class="string">"Org2MSP"</span></span><br><span class="line">							&#125;,</span><br><span class="line">							<span class="attr">"nonce"</span>: <span class="string">"6Z4RNNIV085Nv/pOYUc5W3EaWcBueAAs"</span></span><br><span class="line">						&#125;,</span><br><span class="line">						<span class="attr">"payload"</span>: &#123;</span><br><span class="line">							<span class="attr">"action"</span>: &#123;</span><br><span class="line">								<span class="attr">"endorsements"</span>: [&#123;</span><br><span class="line">										<span class="attr">"endorser"</span>: <span class="string">"CgdPcmcxTVNQEqYGLS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNKekNDQWM2Z0F3SUJBZ0lRVTlaQzNZWEVySzEybHlSRmx2VW1DREFLQmdncWhrak9QUVFEQWpCek1Rc3cKQ1FZRFZRUUdFd0pWVXpFVE1CRUdBMVVFQ0JNS1EyRnNhV1p2Y201cFlURVdNQlFHQTFVRUJ4TU5VMkZ1SUVaeQpZVzVqYVhOamJ6RVpNQmNHQTFVRUNoTVFiM0puTVM1bGVHRnRjR3hsTG1OdmJURWNNQm9HQTFVRUF4TVRZMkV1CmIzSm5NUzVsZUdGdGNHeGxMbU52YlRBZUZ3MHhPVEE0TURFd01qRTBNREJhRncweU9UQTNNamt3TWpFME1EQmEKTUdveEN6QUpCZ05WQkFZVEFsVlRNUk13RVFZRFZRUUlFd3BEWVd4cFptOXlibWxoTVJZd0ZBWURWUVFIRXcxVApZVzRnUm5KaGJtTnBjMk52TVEwd0N3WURWUVFMRXdSd1pXVnlNUjh3SFFZRFZRUURFeFp3WldWeU1DNXZjbWN4CkxtVjRZVzF3YkdVdVkyOXRNRmt3RXdZSEtvWkl6ajBDQVFZSUtvWkl6ajBEQVFjRFFnQUVGdnVqVG5lMXYyRk4KVENxOTI4WlZrSlhheXRNbVlZcnJ2dndoMEV4b1VVZU1yRjRueU9hZjBRcUo4NjZKeTNibFNQL0xDZFJqOElzdwprdzZmNFBDdEE2Tk5NRXN3RGdZRFZSMFBBUUgvQkFRREFnZUFNQXdHQTFVZEV3RUIvd1FDTUFBd0t3WURWUjBqCkJDUXdJb0FnVkJwVFZxMVBIblR6b3lmdGh1OTN0a2tBNytWN1ZOeUgvaU5nOW8vRklCQXdDZ1lJS29aSXpqMEUKQXdJRFJ3QXdSQUlnSCtpTHF0THQ4WGYwSzNSVHNZUVJLNFIyY05hMXNSV3BVd05QYkxEdzFZd0NJRTg4c2kyTgprZkMvTzB6SkhDandhdFR1aDFVbEt4eFc4OU16aWx3aXJjWnEKLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo="</span>,</span><br><span class="line">										<span class="attr">"signature"</span>: <span class="string">"MEQCIEnnXFAiBoxqlqgTRs9aBW5PWv+uyjHEEi1XGWXbX0aaAiBEteVfQu7352r5zokdeKdG5+K5LF+IiAbR+QOomOjF1Q=="</span></span><br><span class="line">									&#125;,</span><br><span class="line">									&#123;</span><br><span class="line">										<span class="attr">"endorser"</span>: <span class="string">"CgdPcmcyTVNQEqYGLS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNKekNDQWM2Z0F3SUJBZ0lRVHA5QTREM25oa2NJaVdXRk4xRUZQakFLQmdncWhrak9QUVFEQWpCek1Rc3cKQ1FZRFZRUUdFd0pWVXpFVE1CRUdBMVVFQ0JNS1EyRnNhV1p2Y201cFlURVdNQlFHQTFVRUJ4TU5VMkZ1SUVaeQpZVzVqYVhOamJ6RVpNQmNHQTFVRUNoTVFiM0puTWk1bGVHRnRjR3hsTG1OdmJURWNNQm9HQTFVRUF4TVRZMkV1CmIzSm5NaTVsZUdGdGNHeGxMbU52YlRBZUZ3MHhPVEE0TURFd01qRTBNREJhRncweU9UQTNNamt3TWpFME1EQmEKTUdveEN6QUpCZ05WQkFZVEFsVlRNUk13RVFZRFZRUUlFd3BEWVd4cFptOXlibWxoTVJZd0ZBWURWUVFIRXcxVApZVzRnUm5KaGJtTnBjMk52TVEwd0N3WURWUVFMRXdSd1pXVnlNUjh3SFFZRFZRUURFeFp3WldWeU1DNXZjbWN5CkxtVjRZVzF3YkdVdVkyOXRNRmt3RXdZSEtvWkl6ajBDQVFZSUtvWkl6ajBEQVFjRFFnQUVSRjBFV0NuQW5oMm8KcnFFazhmRTlLdEFCdmJIc1FYTHhMRnZZdlZYVlFPS1crVDBpVk44eWdQbTZlM0kxcG5FTS9hK3Vha2dtYWNmOApzVnVZVERMSythTk5NRXN3RGdZRFZSMFBBUUgvQkFRREFnZUFNQXdHQTFVZEV3RUIvd1FDTUFBd0t3WURWUjBqCkJDUXdJb0FnbVFGMFluM29zOXBQSFdDTWtrdThVdTNiSzRyZjVBSWVRNjBRWDI0eHhyOHdDZ1lJS29aSXpqMEUKQXdJRFJ3QXdSQUlnVTMwdllnVHpCYS84ZGFaZlpBYThzLzN3RFdZdlRpL1BEY3RuWFJBT043QUNJQmNvQzlXSgpYK28rdHFUUDZybS8vdWxpUU02Rk53cUtBSDlYQWxOcVdhbWsKLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo="</span>,</span><br><span class="line">										<span class="attr">"signature"</span>: <span class="string">"MEUCIQCKz1zIddnNjjoGnzSTuxvVy19TvQSlONS4C9Y3iaJhaAIgY+Zpl003I0X/FsH8+ekifXvugeHCPeZ3UhkO90MWg3U="</span></span><br><span class="line">									&#125;</span><br><span class="line">								],</span><br><span class="line">								<span class="attr">"proposal_response_payload"</span>: &#123;</span><br><span class="line">									<span class="attr">"extension"</span>: &#123;</span><br><span class="line">										<span class="attr">"chaincode_id"</span>: &#123;</span><br><span class="line">											<span class="attr">"name"</span>: <span class="string">"mycc"</span>,</span><br><span class="line">											<span class="attr">"path"</span>: <span class="string">""</span>,</span><br><span class="line">											<span class="attr">"version"</span>: <span class="string">"1.0"</span></span><br><span class="line">										&#125;,</span><br><span class="line">										<span class="attr">"events"</span>: <span class="literal">null</span>,</span><br><span class="line">										<span class="attr">"response"</span>: &#123;</span><br><span class="line">											<span class="attr">"message"</span>: <span class="string">""</span>,</span><br><span class="line">											<span class="attr">"payload"</span>: <span class="literal">null</span>,</span><br><span class="line">											<span class="attr">"status"</span>: <span class="number">200</span></span><br><span class="line">										&#125;,</span><br><span class="line">										<span class="attr">"results"</span>: &#123;</span><br><span class="line">											<span class="attr">"data_model"</span>: <span class="string">"KV"</span>,</span><br><span class="line">											<span class="attr">"ns_rwset"</span>: [&#123;</span><br><span class="line">													<span class="attr">"collection_hashed_rwset"</span>: [],</span><br><span class="line">													<span class="attr">"namespace"</span>: <span class="string">"lscc"</span>,</span><br><span class="line">													<span class="attr">"rwset"</span>: &#123;</span><br><span class="line">														<span class="attr">"metadata_writes"</span>: [],</span><br><span class="line">														<span class="attr">"range_queries_info"</span>: [],</span><br><span class="line">														<span class="attr">"reads"</span>: [&#123;</span><br><span class="line">															<span class="attr">"key"</span>: <span class="string">"mycc"</span>,</span><br><span class="line">															<span class="attr">"version"</span>: &#123;</span><br><span class="line">																<span class="attr">"block_num"</span>: <span class="string">"3"</span>,</span><br><span class="line">																<span class="attr">"tx_num"</span>: <span class="string">"0"</span></span><br><span class="line">															&#125;</span><br><span class="line">														&#125;],</span><br><span class="line">														<span class="attr">"writes"</span>: []</span><br><span class="line">													&#125;</span><br><span class="line">												&#125;,</span><br><span class="line">												&#123;</span><br><span class="line">													<span class="attr">"collection_hashed_rwset"</span>: [],</span><br><span class="line">													<span class="attr">"namespace"</span>: <span class="string">"mycc"</span>,</span><br><span class="line">													<span class="attr">"rwset"</span>: &#123;</span><br><span class="line">														<span class="attr">"metadata_writes"</span>: [],</span><br><span class="line">														<span class="attr">"range_queries_info"</span>: [],</span><br><span class="line">														<span class="attr">"reads"</span>: [&#123;</span><br><span class="line">																<span class="attr">"key"</span>: <span class="string">"a"</span>,</span><br><span class="line">																<span class="attr">"version"</span>: &#123;</span><br><span class="line">																	<span class="attr">"block_num"</span>: <span class="string">"3"</span>,</span><br><span class="line">																	<span class="attr">"tx_num"</span>: <span class="string">"0"</span></span><br><span class="line">																&#125;</span><br><span class="line">															&#125;,</span><br><span class="line">															&#123;</span><br><span class="line">																<span class="attr">"key"</span>: <span class="string">"b"</span>,</span><br><span class="line">																<span class="attr">"version"</span>: &#123;</span><br><span class="line">																	<span class="attr">"block_num"</span>: <span class="string">"3"</span>,</span><br><span class="line">																	<span class="attr">"tx_num"</span>: <span class="string">"0"</span></span><br><span class="line">																&#125;</span><br><span class="line">															&#125;</span><br><span class="line">														],</span><br><span class="line">														<span class="attr">"writes"</span>: [&#123;</span><br><span class="line">																<span class="attr">"is_delete"</span>: <span class="literal">false</span>,</span><br><span class="line">																<span class="attr">"key"</span>: <span class="string">"a"</span>,</span><br><span class="line">																<span class="attr">"value"</span>: <span class="string">"OTA="</span></span><br><span class="line">															&#125;,</span><br><span class="line">															&#123;</span><br><span class="line">																<span class="attr">"is_delete"</span>: <span class="literal">false</span>,</span><br><span class="line">																<span class="attr">"key"</span>: <span class="string">"b"</span>,</span><br><span class="line">																<span class="attr">"value"</span>: <span class="string">"MjEw"</span></span><br><span class="line">															&#125;</span><br><span class="line">														]</span><br><span class="line">													&#125;</span><br><span class="line">												&#125;</span><br><span class="line">											]</span><br><span class="line">										&#125;,</span><br><span class="line">										<span class="attr">"token_expectation"</span>: <span class="literal">null</span></span><br><span class="line">									&#125;,</span><br><span class="line">									<span class="attr">"proposal_hash"</span>: <span class="string">"okKS/G4+W9VT9+t6VXJnAClnPvOhtUkiCdqjPmzkqjI="</span></span><br><span class="line">								&#125;</span><br><span class="line">							&#125;,</span><br><span class="line">							<span class="attr">"chaincode_proposal_payload"</span>: &#123;</span><br><span class="line">								<span class="attr">"TransientMap"</span>: &#123;&#125;,</span><br><span class="line">								<span class="attr">"input"</span>: &#123;</span><br><span class="line">									<span class="attr">"chaincode_spec"</span>: &#123;</span><br><span class="line">										<span class="attr">"chaincode_id"</span>: &#123;</span><br><span class="line">											<span class="attr">"name"</span>: <span class="string">"mycc"</span>,</span><br><span class="line">											<span class="attr">"path"</span>: <span class="string">""</span>,</span><br><span class="line">											<span class="attr">"version"</span>: <span class="string">""</span></span><br><span class="line">										&#125;,</span><br><span class="line">										<span class="attr">"input"</span>: &#123;</span><br><span class="line">											<span class="attr">"args"</span>: [</span><br><span class="line">												<span class="string">"aW52b2tl"</span>,</span><br><span class="line">												<span class="string">"YQ=="</span>,</span><br><span class="line">												<span class="string">"Yg=="</span>,</span><br><span class="line">												<span class="string">"MTA="</span></span><br><span class="line">											],</span><br><span class="line">											<span class="attr">"decorations"</span>: &#123;&#125;</span><br><span class="line">										&#125;,</span><br><span class="line">										<span class="attr">"timeout"</span>: <span class="number">0</span>,</span><br><span class="line">										<span class="attr">"type"</span>: <span class="string">"GOLANG"</span></span><br><span class="line">									&#125;</span><br><span class="line">								&#125;</span><br><span class="line">							&#125;</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;]</span><br><span class="line">				&#125;,</span><br><span class="line">				<span class="attr">"header"</span>: &#123;</span><br><span class="line">					<span class="attr">"channel_header"</span>: &#123;</span><br><span class="line">						<span class="attr">"channel_id"</span>: <span class="string">"mychannel"</span>,</span><br><span class="line">						<span class="attr">"epoch"</span>: <span class="string">"0"</span>,</span><br><span class="line">						<span class="attr">"extension"</span>: <span class="string">"EgYSBG15Y2M="</span>,</span><br><span class="line">						<span class="attr">"timestamp"</span>: <span class="string">"2019-08-01T02:19:38.504172871Z"</span>,</span><br><span class="line">						<span class="attr">"tls_cert_hash"</span>: <span class="literal">null</span>,</span><br><span class="line">						<span class="attr">"tx_id"</span>: <span class="string">"2377b308f2ea91e58d1b21d71b09370dc3c39bab3b92d2c0bc40801843150d6b"</span>,</span><br><span class="line">						<span class="attr">"type"</span>: <span class="number">3</span>,</span><br><span class="line">						<span class="attr">"version"</span>: <span class="number">0</span></span><br><span class="line">					&#125;,</span><br><span class="line">					<span class="attr">"signature_header"</span>: &#123;</span><br><span class="line">						<span class="attr">"creator"</span>: &#123;</span><br><span class="line">							<span class="attr">"id_bytes"</span>: <span class="string">"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNLekNDQWRHZ0F3SUJBZ0lSQUo5YnI3UHJmQWg5cHVVcDFMZkJ3V0V3Q2dZSUtvWkl6ajBFQXdJd2N6RUwKTUFrR0ExVUVCaE1DVlZNeEV6QVJCZ05WQkFnVENrTmhiR2xtYjNKdWFXRXhGakFVQmdOVkJBY1REVk5oYmlCRwpjbUZ1WTJselkyOHhHVEFYQmdOVkJBb1RFRzl5WnpJdVpYaGhiWEJzWlM1amIyMHhIREFhQmdOVkJBTVRFMk5oCkxtOXlaekl1WlhoaGJYQnNaUzVqYjIwd0hoY05NVGt3T0RBeE1ESXhOREF3V2hjTk1qa3dOekk1TURJeE5EQXcKV2pCc01Rc3dDUVlEVlFRR0V3SlZVekVUTUJFR0ExVUVDQk1LUTJGc2FXWnZjbTVwWVRFV01CUUdBMVVFQnhNTgpVMkZ1SUVaeVlXNWphWE5qYnpFUE1BMEdBMVVFQ3hNR1kyeHBaVzUwTVI4d0hRWURWUVFEREJaQlpHMXBia0J2CmNtY3lMbVY0WVcxd2JHVXVZMjl0TUZrd0V3WUhLb1pJemowQ0FRWUlLb1pJemowREFRY0RRZ0FFZndwdkRmOHoKWVdVaWxwclcxQ2hsc3hBaDhVcjBLQXpUYm9oc0oyQjFNWk40ZkVUakhKTHRnWjZDT0ZRaVFoNy9BK1NyNVhYdApDRnpvNUZWSlNSNmc2YU5OTUVzd0RnWURWUjBQQVFIL0JBUURBZ2VBTUF3R0ExVWRFd0VCL3dRQ01BQXdLd1lEClZSMGpCQ1F3SW9BZ21RRjBZbjNvczlwUEhXQ01ra3U4VXUzYks0cmY1QUllUTYwUVgyNHh4cjh3Q2dZSUtvWkkKemowRUF3SURTQUF3UlFJaEFPVUZRWUMvZE1ZMGZ0U2JNYVFLL213Uy83a0JyRWZicXFNaHBwWjlqWG1uQWlCeQpjczdFalFuZHJ2RHRMZnVPUEY4QnJyVGZPdWZDTTVNN09YSDl4S2ZQdVE9PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg=="</span>,</span><br><span class="line">							<span class="attr">"mspid"</span>: <span class="string">"Org2MSP"</span></span><br><span class="line">						&#125;,</span><br><span class="line">						<span class="attr">"nonce"</span>: <span class="string">"6Z4RNNIV085Nv/pOYUc5W3EaWcBueAAs"</span></span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="attr">"signature"</span>: <span class="string">"MEUCIQD5A7tvxqe4q/l+D1KOpDDaTZ5DdpsLs+xTA1CqsR+nBAIgSo+cFAzBBDfRJK8bcV6khmqWuhATKHm/7uiJiDkDjKI="</span></span><br><span class="line">		&#125;]</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">"header"</span>: &#123;</span><br><span class="line">		<span class="attr">"data_hash"</span>: <span class="string">"9Q8SRPt+L2bvRGXAteiCXOkiutLu1nZBiCCaiwAlFdk="</span>,</span><br><span class="line">		<span class="attr">"number"</span>: <span class="string">"4"</span>,</span><br><span class="line">		<span class="attr">"previous_hash"</span>: <span class="string">"vE7W/Qond3H6koHXpoWm2dfcZfZnmMYwF5lfNj6hDlY="</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">"metadata"</span>: &#123;</span><br><span class="line">		<span class="attr">"metadata"</span>: [</span><br><span class="line">			<span class="string">"CgQKAggCEv0GCrIGCpUGCgpPcmRlcmVyTVNQEoYGLS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNEVENDQWJPZ0F3SUJBZ0lSQU0rUFQ2YTJsYm1EY0NpNEVhTEFSeFl3Q2dZSUtvWkl6ajBFQXdJd2FURUwKTUFrR0ExVUVCaE1DVlZNeEV6QVJCZ05WQkFnVENrTmhiR2xtYjNKdWFXRXhGakFVQmdOVkJBY1REVk5oYmlCRwpjbUZ1WTJselkyOHhGREFTQmdOVkJBb1RDMlY0WVcxd2JHVXVZMjl0TVJjd0ZRWURWUVFERXc1allTNWxlR0Z0CmNHeGxMbU52YlRBZUZ3MHhPVEE0TURFd01qRTBNREJhRncweU9UQTNNamt3TWpFME1EQmFNRmd4Q3pBSkJnTlYKQkFZVEFsVlRNUk13RVFZRFZRUUlFd3BEWVd4cFptOXlibWxoTVJZd0ZBWURWUVFIRXcxVFlXNGdSbkpoYm1OcApjMk52TVJ3d0dnWURWUVFERXhOdmNtUmxjbVZ5TG1WNFlXMXdiR1V1WTI5dE1Ga3dFd1lIS29aSXpqMENBUVlJCktvWkl6ajBEQVFjRFFnQUVZVGcwdXZJMVZ0dEsrb2o2MG9LRjRtWlc4YlFXN0FIRFpZcFZueEdoTE5Kems2cmwKTU1uS0RiRmxibElETE9qK0tiakVwOW9WdEN6OVBsbk4xTmhHSEtOTk1Fc3dEZ1lEVlIwUEFRSC9CQVFEQWdlQQpNQXdHQTFVZEV3RUIvd1FDTUFBd0t3WURWUjBqQkNRd0lvQWdRSWtEMTlLWDFQc3VWUi9BQmVuZFM2ejY5cGxDCmNVNmc0aXUrdHFRL1hzQXdDZ1lJS29aSXpqMEVBd0lEU0FBd1JRSWhBTnd0cDQzMUdkYkdqb3pXRU1DQWdwNWIKeFdnMHNRMVlGbG9TYzF1MFFRU3FBaUF1TVNkc1AvMXZoclhVcGtoT1Voa3NwRjYrYVl1V2ozazZaVE84RWV3agpqdz09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0KEhhh6UhNerUcr/HbaA9SbvQ3xInOkYF9oKoSRjBEAiAwGjDnt+7TPrPz7fhm/63rUCFlJYzgRXdPautelXme3gIgUXb8ynZgf2rfIA8bL+y992HIgjtDCBppydWmPmXD9g4="</span>,</span><br><span class="line">			<span class="string">"CgIIAg=="</span>,</span><br><span class="line">			<span class="string">"AA=="</span>,</span><br><span class="line">			<span class="string">""</span></span><br><span class="line">		]</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://lessisbetter.site/2019/07/25/fabric-first-network/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="大彬">
      <meta itemprop="description" content="区块链、Go语言">
      <meta itemprop="image" content="http://img.lessisbetter.site/gzh-qrcode-logo-small.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Go语言充电站">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/07/25/fabric-first-network/" class="post-title-link" itemprop="url">详解Fabric网络搭建</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-07-25 11:37:57" itemprop="dateCreated datePublished" datetime="2019-07-25T11:37:57+08:00">2019-07-25</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-08-13 16:18:50" itemprop="dateModified" datetime="2019-08-13T16:18:50+08:00">2019-08-13</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>这篇文章介绍了如何快速的搭建一个fabric网络，然后又把搭建过程分解，针对每一步都做详细解释，希望你能熟练今后到不看文档也能搭建出fabric网络。</p>
<p>本文是<a href="https://hyperledger-fabric.readthedocs.io/en/release-1.4/build_network.html" target="_blank" rel="noopener">Building Your First Network</a>的笔记和实践记录，基于Fabric 1.4，commit id：9dce73。</p>
<p>前提：</p>
<ol>
<li>安装了Docker、Go等环境。</li>
<li>已经下载了fabric仓库，完成<code>make all</code>。</li>
</ol>
<h2 id="下载fabric-samples和准备工作"><a href="#下载fabric-samples和准备工作" class="headerlink" title="下载fabric-samples和准备工作"></a>下载fabric-samples和准备工作</h2><p>有2种方式。</p>
<p>方式1：一键下载和编译。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -sSL http://bit.ly/2ysbOFE | bash -s</span><br></pre></td></tr></table></figure>
<p>方式2：手动clone，放到GOPATH下，然后执行脚本，构建和拉去一些镜像，为搭建网络做准备。方式2只不过是把方式1的工作，手动做掉了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/hyperledger/fabric-samples.git</span><br><span class="line">cd fabric-samples</span><br><span class="line">sh scripts/bootstrap.sh</span><br></pre></td></tr></table></figure>
<p>参考资料：<a href="https://hyperledger-fabric.readthedocs.io/en/release-1.4/install.html。" target="_blank" rel="noopener">https://hyperledger-fabric.readthedocs.io/en/release-1.4/install.html。</a></p>
<h2 id="快速启动你的第一个Fabric网络"><a href="#快速启动你的第一个Fabric网络" class="headerlink" title="快速启动你的第一个Fabric网络"></a>快速启动你的第一个Fabric网络</h2><p>这一节的目的是用几分钟的时间启动一个网络，并且了解启动一个网络的过程。</p>
<h3 id="启动网络"><a href="#启动网络" class="headerlink" title="启动网络"></a>启动网络</h3><p><code>fabric-samples</code>下有多个示例，本次要使用的是<code>first-network</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">➜  fabric-samples git:(release-1.4) ll | grep ^d</span><br><span class="line">drwxr-xr-x 5 centos centos  193 7月  12 08:21 balance-transfer</span><br><span class="line">drwxr-xr-x 4 centos centos  273 7月  12 08:21 basic-network</span><br><span class="line">drwxrwxr-x 2 centos centos  175 1月   9 2019 bin</span><br><span class="line">drwxr-xr-x 8 centos centos  113 7月  12 08:21 chaincode</span><br><span class="line">drwxr-xr-x 3 centos centos  139 7月  12 08:21 chaincode-docker-devmode</span><br><span class="line">drwxr-xr-x 3 centos centos   44 7月  12 06:47 commercial-paper</span><br><span class="line">drwxrwxr-x 2 centos centos   64 1月   9 2019 config</span><br><span class="line">drwxr-xr-x 2 centos centos   59 7月  12 08:21 docs</span><br><span class="line">drwxr-xr-x 5 centos centos  110 7月  12 08:21 fabcar</span><br><span class="line">drwxr-xr-x 7 centos centos 4.0K 7月  17 03:14 first-network</span><br><span class="line">drwxr-xr-x 4 centos centos   55 7月  12 08:21 high-throughput</span><br><span class="line">drwxr-xr-x 4 centos centos   55 7月  12 08:21 interest_rate_swaps</span><br><span class="line">drwxr-xr-x 4 centos centos   67 7月  17 03:46 scripts</span><br></pre></td></tr></table></figure>
<p>进入<code>first-network</code>然后执行<code>./byfn.sh up</code>，启动操作会持续两三分钟，<code>byfn</code>是Building Your First Network的缩写。</p>
<p>启动过程实际做了这些事：</p>
<p>第一阶段：生成配置文件</p>
<ol>
<li>使用加密工具<code>cryptogen</code>生成证书</li>
<li>使用工具<code>configtxgen</code>生成orderer节点的创世块，即得到genesis.block</li>
<li>使用工具<code>configtxgen</code>生成配置应用通道channel的交易<code>channel.tx</code>，即得到mychannel.block</li>
<li>使用工具<code>configtxgen</code>生成Org1的MSP的anchor peer</li>
<li>使用工具<code>configtxgen</code>生成Org2的MSP的anchor peer</li>
</ol>
<p>第二阶段：启动网络</p>
<p>这个阶段是启动容器，包含客户端(cli)、peer，每个org有2个peer，peer0和peer1，默认是solo共识算法，还会启动1个orderer。</p>
<p>第三阶段：创建和加入通道，部署和测试链码</p>
<ol>
<li>创建应用通道mychannel</li>
<li>peer加入mychannel</li>
<li>在mychannel上更新Org1和Org2 MSP的anchor peer</li>
<li>在ogr1好org2的peer0上安装chaincode</li>
<li>在mychannel中，在peer0.org2上实例化chaincode，1个通道上只需示例化1次chaincode</li>
<li>在mychannel中，Invoke刚实例化的chaincode</li>
<li>在peer1.org2上安装chaincode，并查询</li>
</ol>
<p><code>byfn.sh</code>中的<code>networkUp()</code>函数是<code>./byfn.sh up</code>的主要执行函数，它的主要功能就是组织上面3个阶段。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Generate the needed certificates, the genesis block and start the network.</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">networkUp</span></span>() &#123;</span><br><span class="line">  checkPrereqs</span><br><span class="line">  <span class="comment"># 生成配置：证书、交易、私钥</span></span><br><span class="line">  <span class="comment"># generate artifacts if they don't exist</span></span><br><span class="line">  <span class="keyword">if</span> [ ! -d <span class="string">"crypto-config"</span> ]; <span class="keyword">then</span></span><br><span class="line">    generateCerts</span><br><span class="line">    replacePrivateKey</span><br><span class="line">    generateChannelArtifacts</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  <span class="comment"># 启动网络/容器</span></span><br><span class="line">  COMPOSE_FILES=<span class="string">"-f <span class="variable">$&#123;COMPOSE_FILE&#125;</span>"</span></span><br><span class="line">  <span class="keyword">if</span> [ <span class="string">"<span class="variable">$&#123;CERTIFICATE_AUTHORITIES&#125;</span>"</span> == <span class="string">"true"</span> ]; <span class="keyword">then</span></span><br><span class="line">    COMPOSE_FILES=<span class="string">"<span class="variable">$&#123;COMPOSE_FILES&#125;</span> -f <span class="variable">$&#123;COMPOSE_FILE_CA&#125;</span>"</span></span><br><span class="line">    <span class="built_in">export</span> BYFN_CA1_PRIVATE_KEY=$(<span class="built_in">cd</span> crypto-config/peerOrganizations/org1.example.com/ca &amp;&amp; ls *_sk)</span><br><span class="line">    <span class="built_in">export</span> BYFN_CA2_PRIVATE_KEY=$(<span class="built_in">cd</span> crypto-config/peerOrganizations/org2.example.com/ca &amp;&amp; ls *_sk)</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  <span class="keyword">if</span> [ <span class="string">"<span class="variable">$&#123;CONSENSUS_TYPE&#125;</span>"</span> == <span class="string">"kafka"</span> ]; <span class="keyword">then</span></span><br><span class="line">    COMPOSE_FILES=<span class="string">"<span class="variable">$&#123;COMPOSE_FILES&#125;</span> -f <span class="variable">$&#123;COMPOSE_FILE_KAFKA&#125;</span>"</span></span><br><span class="line">  <span class="keyword">elif</span> [ <span class="string">"<span class="variable">$&#123;CONSENSUS_TYPE&#125;</span>"</span> == <span class="string">"etcdraft"</span> ]; <span class="keyword">then</span></span><br><span class="line">    COMPOSE_FILES=<span class="string">"<span class="variable">$&#123;COMPOSE_FILES&#125;</span> -f <span class="variable">$&#123;COMPOSE_FILE_RAFT2&#125;</span>"</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  <span class="keyword">if</span> [ <span class="string">"<span class="variable">$&#123;IF_COUCHDB&#125;</span>"</span> == <span class="string">"couchdb"</span> ]; <span class="keyword">then</span></span><br><span class="line">    COMPOSE_FILES=<span class="string">"<span class="variable">$&#123;COMPOSE_FILES&#125;</span> -f <span class="variable">$&#123;COMPOSE_FILE_COUCH&#125;</span>"</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  IMAGE_TAG=<span class="variable">$IMAGETAG</span> docker-compose <span class="variable">$&#123;COMPOSE_FILES&#125;</span> up -d 2&gt;&amp;1</span><br><span class="line">  <span class="comment"># 检查容器是否启动</span></span><br><span class="line">  docker ps -a</span><br><span class="line">  <span class="keyword">if</span> [ $? -ne 0 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"ERROR !!!! Unable to start network"</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> [ <span class="string">"<span class="variable">$CONSENSUS_TYPE</span>"</span> == <span class="string">"kafka"</span> ]; <span class="keyword">then</span></span><br><span class="line">    sleep 1</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"Sleeping 10s to allow <span class="variable">$CONSENSUS_TYPE</span> cluster to complete booting"</span></span><br><span class="line">    sleep 9</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> [ <span class="string">"<span class="variable">$CONSENSUS_TYPE</span>"</span> == <span class="string">"etcdraft"</span> ]; <span class="keyword">then</span></span><br><span class="line">    sleep 1</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"Sleeping 15s to allow <span class="variable">$CONSENSUS_TYPE</span> cluster to complete booting"</span></span><br><span class="line">    sleep 14</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># 执行端到端脚本：创建并加入应用通道，然后测试</span></span><br><span class="line">  <span class="comment"># now run the end to end script</span></span><br><span class="line">  docker <span class="built_in">exec</span> cli scripts/script.sh <span class="variable">$CHANNEL_NAME</span> <span class="variable">$CLI_DELAY</span> <span class="variable">$LANGUAGE</span> <span class="variable">$CLI_TIMEOUT</span> <span class="variable">$VERBOSE</span> <span class="variable">$NO_CHAINCODE</span></span><br><span class="line">  <span class="keyword">if</span> [ $? -ne 0 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"ERROR !!!! Test failed"</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>启动日志，日志中标记了各阶段，建议详读一下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br></pre></td><td class="code"><pre><span class="line">$ cd first-network</span><br><span class="line">➜  first-network git:(release-1.4) ./byfn.sh up</span><br><span class="line">Starting for channel &apos;mychannel&apos; with CLI timeout of &apos;10&apos; seconds and CLI delay of &apos;3&apos; seconds</span><br><span class="line">Continue? [Y/n] y</span><br><span class="line">proceeding ...</span><br><span class="line">LOCAL_VERSION=1.4.0</span><br><span class="line">DOCKER_IMAGE_VERSION=1.4.0</span><br><span class="line">/home/centos/go/src/github.com/hyperledger/fabric-samples/bin/cryptogen</span><br><span class="line"></span><br><span class="line">/**** 第1阶段：生成配置文件 ****/</span><br><span class="line"></span><br><span class="line">##########################################################</span><br><span class="line">##### Generate certificates using cryptogen tool #########</span><br><span class="line">##########################################################</span><br><span class="line">+ cryptogen generate --config=./crypto-config.yaml</span><br><span class="line">org1.example.com</span><br><span class="line">org2.example.com</span><br><span class="line">+ res=0</span><br><span class="line">+ set +x</span><br><span class="line"></span><br><span class="line">/home/centos/go/src/github.com/hyperledger/fabric-samples/bin/configtxgen</span><br><span class="line">##########################################################</span><br><span class="line">#########  Generating Orderer Genesis block ##############</span><br><span class="line">##########################################################</span><br><span class="line">CONSENSUS_TYPE=solo</span><br><span class="line">+ &apos;[&apos; solo == solo &apos;]&apos;</span><br><span class="line">+ configtxgen -profile TwoOrgsOrdererGenesis -channelID byfn-sys-channel -outputBlock ./channel-artifacts/genesis.block</span><br><span class="line">2019-07-17 06:34:26.973 UTC [common.tools.configtxgen] main -&gt; INFO 001 Loading configuration</span><br><span class="line">2019-07-17 06:34:27.088 UTC [common.tools.configtxgen.localconfig] completeInitialization -&gt; INFO 002 orderer type: solo</span><br><span class="line">2019-07-17 06:34:27.088 UTC [common.tools.configtxgen.localconfig] Load -&gt; INFO 003 Loaded configuration: /home/centos/go/src/github.com/hyperledger/fabric-samples/first-network/configtx.yaml</span><br><span class="line">2019-07-17 06:34:27.186 UTC [common.tools.configtxgen.localconfig] completeInitialization -&gt; INFO 004 orderer type: solo</span><br><span class="line">2019-07-17 06:34:27.186 UTC [common.tools.configtxgen.localconfig] LoadTopLevel -&gt; INFO 005 Loaded configuration: /home/centos/go/src/github.com/hyperledger/fabric-samples/first-network/configtx.yaml</span><br><span class="line">2019-07-17 06:34:27.188 UTC [common.tools.configtxgen] doOutputBlock -&gt; INFO 006 Generating genesis block</span><br><span class="line">2019-07-17 06:34:27.189 UTC [common.tools.configtxgen] doOutputBlock -&gt; INFO 007 Writing genesis block</span><br><span class="line">+ res=0</span><br><span class="line">+ set +x</span><br><span class="line"></span><br><span class="line">#################################################################</span><br><span class="line">### Generating channel configuration transaction &apos;channel.tx&apos; ###</span><br><span class="line">#################################################################</span><br><span class="line">+ configtxgen -profile TwoOrgsChannel -outputCreateChannelTx ./channel-artifacts/channel.tx -channelID mychannel</span><br><span class="line">2019-07-17 06:34:27.228 UTC [common.tools.configtxgen] main -&gt; INFO 001 Loading configuration</span><br><span class="line">2019-07-17 06:34:27.315 UTC [common.tools.configtxgen.localconfig] Load -&gt; INFO 002 Loaded configuration: /home/centos/go/src/github.com/hyperledger/fabric-samples/first-network/configtx.yaml</span><br><span class="line">2019-07-17 06:34:27.422 UTC [common.tools.configtxgen.localconfig] completeInitialization -&gt; INFO 003 orderer type: solo</span><br><span class="line">2019-07-17 06:34:27.422 UTC [common.tools.configtxgen.localconfig] LoadTopLevel -&gt; INFO 004 Loaded configuration: /home/centos/go/src/github.com/hyperledger/fabric-samples/first-network/configtx.yaml</span><br><span class="line">2019-07-17 06:34:27.422 UTC [common.tools.configtxgen] doOutputChannelCreateTx -&gt; INFO 005 Generating new channel configtx</span><br><span class="line">2019-07-17 06:34:27.425 UTC [common.tools.configtxgen] doOutputChannelCreateTx -&gt; INFO 006 Writing new channel tx</span><br><span class="line">+ res=0</span><br><span class="line">+ set +x</span><br><span class="line"></span><br><span class="line">#################################################################</span><br><span class="line">#######    Generating anchor peer update for Org1MSP   ##########</span><br><span class="line">#################################################################</span><br><span class="line">+ configtxgen -profile TwoOrgsChannel -outputAnchorPeersUpdate ./channel-artifacts/Org1MSPanchors.tx -channelID mychannel -asOrg Org1MSP</span><br><span class="line">2019-07-17 06:34:27.477 UTC [common.tools.configtxgen] main -&gt; INFO 001 Loading configuration</span><br><span class="line">2019-07-17 06:34:27.559 UTC [common.tools.configtxgen.localconfig] Load -&gt; INFO 002 Loaded configuration: /home/centos/go/src/github.com/hyperledger/fabric-samples/first-network/configtx.yaml</span><br><span class="line">2019-07-17 06:34:27.649 UTC [common.tools.configtxgen.localconfig] completeInitialization -&gt; INFO 003 orderer type: solo</span><br><span class="line">2019-07-17 06:34:27.649 UTC [common.tools.configtxgen.localconfig] LoadTopLevel -&gt; INFO 004 Loaded configuration: /home/centos/go/src/github.com/hyperledger/fabric-samples/first-network/configtx.yaml</span><br><span class="line">2019-07-17 06:34:27.649 UTC [common.tools.configtxgen] doOutputAnchorPeersUpdate -&gt; INFO 005 Generating anchor peer update</span><br><span class="line">2019-07-17 06:34:27.649 UTC [common.tools.configtxgen] doOutputAnchorPeersUpdate -&gt; INFO 006 Writing anchor peer update</span><br><span class="line">+ res=0</span><br><span class="line">+ set +x</span><br><span class="line"></span><br><span class="line">#################################################################</span><br><span class="line">#######    Generating anchor peer update for Org2MSP   ##########</span><br><span class="line">#################################################################</span><br><span class="line">+ configtxgen -profile TwoOrgsChannel -outputAnchorPeersUpdate ./channel-artifacts/Org2MSPanchors.tx -channelID mychannel -asOrg Org2MSP</span><br><span class="line">2019-07-17 06:34:27.689 UTC [common.tools.configtxgen] main -&gt; INFO 001 Loading configuration</span><br><span class="line">2019-07-17 06:34:27.773 UTC [common.tools.configtxgen.localconfig] Load -&gt; INFO 002 Loaded configuration: /home/centos/go/src/github.com/hyperledger/fabric-samples/first-network/configtx.yaml</span><br><span class="line">2019-07-17 06:34:27.886 UTC [common.tools.configtxgen.localconfig] completeInitialization -&gt; INFO 003 orderer type: solo</span><br><span class="line">2019-07-17 06:34:27.886 UTC [common.tools.configtxgen.localconfig] LoadTopLevel -&gt; INFO 004 Loaded configuration: /home/centos/go/src/github.com/hyperledger/fabric-samples/first-network/configtx.yaml</span><br><span class="line">2019-07-17 06:34:27.886 UTC [common.tools.configtxgen] doOutputAnchorPeersUpdate -&gt; INFO 005 Generating anchor peer update</span><br><span class="line">2019-07-17 06:34:27.886 UTC [common.tools.configtxgen] doOutputAnchorPeersUpdate -&gt; INFO 006 Writing anchor peer update</span><br><span class="line">+ res=0</span><br><span class="line">+ set +x</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/**** 第2阶段：启动容器网络 ****/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Creating network &quot;net_byfn&quot; with the default driver</span><br><span class="line">Creating volume &quot;net_orderer.example.com&quot; with default driver</span><br><span class="line">Creating volume &quot;net_peer0.org1.example.com&quot; with default driver</span><br><span class="line">Creating volume &quot;net_peer1.org1.example.com&quot; with default driver</span><br><span class="line">Creating volume &quot;net_peer0.org2.example.com&quot; with default driver</span><br><span class="line">Creating volume &quot;net_peer1.org2.example.com&quot; with default driver</span><br><span class="line">Creating orderer.example.com    ... done</span><br><span class="line">Creating peer0.org2.example.com ... done</span><br><span class="line">Creating peer1.org2.example.com ... done</span><br><span class="line">Creating peer0.org1.example.com ... done</span><br><span class="line">Creating peer1.org1.example.com ... done</span><br><span class="line">Creating cli                    ... done</span><br><span class="line">CONTAINER ID        IMAGE                                                                                                          COMMAND                  CREATED                  STATUS                      PORTS                      NAMES</span><br><span class="line">8c2ccb5ee443        hyperledger/fabric-tools:latest                                                                                &quot;/bin/bash&quot;              Less than a second ago   Up Less than a second                                  cli</span><br><span class="line">5af5a3fb3bb7        hyperledger/fabric-peer:latest                                                                                 &quot;peer node start&quot;        2 seconds ago            Up Less than a second       0.0.0.0:8051-&gt;8051/tcp     peer1.org1.example.com</span><br><span class="line">396b363bb6f5        hyperledger/fabric-peer:latest                                                                                 &quot;peer node start&quot;        2 seconds ago            Up Less than a second       0.0.0.0:7051-&gt;7051/tcp     peer0.org1.example.com</span><br><span class="line">94be2011d20f        hyperledger/fabric-orderer:latest                                                                              &quot;orderer&quot;                2 seconds ago            Up Less than a second       0.0.0.0:7050-&gt;7050/tcp     orderer.example.com</span><br><span class="line">da8c17df215d        hyperledger/fabric-peer:latest                                                                                 &quot;peer node start&quot;        2 seconds ago            Up Less than a second       0.0.0.0:9051-&gt;9051/tcp     peer0.org2.example.com</span><br><span class="line">fcd30620e876        hyperledger/fabric-peer:latest                                                                                 &quot;peer node start&quot;        2 seconds ago            Up Less than a second       0.0.0.0:10051-&gt;10051/tcp   peer1.org2.example.com</span><br><span class="line">10510312db61        dc535406-4013-4141-be9e-e472c1cf24a1-simple-5e32b897538246406863e63956e4c561246725b6fbf114a1fedff16775cf782d   &quot;tail -f /dev/null&quot;      22 hours ago             Exited (137) 22 hours ago                              dc535406-4013-4141-be9e-e472c1cf24a1-simple</span><br><span class="line">21a3b8dc137a        hyperledger/fabric-buildenv:amd64-latest                                                                       &quot;/bin/bash&quot;              22 hours ago             Exited (0) 22 hours ago                                musing_swartz</span><br><span class="line">48407948b7d7        hyperledger/fabric-buildenv                                                                                    &quot;/bin/bash&quot;              22 hours ago             Exited (130) 22 hours ago                              affectionate_curie</span><br><span class="line">358f0c0de3e1        92b20cd39f98                                                                                                   &quot;/bin/bash&quot;              23 hours ago             Exited (130) 22 hours ago                              festive_clarke</span><br><span class="line">de5938eccc11        92b20cd39f98                                                                                                   &quot;./scripts/check_dep…&quot;   23 hours ago             Exited (127) 23 hours ago                              quizzical_einstein</span><br><span class="line">324b27de3a34        92b20cd39f98                                                                                                   &quot;/bin/bash&quot;              23 hours ago             Exited (0) 23 hours ago                                amazing_booth</span><br><span class="line">26a53801f203        92b20cd39f98                                                                                                   &quot;./scripts/check_dep…&quot;   23 hours ago             Exited (127) 23 hours ago                              jolly_saha</span><br><span class="line">94a33ddda70a        92b20cd39f98                                                                                                   &quot;./scripts/golinter.…&quot;   23 hours ago             Exited (0) 23 hours ago                                peaceful_allen</span><br><span class="line">6a0c7fded448        92b20cd39f98                                                                                                   &quot;./scripts/golinter.…&quot;   23 hours ago             Created                                                recursing_beaver</span><br><span class="line">233496b4065c        92b20cd39f98                                                                                                   &quot;/bin/bash&quot;              23 hours ago             Exited (0) 23 hours ago                                wizardly_shockley</span><br><span class="line">f0a255a96610        92b20cd39f98                                                                                                   &quot;/bin/bash&quot;              23 hours ago             Exited (0) 23 hours ago                                jolly_ganguly</span><br><span class="line">664416bc4fee        965663acb7cf                                                                                                   &quot;/bin/sh -c &apos;apt-get…&quot;   24 hours ago             Exited (100) 24 hours ago                              nostalgic_chaplygin</span><br><span class="line">51cf784ef4e1        ba82c6de-50fb-4ffd-989d-0dcf54e14e3b-simple-9961bcae6dad48592af2e9f1c1df3c96b568f9394ec82b2f351e79fa51a4f786   &quot;tail -f /dev/null&quot;      47 hours ago             Exited (137) 47 hours ago                              ba82c6de-50fb-4ffd-989d-0dcf54e14e3b-simple</span><br><span class="line">b7642b085ac1        14669948-7a23-4b3b-aa14-8b0622986e03-simple-f8a7b2e1352d04d884580725c2be9b642dd29df7e3e095a4a9403ac789dde2ac   &quot;tail -f /dev/null&quot;      2 days ago               Exited (137) 2 days ago                                14669948-7a23-4b3b-aa14-8b0622986e03-simple</span><br><span class="line"></span><br><span class="line">/**** 第3阶段：创建并加入应用通道，然后测试 ****/</span><br><span class="line"></span><br><span class="line"> ____    _____      _      ____    _____</span><br><span class="line">/ ___|  |_   _|    / \    |  _ \  |_   _|</span><br><span class="line">\___ \    | |     / _ \   | |_) |   | |</span><br><span class="line"> ___) |   | |    / ___ \  |  _ &lt;    | |</span><br><span class="line">|____/    |_|   /_/   \_\ |_| \_\   |_|</span><br><span class="line"></span><br><span class="line">Build your first network (BYFN) end-to-end test</span><br><span class="line"></span><br><span class="line">Channel name : mychannel</span><br><span class="line">Creating channel...</span><br><span class="line">+ peer channel create -o orderer.example.com:7050 -c mychannel -f ./channel-artifacts/channel.tx --tls true --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem</span><br><span class="line">+ res=0</span><br><span class="line">+ set +x</span><br><span class="line">2019-07-17 06:34:32.113 UTC [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized</span><br><span class="line">2019-07-17 06:34:32.190 UTC [cli.common] readBlock -&gt; INFO 002 Received block: 0</span><br><span class="line">===================== Channel &apos;mychannel&apos; created =====================</span><br><span class="line"></span><br><span class="line">Having all peers join the channel...</span><br><span class="line">+ peer channel join -b mychannel.block</span><br><span class="line">+ res=0</span><br><span class="line">+ set +x</span><br><span class="line">2019-07-17 06:34:32.272 UTC [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized</span><br><span class="line">2019-07-17 06:34:32.338 UTC [channelCmd] executeJoin -&gt; INFO 002 Successfully submitted proposal to join channel</span><br><span class="line">===================== peer0.org1 joined channel &apos;mychannel&apos; =====================</span><br><span class="line"></span><br><span class="line">+ peer channel join -b mychannel.block</span><br><span class="line">+ res=0</span><br><span class="line">+ set +x</span><br><span class="line">2019-07-17 06:34:35.449 UTC [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized</span><br><span class="line">2019-07-17 06:34:35.536 UTC [channelCmd] executeJoin -&gt; INFO 002 Successfully submitted proposal to join channel</span><br><span class="line">===================== peer1.org1 joined channel &apos;mychannel&apos; =====================</span><br><span class="line"></span><br><span class="line">+ peer channel join -b mychannel.block</span><br><span class="line">+ res=0</span><br><span class="line">+ set +x</span><br><span class="line">2019-07-17 06:34:38.617 UTC [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized</span><br><span class="line">2019-07-17 06:34:38.673 UTC [channelCmd] executeJoin -&gt; INFO 002 Successfully submitted proposal to join channel</span><br><span class="line">===================== peer0.org2 joined channel &apos;mychannel&apos; =====================</span><br><span class="line"></span><br><span class="line">+ peer channel join -b mychannel.block</span><br><span class="line">+ res=0</span><br><span class="line">+ set +x</span><br><span class="line">2019-07-17 06:34:41.755 UTC [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized</span><br><span class="line">2019-07-17 06:34:41.837 UTC [channelCmd] executeJoin -&gt; INFO 002 Successfully submitted proposal to join channel</span><br><span class="line">===================== peer1.org2 joined channel &apos;mychannel&apos; =====================</span><br><span class="line"></span><br><span class="line">Updating anchor peers for org1...</span><br><span class="line">+ peer channel update -o orderer.example.com:7050 -c mychannel -f ./channel-artifacts/Org1MSPanchors.tx --tls true --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem</span><br><span class="line">+ res=0</span><br><span class="line">+ set +x</span><br><span class="line">2019-07-17 06:34:44.930 UTC [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized</span><br><span class="line">2019-07-17 06:34:44.951 UTC [channelCmd] update -&gt; INFO 002 Successfully submitted channel update</span><br><span class="line">===================== Anchor peers updated for org &apos;Org1MSP&apos; on channel &apos;mychannel&apos; =====================</span><br><span class="line"></span><br><span class="line">Updating anchor peers for org2...</span><br><span class="line">+ peer channel update -o orderer.example.com:7050 -c mychannel -f ./channel-artifacts/Org2MSPanchors.tx --tls true --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem</span><br><span class="line">+ res=0</span><br><span class="line">+ set +x</span><br><span class="line">2019-07-17 06:34:48.037 UTC [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized</span><br><span class="line">2019-07-17 06:34:48.059 UTC [channelCmd] update -&gt; INFO 002 Successfully submitted channel update</span><br><span class="line">===================== Anchor peers updated for org &apos;Org2MSP&apos; on channel &apos;mychannel&apos; =====================</span><br><span class="line"></span><br><span class="line">Installing chaincode on peer0.org1...</span><br><span class="line">+ peer chaincode install -n mycc -v 1.0 -l golang -p github.com/chaincode/chaincode_example02/go/</span><br><span class="line">+ res=0</span><br><span class="line">+ set +x</span><br><span class="line">2019-07-17 06:34:51.167 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 001 Using default escc</span><br><span class="line">2019-07-17 06:34:51.167 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 002 Using default vscc</span><br><span class="line">2019-07-17 06:34:51.462 UTC [chaincodeCmd] install -&gt; INFO 003 Installed remotely response:&lt;status:200 payload:&quot;OK&quot; &gt;</span><br><span class="line">===================== Chaincode is installed on peer0.org1 =====================</span><br><span class="line"></span><br><span class="line">Install chaincode on peer0.org2...</span><br><span class="line">+ peer chaincode install -n mycc -v 1.0 -l golang -p github.com/chaincode/chaincode_example02/go/</span><br><span class="line">+ res=0</span><br><span class="line">+ set +x</span><br><span class="line">2019-07-17 06:34:51.542 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 001 Using default escc</span><br><span class="line">2019-07-17 06:34:51.542 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 002 Using default vscc</span><br><span class="line">2019-07-17 06:34:51.817 UTC [chaincodeCmd] install -&gt; INFO 003 Installed remotely response:&lt;status:200 payload:&quot;OK&quot; &gt;</span><br><span class="line">===================== Chaincode is installed on peer0.org2 =====================</span><br><span class="line"></span><br><span class="line">Instantiating chaincode on peer0.org2...</span><br><span class="line">+ peer chaincode instantiate -o orderer.example.com:7050 --tls true --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n mycc -l golang -v 1.0 -c &apos;&#123;&quot;Args&quot;:[&quot;init&quot;,&quot;a&quot;,&quot;100&quot;,&quot;b&quot;,&quot;200&quot;]&#125;&apos; -P &apos;AND (&apos;\&apos;&apos;Org1MSP.peer&apos;\&apos;&apos;,&apos;\&apos;&apos;Org2MSP.peer&apos;\&apos;&apos;)&apos;</span><br><span class="line">+ res=0</span><br><span class="line">+ set +x</span><br><span class="line">2019-07-17 06:34:51.910 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 001 Using default escc</span><br><span class="line">2019-07-17 06:34:51.910 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 002 Using default vscc</span><br><span class="line">===================== Chaincode is instantiated on peer0.org2 on channel &apos;mychannel&apos; =====================</span><br><span class="line"></span><br><span class="line">Querying chaincode on peer0.org1...</span><br><span class="line">===================== Querying on peer0.org1 on channel &apos;mychannel&apos;... =====================</span><br><span class="line">+ peer chaincode query -C mychannel -n mycc -c &apos;&#123;&quot;Args&quot;:[&quot;query&quot;,&quot;a&quot;]&#125;&apos;</span><br><span class="line">Attempting to Query peer0.org1 ...3 secs</span><br><span class="line">+ res=0</span><br><span class="line">+ set +x</span><br><span class="line"></span><br><span class="line">100</span><br><span class="line">===================== Query successful on peer0.org1 on channel &apos;mychannel&apos; =====================</span><br><span class="line">Sending invoke transaction on peer0.org1 peer0.org2...</span><br><span class="line">+ peer chaincode invoke -o orderer.example.com:7050 --tls true --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n mycc --peerAddresses peer0.org1.example.com:7051 --tlsRootCertFiles /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt --peerAddresses peer0.org2.example.com:9051 --tlsRootCertFiles /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt -c &apos;&#123;&quot;Args&quot;:[&quot;invoke&quot;,&quot;a&quot;,&quot;b&quot;,&quot;10&quot;]&#125;&apos;</span><br><span class="line">+ res=0</span><br><span class="line">+ set +x</span><br><span class="line">2019-07-17 06:35:27.719 UTC [chaincodeCmd] chaincodeInvokeOrQuery -&gt; INFO 001 Chaincode invoke successful. result: status:200</span><br><span class="line">===================== Invoke transaction successful on peer0.org1 peer0.org2 on channel &apos;mychannel&apos; =====================</span><br><span class="line"></span><br><span class="line">Installing chaincode on peer1.org2...</span><br><span class="line">+ peer chaincode install -n mycc -v 1.0 -l golang -p github.com/chaincode/chaincode_example02/go/</span><br><span class="line">+ res=0</span><br><span class="line">+ set +x</span><br><span class="line">2019-07-17 06:35:27.809 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 001 Using default escc</span><br><span class="line">2019-07-17 06:35:27.809 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 002 Using default vscc</span><br><span class="line">2019-07-17 06:35:28.060 UTC [chaincodeCmd] install -&gt; INFO 003 Installed remotely response:&lt;status:200 payload:&quot;OK&quot; &gt;</span><br><span class="line">===================== Chaincode is installed on peer1.org2 =====================</span><br><span class="line"></span><br><span class="line">Querying chaincode on peer1.org2...</span><br><span class="line">===================== Querying on peer1.org2 on channel &apos;mychannel&apos;... =====================</span><br><span class="line">+ peer chaincode query -C mychannel -n mycc -c &apos;&#123;&quot;Args&quot;:[&quot;query&quot;,&quot;a&quot;]&#125;&apos;</span><br><span class="line">Attempting to Query peer1.org2 ...3 secs</span><br><span class="line">+ res=0</span><br><span class="line">+ set +x</span><br><span class="line"></span><br><span class="line">90</span><br><span class="line">===================== Query successful on peer1.org2 on channel &apos;mychannel&apos; =====================</span><br><span class="line"></span><br><span class="line">========= All GOOD, BYFN execution completed ===========</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> _____   _   _   ____</span><br><span class="line">| ____| | \ | | |  _ \</span><br><span class="line">|  _|   |  \| | | | | |</span><br><span class="line">| |___  | |\  | | |_| |</span><br><span class="line">|_____| |_| \_| |____/</span><br></pre></td></tr></table></figure>
<p>使用docker查看起来的服务：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">➜  first-network git:(release-1.4) docker ps</span><br><span class="line">CONTAINER ID        IMAGE                                                                                                  COMMAND                  CREATED             STATUS              PORTS                      NAMES</span><br><span class="line">fe690a4f3e9f        dev-peer1.org2.example.com-mycc-1.0-26c2ef32838554aac4f7ad6f100aca865e87959c9a126e86d764c8d01f8346ab   &quot;chaincode -peer.add…&quot;   2 hours ago         Up 2 hours                                     dev-peer1.org2.example.com-mycc-1.0</span><br><span class="line">03a5f82384a0        dev-peer0.org1.example.com-mycc-1.0-384f11f484b9302df90b453200cfb25174305fce8f53f4e94d45ee3b6cab0ce9   &quot;chaincode -peer.add…&quot;   2 hours ago         Up 2 hours                                     dev-peer0.org1.example.com-mycc-1.0</span><br><span class="line">a737b47e9de6        dev-peer0.org2.example.com-mycc-1.0-15b571b3ce849066b7ec74497da3b27e54e0df1345daff3951b94245ce09c42b   &quot;chaincode -peer.add…&quot;   2 hours ago         Up 2 hours                                     dev-peer0.org2.example.com-mycc-1.0</span><br><span class="line">8c2ccb5ee443        hyperledger/fabric-tools:latest                                                                        &quot;/bin/bash&quot;              2 hours ago         Up 2 hours                                     cli</span><br><span class="line">5af5a3fb3bb7        hyperledger/fabric-peer:latest                                                                         &quot;peer node start&quot;        2 hours ago         Up 2 hours          0.0.0.0:8051-&gt;8051/tcp     peer1.org1.example.com</span><br><span class="line">396b363bb6f5        hyperledger/fabric-peer:latest                                                                         &quot;peer node start&quot;        2 hours ago         Up 2 hours          0.0.0.0:7051-&gt;7051/tcp     peer0.org1.example.com</span><br><span class="line">94be2011d20f        hyperledger/fabric-orderer:latest                                                                      &quot;orderer&quot;                2 hours ago         Up 2 hours          0.0.0.0:7050-&gt;7050/tcp     orderer.example.com</span><br><span class="line">da8c17df215d        hyperledger/fabric-peer:latest                                                                         &quot;peer node start&quot;        2 hours ago         Up 2 hours          0.0.0.0:9051-&gt;9051/tcp     peer0.org2.example.com</span><br><span class="line">fcd30620e876        hyperledger/fabric-peer:latest                                                                         &quot;peer node start&quot;        2 hours ago         Up 2 hours          0.0.0.0:10051-&gt;10051/tcp   peer1.org2.example.com</span><br></pre></td></tr></table></figure>
<p>上面有3个<code>dev-peer*.org*.example.com-mycc-1.0</code>容器，它们是链码容器，<strong>每一个安装过链码的peer都会创建一个属于自己的链码容器</strong>，在调用链码的时候，peer会通过gRPC和自己的链码容器通信。</p>
<h3 id="关闭网络"><a href="#关闭网络" class="headerlink" title="关闭网络"></a>关闭网络</h3><p>使用<code>./byfn.sh down</code>命令，关闭<code>first-network</code>：</p>
<ol>
<li>依次停止channel、客户端、orderer、peer</li>
<li>删除cli、orderer、peer、netowrk</li>
<li>删除docker镜像</li>
</ol>
<p><strong>当<code>./byfn.sh up</code>失败时，也需要使用此命令清理数据，以免后面启动网络时出问题。</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">➜  first-network git:(release-1.4) ./byfn.sh down</span><br><span class="line">Stopping for channel &apos;mychannel&apos; with CLI timeout of &apos;10&apos; seconds and CLI delay of &apos;3&apos; seconds</span><br><span class="line">Continue? [Y/n] y</span><br><span class="line">proceeding ...</span><br><span class="line">WARNING: The BYFN_CA1_PRIVATE_KEY variable is not set. Defaulting to a blank string.</span><br><span class="line">WARNING: The BYFN_CA2_PRIVATE_KEY variable is not set. Defaulting to a blank string.</span><br><span class="line">Stopping cli                    ... done</span><br><span class="line">Stopping orderer.example.com    ... done</span><br><span class="line">Stopping peer1.org1.example.com ... done</span><br><span class="line">Stopping peer0.org1.example.com ... done</span><br><span class="line">Stopping peer0.org2.example.com ... done</span><br><span class="line">Stopping peer1.org2.example.com ... done</span><br><span class="line">Removing cli                    ... done</span><br><span class="line">Removing orderer.example.com    ... done</span><br><span class="line">Removing peer1.org1.example.com ... done</span><br><span class="line">Removing peer0.org1.example.com ... done</span><br><span class="line">Removing peer0.org2.example.com ... done</span><br><span class="line">Removing peer1.org2.example.com ... done</span><br><span class="line">Removing network net_byfn</span><br><span class="line">Removing volume net_orderer.example.com</span><br><span class="line">Removing volume net_peer0.org1.example.com</span><br><span class="line">Removing volume net_peer1.org1.example.com</span><br><span class="line">Removing volume net_peer0.org2.example.com</span><br><span class="line">Removing volume net_peer1.org2.example.com</span><br><span class="line">Removing volume net_orderer2.example.com</span><br><span class="line">WARNING: Volume net_orderer2.example.com not found.</span><br><span class="line">Removing volume net_orderer3.example.com</span><br><span class="line">WARNING: Volume net_orderer3.example.com not found.</span><br><span class="line">Removing volume net_orderer4.example.com</span><br><span class="line">WARNING: Volume net_orderer4.example.com not found.</span><br><span class="line">Removing volume net_orderer5.example.com</span><br><span class="line">WARNING: Volume net_orderer5.example.com not found.</span><br><span class="line">Removing volume net_peer0.org3.example.com</span><br><span class="line">WARNING: Volume net_peer0.org3.example.com not found.</span><br><span class="line">Removing volume net_peer1.org3.example.com</span><br><span class="line">WARNING: Volume net_peer1.org3.example.com not found.</span><br><span class="line">05c281ff186c</span><br><span class="line">f3ccbe5e2b80</span><br><span class="line">7f0144ca0eae</span><br><span class="line">Untagged: dev-peer1.org2.example.com-mycc-1.0-26c2ef32838554aac4f7ad6f100aca865e87959c9a126e86d764c8d01f8346ab:latest</span><br><span class="line">Deleted: sha256:9425c8298cafe082ed22c5968d431a6098d53ef2318fb5d286efb96b4bc44915</span><br><span class="line">Deleted: sha256:9005a0d9f52947d9256aa4766d4c26a9bab98f229aab7f2598da05789fc977ef</span><br><span class="line">Deleted: sha256:98602d24729b179952f685f8f83f1effaf3733e7f93354a9d31b15f711bc0fac</span><br><span class="line">Deleted: sha256:fe2b67155487d7e001c8a0b2ef100bb710b1b816897bc9d2a80029f4c7bd0b54</span><br><span class="line">Untagged: dev-peer0.org1.example.com-mycc-1.0-384f11f484b9302df90b453200cfb25174305fce8f53f4e94d45ee3b6cab0ce9:latest</span><br><span class="line">Deleted: sha256:0759f367d73c68e71b6077ebd46611d43a8d9c1c9ebc398b838010268b175d65</span><br><span class="line">Deleted: sha256:2d56a884d5514a4467471cf06b42c0cfa492a80a239d48f79fa48273982d81b7</span><br><span class="line">Deleted: sha256:614c6a2a164cc8afbb7f348fdf6d048834dc0cb2a94a22638b8d4dcd72eaeb14</span><br><span class="line">Deleted: sha256:9a39bc364e8d141bdab60a80946e4af10513cb070c34e4bda1b1cbbf88f9dca3</span><br><span class="line">Untagged: dev-peer0.org2.example.com-mycc-1.0-15b571b3ce849066b7ec74497da3b27e54e0df1345daff3951b94245ce09c42b:latest</span><br><span class="line">Deleted: sha256:63a4ecd2677f62197f547b1cef9041e3f3ad5c929b1dcd139610b106862a92b5</span><br><span class="line">Deleted: sha256:6a30b775f40f687d0ed98fe9d5fdd2da60ce22753b066db599e4308303f16c13</span><br><span class="line">Deleted: sha256:d94c0213bc68b7ee8dfa942c82c07cf8d8b3e7a4d68cf5ca79d372557e5f6567</span><br><span class="line">Deleted: sha256:c720d5e3b8c3b5690da0b10588517592ca11d94b3427cf75e88be0e000352ec9</span><br></pre></td></tr></table></figure>
<h2 id="部署网络步骤详解"><a href="#部署网络步骤详解" class="headerlink" title="部署网络步骤详解"></a>部署网络步骤详解</h2><h3 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h3><ol>
<li>以下用到的工具都在<code>fabric-samples/bin</code>目录下，手动执行记得把该目录添加到PATH。</li>
<li>这些目录下的工具必须是跟当前<code>fabirc</code>项目是版本匹配的，最好把fabric编译生成的工具<code>fabric/build/bin/*</code>，拷贝到<code>fabric-samples/bin</code>目录。</li>
<li>执行<code>./byfn.sh down</code>清理掉之前启动的数据，不然可能造成错误。</li>
</ol>
<h3 id="生成证书"><a href="#生成证书" class="headerlink" title="生成证书"></a>生成证书</h3><p>从<code>byfn.sh</code>中能找到生成证书的命令，手动执行命令可以生成证书，生成的证书在crypto-config目录下。</p>
<p><code>crypto-config.yaml</code>是证书的配置文件。<code>ordererOrganizations</code>是系统通道组织，<code>peerOrganizations</code>是应用通道组织，包含2个组织：<code>org1.example.com</code>和<code>org2.example.com</code>。</p>
<p>各组织的子目录是：证书、MSP、私钥、TLS证书、以及组织下的用户，用户目录会包含所有用户，以及用户的各种证书。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">➜  first-network git:(release-1.4) cryptogen generate --config=./crypto-config.yaml</span><br><span class="line">org1.example.com</span><br><span class="line">org2.example.com</span><br><span class="line">➜  first-network git:(release-1.4) tree crypto-config -L 3</span><br><span class="line">crypto-config</span><br><span class="line">├── ordererOrganizations</span><br><span class="line">│   └── example.com</span><br><span class="line">│       ├── ca</span><br><span class="line">│       ├── msp</span><br><span class="line">│       ├── orderers</span><br><span class="line">│       ├── tlsca</span><br><span class="line">│       └── users</span><br><span class="line">└── peerOrganizations</span><br><span class="line">    ├── org1.example.com</span><br><span class="line">    │   ├── ca</span><br><span class="line">    │   ├── msp</span><br><span class="line">    │   ├── peers</span><br><span class="line">    │   ├── tlsca</span><br><span class="line">    │   └── users</span><br><span class="line">    └── org2.example.com</span><br><span class="line">        ├── ca</span><br><span class="line">        ├── msp</span><br><span class="line">        ├── peers</span><br><span class="line">        ├── tlsca</span><br><span class="line">        └── users</span><br><span class="line"></span><br><span class="line">20 directories, 0 files</span><br></pre></td></tr></table></figure>
<h3 id="生成创世块"><a href="#生成创世块" class="headerlink" title="生成创世块"></a>生成创世块</h3><p>系统通道保存的链是系统链，链上的区块都是配置信息，它的第一个区块，被称为创世块<code>genesis.block</code>，用来初始化系统链。</p>
<p>生成创世块的工具是<code>configtxgen</code>，会自动在执行目录下寻找<code>configtx.yaml</code>文件，该文件包含了网络的初始配置，使用<code>-profile</code>指定系统链的配置<code>TwoOrgsOrdererGenesis</code>，该变量定义在<code>configtx.yaml</code>中。</p>
<p>使用<code>-outputBlock</code>指定输出的创世块文件。</p>
<p>命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">configtxgen -profile TwoOrgsOrdererGenesis -channelID byfn-sys-channel -outputBlock ./channel-artifacts/genesis.block</span><br></pre></td></tr></table></figure>
<p>记录：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">➜  first-network git:(release-1.4) configtxgen -profile TwoOrgsOrdererGenesis -channelID byfn-sys-channel -outputBlock ./channel-artifacts/genesis.block</span><br><span class="line">2019-07-29 07:17:02.140 UTC [common.tools.configtxgen] main -&gt; INFO 001 Loading configuration</span><br><span class="line">2019-07-29 07:17:02.229 UTC [common.tools.configtxgen.localconfig] completeInitialization -&gt; INFO 002 orderer type: solo</span><br><span class="line">2019-07-29 07:17:02.229 UTC [common.tools.configtxgen.localconfig] Load -&gt; INFO 003 Loaded configuration: /home/centos/go/src/github.com/hyperledger/fabric-samples/first-network/configtx.yaml</span><br><span class="line">2019-07-29 07:17:02.311 UTC [common.tools.configtxgen.localconfig] completeInitialization -&gt; INFO 004 orderer type: solo</span><br><span class="line">2019-07-29 07:17:02.311 UTC [common.tools.configtxgen.localconfig] LoadTopLevel -&gt; INFO 005 Loaded configuration: /home/centos/go/src/github.com/hyperledger/fabric-samples/first-network/configtx.yaml</span><br><span class="line">2019-07-29 07:17:02.313 UTC [common.tools.configtxgen] doOutputBlock -&gt; INFO 006 Generating genesis block</span><br><span class="line">2019-07-29 07:17:02.313 UTC [common.tools.configtxgen] doOutputBlock -&gt; INFO 007 Writing genesis block</span><br><span class="line">➜  first-network git:(release-1.4) ls channel-artifacts</span><br><span class="line">genesis.block</span><br></pre></td></tr></table></figure>
<p>以上命令是采用Solo共识算法创世块，如果使用<strong>Raft</strong>需要使用<code>-profile SampleMultiNodeEtcdRaft</code>选项：</p>
<p>命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">configtxgen -profile SampleMultiNodeEtcdRaft -channelID byfn-sys-channel -outputBlock ./channel-artifacts/genesis.block</span><br></pre></td></tr></table></figure>
<p>记录：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">➜  first-network git:(release-1.4) configtxgen -profile SampleMultiNodeEtcdRaft -channelID byfn-sys-channel -outputBlock ./channel-artifacts/genesis.block</span><br><span class="line">2019-07-29 08:44:18.348 UTC [common.tools.configtxgen] main -&gt; INFO 001 Loading configuration</span><br><span class="line">2019-07-29 08:44:18.444 UTC [common.tools.configtxgen.localconfig] completeInitialization -&gt; INFO 002 orderer type: etcdraft</span><br><span class="line">2019-07-29 08:44:18.444 UTC [common.tools.configtxgen.localconfig] completeInitialization -&gt; INFO 003 Orderer.EtcdRaft.Options unset, setting to tick_interval:&quot;500ms&quot; election_tick:10 heartbeat_tick:1 max_inflight_blocks:5 snapshot_interval_size:20971520</span><br><span class="line">2019-07-29 08:44:18.444 UTC [common.tools.configtxgen.localconfig] Load -&gt; INFO 004 Loaded configuration: /home/centos/go/src/github.com/hyperledger/fabric-samples/first-network/configtx.yaml</span><br><span class="line">2019-07-29 08:44:18.552 UTC [common.tools.configtxgen.localconfig] completeInitialization -&gt; INFO 005 orderer type: solo</span><br><span class="line">2019-07-29 08:44:18.553 UTC [common.tools.configtxgen.localconfig] LoadTopLevel -&gt; INFO 006 Loaded configuration: /home/centos/go/src/github.com/hyperledger/fabric-samples/first-network/configtx.yaml</span><br><span class="line">2019-07-29 08:44:18.558 UTC [common.tools.configtxgen] doOutputBlock -&gt; INFO 007 Generating genesis block</span><br><span class="line">2019-07-29 08:44:18.559 UTC [common.tools.configtxgen] doOutputBlock -&gt; INFO 008 Writing genesis block</span><br></pre></td></tr></table></figure>
<h3 id="生成创建应用通道的交易"><a href="#生成创建应用通道的交易" class="headerlink" title="生成创建应用通道的交易"></a>生成创建应用通道的交易</h3><p>网络启动后，只有1个系统通道，应用通道需要通过交易生成，这个交易（channel.tx）需要使用<code>configtxgen</code>工具创建，具体命令如下，<code>-outputCreateChannelTx</code>说明了是要生成创建应用通道的交易。</p>
<p>命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">configtxgen -profile TwoOrgsChannel -outputCreateChannelTx ./channel-artifacts/channel.tx -channelID mychannel</span><br></pre></td></tr></table></figure>
<p>记录：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">➜  first-network git:(release-1.4) configtxgen -profile TwoOrgsChannel -outputCreateChannelTx ./channel-artifacts/channel.tx -channelID mychannel</span><br><span class="line">2019-07-29 07:26:03.976 UTC [common.tools.configtxgen] main -&gt; INFO 001 Loading configuration</span><br><span class="line">2019-07-29 07:26:04.072 UTC [common.tools.configtxgen.localconfig] Load -&gt; INFO 002 Loaded configuration: /home/centos/go/src/github.com/hyperledger/fabric-samples/first-network/configtx.yaml</span><br><span class="line">2019-07-29 07:26:04.169 UTC [common.tools.configtxgen.localconfig] completeInitialization -&gt; INFO 003 orderer type: solo</span><br><span class="line">2019-07-29 07:26:04.169 UTC [common.tools.configtxgen.localconfig] LoadTopLevel -&gt; INFO 004 Loaded configuration: /home/centos/go/src/github.com/hyperledger/fabric-samples/first-network/configtx.yaml</span><br><span class="line">2019-07-29 07:26:04.169 UTC [common.tools.configtxgen] doOutputChannelCreateTx -&gt; INFO 005 Generating new channel configtx</span><br><span class="line">2019-07-29 07:26:04.172 UTC [common.tools.configtxgen] doOutputChannelCreateTx -&gt; INFO 006 Writing new channel tx</span><br><span class="line">➜  first-network git:(release-1.4)</span><br><span class="line">➜  first-network git:(release-1.4) ls channel-artifacts</span><br><span class="line">channel.tx  genesis.block</span><br></pre></td></tr></table></figure>
<h3 id="生成更新组织1的锚节点交易"><a href="#生成更新组织1的锚节点交易" class="headerlink" title="生成更新组织1的锚节点交易"></a>生成更新组织1的锚节点交易</h3><p>组织节点加入到应用通道后，需要更新系统配置，把组织1的锚节点写入到配置块，这个也需要通过1笔交易完成。工具依然是<code>configtxgen</code>，<code>-outputAnchorPeersUpdate</code>表明了这是生成更新组织锚节点配置交易的操作。</p>
<p>命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">configtxgen -profile TwoOrgsChannel -outputAnchorPeersUpdate ./channel-artifacts/Org1MSPanchors.tx -channelID mychannel -asOrg Org1MSP</span><br></pre></td></tr></table></figure>
<p>记录：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">➜  first-network git:(release-1.4) configtxgen -profile TwoOrgsChannel -outputAnchorPeersUpdate ./channel-artifacts/Org1MSPanchors.tx -channelID mychannel -asOrg Org1MSP</span><br><span class="line">2019-07-29 07:30:26.456 UTC [common.tools.configtxgen] main -&gt; INFO 001 Loading configuration</span><br><span class="line">2019-07-29 07:30:26.557 UTC [common.tools.configtxgen.localconfig] Load -&gt; INFO 002 Loaded configuration: /home/centos/go/src/github.com/hyperledger/fabric-samples/first-network/configtx.yaml</span><br><span class="line">2019-07-29 07:30:26.640 UTC [common.tools.configtxgen.localconfig] completeInitialization -&gt; INFO 003 orderer type: solo</span><br><span class="line">2019-07-29 07:30:26.640 UTC [common.tools.configtxgen.localconfig] LoadTopLevel -&gt; INFO 004 Loaded configuration: /home/centos/go/src/github.com/hyperledger/fabric-samples/first-network/configtx.yaml</span><br><span class="line">2019-07-29 07:30:26.640 UTC [common.tools.configtxgen] doOutputAnchorPeersUpdate -&gt; INFO 005 Generating anchor peer update</span><br><span class="line">2019-07-29 07:30:26.641 UTC [common.tools.configtxgen] doOutputAnchorPeersUpdate -&gt; INFO 006 Writing anchor peer update</span><br><span class="line">➜  first-network git:(release-1.4)</span><br><span class="line">➜  first-network git:(release-1.4) ls channel-artifacts</span><br><span class="line">channel.tx  genesis.block  Org1MSPanchors.tx</span><br></pre></td></tr></table></figure>
<h3 id="生成更新组织2的锚节点交易"><a href="#生成更新组织2的锚节点交易" class="headerlink" title="生成更新组织2的锚节点交易"></a>生成更新组织2的锚节点交易</h3><p>与上面类似，这是生成组织2锚节点配置的交易。</p>
<p>命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">configtxgen -profile TwoOrgsChannel -outputAnchorPeersUpdate ./channel-artifacts/Org2MSPanchors.tx -channelID mychannel -asOrg Org2MSP</span><br></pre></td></tr></table></figure>
<p>记录：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">➜  first-network git:(release-1.4) configtxgen -profile TwoOrgsChannel -outputAnchorPeersUpdate ./channel-artifacts/Org2MSPanchors.tx -channelID mychannel -asOrg Org2MSP</span><br><span class="line">2019-07-29 07:32:45.446 UTC [common.tools.configtxgen] main -&gt; INFO 001 Loading configuration</span><br><span class="line">2019-07-29 07:32:45.567 UTC [common.tools.configtxgen.localconfig] Load -&gt; INFO 002 Loaded configuration: /home/centos/go/src/github.com/hyperledger/fabric-samples/first-network/configtx.yaml</span><br><span class="line">2019-07-29 07:32:45.662 UTC [common.tools.configtxgen.localconfig] completeInitialization -&gt; INFO 003 orderer type: solo</span><br><span class="line">2019-07-29 07:32:45.662 UTC [common.tools.configtxgen.localconfig] LoadTopLevel -&gt; INFO 004 Loaded configuration: /home/centos/go/src/github.com/hyperledger/fabric-samples/first-network/configtx.yaml</span><br><span class="line">2019-07-29 07:32:45.662 UTC [common.tools.configtxgen] doOutputAnchorPeersUpdate -&gt; INFO 005 Generating anchor peer update</span><br><span class="line">2019-07-29 07:32:45.662 UTC [common.tools.configtxgen] doOutputAnchorPeersUpdate -&gt; INFO 006 Writing anchor peer update</span><br><span class="line">➜  first-network git:(release-1.4) ls ./channel-artifacts/</span><br><span class="line">channel.tx  genesis.block  Org1MSPanchors.tx  Org2MSPanchors.tx</span><br></pre></td></tr></table></figure>
<h3 id="启动网络-1"><a href="#启动网络-1" class="headerlink" title="启动网络"></a>启动网络</h3><p>启动网络涉及到docker容器的创建与启动，这部分不挨个手动执行，使用<code>byfn.sh</code>完成，这样可以完成fabric网络的启动，系统通道的启动也在这个阶段完成。</p>
<p><code>byfn.sh</code>利用<code>scripts/script.sh</code>完成的从创建应用通道到调研合约、查询合约的过程，这部分继续手动执行，需要注释掉<code>byfn.sh</code>中的下面这行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec cli scripts/script.sh $CHANNEL_NAME $CLI_DELAY $LANGUAGE $CLI_TIMEOUT $VERBOSE $NO_CHAINCODE</span><br></pre></td></tr></table></figure>
<p>然后执行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./byfn.sh up</span><br></pre></td></tr></table></figure>
<p>这样启动的是solo共识算法的网络，我启动的是raft共识的网络：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./byfn.sh up -o etcdraft</span><br></pre></td></tr></table></figure>
<p>如果是solo，启动起来的容器与<a href="#快速启动你的第一个Fabric网络">快速启动你的第一个Fabric网络</a>中的类似，只不过缺少3个链码容器。如果是raft应当是下面这样：</p>
<ul>
<li>5个orderer节点，</li>
<li>4个peer节点</li>
<li>1个cli客户端</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">➜  first-network git:(r1.4-raft) ✗ docker ps</span><br><span class="line">CONTAINER ID        IMAGE                               COMMAND             CREATED             STATUS              PORTS                      NAMES</span><br><span class="line">fc0891e02afd        hyperledger/fabric-tools:latest     &quot;/bin/bash&quot;         26 seconds ago      Up 25 seconds                                  cli</span><br><span class="line">9363a51d3f68        hyperledger/fabric-orderer:latest   &quot;orderer&quot;           29 seconds ago      Up 25 seconds       0.0.0.0:10050-&gt;7050/tcp    orderer4.example.com</span><br><span class="line">7d9c13f964a5        hyperledger/fabric-orderer:latest   &quot;orderer&quot;           29 seconds ago      Up 25 seconds       0.0.0.0:7050-&gt;7050/tcp     orderer.example.com</span><br><span class="line">e16a90f3f3fc        hyperledger/fabric-peer:latest      &quot;peer node start&quot;   29 seconds ago      Up 25 seconds       0.0.0.0:7051-&gt;7051/tcp     peer0.org1.example.com</span><br><span class="line">4c7776287dc7        hyperledger/fabric-peer:latest      &quot;peer node start&quot;   29 seconds ago      Up 27 seconds       0.0.0.0:8051-&gt;8051/tcp     peer1.org1.example.com</span><br><span class="line">aaeab5fdb418        hyperledger/fabric-orderer:latest   &quot;orderer&quot;           30 seconds ago      Up 27 seconds       0.0.0.0:11050-&gt;7050/tcp    orderer5.example.com</span><br><span class="line">817a3ec7dd9d        hyperledger/fabric-peer:latest      &quot;peer node start&quot;   30 seconds ago      Up 27 seconds       0.0.0.0:10051-&gt;10051/tcp   peer1.org2.example.com</span><br><span class="line">26524f34f654        hyperledger/fabric-peer:latest      &quot;peer node start&quot;   30 seconds ago      Up 27 seconds       0.0.0.0:9051-&gt;9051/tcp     peer0.org2.example.com</span><br><span class="line">2485874c48d1        hyperledger/fabric-orderer:latest   &quot;orderer&quot;           30 seconds ago      Up 27 seconds       0.0.0.0:8050-&gt;7050/tcp     orderer2.example.com</span><br><span class="line">5a8142d00432        hyperledger/fabric-orderer:latest   &quot;orderer&quot;           30 seconds ago      Up 28 seconds       0.0.0.0:9050-&gt;7050/tcp     orderer3.example.com</span><br></pre></td></tr></table></figure>
<h3 id="创建应用通道"><a href="#创建应用通道" class="headerlink" title="创建应用通道"></a>创建应用通道</h3><p>连接cli发送创建mychannel的交易。</p>
<p>命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer channel create -o orderer.example.com:7050 -c mychannel -f ./channel-artifacts/channel.tx --tls true --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem</span><br></pre></td></tr></table></figure>
<p>记录：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">➜  first-network git:(r1.4-raft) ✗ docker exec -it cli  /bin/bash</span><br><span class="line">root@fc0891e02afd:/opt/gopath/src/github.com/hyperledger/fabric/peer# ls</span><br><span class="line">channel-artifacts  crypto  scripts</span><br><span class="line">root@fc0891e02afd:/opt/gopath/src/github.com/hyperledger/fabric/peer# ls channel-artifacts/</span><br><span class="line">Org1MSPanchors.tx  Org2MSPanchors.tx  channel.tx  genesis.block</span><br><span class="line">root@fc0891e02afd:/opt/gopath/src/github.com/hyperledger/fabric/peer# peer channel create -o orderer.example.com:7050 -c mychannel -f ./channel-artifacts/channel.tx --tls true --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem</span><br><span class="line">2019-07-29 11:25:57.987 UTC [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized</span><br><span class="line">2019-07-29 11:25:58.026 UTC [cli.common] readBlock -&gt; INFO 002 Got status: &amp;&#123;NOT_FOUND&#125;</span><br><span class="line">2019-07-29 11:25:58.029 UTC [channelCmd] InitCmdFactory -&gt; INFO 003 Endorser and orderer connections initialized</span><br><span class="line">2019-07-29 11:25:58.231 UTC [cli.common] readBlock -&gt; INFO 004 Got status: &amp;&#123;SERVICE_UNAVAILABLE&#125;</span><br><span class="line">2019-07-29 11:25:58.234 UTC [channelCmd] InitCmdFactory -&gt; INFO 005 Endorser and orderer connections initialized</span><br><span class="line">2019-07-29 11:25:58.436 UTC [cli.common] readBlock -&gt; INFO 006 Got status: &amp;&#123;SERVICE_UNAVAILABLE&#125;</span><br><span class="line">2019-07-29 11:25:58.441 UTC [channelCmd] InitCmdFactory -&gt; INFO 007 Endorser and orderer connections initialized</span><br><span class="line">2019-07-29 11:25:58.643 UTC [cli.common] readBlock -&gt; INFO 008 Got status: &amp;&#123;SERVICE_UNAVAILABLE&#125;</span><br><span class="line">2019-07-29 11:25:58.646 UTC [channelCmd] InitCmdFactory -&gt; INFO 009 Endorser and orderer connections initialized</span><br><span class="line">2019-07-29 11:25:58.848 UTC [cli.common] readBlock -&gt; INFO 00a Got status: &amp;&#123;SERVICE_UNAVAILABLE&#125;</span><br><span class="line">2019-07-29 11:25:58.852 UTC [channelCmd] InitCmdFactory -&gt; INFO 00b Endorser and orderer connections initialized</span><br><span class="line">2019-07-29 11:25:59.053 UTC [cli.common] readBlock -&gt; INFO 00c Got status: &amp;&#123;SERVICE_UNAVAILABLE&#125;</span><br><span class="line">2019-07-29 11:25:59.056 UTC [channelCmd] InitCmdFactory -&gt; INFO 00d Endorser and orderer connections initialized</span><br><span class="line">2019-07-29 11:25:59.260 UTC [cli.common] readBlock -&gt; INFO 00e Received block: 0</span><br><span class="line">root@fc0891e02afd:/opt/gopath/src/github.com/hyperledger/fabric/peer#</span><br></pre></td></tr></table></figure>
<h4 id="确认应用通道创建成功"><a href="#确认应用通道创建成功" class="headerlink" title="确认应用通道创建成功"></a>确认应用通道创建成功</h4><p>连接orderer查看mychannel是否创建，可以看到已经存在mychannel目录，证明mychannel已创建。</p>
<p>命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls /var/hyperledger/production/orderer/chains/mychannel/</span><br></pre></td></tr></table></figure>
<p>记录：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ docker exec -it orderer.example.com bash</span><br><span class="line">root@7d9c13f964a5:/opt/gopath/src/github.com/hyperledger/fabric# ls</span><br><span class="line">root@7d9c13f964a5:/opt/gopath/src/github.com/hyperledger/fabric# ls /var/hyperledger/production/orderer/chains/mychannel/</span><br><span class="line">blockfile_000000</span><br></pre></td></tr></table></figure>
<h3 id="加入应用通道"><a href="#加入应用通道" class="headerlink" title="加入应用通道"></a>加入应用通道</h3><p>从cli上可以发起peer0.org1加入mychannel的交易请求，方法是通过让<code>peer channel join</code>读取环境变量信息，环境变量决定了当前为哪个peer进行处理。</p>
<p><code>CORE_PEER*</code>相关的环境变量，代表了所有和peer相关的配置信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@fc0891e02afd:/opt/gopath/src/github.com/hyperledger/fabric/peer# env | grep &quot;CORE_PEER&quot;</span><br><span class="line">CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt</span><br><span class="line">CORE_PEER_TLS_KEY_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.key</span><br><span class="line">CORE_PEER_LOCALMSPID=Org1MSP</span><br><span class="line">CORE_PEER_TLS_CERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.crt</span><br><span class="line">CORE_PEER_TLS_ENABLED=true</span><br><span class="line">CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp</span><br><span class="line">CORE_PEER_ID=cli</span><br><span class="line">CORE_PEER_ADDRESS=peer0.org1.example.com:7051</span><br></pre></td></tr></table></figure>
<p>切换peer时，只需修改以下4个环境变量，它们代表当前是哪个peer，以及peer的配置，其他环境变量通用：</p>
<ul>
<li>CORE_PEER_LOCALMSPID</li>
<li>CORE_PEER_TLS_ROOTCERT_FILE</li>
<li>CORE_PEER_MSPCONFIGPATH</li>
<li>CORE_PEER_ADDRESS，最易分辨当前是在为哪个peer操作，比如默认是peer0.org1</li>
</ul>
<p>以下为加入mychannel和列出当前peer(peer0.org1)所加入的通道：</p>
<p>命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">peer channel join -b mychannel.block</span><br><span class="line">peer channel list</span><br></pre></td></tr></table></figure>
<p>记录：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">➜  first-network git:(r1.4-raft) ✗ docker exec -it cli  /bin/bash</span><br><span class="line">root@fc0891e02afd:/opt/gopath/src/github.com/hyperledger/fabric/peer# ls</span><br><span class="line">channel-artifacts  crypto  mychannel.block  scripts</span><br><span class="line">root@fc0891e02afd:/opt/gopath/src/github.com/hyperledger/fabric/peer#</span><br><span class="line">root@fc0891e02afd:/opt/gopath/src/github.com/hyperledger/fabric/peer# peer channel join -b mychannel.block</span><br><span class="line">2019-07-29 11:38:30.638 UTC [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized</span><br><span class="line">2019-07-29 11:38:30.719 UTC [channelCmd] executeJoin -&gt; INFO 002 Successfully submitted proposal to join channel</span><br><span class="line">root@fc0891e02afd:/opt/gopath/src/github.com/hyperledger/fabric/peer#</span><br><span class="line">root@fc0891e02afd:/opt/gopath/src/github.com/hyperledger/fabric/peer# peer channel list</span><br><span class="line">2019-07-29 11:45:29.692 UTC [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized</span><br><span class="line">Channels peers has joined:</span><br><span class="line">mychannel</span><br></pre></td></tr></table></figure>
<p>也可以登录peer0.org1去查看peer加入的通道：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ docker exec -it peer0.org1.example.com bash</span><br><span class="line">root@e16a90f3f3fc:/opt/gopath/src/github.com/hyperledger/fabric/peer# peer channel list</span><br><span class="line">2019-07-29 11:59:51.415 UTC [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized</span><br><span class="line">Channels peers has joined:</span><br><span class="line">mychannel</span><br></pre></td></tr></table></figure>
<blockquote>
<p>没有命令能够查看某个通道所有的peer。</p>
</blockquote>
<p>peer0.org1重复加入会发起proposal失败：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@fc0891e02afd:/opt/gopath/src/github.com/hyperledger/fabric/peer# peer channel join -b mychannel.block</span><br><span class="line">2019-07-29 11:58:25.746 UTC [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized</span><br><span class="line">Error: proposal failed (err: bad proposal response 500: cannot create ledger from genesis block: LedgerID already exists)</span><br></pre></td></tr></table></figure>
<p>修改环境变量的规则见<code>fabric-samples/first-network/scripts/utils.sh</code>中的<code>setGloabls</code>函数。以下是peer1.org0加入mychanel:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">CORE_PEER_LOCALMSPID=&quot;Org1MSP&quot;</span><br><span class="line">CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt</span><br><span class="line">CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp</span><br><span class="line">CORE_PEER_ADDRESS=peer1.org1.example.com:8051</span><br><span class="line"># 执行加入通道</span><br><span class="line">root@fc0891e02afd:/opt/gopath/src/github.com/hyperledger/fabric/peer# peer channel join -b mychannel.block</span><br><span class="line">2019-07-29 12:01:20.752 UTC [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized</span><br><span class="line">2019-07-29 12:01:20.832 UTC [channelCmd] executeJoin -&gt; INFO 002 Successfully submitted proposal to join channel</span><br></pre></td></tr></table></figure>
<h4 id="确认peer加入的应用通道和数据"><a href="#确认peer加入的应用通道和数据" class="headerlink" title="确认peer加入的应用通道和数据"></a>确认peer加入的应用通道和数据</h4><p>登录peer1.org1确认已经加入mychanel，以及同步到了mychannel上的链数据：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ docker exec -it peer1.org1.example.com bash</span><br><span class="line">root@4c7776287dc7:/opt/gopath/src/github.com/hyperledger/fabric/peer# peer channel list</span><br><span class="line">2019-07-29 12:02:48.662 UTC [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized</span><br><span class="line">Channels peers has joined:</span><br><span class="line">mychannel</span><br><span class="line">root@4c7776287dc7:/opt/gopath/src/github.com/hyperledger/fabric/peer# ls /var/hyperledger/production/ledgersData/chains/chains/mychannel/blockfile_000000</span><br><span class="line">/var/hyperledger/production/ledgersData/chains/chains/mychannel/blockfile_000000</span><br></pre></td></tr></table></figure>
<h3 id="更新锚节点配置"><a href="#更新锚节点配置" class="headerlink" title="更新锚节点配置"></a>更新锚节点配置</h3><p>使用cli更新peer1.org1的锚节点配置：</p>
<blockquote>
<p>因为上一步操作环境变量已经修改成peer1.org1的，所以，就直接让peer1.org1做锚节点好了。</p>
</blockquote>
<p>命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer channel update -o orderer.example.com:7050 -c mychannel -f ./channel-artifacts/Org1MSPanchors.tx --tls true --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem</span><br></pre></td></tr></table></figure>
<p>记录：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@fc0891e02afd:/opt/gopath/src/github.com/hyperledger/fabric/peer# peer channel update -o orderer.example.com:7050 -c mychannel -f ./channel-artifacts/Org1MSPanchors.tx --tls true --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem</span><br><span class="line">2019-07-29 12:05:12.585 UTC [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized</span><br><span class="line">2019-07-29 12:05:12.609 UTC [channelCmd] update -&gt; INFO 002 Successfully submitted channel update</span><br></pre></td></tr></table></figure>
<h3 id="安装链码"><a href="#安装链码" class="headerlink" title="安装链码"></a>安装链码</h3><p>使用cli为peer1.org1安装链码，安装链码是把链码源码打包和拷贝到peer节点的文件系统上，具体见<a href="http://lessisbetter.site/2019/07/25/fabric-concepts-notes/#安装链码">快速入门Fabric核心概念和框架：安装链码</a>。</p>
<p>安装命令为<code>peer channel isntall</code>，包含了以下参数：</p>
<ul>
<li><code>-n mycc</code>：链码名称</li>
<li><code>-v 1.0</code>：链码版本</li>
<li><code>-l golang</code>：链码语言</li>
<li><code>-p github.com/chaincode/chaincode_example02/go/</code>：本地链码代码所在路径，从<code>$GOPATH/src</code>下开始搜索。</li>
</ul>
<p>更多选项见<code>peer chaincode install -h</code>。</p>
<p>命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode install -n mycc -v 1.0 -l golang -p github.com/chaincode/chaincode_example02/go/</span><br></pre></td></tr></table></figure>
<p>记录：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 查看链码源码</span><br><span class="line">root@fc0891e02afd:/opt/gopath/src/github.com/hyperledger/fabric/peer# ls ../../../../github.com/chaincode/chaincode_example02/go/</span><br><span class="line">chaincode_example02.go</span><br><span class="line"># 安装链码</span><br><span class="line">root@fc0891e02afd:/opt/gopath/src/github.com/hyperledger/fabric/peer# peer chaincode install -n mycc -v 1.0 -l golang -p github.com/chaincode/chaincode_example02/go/</span><br><span class="line">2019-07-30 02:09:10.516 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 001 Using default escc</span><br><span class="line">2019-07-30 02:09:10.516 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 002 Using default vscc</span><br><span class="line">2019-07-30 02:09:10.800 UTC [chaincodeCmd] install -&gt; INFO 003 Installed remotely response:&lt;status:200 payload:&quot;OK&quot; &gt;</span><br></pre></td></tr></table></figure>
<h4 id="查看安装的链码"><a href="#查看安装的链码" class="headerlink" title="查看安装的链码"></a>查看安装的链码</h4><p>2种方式。</p>
<p>1、在cli上执行查询：</p>
<p>命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode list --installed</span><br></pre></td></tr></table></figure>
<p>记录：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@fc0891e02afd:/opt/gopath/src/github.com/hyperledger/fabric/peer# peer chaincode list --installed</span><br><span class="line">Get installed chaincodes on peer:</span><br><span class="line">Name: mycc, Version: 1.0, Path: github.com/chaincode/chaincode_example02/go/, Id: 476fca1a949274001971f1ec2836cb09321f0b71268b3762d68931c93f218134</span><br></pre></td></tr></table></figure>
<p>2、登录到peer1.org1上查询链码文件：</p>
<p>命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls /var/hyperledger/production/chaincodes</span><br></pre></td></tr></table></figure>
<p>记录：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@4c7776287dc7:/opt/gopath/src/github.com/hyperledger/fabric/peer# ls /var/hyperledger/production/chaincodes/mycc.1.0</span><br><span class="line">/var/hyperledger/production/chaincodes/mycc.1.0</span><br></pre></td></tr></table></figure>
<h4 id="链码安装过程"><a href="#链码安装过程" class="headerlink" title="链码安装过程"></a>链码安装过程</h4><p>也可以查看peer1.org1安装链码的日志：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ docker logs peer1.org1.example.com</span><br><span class="line">...省略老日志</span><br><span class="line">2019-07-30 02:09:10.796 UTC [endorser] callChaincode -&gt; INFO 04b [][876f7f14] Entry chaincode: name:&quot;lscc&quot;</span><br><span class="line">2019-07-30 02:09:10.799 UTC [lscc] executeInstall -&gt; INFO 04c Installed Chaincode [mycc] Version [1.0] to peer</span><br><span class="line">2019-07-30 02:09:10.799 UTC [endorser] callChaincode -&gt; INFO 04d [][876f7f14] Exit chaincode: name:&quot;lscc&quot;  (2ms)</span><br><span class="line">2019-07-30 02:09:10.799 UTC [comm.grpc.server] 1 -&gt; INFO 04e unary call completed grpc.service=protos.Endorser grpc.method=ProcessProposal grpc.peer_address=172.28.0.11:35232 grpc.code=OK grpc.call_duration=3.276308ms</span><br><span class="line">2019-07-30 02:10:51.409 UTC [endorser] callChaincode -&gt; INFO 04f [][9db45293] Entry chaincode: name:&quot;lscc&quot;</span><br><span class="line">2019-07-30 02:10:51.411 UTC [endorser] callChaincode -&gt; INFO 050 [][9db45293] Exit chaincode: name:&quot;lscc&quot;  (2ms)</span><br><span class="line">2019-07-30 02:10:51.411 UTC [comm.grpc.server] 1 -&gt; INFO 051 unary call completed grpc.service=protos.Endorser grpc.method=ProcessProposal grpc.peer_address=172.28.0.11:35240 grpc.code=OK grpc.call_duration=2.667734ms</span><br></pre></td></tr></table></figure>
<h3 id="部署链码"><a href="#部署链码" class="headerlink" title="部署链码"></a>部署链码</h3><p>实例化链码也成部署链码，鉴于少1个字，下文使用部署链码。</p>
<p>通过cli部署链码，由于之前设置的环境变量，部署等价于由peer1.org1触发。</p>
<p>在一个通道上，链码只需部署1次，所以无需每个peer都去部署链码。部署链码实际是一笔部署交易，该交易的结果就是部署链码容器。</p>
<p>部署命令是<code>peer chaincode instantiate</code>，需要使用以下标记：</p>
<ul>
<li><code>-o orderer.example.com:7050</code>：指定要连接的orderer节点</li>
<li><code>--tls true</code>：开启TLS验证</li>
<li><code>--cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem</code>：使用的CA证书文件，注意使用的是orderer的证书</li>
<li><code>-C mychannel</code>：在哪个通道上部署</li>
<li><code>-n mycc</code>：链码名称</li>
<li><code>-l golang</code>：链码语言</li>
<li><code>-v 1.0</code>：链码版本</li>
<li><code>-c &#39;{&quot;Args&quot;:[&quot;init&quot;,&quot;a&quot;,&quot;100&quot;,&quot;b&quot;,&quot;200&quot;]}&#39;</code>：链码的构建过程消息，JSON格式，调用<code>init</code>函数，设置a和b的值</li>
<li><code>-P &#39;AND (&#39;\&#39;&#39;Org1MSP.peer&#39;\&#39;&#39;,&#39;\&#39;&#39;Org2MSP.peer&#39;\&#39;&#39;)&#39;</code>：指定背书策略，必须由org1和org2同时背书</li>
</ul>
<p>命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode instantiate -o orderer.example.com:7050 --tls true --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n mycc -l golang -v 1.0 -c &apos;&#123;&quot;Args&quot;:[&quot;init&quot;,&quot;a&quot;,&quot;100&quot;,&quot;b&quot;,&quot;200&quot;]&#125;&apos; -P &apos;AND (&apos;\&apos;&apos;Org1MSP.peer&apos;\&apos;&apos;,&apos;\&apos;&apos;Org2MSP.peer&apos;\&apos;&apos;)&apos;</span><br></pre></td></tr></table></figure>
<p>部署和快速查询如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@fc0891e02afd:/opt/gopath/src/github.com/hyperledger/fabric/peer# peer chaincode instantiate -o orderer.example.com:7050 --tls true --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n mycc -l golang -v 1.0 -c &apos;&#123;&quot;Args&quot;:[&quot;init&quot;,&quot;a&quot;,&quot;100&quot;,&quot;b&quot;,&quot;200&quot;]&#125;&apos; -P &apos;AND (&apos;\&apos;&apos;Org1MSP.peer&apos;\&apos;&apos;,&apos;\&apos;&apos;Org2MSP.peer&apos;\&apos;&apos;)&apos;</span><br><span class="line">2019-07-30 02:18:57.119 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 001 Using default escc</span><br><span class="line">2019-07-30 02:18:57.119 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 002 Using default vscc</span><br><span class="line">root@fc0891e02afd:/opt/gopath/src/github.com/hyperledger/fabric/peer#</span><br><span class="line">root@fc0891e02afd:/opt/gopath/src/github.com/hyperledger/fabric/peer# peer chaincode list --instantiated -C &quot;mychannel&quot;</span><br><span class="line">Get instantiated chaincodes on channel mychannel:</span><br><span class="line">Name: mycc, Version: 1.0, Path: github.com/chaincode/chaincode_example02/go/, Escc: escc, Vscc: vscc</span><br></pre></td></tr></table></figure>
<h4 id="查看部署的链码"><a href="#查看部署的链码" class="headerlink" title="查看部署的链码"></a>查看部署的链码</h4><p>链码部署后，会启动链码容器，可以查看：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ docker ps</span><br><span class="line">CONTAINER ID        IMAGE                                                                                                  COMMAND                  CREATED             STATUS              PORTS                      NAMES</span><br><span class="line">8bab025e153e        dev-peer1.org1.example.com-mycc-1.0-cd123150154e6bf2df7ce682e0b1bcbea40499416f37a6da3aae14c4eb51b08d   &quot;chaincode -peer.add…&quot;   11 minutes ago      Up 11 minutes                                  dev-peer1.org1.example.com-mycc-1.0</span><br></pre></td></tr></table></figure>
<p>查看链码容器日志：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ docker logs dev-peer1.org1.example.com-mycc-1.0</span><br><span class="line">ex02 Init</span><br><span class="line">Aval = 100, Bval = 200</span><br></pre></td></tr></table></figure>
<h4 id="部署链码的过程"><a href="#部署链码的过程" class="headerlink" title="部署链码的过程"></a>部署链码的过程</h4><p>可以通过peer1.org1的日志查看：</p>
<ol>
<li>背书</li>
<li>生成Docker构建镜像：GenerateDockerBuild</li>
<li>接收到区块2（前面一步必然被orderer打包了）</li>
<li>部署链码：HandleStateUpdates</li>
<li>提交区块2</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">2019-07-30 02:17:46.522 UTC [endorser] callChaincode -&gt; INFO 052 [mychannel][1c8a3567] Entry chaincode: name:&quot;lscc&quot;</span><br><span class="line">2019-07-30 02:17:46.526 UTC [endorser] callChaincode -&gt; INFO 053 [mychannel][1c8a3567] Exit chaincode: name:&quot;lscc&quot;  (3ms)</span><br><span class="line">2019-07-30 02:17:46.527 UTC [comm.grpc.server] 1 -&gt; INFO 054 unary call completed grpc.service=protos.Endorser grpc.method=ProcessProposal grpc.peer_address=172.28.0.11:35248 grpc.code=OK grpc.call_duration=6.246381ms</span><br><span class="line">2019-07-30 02:18:57.122 UTC [endorser] callChaincode -&gt; INFO 055 [mychannel][5059d46e] Entry chaincode: name:&quot;lscc&quot;</span><br><span class="line">2019-07-30 02:18:57.141 UTC [chaincode.platform.golang] GenerateDockerBuild -&gt; INFO 056 building chaincode with ldflagsOpt: &apos;-ldflags &quot;-linkmode external -extldflags &apos;-static&apos;&quot;&apos;</span><br><span class="line">2019-07-30 02:19:12.363 UTC [endorser] callChaincode -&gt; INFO 057 [mychannel][5059d46e] Exit chaincode: name:&quot;lscc&quot;  (15240ms)</span><br><span class="line">2019-07-30 02:19:12.363 UTC [comm.grpc.server] 1 -&gt; INFO 058 unary call completed grpc.service=protos.Endorser grpc.method=ProcessProposal grpc.peer_address=172.28.0.11:35252 grpc.code=OK grpc.call_duration=15.242059303s</span><br><span class="line">2019-07-30 02:19:14.462 UTC [gossip.privdata] StoreBlock -&gt; INFO 059 [mychannel] Received block [2] from buffer</span><br><span class="line">2019-07-30 02:19:14.464 UTC [committer.txvalidator] Validate -&gt; INFO 05a [mychannel] Validated block [2] in 2ms</span><br><span class="line">2019-07-30 02:19:14.464 UTC [cceventmgmt] HandleStateUpdates -&gt; INFO 05b Channel [mychannel]: Handling deploy or update of chaincode [mycc]</span><br><span class="line">2019-07-30 02:19:14.503 UTC [kvledger] CommitWithPvtData -&gt; INFO 05c [mychannel] Committed block [2] with 1 transaction(s) in 38ms (state_validation=0ms block_and_pvtdata_commit=16ms state_commit=6ms)</span><br><span class="line">2019-07-30 02:20:41.569 UTC [endorser] callChaincode -&gt; INFO 05d [mychannel][3d51a2d1] Entry chaincode: name:&quot;lscc&quot;</span><br><span class="line">2019-07-30 02:20:41.571 UTC [endorser] callChaincode -&gt; INFO 05e [mychannel][3d51a2d1] Exit chaincode: name:&quot;lscc&quot;  (2ms)</span><br><span class="line">2019-07-30 02:20:41.571 UTC [comm.grpc.server] 1 -&gt; INFO 05f unary call completed grpc.service=protos.Endorser grpc.method=ProcessProposal grpc.peer_address=172.28.0.11:35260 grpc.code=OK grpc.call_duration=2.998184ms</span><br></pre></td></tr></table></figure>
<h3 id="查询链码"><a href="#查询链码" class="headerlink" title="查询链码"></a>查询链码</h3><p>链码查询的命令是<code>peer chaincode query</code>，需要指定通道以及链码，最后是调用参数。</p>
<p>如果key存在可以查询到正确的值，如果key不存在，查询结果提示Error。</p>
<p>命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -C mychannel -n mycc -c &apos;&#123;&quot;Args&quot;:[&quot;query&quot;,&quot;a&quot;]&#125;&apos;</span><br></pre></td></tr></table></figure>
<p>记录：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@fc0891e02afd:/opt/gopath/src/github.com/hyperledger/fabric/peer# peer chaincode query -C mychannel -n mycc -c &apos;&#123;&quot;Args&quot;:[&quot;query&quot;,&quot;a&quot;]&#125;&apos;</span><br><span class="line">100</span><br><span class="line">root@fc0891e02afd:/opt/gopath/src/github.com/hyperledger/fabric/peer# peer chaincode query -C mychannel -n mycc -c &apos;&#123;&quot;Args&quot;:[&quot;query&quot;,&quot;b&quot;]&#125;&apos;</span><br><span class="line">200</span><br><span class="line">root@fc0891e02afd:/opt/gopath/src/github.com/hyperledger/fabric/peer# peer chaincode query -C mychannel -n mycc -c &apos;&#123;&quot;Args&quot;:[&quot;query&quot;,&quot;c&quot;]&#125;&apos;</span><br><span class="line">Error: endorsement failure during query. response: status:500 message:&quot;&#123;\&quot;Error\&quot;:\&quot;Nil amount for c\&quot;&#125;&quot;</span><br></pre></td></tr></table></figure>
<p>1次查询操作，链码容器的日志会是这样，可以看到触发Invoke，然后是Query Response，并不是真正去Invoke：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ex02 Invoke</span><br><span class="line">Query Response:&#123;&quot;Name&quot;:&quot;a&quot;,&quot;Amount&quot;:&quot;100&quot;&#125;</span><br></pre></td></tr></table></figure>
<h3 id="调用链码"><a href="#调用链码" class="headerlink" title="调用链码"></a>调用链码</h3><p>调用链码是一笔调用交易，需要：</p>
<ul>
<li>指定orderer节点</li>
<li>使用TLS、指定orderer的CA证书</li>
<li>指定哪个通道的，哪个链码</li>
<li>通过peerAddresses指定背书的peer，以及要使用的证书</li>
</ul>
<p>只有当背书策略满足要求时，调用交易才会判断为有效，然后修改链码容器内的数据。</p>
<h4 id="不满足背书策略的调用交易"><a href="#不满足背书策略的调用交易" class="headerlink" title="不满足背书策略的调用交易"></a>不满足背书策略的调用交易</h4><p>以下为无效的调用交易，因为只指定了peer1.org1进行背书，而mycc的背书策略要求org1和org2的2个peer同时背书才行。</p>
<p>命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode invoke -o orderer.example.com:7050 --tls true --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n mycc --peerAddresses peer1.org1.example.com:8051 --tlsRootCertFiles /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer1.org1.example.com/tls/ca.crt  -c &apos;&#123;&quot;Args&quot;:[&quot;invoke&quot;,&quot;a&quot;,&quot;b&quot;,&quot;10&quot;]&#125;&apos;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>-c &#39;{&quot;Args&quot;:[&quot;invoke&quot;,&quot;a&quot;,&quot;b&quot;,&quot;10&quot;]}&#39;</code>指调用链码的invoke函数，参数为a, b和10，含义是对把a和b的值分别修改为a-10，b+10，具体操作可以见源码：<br>fabric-samples/chaincode/chaincode_example02/go/chaincode_example02.go。</p>
</blockquote>
<p>链码容器日志如下，可以看到触发了Invoke，值进行了变更。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ex02 Invoke</span><br><span class="line">Aval = 90, Bval = 210</span><br></pre></td></tr></table></figure>
<p>通过查询命令可以发现链码数据并未改变，因为交易proposal不满足背书策略，cli不会发起交易给orderer，数据不会提交。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@fc0891e02afd:/opt/gopath/src/github.com/hyperledger/fabric/peer# peer chaincode query -C mychannel -n mycc -c &apos;&#123;&quot;Args&quot;:[&quot;query&quot;,&quot;a&quot;]&#125;&apos;</span><br><span class="line">100</span><br><span class="line">root@fc0891e02afd:/opt/gopath/src/github.com/hyperledger/fabric/peer# peer chaincode query -C mychannel -n mycc -c &apos;&#123;&quot;Args&quot;:[&quot;query&quot;,&quot;b&quot;]&#125;&apos;</span><br><span class="line">200</span><br></pre></td></tr></table></figure>
<h4 id="有效的调用交易"><a href="#有效的调用交易" class="headerlink" title="有效的调用交易"></a>有效的调用交易</h4><p>之前安装链码时，只在peer1.org1进行了安装，但背书要求org2的节点也要进行背书，背书节点需要已经安装链码，否则无法进行背书，会返回错误的背书响应：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Error: endorsement failure during invoke. response: status:500 message:&quot;cannot retrieve package for chaincode mycc/1.0, error open /var/hyperledger/production/chaincodes/mycc.1.0: no such file or directory&quot;</span><br></pre></td></tr></table></figure>
<p>本文选择peer1.org2，先让它加入mychannel，然后安装链码，详细过程见<a href="#加入应用通道">加入应用通道</a>和<a href="#安装链码">安装链码</a>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"># 设置环境变量</span><br><span class="line">root@fc0891e02afd:/opt/gopath/src/github.com/hyperledger/fabric/peer# CORE_PEER_LOCALMSPID=&quot;Org2MSP&quot;</span><br><span class="line">root@fc0891e02afd:/opt/gopath/src/github.com/hyperledger/fabric/peer# CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer1.org2.example.com/tls/ca.crt</span><br><span class="line">root@fc0891e02afd:/opt/gopath/src/github.com/hyperledger/fabric/peer# CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp</span><br><span class="line">root@fc0891e02afd:/opt/gopath/src/github.com/hyperledger/fabric/peer# CORE_PEER_ADDRESS=peer1.org2.example.com:10051</span><br><span class="line">root@fc0891e02afd:/opt/gopath/src/github.com/hyperledger/fabric/peer#</span><br><span class="line"></span><br><span class="line"># 加入mychannel</span><br><span class="line">root@fc0891e02afd:/opt/gopath/src/github.com/hyperledger/fabric/peer# peer channel join -b mychannel.block</span><br><span class="line">2019-07-30 03:45:39.637 UTC [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized</span><br><span class="line">2019-07-30 03:45:39.731 UTC [channelCmd] executeJoin -&gt; INFO 002 Successfully submitted proposal to join channel</span><br><span class="line">root@fc0891e02afd:/opt/gopath/src/github.com/hyperledger/fabric/peer#</span><br><span class="line">root@fc0891e02afd:/opt/gopath/src/github.com/hyperledger/fabric/peer# peer channel list</span><br><span class="line">2019-07-30 03:46:09.910 UTC [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized</span><br><span class="line">Channels peers has joined:</span><br><span class="line">mychannel</span><br><span class="line">root@fc0891e02afd:/opt/gopath/src/github.com/hyperledger/fabric/peer#</span><br><span class="line"></span><br><span class="line"># 设置org2的锚节点</span><br><span class="line">root@fc0891e02afd:/opt/gopath/src/github.com/hyperledger/fabric/peer# peer channel update -o orderer.example.com:7050 -c mychannel -f ./channel-artifacts/Org2MSPanchors.tx --tls true --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem</span><br><span class="line">2019-07-30 03:47:27.412 UTC [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized</span><br><span class="line">2019-07-30 03:47:27.447 UTC [channelCmd] update -&gt; INFO 002 Successfully submitted channel update</span><br><span class="line">root@fc0891e02afd:/opt/gopath/src/github.com/hyperledger/fabric/peer#</span><br><span class="line"></span><br><span class="line"># 安装链码</span><br><span class="line">root@fc0891e02afd:/opt/gopath/src/github.com/hyperledger/fabric/peer# peer chaincode install -n mycc -v 1.0 -l golang -p github.com/chaincode/chaincode_example02/go/</span><br><span class="line">2019-07-30 03:48:18.903 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 001 Using default escc</span><br><span class="line">2019-07-30 03:48:18.903 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 002 Using default vscc</span><br><span class="line">2019-07-30 03:48:19.180 UTC [chaincodeCmd] install -&gt; INFO 003 Installed remotely response:&lt;status:200 payload:&quot;OK&quot; &gt;</span><br></pre></td></tr></table></figure>
<p>之前已经实例化过1链码，所以无需再次实例化。</p>
<p>接下来重新执行调用链码，并且制定2个背书节点，分别是peer1.org1和peer1.org2。背书启用了TLS，需要在<code>--peerAddresses</code>后面，使用<code>--tlsRootCertFiles</code>指定对应peer的证书文件，使用<code>--cafile</code>指定orderer的证书文件。</p>
<p>命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@fc0891e02afd:/opt/gopath/src/github.com/hyperledger/fabric/peer# peer chaincode invoke -o orderer.example.com:7050 --tls true --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n mycc --peerAddresses peer1.org1.example.com:8051 --tlsRootCertFiles /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer1.org1.example.com/tls/ca.crt --peerAddresses peer1.org2.example.com:10051 --tlsRootCertFiles /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer1.org2.example.com/tls/ca.crt -c &apos;&#123;&quot;Args&quot;:[&quot;invoke&quot;,&quot;a&quot;,&quot;b&quot;,&quot;10&quot;]&#125;&apos;</span><br><span class="line">2019-07-30 03:52:53.880 UTC [chaincodeCmd] chaincodeInvokeOrQuery -&gt; INFO 001 Chaincode invoke successful. result: status:200</span><br></pre></td></tr></table></figure>
<p>可以通过命令查询到，链码中的数据已经更新到最新，说明调用链码成功。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@fc0891e02afd:/opt/gopath/src/github.com/hyperledger/fabric/peer# peer chaincode query -C mychannel -n mycc -c &apos;&#123;&quot;Args&quot;:[&quot;query&quot;,&quot;a&quot;]&#125;&apos;</span><br><span class="line">90</span><br><span class="line">root@fc0891e02afd:/opt/gopath/src/github.com/hyperledger/fabric/peer# peer chaincode query -C mychannel -n mycc -c &apos;&#123;&quot;Args&quot;:[&quot;query&quot;,&quot;b&quot;]&#125;&apos;</span><br><span class="line">210</span><br></pre></td></tr></table></figure>
<p>链码容器的日志可以看到Invoke的日志：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ex02 Invoke</span><br><span class="line">Aval = 90, Bval = 210</span><br></pre></td></tr></table></figure>
<h3 id="链码FAQ"><a href="#链码FAQ" class="headerlink" title="链码FAQ"></a>链码FAQ</h3><p>执行完上面的操作，你是否有这2个疑问：</p>
<ol>
<li>有2个背书节点，不应该2个背书节点都Invoke吗，为什么链码容器日志只看到1次Invoke？</li>
<li>背书节点Invoke链码容器时，链码容器的数据并不会提交，链码容器里的数据是什么时候更新的？</li>
</ol>
<h4 id="疑问1解答"><a href="#疑问1解答" class="headerlink" title="疑问1解答"></a>疑问1解答</h4><blockquote>
<p>有2个背书节点，不应该2个背书节点都Invoke吗，为什么链码容器日志只看到1次Invoke？</p>
</blockquote>
<p>每个组织进行背书，都必须部署自己的链码容器，背书时通过gRPC和自己组织的链码容器交互，所以上面查看链码容器<code>dev-peer1.org1.example.com-mycc-1.0</code>日志的时候，只看到1次Invoke，另外1次，在org2的链码容器<code>dev-peer1.org2.example.com-mycc-1.0</code>日志里。</p>
<p>在<a href="#有效的调用交易">有效的调用交易</a>这一节，我们只安装了链码，因为<strong>在某个通道内，链码只需部署1次</strong>，并且之前peer1.org1已经发送了<strong>部署交易</strong>，所以无需再发送部署交易。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ docker ps</span><br><span class="line">CONTAINER ID        IMAGE                                                                                                  COMMAND                  CREATED             STATUS              PORTS                      NAMES</span><br><span class="line">0700ebc80246        dev-peer1.org2.example.com-mycc-1.0-26c2ef32838554aac4f7ad6f100aca865e87959c9a126e86d764c8d01f8346ab   &quot;chaincode -peer.add…&quot;   3 hours ago         Up 3 hours                                     dev-peer1.org2.example.com-mycc-1.0</span><br><span class="line">8bab025e153e        dev-peer1.org1.example.com-mycc-1.0-cd123150154e6bf2df7ce682e0b1bcbea40499416f37a6da3aae14c4eb51b08d   &quot;chaincode -peer.add…&quot;   4 hours ago         Up 4 hours                                     dev-peer1.org1.example.com-mycc-1.0</span><br></pre></td></tr></table></figure>
<p>这里有一点需要注意，当org2的背书节点进行背书时，发现没有链码容器，会自动创建，而不是安装链码后，即可主动部署链码容器，可以从peer1.org2的日志确认以上流程。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 安装链码</span><br><span class="line">2019-07-30 03:48:19.177 UTC [endorser] callChaincode -&gt; INFO 063 [][353ca5ab] Entry chaincode: name:&quot;lscc&quot;</span><br><span class="line">2019-07-30 03:48:19.179 UTC [lscc] executeInstall -&gt; INFO 064 Installed Chaincode [mycc] Version [1.0] to peer</span><br><span class="line">2019-07-30 03:48:19.179 UTC [endorser] callChaincode -&gt; INFO 065 [][353ca5ab] Exit chaincode: name:&quot;lscc&quot;  (2ms)</span><br><span class="line">2019-07-30 03:48:19.179 UTC [comm.grpc.server] 1 -&gt; INFO 066 unary call completed grpc.service=protos.Endorser grpc.method=ProcessProposal grpc.peer_address=172.28.0.11:38546 grpc.code=OK grpc.call_duration=2.758068ms</span><br><span class="line"></span><br><span class="line"># 12s后才部署链码容器</span><br><span class="line">2019-07-30 03:52:37.932 UTC [endorser] callChaincode -&gt; INFO 067 [mychannel][6b87148b] Entry chaincode: name:&quot;mycc&quot;</span><br><span class="line">2019-07-30 03:52:37.948 UTC [chaincode.platform.golang] GenerateDockerBuild -&gt; INFO 068 building chaincode with ldflagsOpt: &apos;-ldflags &quot;-linkmode external -extldflags &apos;-static&apos;&quot;&apos;</span><br><span class="line">2019-07-30 03:52:53.875 UTC [endorser] callChaincode -&gt; INFO 069 [mychannel][6b87148b] Exit chaincode: name:&quot;mycc&quot;  (15943ms)</span><br><span class="line">2019-07-30 03:52:53.876 UTC [comm.grpc.server] 1 -&gt; INFO 06a unary call completed grpc.service=protos.Endorser grpc.method=ProcessProposal grpc.peer_address=172.28.0.11:38984 grpc.code=OK grpc.call_duration=15.945466965s</span><br></pre></td></tr></table></figure>
<h4 id="疑问2解答"><a href="#疑问2解答" class="headerlink" title="疑问2解答"></a>疑问2解答</h4><blockquote>
<p>背书节点Invoke链码容器时，链码容器的数据并不会提交，链码容器里的数据是什么时候更新的？</p>
</blockquote>
<p>链码容器只是负责执行调用，不负责存储数据，所以不存在链码容器数据何时更新的问题。</p>
<p>下面是调用链码的流程图，可以看到链码执行时，是通过Shim从fabric账本读取数据的，然后把执行结果返回。如果交易被peer节点验证有效，调用交易的结果会写入当fabric账本，如果无效，不会改变fabric账本，所以你现在是否理解<a href="#不满足背书策略的调用交易">不满足背书策略的调用交易</a>不会改变数据，而<a href="#有效的调用交易">有效的调用交易</a>会改变数据。</p>
<p><img src="http://img.lessisbetter.site/2019-07-chaincode_swimlane.png" alt=""></p>
<h2 id="启动自定义网络"><a href="#启动自定义网络" class="headerlink" title="启动自定义网络"></a>启动自定义网络</h2><h3 id="利用byfn启动自定义网络"><a href="#利用byfn启动自定义网络" class="headerlink" title="利用byfn启动自定义网络"></a>利用byfn启动自定义网络</h3><p><code>./byfn.sh</code>不止<code>up</code>和<code>down</code>2个命令，还有其他命令，以及更多的参数，比如restart, generate和upgrade。</p>
<p>在上一节，使用了完全默认的参数，启动了网络，这是完全傻瓜式的。基于对fabric的掌握，还可以设置更多的参数，比如使用参数可以指定channel名称，而不是使用默认的<code>mychannel</code>，可以设置超时时间，使用指定docker编排文件创建各容器，指定chaincode的语言是Go还是Java等，还有更多的参数自己探索吧，设置一些参数重新启动网络。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">➜  first-network git:(release-1.4) ./byfn.sh help</span><br><span class="line">Usage:</span><br><span class="line">  byfn.sh &lt;mode&gt; [-c &lt;channel name&gt;] [-t &lt;timeout&gt;] [-d &lt;delay&gt;] [-f &lt;docker-compose-file&gt;] [-s &lt;dbtype&gt;] [-l &lt;language&gt;] [-o &lt;consensus-type&gt;] [-i &lt;imagetag&gt;] [-a] [-n] [-v]</span><br><span class="line">    &lt;mode&gt; - one of &apos;up&apos;, &apos;down&apos;, &apos;restart&apos;, &apos;generate&apos; or &apos;upgrade&apos;</span><br><span class="line">      - &apos;up&apos; - bring up the network with docker-compose up</span><br><span class="line">      - &apos;down&apos; - clear the network with docker-compose down</span><br><span class="line">      - &apos;restart&apos; - restart the network</span><br><span class="line">      - &apos;generate&apos; - generate required certificates and genesis block</span><br><span class="line">      - &apos;upgrade&apos;  - upgrade the network from version 1.3.x to 1.4.0</span><br><span class="line">    -c &lt;channel name&gt; - channel name to use (defaults to &quot;mychannel&quot;)</span><br><span class="line">    -t &lt;timeout&gt; - CLI timeout duration in seconds (defaults to 10)</span><br><span class="line">    -d &lt;delay&gt; - delay duration in seconds (defaults to 3)</span><br><span class="line">    -f &lt;docker-compose-file&gt; - specify which docker-compose file use (defaults to docker-compose-cli.yaml)</span><br><span class="line">    -s &lt;dbtype&gt; - the database backend to use: goleveldb (default) or couchdb</span><br><span class="line">    -l &lt;language&gt; - the chaincode language: golang (default) or node</span><br><span class="line">    -o &lt;consensus-type&gt; - the consensus-type of the ordering service: solo (default), kafka, or etcdraft</span><br><span class="line">    -i &lt;imagetag&gt; - the tag to be used to launch the network (defaults to &quot;latest&quot;)</span><br><span class="line">    -a - launch certificate authorities (no certificate authorities are launched by default)</span><br><span class="line">    -n - do not deploy chaincode (abstore chaincode is deployed by default)</span><br><span class="line">    -v - verbose mode</span><br><span class="line">  byfn.sh -h (print this message)</span><br><span class="line"></span><br><span class="line">Typically, one would first generate the required certificates and</span><br><span class="line">genesis block, then bring up the network. e.g.:</span><br><span class="line"></span><br><span class="line">	byfn.sh generate -c mychannel</span><br><span class="line">	byfn.sh up -c mychannel -s couchdb</span><br><span class="line">        byfn.sh up -c mychannel -s couchdb -i 1.4.0</span><br><span class="line">	byfn.sh up -l node</span><br><span class="line">	byfn.sh down -c mychannel</span><br><span class="line">        byfn.sh upgrade -c mychannel</span><br><span class="line"></span><br><span class="line">Taking all defaults:</span><br><span class="line">	byfn.sh generate</span><br><span class="line">	byfn.sh up</span><br><span class="line">	byfn.sh down</span><br></pre></td></tr></table></figure>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>通过这篇文章能够掌握部署一个Fabric网络需哪些步骤，以及各步骤需要做哪些工作。但这篇文章，缺少了关于docker配置各容器的部分，后面会单独一篇文章介绍。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://lessisbetter.site/2019/07/17/fabric-concepts-notes/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="大彬">
      <meta itemprop="description" content="区块链、Go语言">
      <meta itemprop="image" content="http://img.lessisbetter.site/gzh-qrcode-logo-small.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Go语言充电站">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/07/17/fabric-concepts-notes/" class="post-title-link" itemprop="url">快速入门Fabric核心概念和框架</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-07-17 18:54:56" itemprop="dateCreated datePublished" datetime="2019-07-17T18:54:56+08:00">2019-07-17</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-08-13 16:18:50" itemprop="dateModified" datetime="2019-08-13T16:18:50+08:00">2019-08-13</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="声明"><a href="#声明" class="headerlink" title="声明"></a>声明</h2><p>这是一篇信息整合的文章，80%的内容来自Fabric官方文档和网络文章，在此基础上整理和修改，剩下20%为操作记录。</p>
<h3 id="官方文档资料链接"><a href="#官方文档资料链接" class="headerlink" title="官方文档资料链接"></a>官方文档资料链接</h3><ul>
<li><p><a href="https://hyperledger-fabric.readthedocs.io/en/release-1.4/glossary.html" target="_blank" rel="noopener">https://hyperledger-fabric.readthedocs.io/en/release-1.4/glossary.html</a><br>Fabric术语表，所有概念都能在这找到，建议详读几遍，有疑问时也可以随时来查，会有新的理解。</p>
</li>
<li><p><a href="https://hyperledger-fabric.readthedocs.io/en/release-1.4/Fabric-FAQ.html" target="_blank" rel="noopener">https://hyperledger-fabric.readthedocs.io/en/release-1.4/Fabric-FAQ.html</a></p>
<p>这篇FAQ，也会解决很多疑问。</p>
</li>
</ul>
<p><strong>剩下的官方文档链接都加入到了下面的笔记中</strong>。</p>
<h3 id="网络文章"><a href="#网络文章" class="headerlink" title="网络文章"></a>网络文章</h3><p><a href="https://blog.51cto.com/9291927/category29.html" target="_blank" rel="noopener">天山老妖S：HyperLeger Fabric SDK开发系列文章</a></p>
<p><a href="http://www.taohui.pub/2018/05/26/%e5%8c%ba%e5%9d%97%e9%93%be%e5%bc%80%e6%ba%90%e5%ae%9e%e7%8e%b0hyperledger-fabric%e6%9e%b6%e6%9e%84%e8%af%a6%e8%a7%a3/" target="_blank" rel="noopener">陶辉：区块链开源实现hyperledger fabric架构详解</a></p>
<p><a href="https://shanma.pro/tutorial/hyperledger/16632.html" target="_blank" rel="noopener">Hyperledger Fabric 开发系列文章</a></p>
<h2 id="笔记摘录"><a href="#笔记摘录" class="headerlink" title="笔记摘录"></a>笔记摘录</h2><h3 id="架构"><a href="#架构" class="headerlink" title="架构"></a>架构</h3><p><img src="http://img.lessisbetter.site/2019-07-fabric-arch.png" alt="HyperLeger Fabric架构"></p>
<p> Fabric网络是通过组织（organization）来划分的，每个组织内都包含承担不同功能的Peer 节点，每个Peer节点又可以担任多种角色。<strong>所有的组织共用一个统一的Orderer排序服务集群</strong>。基于Hyperledger Fabric区块链网络的设计时需要考虑组织之间的业务关系以及内部每个模块之间的联系，统一进行规划。</p>
<p><img src="http://img.lessisbetter.site/2019-07-fabric-network.png" alt=""></p>
<p>每个组织通常拥有自己的客户端、Peer节点和CA节点，并且可以根据需要创建一个或多个不同的类型节点。Orderer节点不属于某个组织的实体，属于组织共同维护的节点。</p>
<p><img src="http://img.lessisbetter.site/2019-07-fabirc-org.png" alt=""></p>
<h3 id="排序节点"><a href="#排序节点" class="headerlink" title="排序节点"></a>排序节点</h3><p>orderer负责排序和打包区块。排序服务节点只是决定交易处理的顺序，并不对交易的合法性进行校验，也无需去管之前的交易是否合法，也不负责维护账本信息，只有记账节点才有账本写入权限。peer验证交易后会给交易打上交易是否合法。</p>
<p>排序服务节点接收包含背书签名的交易，对未打包的交易进行排序生成区块，广播给Peer节点中的主节点。排序服务提供的是原子广播，保证同一个链上的节点接收到相同的消息，并且有相同的逻辑顺序。排序服务独立于Peer进程存在并且以先来先服务的方式对Fabric网络上的所有通道进行排序交易。</p>
<p>Tx排序的依据是什么？根据每个通道按时间顺序调用，创建每个通道的交易区块。</p>
<p>出块的依据是什么？交易数、时间？都可以，具体见<a href="#orderer排序交易">orderer排序交易</a>。</p>
<h3 id="peer节点角色"><a href="#peer节点角色" class="headerlink" title="peer节点角色"></a>peer节点角色</h3><p>peer文档：<a href="https://hyperledger-fabric.readthedocs.io/en/release-1.4/peers/peers.html" target="_blank" rel="noopener">https://hyperledger-fabric.readthedocs.io/en/release-1.4/peers/peers.html</a></p>
<p>peer节点负责背书和验证交易，以及Org之间的通信。</p>
<p>每个Org可以有多个Peer，每个Peer节点都是记账节点，并且可担任多种角色：</p>
<ul>
<li>Endorser Peer（背书节点）</li>
<li>Leading Peer（主节点）</li>
<li>Committer Peer（记账节点）</li>
<li>Anchor Peer（锚节点）</li>
</ul>
<h4 id="背书节点-Endorser-Peer"><a href="#背书节点-Endorser-Peer" class="headerlink" title="背书节点(Endorser Peer)"></a>背书节点(Endorser Peer)</h4><p>部分Peer节点会执行交易并对结果进行签名背书。背书节点是动态的角色，是与具体链码绑定的，由链码的背书策略指定。</p>
<p>只有在应用程序向节点发起交易背书请求时才成为背书节点，其它时候是普通的记账节点，只负责验证交易并记账。</p>
<h4 id="主节点（Leading-Peer）"><a href="#主节点（Leading-Peer）" class="headerlink" title="主节点（Leading Peer）"></a>主节点（Leading Peer）</h4><p>主节点负责和Orderer排序服务节点通信，从排序服务节点处获取最新的区块，并把区块分发到本channel内同组织的其他节点。可以使用配置文件强制设置，也可以选举产生。</p>
<blockquote>
<p>注意：主节点不是指Raft中的leader，是指org中的主节点(leading peer)。</p>
</blockquote>
<h4 id="记账节点（Committer-Peer）"><a href="#记账节点（Committer-Peer）" class="headerlink" title="记账节点（Committer Peer）"></a>记账节点（Committer Peer）</h4><p>负责验证区块里的交易，然后将区块提交（写入/追加）到其通道账本的副本。记账节点还将每个块中的每个交易标记为<strong>有效或无效</strong>，通过验证的为有效，否则为无效。</p>
<h4 id="锚节点（Anchor-Peer）"><a href="#锚节点（Anchor-Peer）" class="headerlink" title="锚节点（Anchor Peer）"></a>锚节点（Anchor Peer）</h4><p>在一个通道上可以被所有其它Peer节点发现的Peer节点，通道上的每个组织都有一个或多个锚节点，多个锚节点可以用来防止单点故障，通过锚节点实现不同组织的Peer节点发现通道上的所有组织的锚节点。</p>
<p>举个例子，peer0.org1是org1的锚节点，它连接peer0.org2时，如果peer0.org2知道org3的锚节点peer0.org3，那么会告诉peer0.org1，org3的锚节点是peer0.org3，以后peer0.org1就可以直接和peer0.org3通信了。</p>
<h3 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h3><p>2种：1. CLI，2. SDK.</p>
<h4 id="SDK"><a href="#SDK" class="headerlink" title="SDK"></a>SDK</h4><p>Fabric提供了三种语言版本的SDK，分别如下：</p>
<ol>
<li>Fabric Nodejs SDK</li>
<li>Fabric Java SDK</li>
<li>Fabric Go SDK</li>
</ol>
<p>Fabric区块链应用可以通过SDK访问Fabric区块链网络中的多种资源，包括账本、交易、链码、事件、权限管理等。应用程序代表用户与Fabric区块链网络进行交互，Fabric SDK API提供了如下功能：</p>
<ol>
<li>创建通道</li>
<li>将peer节点加入通道</li>
<li>在peer节点安装链码</li>
<li>在通道实例化链码</li>
<li>通过链码调用交易</li>
<li>查询交易或区块的账本</li>
</ol>
<h3 id="链码"><a href="#链码" class="headerlink" title="链码"></a>链码</h3><p>链码即智能合约，链码分系统链码和用户链码，在没有特殊强调的时候，链码就是指用户链码。</p>
<p>链码操作包含3个基本操作：安装（install）、实例化（instantiation）和调用（Invoke），以及其他操作比如打包、签名。</p>
<p>用户链码被编译成一个独立的应用程序，运行于隔离的Docker容器中，在链码部署的时候会自动生成链码的Docker镜像，链码容器通过gRPC协议与相应的Peer节点进行交互，以操作分布式账本中的数据。</p>
<p>一个channel内链码只需实例化1次，所有运行链码的节点都需要安装该链码，如果只需要验证交易，并不需要安装链码，因为实例化后，可以通过gRPC通信与链码容器交互验证链码。</p>
<h4 id="背书策略（Endorser-Policy）"><a href="#背书策略（Endorser-Policy）" class="headerlink" title="背书策略（Endorser Policy）"></a>背书策略（Endorser Policy）</h4><p><strong>背书策略是背书节点如何决策交易是否合法的条件</strong>。链码实例化时可指定背书策略，当记账节点接收到交易时，会获知相关链码信息，然后检查链码的背书策略，判断交易是否满足背书策略，若满足则标注交易为合法。</p>
<p>背书策略可分为主体Principal(P)和阈值Threshold(T)两部分，具体如下：</p>
<ul>
<li>Principal指定由哪些成员进行背书。</li>
<li>Threshold接受两个输入，分别为阈值t和若干个P的集合n，只要交易中包含了n中t个成员的背书则认为交易合法。</li>
</ul>
<p>背书策略可以指定某几个组织内的任意成员身份进行背书，或者要求至少有一个管理员身份进行背书等等。</p>
<ul>
<li>T(1, ‘A’, ‘B’) 则需要A，B中任意成员背书。</li>
<li>T(1, ‘A’, T(2, ‘B’, ‘C’))则需要A成员背书或B，C成员同时背书。</li>
</ul>
<p>目前客户端已经实现对背书策略的支持，可以通过-P来指定背书策略，结合AND、OR来组合成员，完成成员身份（admin、member）的集合。</p>
<p><code>-P OR ( &#39;Org1.admin&#39; , AND (&#39;Org2.member&#39; , &#39;Org3.member&#39;) )</code></p>
<blockquote>
<p>可以把OR、AND理解为函数，函数内为参数。</p>
</blockquote>
<p>上述背书策略指定要么Org1的admin进行背书，或者Org2和Org3的成员同时进行背书，才满足背书策略。</p>
<p>链接：<a href="https://hyperledger-fabric.readthedocs.io/en/release-1.4/glossary.html#endorsement-policy" target="_blank" rel="noopener">https://hyperledger-fabric.readthedocs.io/en/release-1.4/glossary.html#endorsement-policy</a></p>
<h4 id="系统链码"><a href="#系统链码" class="headerlink" title="系统链码"></a>系统链码</h4><p>系统链码与用户链码有相同的编程模型，但<strong>系统链码运行在Peer节点，用户链码则在隔离的容器中运行。因此，系统链码内置为Peer节点的可执行文件中，不遵循用户链码的生命周期，安装、实例化、升级不适用于系统链码</strong>。</p>
<p>系统链码用于减少Peer节点与用户链码进行gRPC通信的开销，同时权衡管理的灵活性。系统链码只能通过Peer节点的二进制文件升级，必须通过一组固定的参数进行注册，但<strong>不具有背书策略</strong>。</p>
<p>Hyperledger Fabric系统链码实现了一系列系统功能，以便系统集成人员能够根据需求对其进行修改与替换。</p>
<p>常见系统链码如下：</p>
<ul>
<li>生命周期系统链码（LSCC ）：负责对用户链码的生命周期进行管理。</li>
<li>配置系统链码（CSCC）：处理在Peer节点上的通道配置。</li>
<li>查询系统链码（QSCC）：提供账本的查询API，例如获取区块以及交易。</li>
<li>背书系统链码（ESCC）：背书过程的管理和配置。</li>
<li>验证系统链码（VSCC）：处理交易验证，包括检查背书策略以及多进程并发控制。</li>
</ul>
<p><strong>这样容易记：一共5个SCC，前2个与配置相关，后3个与操作相关，配置有生命周期和配置，操作有背书、验证和查询</strong>。</p>
<p>在修改或者替换系统链码（LSCC、ESCC、VSCC）时必须注意，因为系统链码在主交易执行的路径中。VSCC在将区块提交至账本前，所有在通道的Peer节点会计算相同的验证以避免账本分歧（不确定性）。如果VSCC被改变或者替换，需要特别小心。</p>
<h4 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h4><p>通过install安装链码，通过instantiate实例化链码，然后可以通过invoke、query调用链码和查询链码。<br>如果需要升级链码，则需要先install安装新版本的链码，通过upgrade升级链码。在install安装链码前，可以通过package打包并签名生成打包文件，然后再通过install安装。</p>
<p><img src="http://img.lessisbetter.site/2019-07-fabric-chaincode-lifecycle.png" alt=""></p>
<h4 id="链码管理"><a href="#链码管理" class="headerlink" title="链码管理"></a>链码管理</h4><p><code>peer chaincode -h</code>可以列出链码的几种操作：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">install     Package the specified chaincode into a deployment spec and save it on the peer&apos;s path.</span><br><span class="line">instantiate Deploy the specified chaincode to the network.</span><br><span class="line">invoke      Invoke the specified chaincode.</span><br><span class="line">list        Get the instantiated chaincodes on a channel or installed chaincodes on a peer.</span><br><span class="line">package     Package the specified chaincode into a deployment spec.</span><br><span class="line">query       Query using the specified chaincode.</span><br><span class="line">signpackage Sign the specified chaincode package</span><br><span class="line">upgrade     Upgrade chaincode.</span><br></pre></td></tr></table></figure>
<ul>
<li><p>安装：把chaincode打包成部署规格，并且保存到peer的某个路径。</p>
</li>
<li><p>实例化：部署chaincode到网络。</p>
</li>
<li>调用：调用chaincode。</li>
<li>list：列出某个通道上已经实例化的chaincode或已安装到peer上的chaincode。</li>
<li>打包：把chaincode打包成部署规格。</li>
<li>查询：使用chaincode查询，即查询该查询该chaincode上的信息。</li>
<li>signpackage：对打包的chaincode签名。</li>
<li>升级：升级已实例化的chaincode。</li>
</ul>
<p>可以看到安装chaincode实际已经包含了打包的过程。</p>
<h4 id="打包链码"><a href="#打包链码" class="headerlink" title="打包链码"></a>打包链码</h4><p>链码包由三个部分组成：</p>
<ol>
<li><strong>由ChaincodeDeploymentSpec（CDS）格式定义的链码</strong>。CDS根据代码及其它属性（如名称与版本）定义链码包；</li>
<li><strong>一个可选的实例化策略，能够被用作背书的策略进行描述</strong>；</li>
<li>拥有链码的实体的一组签名。</li>
</ol>
<p>其中，链码的签名主要目的如下：</p>
<ol>
<li>建立链码的所有权；</li>
<li>允许验证链码包中的内容；</li>
<li>允许检测链码包是否被篡改。</li>
</ol>
<p>通道上的链码的实例化交易的创建者能够被链码的实例化策略验证。</p>
<p>链码打包的方法由两种，一种是打包被多个所有者所拥有的链码，需要初始化创建一个被签名的链码包（SignedCDS），然后将其按顺序的传递给其它所有者进行签名；一种是打包单个所有者持有的链码。</p>
<p>创建一个被签名的链码包的命令如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode package -n sacc -p chaincodedev/chaincode/sacc -v 0 -s -S -i &quot;AND(&apos;OrgA.admin&apos;)&quot; ccpack.out</span><br></pre></td></tr></table></figure>
<ul>
<li><code>-s</code>选项创建一个能被多个所有者签名的链码包，而不是简单的创建一个原始的CDS。一旦-s被指定，如果其它所有者想要签名CDS，则-S选项必须被指定。否则，将会创建一个SignedCDS，除CDS外仅仅包括实例化策略。</li>
<li><code>-S</code>选项使用被在core.yaml文件中定义的localMspid属性的值标识的MSP对链码包进行签名。</li>
<li><code>-S</code>选项是可选的。如果创建了一个没有签名的链码包，不能被其它所有者使用signpackage命令进行签名。</li>
<li><code>-i</code>选项是可选的，允许为链码指定实例化策略。实例化策略与背书策略有相同的格式，指定哪些身份能够实例化链码。本例中仅OrgA的admin能够实例化链码。如果没有实例化策略被指定，将会使用默认的策略，仅允许拥有Peer的MSP的管理员身份实例化链码。</li>
</ul>
<h4 id="签名链码"><a href="#签名链码" class="headerlink" title="签名链码"></a>签名链码</h4><p>在创建阶段就被签名的链码包能够交给其它所有者进行检查与签名，支持带外对链码进行签名。<br> ChaincodeDeploymentSpec可以选择由所有者集合进行签名，从而创建一个SignedChaincodeDeploymentSpec(SignedCDS)。SignedCDS包括3个部分：</p>
<ol>
<li><p>CDS包括源代码，链码的名称与版本号；</p>
</li>
<li><p>链码的实例化策略，表示为背书策略；</p>
</li>
<li><p>链码所有者的列表，由背书策略定义。</p>
</li>
</ol>
<p><strong>当在某些通道上实例化链码时，背书策略是在带外确定的</strong>，用于提供合适的MSP主体。如果没指定实例化策略，则默认的策略就是通道的任何MSP管理员。</p>
<p>每一个链码的所有者通过将SignedCDS与链码所有者的身份（例如证书）组合并签署组合结果来背书ChaincodeDeploymentSpec。</p>
<p>一个链码的所有者能够对自己所创建的签名过的链码包进行签名，需要使用如下命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode signpackage ccpack.out signedccpack.out</span><br></pre></td></tr></table></figure>
<p>ccpack.out、signedccpack.out分别是输入与输出包。signedccpack.out包括一个对链码包附加的签名（通过local msp进行的签名）。</p>
<h4 id="安装链码"><a href="#安装链码" class="headerlink" title="安装链码"></a>安装链码</h4><p>将链码的源代码打包成ChaincodeDeploymentSpec（CDS）的规定的格式，然后<strong>安装到通道中的背书节点上</strong>。</p>
<p>当安装的链码包只包含一个ChaincodeDeploymentSpec时，将使用默认初始化策略并包括一个空的所有者列表。<br>链码应该仅仅被安装在链码所有者成员的背书节点上，用于实现链码对于网络中其它成员在逻辑上是隔离的。</p>
<p>安装链码会发送一个<strong>SignedProposal到生命周期系统链码(LSCC)</strong> ，也就是说会发送调用系统链码的交易。</p>
<p>使用CLI安装sacc链码的命令如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode install -n sacc -v 1.0 -p sacc</span><br></pre></td></tr></table></figure>
<ul>
<li>-n选项指定链码实例名称</li>
<li>-v选项指定链码的版本</li>
<li>-p选项指定链码所在路径，必须在GOPATH路径下</li>
</ul>
<p>CLI内部创建<strong>sacc</strong>的SignedChaincodeDeploymentSpec，然后将其发送给本地Peer节点，Peer节点会<strong>调用</strong>LSCC上的安装方法。<strong>为了在Peer节点上安装链码，SignedProposal的签名必须来自于Peer节点的本地MSP管理员之一</strong>。</p>
<p><strong>未安装 chaincode 的节点不能执行 chaincode，但仍可以验证交易并提交到账本中。所以背书节点必须按照链码，记账节点并非必须安装链码。</strong></p>
<h4 id="实例化链码"><a href="#实例化链码" class="headerlink" title="实例化链码"></a>实例化链码</h4><p><strong>链码和通道是低耦合的：实例化调用生命周期系统链码(LSCC)用于创建及初始化通道上的链码。链码能够被绑定到任意数量的通道，以及在每个通道上单独的操作。无论链码安装及实例化到多少个通道上，每个通道的状态都是隔离的。</strong></p>
<p>实例化的创建者必须满足包含在SignedCDS内链码的<strong>实例化策略</strong>，而且还必须是通道的写入器（作为通道创建的一部分被配置）。可以防止部署链码的流氓实体或者欺骗者在未被绑定的通道上执行链码。</p>
<p><strong>默认的实例化策略是任意的通道MSP的管理员，因此链码实例化交易的创建者必须是通道管理员之一</strong>。当交易提案到达背书节点后，背书节点会根据实例化策略验证创建者的签名。在提交实例化交易到账本前，在交易验证时再一次完成该操作。</p>
<p><strong>实例化交易同样设置了通道上的链码的背书策略</strong> 。背书策略描述了交易被通道上成员接受的认证要求。<br>使用CLI去实例化sacc的链码并初始化状态为user1与0，命令如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode instantiate -n sacc -v 1.0 -c &apos;&#123;&quot;Args&quot;:[&quot;user1&quot;,&quot;0&quot;]&#125;&apos; -P &quot;OR (&apos;Org1.member&apos;,&apos;Org2.member&apos;)&quot;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>-n选项指定链码实例名称</strong></li>
<li>-v选项指定链码的版本</li>
<li>-c 选项指定链码的调用参数</li>
<li>-P选项指定链码的背书策略</li>
</ul>
<p>链码的背书策略表示，org1.member或者org2.member必须对调用使用sacc(这名字起的让我以为是某种SCC)的交易进行签名，以保障交易是有效的。在成功实例化后，通道的链码进入激活状态，可以处理任意的交易提案。交易到达背书节点时，会同时被处理。</p>
<p>实例化选项：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">root@5af5a3fb3bb7:/var/hyperledger/production# peer chaincode instantiate -h</span><br><span class="line">Deploy the specified chaincode to the network.</span><br><span class="line"></span><br><span class="line">Usage:</span><br><span class="line">  peer chaincode instantiate [flags]</span><br><span class="line"></span><br><span class="line">Flags:</span><br><span class="line">  -C, --channelID string               The channel on which this command should be executed</span><br><span class="line">      --collections-config string      The fully qualified path to the collection JSON file including the file name</span><br><span class="line">      --connectionProfile string       Connection profile that provides the necessary connection information for the network. Note: currently only supported for providing peer connection information</span><br><span class="line">  -c, --ctor string                    Constructor message for the chaincode in JSON format (default &quot;&#123;&#125;&quot;)</span><br><span class="line">  -E, --escc string                    The name of the endorsement system chaincode to be used for this chaincode</span><br><span class="line">  -h, --help                           help for instantiate</span><br><span class="line">  -l, --lang string                    Language the chaincode is written in (default &quot;golang&quot;)</span><br><span class="line">  -n, --name string                    Name of the chaincode</span><br><span class="line">      --peerAddresses stringArray      The addresses of the peers to connect to</span><br><span class="line">  -P, --policy string                  The endorsement policy associated to this chaincode</span><br><span class="line">      --tlsRootCertFiles stringArray   If TLS is enabled, the paths to the TLS root cert files of the peers to connect to. The order and number of certs specified should match the --peerAddresses flag</span><br><span class="line">  -v, --version string                 Version of the chaincode specified in install/instantiate/upgrade commands</span><br><span class="line">  -V, --vscc string                    The name of the verification system chaincode to be used for this chaincode</span><br><span class="line"></span><br><span class="line">Global Flags:</span><br><span class="line">      --cafile string                       Path to file containing PEM-encoded trusted certificate(s) for the ordering endpoint</span><br><span class="line">      --certfile string                     Path to file containing PEM-encoded X509 public key to use for mutual TLS communication with the orderer endpoint</span><br><span class="line">      --clientauth                          Use mutual TLS when communicating with the orderer endpoint</span><br><span class="line">      --connTimeout duration                Timeout for client to connect (default 3s)</span><br><span class="line">      --keyfile string                      Path to file containing PEM-encoded private key to use for mutual TLS communication with the orderer endpoint</span><br><span class="line">  -o, --orderer string                      Ordering service endpoint</span><br><span class="line">      --ordererTLSHostnameOverride string   The hostname override to use when validating the TLS connection to the orderer.</span><br><span class="line">      --tls                                 Use TLS when communicating with the orderer endpoint</span><br><span class="line">      --transient string                    Transient map of arguments in JSON encoding</span><br></pre></td></tr></table></figure>
<h4 id="调用链码"><a href="#调用链码" class="headerlink" title="调用链码"></a>调用链码</h4><p>调用链码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode invoke -o orderer.example.com:7050 --tls $CORE_PEER_TLS_ENABLED --cafile $ORDERER_CA -C mychannel -n sacc -c &apos;&#123;&quot;Args&quot;:[&quot;invoke&quot;,&quot;user1&quot;,&quot;user2&quot;,&quot;10&quot;]&#125;&apos;</span><br></pre></td></tr></table></figure>
<p>查询链码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -C mychannel -n sacc -c &apos;&#123;&quot;Args&quot;:[&quot;query&quot;,&quot;user1&quot;]&#125;&apos;</span><br></pre></td></tr></table></figure>
<p><strong>调用链码的前提是链码已经实例化。</strong></p>
<p>链码实例化之后存在了运行了一个容器，这个容器一直在运行，所以调用1个链码，实际是peer容器和链码容器交互的过程。</p>
<p>链码与Peer节点的交互过程如下：</p>
<ol>
<li>链码通过gRPC与Peer节点交互，当Peer节点收到客户端的交易提案请求后，会发送一个链码消息对象（包含交易提案信息、调用者信息）给对应的链码。</li>
<li>链码调用Invoke方法，通过发送获取数据（GetState）和写入数据（PutState）消息，向Peer节点获取账本状态信息和发送预提交状态。</li>
<li>链码发送模拟执行结果给Peer节点，Peer节点对交易提案和模拟执行结果进行背书签名。</li>
</ol>
<p><img src="http://img.lessisbetter.site/2019-07-fabric-invoke-chaincode.png" alt=""></p>
<p><img src="http://img.lessisbetter.site/2019-07-chaincode_swimlane.png" alt=""></p>
<h4 id="升级链码"><a href="#升级链码" class="headerlink" title="升级链码"></a>升级链码</h4><p>链码的升级通过改变其版本号（作为SignedCDS的一部分）。SignedCDS另外的部分，如所有者及实例化策略都是可选的。然而，<strong>链码的名称必须是一致的，否则会被当做另外一个新的链码</strong>。<br>在升级前，必须将新版本的链码安装到有需求的背书节点上。升级也是一种交易，会把新版本的链码绑定到通道中。<strong>升级只能在一个时间点对一个通道产生影响，其它通道仍然运行旧版本的链码</strong>。<br>由于可能存在多个版本的链码同时存在，<strong>升级过程不会自动删除老版本链码，用户必须手动操作删除过程</strong>。<br>升级与实例化transaction有一点不同的是：通过现有的chaincode实例化策略检查升级transaction，而不是用新的策略检查。这是为了确保只有当前实例化策略中指定的成员能够升级chaincode。<br>在升级期间，链码的Init函数也会被调用，执行有关升级的数据或者使用数据重新进行初始化，在升级链码的期间避免对状态进行重置。<br>安装新版本的链码<br><code>peer chaincode install -n sacc -v 1 -p path/to/my/chaincode/v1</code><br>upgrade升级链码<br><code>peer chaincode upgrade -n sacc -v 1 -c &#39;{&quot;Args&quot;:[&quot;d&quot;, &quot;e&quot;, &quot;f&quot;]}&#39; -C mychannel</code></p>
<h4 id="都是交易"><a href="#都是交易" class="headerlink" title="都是交易"></a>都是交易</h4><p>安装、实例化、调用、升级链码，都是创建一笔交易，通过交易实现。</p>
<h4 id="链码开发"><a href="#链码开发" class="headerlink" title="链码开发"></a>链码开发</h4><p><code>github.com/hyperledger/fabric/core/chaincode/shim</code>包是开发Go语言链码的API。shim 包提供了链码与账本交互的中间层。链码通过 shim.ChaincodeStub 提供的方法来读取和修改账本的状态。</p>
<p>链码启动必须通过调用 shim 包中的 Start 函数，而 Start 函数被调用时需要传递一个类型为 Chaincode 的参数，这个参数 Chaincode 是一个接口类型，该接口中有两个重要的函数 Init 与 Invoke 。</p>
<p>Chaincode 接口定义如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Chaincode <span class="keyword">interface</span>&#123;</span><br><span class="line">    Init(stub ChaincodeStubInterface) peer.Response</span><br><span class="line">    Invoke(stub ChaincodeStubInterface) peer.Response</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>Init 与 Invoke 方法</strong></p>
<p>编写链码，关键是实现 Init 与 Invoke 两个方法，必须由所有链码实现。Fabric 通过调用指定的函数来运行事务。</p>
<ul>
<li><strong>Init：</strong>在链码实例化或升级时被调用, 完成初始化数据的工作。</li>
<li><strong>invoke：</strong>更新或查询提案事务中的分类帐本数据状态时，Invoke 方法被调用， 因此响应调用或查询的业务实现逻辑都需要在此方法中编写实现。</li>
</ul>
<p>示例：<a href="https://blog.51cto.com/9291927/2318364" target="_blank" rel="noopener">https://blog.51cto.com/9291927/2318364</a></p>
<h3 id="通道"><a href="#通道" class="headerlink" title="通道"></a>通道</h3><p><strong>通道由排序服务管理</strong>，排序服务节点还负责对通道中的交易进行排序。。</p>
<p>目前通道分为<strong>系统通道（System Channel）和应用通道</strong>（Application Channel）。排序服务通过系统通道来管理应用通道，用户的交易信息通过应用通道传递。</p>
<p><strong>每个组织可以有多个节点加入同一个通道</strong>，组织内的节点中可以指定一个锚节点或多个锚节点（增强系统可靠性，避免单点故障）。另外，同一组织的节点会选举或指定主导节点（leading peer），主导节点负责接收从排序服务发来的区块，然后转发给本组织的其它节点。主导节点可以通过特定的算法选出，可以保证在节点数量不断变动的情况下仍能维持整个网络的稳定性。</p>
<p>在Fabric网络中，<strong>可能同时存在多条彼此隔离的通道，每条通道包含一条私有的区块链和一个私有账本，通道中可以实例化一个或多个链码，以操作区块链上的数据</strong>。</p>
<p><strong>通道是共识服务提供的一种通讯机制</strong>，基于发布-订阅关系，将Peer节点和排序节点根据某个Topic连接在一起，形成一个具有保密性的通讯链路（虚拟），实现业务隔离的要求。</p>
<p><strong>排序服务提供了供Peer节点订阅的主题</strong>（如发布-订阅消息队列），每个主题是一个通道。Peer节点可以订阅多个通道，并且只能访问自己所订阅通道上的交易，因此一个Peer节点可以通过接入多个通道参与到多条链中。</p>
<p><strong>排序服务支持多通道，提供了通向客户端和Peer节点的共享通信通道</strong>，提供了包含交易的消息广播服务（broadcast和deliver）。客户端可以通过通道向连接到通道的所有节点广播（broadcast）消息，向连接到通道的所有节点投递(deliver)消息。多通道使得Peer节点可以基于应用访问控制策略来订阅任意数量的通道，应用程序根据业务逻辑决定将交易发送到1个或多个通道。</p>
<p>文档：<a href="https://hyperledger-fabric.readthedocs.io/en/release-1.4/channels.html" target="_blank" rel="noopener">https://hyperledger-fabric.readthedocs.io/en/release-1.4/channels.html</a></p>
<h4 id="创建"><a href="#创建" class="headerlink" title="创建"></a>创建</h4><p>在创建通道的时候，需要定义通道的成员和组织、锚节点（anchor peer）和排序服务节点，一条与通道对应的区块链会同时生成，用于记录账本的交易，通道的初始配置信息记录在区块链的创世区块中，可以通过增加一个新的配置区块来更改通道的配置信息。</p>
<p>创建通道的时候定义了成员，只有通过成员MSP验证的实体，才能够加入到通道并访问通道的数据。在通道中一般包含有若干成员（组织），若两个网络实体的×××书能够追溯到同一个根CA，则认为这两个实体属于同一组织。</p>
<h4 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h4><p>通道的配置信息都被打包到一个区块中，并存放在通道的共享账本中，成为通道的配置区块，配置区块除了配置信息外不包含其它交易信息。通道可以使用配置区块来更新配置，因此在账本中每新添加一个配置区块，通道就按照最新配置区块的定义来修改配置。通道账本的首个区块一定是配置区块，也称为<strong>创世区块</strong>（Genesis Block）。</p>
<h3 id="交易"><a href="#交易" class="headerlink" title="交易"></a>交易</h3><p>交易的过程，实际是共识的3步：背书、排序和校验。</p>
<h4 id="类型"><a href="#类型" class="headerlink" title="类型"></a>类型</h4><p>Fabric区块链的交易分两种，<strong>部署交易和调用交易</strong>。</p>
<p><strong>部署交易把链码部署到Peer节点上并准备好被调用，当一个部署交易成功执行时，链码就被部署到各个背书节点上。（部署指实例化）</strong></p>
<p>调用交易是客户端应用程序通过Fabric提供的API调用先前已部署好的某个链码的某个函数执行交易，并相应地读取和写入KV数据库，返回是否成功或者失败。</p>
<h4 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h4><p>详读这篇文档：<a href="https://hyperledger-fabric.readthedocs.io/en/release-1.4/txflow.html" target="_blank" rel="noopener">https://hyperledger-fabric.readthedocs.io/en/release-1.4/txflow.html</a></p>
<p>背书节点校验客户端的签名，然后执行智能合约代码模拟交易。交易处理完成后，对交易信息签名，返回给客户端。客户端收到签名后的交易信息后，发给排序服务节点排序。排序服务节点将交易信息排序打包成区块后，广播发给确认节点，写入区块链中。</p>
<p><img src="http://img.lessisbetter.site/2019-07-tx-flow.png" alt=""></p>
<h5 id="客户端提案"><a href="#客户端提案" class="headerlink" title="客户端提案"></a>客户端提案</h5><p>客户端应用程序利用SDK（Node.js，Java，Python）构造交易提案（Proposal），提案有2种：</p>
<ol>
<li>实例化chaincode。</li>
<li>调用chaincode。</li>
</ol>
<p>客户端把交易提案（<strong>Proposal</strong>）根据背书策略发送给一个或多个背书节点，<strong>交易提案中包含本次交易要调用的合约标识、合约方法和参数信息以及客户端签名</strong>等。<br>SDK将交易提案打包为可识别的格式（如gRPC上的protobuf），并使用用户的加密凭证为该交易提案生成唯一的签名。</p>
<p>背书策略定义需要哪些节点背书交易才有效，例如需要5个成员的背书节点中至少3个同意；或者某个特殊身份的成员支持等。客户端只有在收集足够多的背书节点的交易提案签名，交易才能被视为有效。</p>
<p><img src="http://img.lessisbetter.site/2019-07-txflow-step1.png" alt=""></p>
<h5 id="背书节点为提案背书"><a href="#背书节点为提案背书" class="headerlink" title="背书节点为提案背书"></a>背书节点为提案背书</h5><p>背书节点（endorser）收到交易提案后，<strong>验证签名</strong>并确定提交者是否有权执行操作。背书节点将交易提案的参数作为输入，在当前状态KV数据库上执行交易，生成响应返回给客户端，响应包<strong>含执行返回值、读写集的交易结果（此时不会更新账本），交易结果集、背书节点的签名和背书结果（YES/NO）作为提案的结果</strong>，客户端SDK解析信息判断是否应用于后续的交易。</p>
<p><img src="http://img.lessisbetter.site/2019-07-txflow-step2.png" alt=""></p>
<p>在所有合法性校验通过后，背书节点按照交易提案调用链码模拟执行交易。链码执行时，读取的数据（键值对）是背书节点中本地的状态数据库，链码读取过的数据回被归总到读集（Read Set）；链码对状态数据库的写操作并不会对账本做改变，所有的写操作将归总到一个写入集（Write Set）中记录下来。读集和写集将在确认节点中用于确定交易是否最终写入账本。</p>
<p>资料：<a href="https://hyperledger-fabric.readthedocs.io/en/release-1.4/glossary.html#endorsement" target="_blank" rel="noopener">https://hyperledger-fabric.readthedocs.io/en/release-1.4/glossary.html#endorsement</a></p>
<h5 id="客户端收集提案背书"><a href="#客户端收集提案背书" class="headerlink" title="客户端收集提案背书"></a>客户端收集提案背书</h5><p>客户端验证背书节点签名，并比较各节点返回的提案结果，判断提案结果是否一致以及是否参照指定的背书策略执行。</p>
<p><img src="http://img.lessisbetter.site/2019-07-txflow-step3.png" alt=""></p>
<p>当背书结果都通过验证，并且满足背书策略时，客户端生成一笔交易发送给排序节点。<strong>交易包含交易签名、proposal、读写集、背书结果和通道ID。</strong></p>
<p><img src="http://img.lessisbetter.site/2019-07-txflow-step4.png" alt=""></p>
<h5 id="orderer排序交易"><a href="#orderer排序交易" class="headerlink" title="orderer排序交易"></a>orderer排序交易</h5><p>排序服务节点对接收到的交易进行共识排序，然后按照区块生成策略，将一批交易打包到一起，生成新的区块，调用deliver API投递消息，发送给确认节点。</p>
<p><img src="http://img.lessisbetter.site/2019-07-txflow-step5.png" alt=""></p>
<p><strong>区块的广播有两种触发条件</strong>，一种是当通道的交易数量达到某个预设的阈值，另一种是在交易数量没有超过阈值但距离上次广播的时间超过某个特定阈值，也可触发广播数据块。两种方式相结合，使得经过排序的交易及时生成区块并广播给通道的Leader节点（记账节点），Leader节点验证后，再发送给同channel同组织的其他记账节点。</p>
<h5 id="peer验证区块"><a href="#peer验证区块" class="headerlink" title="peer验证区块"></a>peer验证区块</h5><p>peer需要对区块内的所有交易进行验证，验证交易是否按背书策略执行以及根据读写集把交易打上有效或者无效的标签。最后把区块追加到本地的区块链，修改世界状态。</p>
<p>记账节点收到排序服务节点发来的区块后，逐笔检查区块中的交易：</p>
<ol>
<li>先检查交易的合法性以及该交易是否曾经出现过。</li>
<li>然后调用校验系统链码（VSCC，Validation System Chaincode）检验交易的签名背书是否合法，</li>
<li>以及背书的数量是否满足背书策略的要求。</li>
<li>记账节点对交易进行<strong>多版本并发控制（MVCC）</strong>检查，即校验交易的读集（Read Set）是否和当前账本中的版本一致（即没有变化）。如果没有改变，说明交易写集（Write Set）中对数据的修改有效，把该交易标注为有效，交易的写集更新到状态数据库中。如果当前账本的数据和读集版本不一致，则该交易被标注为无效，不更新状态数据库。</li>
</ol>
<p>交易流程中，采用<strong>MVCC的乐观锁模型，提高了系统的并发能力。但MVCC也带来了一些局限性。例如，在同一个区块中若有两个交易先后对某个数据项做更新，顺序在后的交易将失败，因为后序交易的读集版本和当前数据项版本已经不一致。</strong></p>
<p><img src="http://img.lessisbetter.site/2019-07-blocks-3.png" alt=""></p>
<h5 id="区块写入账本"><a href="#区块写入账本" class="headerlink" title="区块写入账本"></a>区块写入账本</h5><p>每个peer都把区块追加到对应channel的账本上，每个有效交易的write set会被提交到状态数据库。</p>
<p><img src="http://img.lessisbetter.site/2019-07-txflow-step6.png" alt=""></p>
<h5 id="客户端获取交易结果"><a href="#客户端获取交易结果" class="headerlink" title="客户端获取交易结果"></a>客户端获取交易结果</h5><p>客户端可以通过事件订阅交易的结果：是否添加到数据库，是否有效。</p>
<h4 id="结构"><a href="#结构" class="headerlink" title="结构"></a>结构</h4><p><img src="http://img.lessisbetter.site/2019-07-fabric-storage.png" alt=""></p>
<h3 id="账本"><a href="#账本" class="headerlink" title="账本"></a>账本</h3><p><strong>账本由区块链和状态数据库两部分组成</strong>。</p>
<ol>
<li>区块链是一组不可更改的有序的区块（数据块），记录着全部交易的日志。</li>
<li>状态数据库记录了账本中所有键值对的当前值（世界状态），相当于对当前账本的交易日志做了索引。链码执行交易的时候需要读取账本的当前状态，从状态数据库可以迅速获取键值的最新状态。</li>
</ol>
<p><img src="http://img.lessisbetter.site/2019-07-fabric-storage.png" alt=""></p>
<p><img src="http://img.lessisbetter.site/2019-07-fabric-storage-flow.png" alt=""></p>
<h4 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h4><p>Fabric区块链网络中，每个通道都有其账本，每个Peer节点都保存着其所加入通道的账本，Peer节点的账本包含如下数据：</p>
<ol>
<li>账本编号，用于快速查询存在哪些账本</li>
<li>账本数据，用于区块数据存储</li>
<li>区块索引，用于快速查询区块／交易</li>
<li>状态数据，用于最新的<strong>世界状态</strong>数据</li>
<li>历史数据，用于跟踪键的历史</li>
</ol>
<p>Fabric的Peer节点账本中有四种数据库，idStore（ledgerID数据库）、blkstorage（block文件存储）、statedb（状态数据库）、historydb（历史数据库）。</p>
<p><strong>账本数据库</strong>基于文件系统，将区块存储在文件块中，然后在区块索引LevelDB中存储区块交易对应的文件块及其偏移，即将区块索引LevelDB作为账本数据库的索引。目前<strong>支持的区块索引有：区块编号、区块哈希、交易ID、区块交易编号</strong>。</p>
<p><strong>状态数据库</strong>存储的是所有曾经在交易中出现的键值对的最新值（世界状态）。调用链码执行交易可以改变状态数据，为了高效的执行链码调用，所有数据的最新值都被存放在状态数据库中；状态数据库是有序交易日志的快照，任何时候都可以根据交易日志重新生成状态数据库；状态数据库会在Peer节点启动的时候自动恢复或重构，未完备前，本Peer节点不会接受新的交易；状态数据库可以使用LevelDB或者CouchDB，CouchDB能够存储任意的二进制数据，支持富文本查询。链接：<a href="https://hyperledger-fabric.readthedocs.io/en/release-1.4/glossary.html#world-state" target="_blank" rel="noopener">https://hyperledger-fabric.readthedocs.io/en/release-1.4/glossary.html#world-state</a> 。</p>
<p><strong>历史状态数据库</strong>用于查询某个key的历史修改记录，历史状态数据库并不存储key具体的值，而只记录在某个区块的某个交易里，某key变动了一次。后续需要查询的时候，根据变动历史去查询实际变动的值。</p>
<p><strong>ledgerID数据库</strong>存储chainID，用于快速查询节点存在哪些账本。</p>
<p><img src="http://img.lessisbetter.site/2019-07-fabric-storage-file.png" alt=""></p>
<p>ledgersData是Peer节点账本的根目录，Peer节点的账本存储在Peer节点容器的<code>/var/hyperledger/production/ledgersData</code>目录下，通过命令行可以进入Peer节点容器进行查看，命令如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it peer0.org1.example.com bash</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">root@5af5a3fb3bb7:/var/hyperledger/production# ls -R chaincodes</span><br><span class="line">chaincodes:</span><br><span class="line">root@5af5a3fb3bb7:/var/hyperledger/production# ls -R transientStore/</span><br><span class="line">transientStore/:</span><br><span class="line">000001.log  CURRENT  LOCK  LOG  MANIFEST-000000</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">root@5af5a3fb3bb7:/var/hyperledger/production# ls -R ledgersData/</span><br><span class="line">ledgersData/:</span><br><span class="line">bookkeeper  chains  configHistory  historyLeveldb  ledgerProvider  pvtdataStore  stateLeveldb</span><br><span class="line"></span><br><span class="line">ledgersData/bookkeeper:</span><br><span class="line">000001.log  CURRENT  LOCK  LOG  MANIFEST-000000</span><br><span class="line"></span><br><span class="line">ledgersData/chains:</span><br><span class="line">chains  index</span><br><span class="line"></span><br><span class="line">ledgersData/chains/chains:</span><br><span class="line">mychannel</span><br><span class="line"></span><br><span class="line">ledgersData/chains/chains/mychannel:</span><br><span class="line">blockfile_000000</span><br><span class="line"></span><br><span class="line">ledgersData/chains/index:</span><br><span class="line">000001.log  CURRENT  LOCK  LOG  MANIFEST-000000</span><br><span class="line"></span><br><span class="line">ledgersData/configHistory:</span><br><span class="line">000001.log  CURRENT  LOCK  LOG  MANIFEST-000000</span><br><span class="line"></span><br><span class="line">ledgersData/historyLeveldb:</span><br><span class="line">000001.log  CURRENT  LOCK  LOG  MANIFEST-000000</span><br><span class="line"></span><br><span class="line">ledgersData/ledgerProvider:</span><br><span class="line">000001.log  CURRENT  LOCK  LOG  MANIFEST-000000</span><br><span class="line"></span><br><span class="line">ledgersData/pvtdataStore:</span><br><span class="line">000001.log  CURRENT  LOCK  LOG  MANIFEST-000000</span><br><span class="line"></span><br><span class="line">ledgersData/stateLeveldb:</span><br><span class="line">000001.log  CURRENT  LOCK  LOG  MANIFEST-000000</span><br></pre></td></tr></table></figure>
<ul>
<li>chains/chains目录下的mychannel目录channel的名称，Fabric支持多通道的机制，而通道之间的账本是隔离的，每个通道都有自己的账本空间。</li>
<li>chains/index目录包含levelDB数据库文件，存储区块索引数据库，使用leveldb实现。</li>
<li>historyLeveldb目录存储智能合约中写入的key的历史记录的索引地址，使用leveldb实现。</li>
<li>ledgerProvider目录存储当前节点所包含channel的信息（已经创建的channel id 和正在创建中的channel id），使用leveldb实现。</li>
<li>stateLeveldb目录存储智能合约写入的数据，可选择使用leveldb或couchDB，即状态数据库。</li>
</ul>
<h4 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h4><p>区块索引用于快速定位区块。<strong>索引键可以是区块高度、区块哈希、交易哈希。索引值为区块文件编号+文件内偏移量+区块数据长度。</strong></p>
<p>Hyperledger Fabric提供了多种区块索引的方式，以便能快速找到区块。索引的内容是文件位置指针（File Location Pointer）。文件位置指针由三个部分组成：所在文件的编号（fileSuffixNum）、文件内的偏移量（offset）、区块占用的字节数（bytesLength）。</p>
<h4 id="链"><a href="#链" class="headerlink" title="链"></a>链</h4><p>整个网络有一条系统链，保存有网络的配置信息，比如MSP、各种策略、各种配置项，系统链在排序服务中（即，peer上没有？），保存在ordering节点的系统channel中，任何改变整个网络配置的，都会产生一个新的配置块添加到系统链上去。</p>
<p>链接：<a href="https://hyperledger-fabric.readthedocs.io/en/release-1.4/glossary.html#system-chain" target="_blank" rel="noopener">https://hyperledger-fabric.readthedocs.io/en/release-1.4/glossary.html#system-chain</a></p>
<h3 id="共识-排序服务"><a href="#共识-排序服务" class="headerlink" title="共识/排序服务"></a>共识/排序服务</h3><p>文档：<a href="https://hyperledger-fabric.readthedocs.io/en/release-1.4/orderer/ordering_service.html" target="_blank" rel="noopener">https://hyperledger-fabric.readthedocs.io/en/release-1.4/orderer/ordering_service.html</a></p>
<h4 id="kafka"><a href="#kafka" class="headerlink" title="kafka"></a>kafka</h4><p>共识集群由多个排序服务节点（OSN）和一个Kafka集群组成。排序节点之间不直接通信，仅仅与Kafka集群通信。</p>
<p>在排序节点的实现里，通道(Channel)在Kafka中是以主题topic的形式隔离。</p>
<p><strong>每个排序节点内部，针对每个通道都会建立与Kafka集群对应topic的生产者及消费者</strong>。生产者将排序节点收到的交易发送到Kafka集群进行排序，在生产的同时，消费者也同步消费排序后的交易。</p>
<p><img src="http://img.lessisbetter.site/2019-07-fabric-kafka.png" alt=""></p>
<h4 id="Raft"><a href="#Raft" class="headerlink" title="Raft"></a>Raft</h4><p>fabric的raft基于etcd的raft，raft是CFT，是leader-follower模型。</p>
<p>需要注意的一点是，所有channel共用排序集群，但每个channel都有各自的Raft实例，所以每个channel可以选举自己的leader。</p>
<p>虽然所有的 Raft 节点都必须包含在系统通道中，但他们并不需要都包含在应用通道中。通道创建者(和通道管理员)拥有选择可用排序节点子集的能力并且可以根据需要增加或移除排序节点(只要每次只增加会移除一个节点)。</p>
<blockquote>
<p>where a leader node is elected (per channel) and its decisions are replicated by the followers.</p>
</blockquote>
<p>链接：<a href="https://hyperledger-fabric.readthedocs.io/en/release-1.4/glossary.html#raft" target="_blank" rel="noopener">https://hyperledger-fabric.readthedocs.io/en/release-1.4/glossary.html#raft</a></p>
<h3 id="通信"><a href="#通信" class="headerlink" title="通信"></a>通信</h3><h4 id="Gossip"><a href="#Gossip" class="headerlink" title="Gossip"></a>Gossip</h4><p>gossip是数据扩散协议，有3个功能：</p>
<ol>
<li>管理节点发现和channel的成员关系</li>
<li>同channel上的所有peer扩散账本数据</li>
<li>同channel上的所有peer间同步账本状态</li>
</ol>
<p>更多信息：<a href="https://hyperledger-fabric.readthedocs.io/en/release-1.4/gossip.html" target="_blank" rel="noopener">https://hyperledger-fabric.readthedocs.io/en/release-1.4/gossip.html</a></p>
<p><strong>Gossip 协议最终的目的是将数据分发到网络中的每一个节点</strong>，Gossip数据分发协议实现了两种数据传输方式。</p>
<h5 id="推送数据"><a href="#推送数据" class="headerlink" title="推送数据"></a>推送数据</h5><ol>
<li>网络中的某个节点<strong>随机选择N个节点</strong>作为数据接收对象，N配置在配置文件中</li>
<li>该节点向其选中的N个节点传输相应的信息</li>
<li>接收到信息的节点处理它接收到的数据</li>
<li>接收到数据的节点再从第一步开始重复执行</li>
</ol>
<p><img src="http://img.lessisbetter.site/2019-07-fabric-gossip-push.png" alt=""></p>
<h5 id="拉去数据"><a href="#拉去数据" class="headerlink" title="拉去数据"></a>拉去数据</h5><ol>
<li>某个节点<strong>周期性</strong>地选择随机N个节点询问有没有最新的信息</li>
<li>收到请求的节点回复请求节点其最近未收到的信息</li>
</ol>
<p><img src="http://img.lessisbetter.site/2019-07-fabric-gossip-pull.png" alt=""></p>
<h4 id="数据同步"><a href="#数据同步" class="headerlink" title="数据同步"></a>数据同步</h4><p>节点之间使用数据同步保证账本数据和状态数据的即使更新，数据同步主要有2类：</p>
<ol>
<li>主动广播，比如广播新打包的区块，排序节点把区块发送给主节点，它基于Gossip的推送数据</li>
<li>主动请求，比如新加入的节点，向已存在的其他组织锚节点请求数据，锚节点给他响应，它基于Gossip的拉去数据</li>
</ol>
<p><img src="http://img.lessisbetter.site/2019-07-fabric-deliver-data.png" alt=""></p>
<p><img src="http://img.lessisbetter.site/2019-07-fabric-request-data.png" alt=""></p>
<h3 id="应用开发"><a href="#应用开发" class="headerlink" title="应用开发"></a>应用开发</h3><p>文档：<a href="https://hyperledger-fabric.readthedocs.io/en/release-1.4/developapps/developing_applications.html" target="_blank" rel="noopener">https://hyperledger-fabric.readthedocs.io/en/release-1.4/developapps/developing_applications.html</a></p>
<h3 id="Fabric网络"><a href="#Fabric网络" class="headerlink" title="Fabric网络"></a>Fabric网络</h3><p>文档：<a href="https://hyperledger-fabric.readthedocs.io/en/release-1.4/network/network.html" target="_blank" rel="noopener">https://hyperledger-fabric.readthedocs.io/en/release-1.4/network/network.html</a></p>
<p>文档里介绍了以上各种概念在网络中的位置。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://lessisbetter.site/2019/07/13/fast-mirrors/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="大彬">
      <meta itemprop="description" content="区块链、Go语言">
      <meta itemprop="image" content="http://img.lessisbetter.site/gzh-qrcode-logo-small.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Go语言充电站">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/07/13/fast-mirrors/" class="post-title-link" itemprop="url">让镜像飞，加速你的开发</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-07-13 11:15:51" itemprop="dateCreated datePublished" datetime="2019-07-13T11:15:51+08:00">2019-07-13</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-08-13 16:18:50" itemprop="dateModified" datetime="2019-08-13T16:18:50+08:00">2019-08-13</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>由于你知我知的网络原因，开发者遇到了以下问题：</p>
<ol>
<li>brew/apt-get/yum等安装软件慢、更新慢</li>
<li>docker下载镜像慢</li>
<li>go get某些package无法访问、超时</li>
<li>…</li>
</ol>
<p>怎么解决？</p>
<ol>
<li>挂代理，实现科学上网</li>
<li>换镜像，曲线救国</li>
</ol>
<p>镜像都在国内，所以镜像效果比代理好。</p>
<p>换代理请看<a href="http://lessisbetter.site/2018/09/06/Science-and-the-Internet/">让终端科学上网</a>。</p>
<p>接下来看几个常用的镜像。</p>
<h2 id="Linux发行版镜像"><a href="#Linux发行版镜像" class="headerlink" title="Linux发行版镜像"></a>Linux发行版镜像</h2><p><a href="https://opsx.alibaba.com/mirror" target="_blank" rel="noopener">阿里镜像首页</a>列出了所有发行版的镜像状态，以及【帮助】，展示了如何更换源。</p>
<p>这里不仅包含了发行版的镜像，还有homebrew、docker，但我认为这2个阿里的镜像不太好用，但列出来了。</p>
<h2 id="Brew镜像"><a href="#Brew镜像" class="headerlink" title="Brew镜像"></a>Brew镜像</h2><p>你需要<a href="http://lessisbetter.site/2019/07/13/better-brew/">让Homebrew飞</a>。</p>
<h2 id="Docker镜像"><a href="#Docker镜像" class="headerlink" title="Docker镜像"></a>Docker镜像</h2><p>看如何配置<a href="https://yeasy.gitbooks.io/docker_practice/install/mirror.html" target="_blank" rel="noopener">Docker镜像加速器</a>。</p>
<p>推荐使用七牛或DaoCloud的镜像。</p>
<h2 id="Go-modules代理"><a href="#Go-modules代理" class="headerlink" title="Go modules代理"></a>Go modules代理</h2><p>现在国内已经有第三方的Go modules代理服务了，比如：</p>
<ol>
<li><a href="https://goproxy.io/zh/" target="_blank" rel="noopener">goproxy.io</a>，是即将毕业的<a href="https://github.com/aofei" target="_blank" rel="noopener">盛奥飞</a>小哥捐给了七牛搭建的Go modules代理服务。</li>
<li><a href="http://mirrors.aliyun.com/goproxy/" target="_blank" rel="noopener">aliyun goproxy</a>，阿里云昨天（大概2019年07月15日）刚开放了Go modules代理服务。</li>
</ol>
<p>fabric使用vendor，下载各种东西的时候需要翻墙，即便是可以翻墙，也是有缺点的：</p>
<ol>
<li>慢。</li>
<li>翻墙有流量限制。</li>
</ol>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://lessisbetter.site/2019/07/13/better-brew/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="大彬">
      <meta itemprop="description" content="区块链、Go语言">
      <meta itemprop="image" content="http://img.lessisbetter.site/gzh-qrcode-logo-small.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Go语言充电站">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/07/13/better-brew/" class="post-title-link" itemprop="url">让Homebrew飞</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-07-13 11:12:17" itemprop="dateCreated datePublished" datetime="2019-07-13T11:12:17+08:00">2019-07-13</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-08-13 16:18:50" itemprop="dateModified" datetime="2019-08-13T16:18:50+08:00">2019-08-13</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Homebrew源"><a href="#Homebrew源" class="headerlink" title="Homebrew源"></a>Homebrew源</h2><p>homebrew默认使用的是Github，虽然已经科学上网了，速度依然是KB级别的，相当的慢。使用国内的源，速度有质的提升，推荐2个国内的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">https://mirrors.cloud.tencent.com/homebrew/brew.git</span><br><span class="line">git://mirrors.ustc.edu.cn/brew.git</span><br></pre></td></tr></table></figure>
<p>腾讯源更多信息见：<a href="https://mirrors.cloud.tencent.com/help/homebrew-bottles.html" target="_blank" rel="noopener">https://mirrors.cloud.tencent.com/help/homebrew-bottles.html</a></p>
<p>建议ping一下以上2个源，选延时小的。</p>
<h2 id="下载和修改安装脚本"><a href="#下载和修改安装脚本" class="headerlink" title="下载和修改安装脚本"></a>下载和修改安装脚本</h2><p>下载官方安装脚本：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install &gt;&gt; brew_install</span><br></pre></td></tr></table></figure>
<p>修改官方脚本，把Github源替换为腾讯源：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/ruby</span><br><span class="line"># This script installs to /usr/local only. To install elsewhere (which is</span><br><span class="line"># unsupported) you can untar https://github.com/Homebrew/brew/tarball/master</span><br><span class="line"># anywhere you like.</span><br><span class="line">HOMEBREW_PREFIX = &quot;/usr/local&quot;.freeze</span><br><span class="line">HOMEBREW_REPOSITORY = &quot;/usr/local/Homebrew&quot;.freeze</span><br><span class="line">HOMEBREW_CORE_TAP = &quot;/usr/local/Homebrew/Library/Taps/homebrew/homebrew-core&quot;.freeze</span><br><span class="line">HOMEBREW_CACHE = &quot;#&#123;ENV[&quot;HOME&quot;]&#125;/Library/Caches/Homebrew&quot;.freeze</span><br><span class="line">BREW_REPO = &quot;https://github.com/Homebrew/brew.git&quot;.freeze</span><br></pre></td></tr></table></figure>
<p>把<code>BREW_REPO = &quot;https://github.com/Homebrew/brew.git&quot;.freeze</code>替换为<code>BREW_REPO = &quot;https://mirrors.cloud.tencent.com/homebrew/brew.git&quot;.freeze</code>。</p>
<h2 id="运行脚本安装"><a href="#运行脚本安装" class="headerlink" title="运行脚本安装"></a>运行脚本安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/ruby ~/brew_install</span><br></pre></td></tr></table></figure>
<p>这个版本的安装脚本已经没有CORE_TAP_REPO了，所以下载homebrew core的时候依然去Github下载，非常慢，可以在brew.git下载完，control-c结束掉。</p>
<p>把仓库<code>https://mirrors.cloud.tencent.com/homebrew/homebrew-core.git</code>克隆到<code>/usr/local/Homebrew/Library/Taps/homebrew/</code>目录，然后再执行上面的安装脚本。</p>
<h2 id="更换brew源"><a href="#更换brew源" class="headerlink" title="更换brew源"></a>更换brew源</h2><p>如果brew已经安装了，直接修改源就行了。</p>
<p>1、替换brew.git和homebrew-core.git的源:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> <span class="string">"<span class="variable">$(brew --repo)</span>"</span></span><br><span class="line">git remote <span class="built_in">set</span>-url origin https://mirrors.cloud.tencent.com/homebrew/brew.git</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> <span class="string">"<span class="variable">$(brew --repo)</span>/Library/Taps/homebrew/homebrew-core"</span></span><br><span class="line">git remote <span class="built_in">set</span>-url origin https://mirrors.cloud.tencent.com/homebrew/homebrew-core.git</span><br></pre></td></tr></table></figure>
<p>2、更新 bottles源</p>
<p>对于bash用户：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">'export HOMEBREW_BOTTLE_DOMAIN=https://mirrors.cloud.tencent.com/homebrew-bottles'</span> &gt;&gt; ~/.bash_profile</span><br><span class="line"><span class="built_in">source</span> ~/.bash_profile</span><br></pre></td></tr></table></figure>
<p>对于zsh用户</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">'export HOMEBREW_BOTTLE_DOMAIN=https://mirrors.cloud.tencent.com/homebrew-bottles'</span> &gt;&gt; ~/.zshrc</span><br><span class="line"><span class="built_in">source</span> ~/.zshrc</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://lessisbetter.site/2019/07/12/do-not-abuse-of-log/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="大彬">
      <meta itemprop="description" content="区块链、Go语言">
      <meta itemprop="image" content="http://img.lessisbetter.site/gzh-qrcode-logo-small.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Go语言充电站">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/07/12/do-not-abuse-of-log/" class="post-title-link" itemprop="url">你滥用log了吗</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-07-12 18:17:24" itemprop="dateCreated datePublished" datetime="2019-07-12T18:17:24+08:00">2019-07-12</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-08-13 16:18:50" itemprop="dateModified" datetime="2019-08-13T16:18:50+08:00">2019-08-13</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>代码Review的时候，遇到过一些log滥用的情况，今天聊一聊滥用（过渡使用）日志。</p>
<blockquote>
<p>好的log能够帮助开发人员快速定位bug，而差的log各有各的不同。</p>
</blockquote>
<h2 id="你滥用日志了吗？"><a href="#你滥用日志了吗？" class="headerlink" title="你滥用日志了吗？"></a>你滥用日志了吗？</h2><p>是什么导致了滥用log？是不是存在这些误解：</p>
<p><strong>1. 害怕出了问题，现有的log无法定位</strong>，要多加一些log，恨不得每段都有一个log，log数简直越多越好，看日志有一种，每一步都非常清晰的错觉。</p>
<p><strong>2. 不知道log多了，定位效率更低</strong>，试问你有没有经历过几分钟刷出了G级别日志文件？在这种日志文件里定位bug，简直是大海捞针，这让log的价值非常低。</p>
<p><strong>3. 不知道log多了会影响性能</strong>，log自身涉及格式化和文件读写，虽然现在各log库都已经比较高效了，但是，这也扛不住“海量”的log啊，积少成多，势必影响程序性能。</p>
<p><strong>4. 对log级别错误的认知</strong>：日志级别设置为Info，Debug、Trace级别的日志不会打印，Debug、Trace级别日志多没关系。虽然日志不会输出，并不代表相关代码没执行啊。</p>
<p>第4点重点解释一下：</p>
<p><img src="http://img.lessisbetter.site/2019-07-debug-demo.png" alt="debug-demo"></p>
<p>这是一个打印Debug级别的日志，它还有1项日志信息，是来自<code>func()</code>的结果，请问：</p>
<ol>
<li>日志级别设置为Info，log.Debug会执行吗？<code>func()</code>还会执行吗？</li>
<li>如果这行日志频繁被执行，是不是浪费了CPU做无用功？</li>
</ol>
<p>如果你认为不会执行，看下面的Demo，log使用zap。</p>
<p><img src="http://img.lessisbetter.site/2019-07-log-test.png" alt="log-test"></p>
<p>结果：</p>
<p><img src="http://img.lessisbetter.site/2019-07-log-ret.png" alt="log-ret"></p>
<p>事实证明无论限制的日志级别是什么，<code>log.***</code>一定会被调用，它入参中的函数也一定会被调用，只不过是日记级别不满足打印时，不会打印而已。被调函数的结果只被这条<code>log.***</code>使用，结果这个日志根本不打印，这就浪费了CPU。</p>
<p>日志级别都设置为Info了，Debug级别的日志为何还会打印？</p>
<p>如果你有这个问题，你可能没有理解2个地方。</p>
<p>日志级别设置为Info，不代表<code>log.Debug</code>函数不执行。<code>log.Debug</code>函数一定会执行，看下图，<code>log.Info，Error</code>等接口会调用相同的真实实现函数<code>log.log</code>，<code>log.log</code>的入参包含了<code>log.Info</code>等接口的入参，以及当前的<code>log_level</code>，比如以下2种是等价的：</p>
<p><img src="http://img.lessisbetter.site/2019-07-log-log.png" alt="log-log"></p>
<p>所以，无论设置的是什么日志级别控制，<code>log.Debug</code>一定会被执行，至于当前日志是否会打印，会在<code>log.log</code>里决定。</p>
<p><img src="http://img.lessisbetter.site/2019-07-log-call.png" alt="image-20190712072742045"></p>
<p>日志为Warn级别，Debug日志不会打印，<code>func()</code>会不会执行？</p>
<p>日志打印本质是函数调用，会先计算入参，再调用函数。比如：</p>
<p><img src="http://img.lessisbetter.site/2019-07-log-debug.png" alt="log-debug"></p>
<p>所以<code>func()</code>一定会被调用。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>针对滥用日志的情况给几点建议：</p>
<ol>
<li>1条日志描述清when、where、what，提供有效信息，这就对定位很有帮助了。</li>
<li>只在“可能”出问题的地方打印日志，一些能根据上下文日志推断的地方，就无需再增加日志。</li>
<li>日志打印不要调用函数。</li>
</ol>
<blockquote>
<ol>
<li>如果这篇文章对你有帮助，不妨关注下我的Github，有文章会收到通知。</li>
<li>本文作者：<a href="http://lessisbetter.site/about/">大彬</a></li>
<li>如果喜欢本文，随意转载，但请保留此原文链接：<a href="http://lessisbetter.site/2019/07/12/do-not-abuse-of-log/">http://lessisbetter.site/2019/07/12/do-not-abuse-of-log/</a></li>
</ol>
</blockquote>
<p><div style="color:#0096FF; text-align:center">关注公众号，获取最新Golang文章</div><br><img src="http://img.lessisbetter.site/2019-01-article_qrcode.jpg" style="border:0" align="center"></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="http://img.lessisbetter.site/gzh-qrcode-logo-small.png"
                alt="大彬" />
            
              <p class="site-author-name" itemprop="name">大彬</p>
              <p class="site-description motion-element" itemprop="description">区块链、Go语言</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives">
                
                    <span class="site-state-item-count">94</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">60</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="http://img.lessisbetter.site/gzh-qrcode-logo-small.png" title="公众号 &rarr; http://img.lessisbetter.site/gzh-qrcode-logo-small.png" rel="noopener" target="_blank"><i class="fa fa-fw fa-wechat"></i>公众号</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/shitaibin" title="GitHub &rarr; https://github.com/shitaibin" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://segmentfault.com/u/lessisbetter" title="SegmentFault &rarr; https://segmentfault.com/u/lessisbetter" rel="noopener" target="_blank"><i class="fa fa-fw fa-crosshairs"></i>SegmentFault</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://www.jianshu.com/u/947f3ccdd481" title="简书 &rarr; https://www.jianshu.com/u/947f3ccdd481" rel="noopener" target="_blank"><i class="fa fa-fw fa-heartbeat"></i>简书</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://stackoverflow.com/users/4296218/james-shi" title="StackOverflow &rarr; https://stackoverflow.com/users/4296218/james-shi" rel="noopener" target="_blank"><i class="fa fa-fw fa-stack-overflow"></i>StackOverflow</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="mailto:hz_stb@163.com" title="E-Mail &rarr; mailto:hz_stb@163.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
            </div>
          

          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                友链
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://xargin.com" title="https://xargin.com" rel="noopener" target="_blank">Xargin曹大博客</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://pingcap.com/blog-cn/" title="https://pingcap.com/blog-cn/" rel="noopener" target="_blank">PingCap技术博客</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://qcrao.github.io/" title="https://qcrao.github.io/" rel="noopener" target="_blank">码农桃花源博客</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://book.eddycjy.com/golang/" title="https://book.eddycjy.com/golang/" rel="noopener" target="_blank">煎鱼的迷之博客</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://dave.cheney.net" title="https://dave.cheney.net" rel="noopener" target="_blank">Dave Cheney的博客</a>
                  </li>
                
              </ul>
            </div>
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">[object Object]</span>

  

  
</div>


  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.7.1</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> v6.6.0</div>




        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv" title="总访客量">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  

  
    <span class="site-pv" title="总访问量">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>









  <div style="display: none;">
    <script src="//s95.cnzz.com/z_stat.php?id=1275814754&web_id=1275814754" language="JavaScript"></script>
  </div>



        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script src="/js/src/utils.js?v=6.6.0"></script>

  <script src="/js/src/motion.js?v=6.6.0"></script>



  
  


  <script src="/js/src/affix.js?v=6.6.0"></script>

  <script src="/js/src/schemes/pisces.js?v=6.6.0"></script>



  

  


  <script src="/js/src/bootstrap.js?v=6.6.0"></script>



  



  











  





  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  

  

  
  

  

  

  

  

  
  <style>
    .copy-btn {
      display: inline-block;
      padding: 6px 12px;
      font-size: 13px;
      font-weight: 700;
      line-height: 20px;
      color: #333;
      white-space: nowrap;
      vertical-align: middle;
      cursor: pointer;
      background-color: #eee;
      background-image: linear-gradient(#fcfcfc, #eee);
      border: 1px solid #d5d5d5;
      border-radius: 3px;
      user-select: none;
      outline: 0;
    }

    .highlight-wrap .copy-btn {
      transition: opacity .3s ease-in-out;
      opacity: 0;
      padding: 2px 6px;
      position: absolute;
      right: 4px;
      top: 8px;
    }

    .highlight-wrap:hover .copy-btn,
    .highlight-wrap .copy-btn:focus {
      opacity: 1
    }

    .highlight-wrap {
      position: relative;
    }
  </style>
  <script>
    $('.highlight').each(function (i, e) {
      var $wrap = $('<div>').addClass('highlight-wrap');
      $(e).after($wrap);
      $wrap.append($('<button>').addClass('copy-btn').append('复制').on('click', function (e) {
        var code = $(this).parent().find('.code').find('.line').map(function (i, e) {
          return $(e).text();
        }).toArray().join('\n');
        var ta = document.createElement('textarea');
        var range = document.createRange(); //For Chrome
        var sel = window.getSelection(); //For Chrome
        var yPosition = window.pageYOffset || document.documentElement.scrollTop;
        ta.style.top = yPosition + 'px'; //Prevent page scroll
        ta.style.position = 'absolute';
        ta.style.opacity = '0';
        ta.value = code;
        ta.textContent = code; //For FireFox
        ta.contentEditable = true;
        ta.readOnly = false;
        document.body.appendChild(ta);
        range.selectNode(ta);
        sel.removeAllRanges();
        sel.addRange(range);
        ta.setSelectionRange(0, code.length);
        var result = document.execCommand('copy');
        
        ta.blur(); //For iOS
        $(this).blur();
      })).on('mouseleave', function (e) {
        var $b = $(this).find('.copy-btn');
        setTimeout(function () {
          $b.text('复制');
        }, 300);
      }).append(e);
    })
  </script>


  

</body>
</html>
